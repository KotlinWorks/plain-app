import{d as Z,p as J,u as ee,n as te,r as d,s as ae,a as se,i as ne,t as oe,G as N,aU as ie,a3 as R,aV as le,aP as ce,aW as re,K as de,L as B,M as ue,N as _e,o as l,c as u,e as n,x as f,y as h,j as c,F as pe,A as ve,g as v,aX as I,l as K,T as me,O as b,R as S,f as z,aY as G,P as fe,al as y,w as m,aZ as he,ap as ye,a_ as Ce,_ as ge}from"./index-df35a132.js";import{g as Q,M as Ae}from"./splitpanes.es-c959884b.js";import{u as Me}from"./markdown-cf6b239f.js";const ke={class:"page-container"},we={class:"main"},Ie={key:0,class:"date"},be={class:"chat-title"},Te={class:"name"},xe={class:"time"},$e={class:"menu-items"},Le=["onClick","headline","disabled"],Ve={key:2,class:"chat-title"},De={class:"name"},He={class:"time"},Ne=["innerHTML"],Re={key:0,class:"chat-item replying"},Be={class:"chat-title"},Ke={class:"name"},Se=["innerHTML"],ze=["placeholder","onKeydown"],Ge={class:"btns"},Qe=["onClick"],Fe=Z({__name:"AIChatView",setup(Pe){const F=J(),{t:P}=ee(),U=te(),r=d(U.params.id),i=d(""),_=d([]),C=d(!1),g=d(""),M=d(""),{app:j,fileIdKey:q}=ae(se()),T=d(),{render:A}=Me(j,q);function k(){return r.value==="create"}function E(e,t){let s=!1;if(t==0)s=!0;else{const o=t>0?_.value[t-1]:null;o!=null&&I(o.createdAt)!==I(e.createdAt)&&(s=!0)}return s}k()||ne({handle:async(e,t)=>{if(t)oe(P(t),"error");else{const s=[];s.push({...e.aiChat,md:await A(e.aiChat.content)});for(const o of e.aiChats)s.push({...o,md:await A(o.content)});_.value=s,await N(),L()}},document:ie,variables:()=>({id:r.value,query:`parent_id:${r.value} sort:created_at-asc`}),appApi:!0});const{mutate:x,onDone:O}=R({document:le,appApi:!0});function $(){!i.value||C.value||x({id:k()?"":r.value,message:i.value,isMe:!0})}O(async e=>{var s;const t=e.data.createAIChat;if(t){for(const p of t)(s=_.value)==null||s.push({...p,md:await A(p.content)});k()&&(r.value=t[0].id,ce(F,`/aichats/${r.value}`)),i.value="",C.value=!C.value,g.value="",M.value='<span class="blinking-cursor"></span>',await N(),L()}});function L(){const e=T.value;e&&(e.scrollTop=e.scrollHeight)}const w=d(""),{mutate:W,loading:X}=R({document:re,options:{update:e=>{var s,o;e.evict({id:e.identify({__typename:"AIChat",id:w.value})});const t=(s=_.value)==null?void 0:s.findIndex(p=>p.id===w.value);t!==null&&((o=_.value)==null||o.splice(t,1))}},appApi:!0});function Y(e){w.value=e,W({ids:[e]})}const V=async e=>{e.parentId===r.value&&(g.value+=e.content,M.value=await A(g.value+'<span class="blinking-cursor"></span>'),e.finishReason==="stop"&&x({id:r.value,message:g.value,isMe:!1}))};return de(()=>{B.on("ai_chat_replied",V)}),ue(()=>{B.off("ai_chat_replied",V)}),(e,t)=>{const s=he,o=ye,p=Ce,D=_e("tooltip");return l(),u("div",ke,[n("div",we,[f(c(Ae),{class:"chat-container",horizontal:""},{default:h(()=>[f(c(Q),{size:"80"},{default:h(()=>[n("div",{class:"chat-items",ref_key:"scrollContainer",ref:T},[(l(!0),u(pe,null,ve(_.value,(a,H)=>(l(),u("div",{key:a.id,class:"chat-item"},[E(a,H)?(l(),u("div",Ie,v(c(I)(a.createdAt)),1)):K("",!0),H>0?(l(),me(o,{key:1},{content:h(()=>[n("div",$e,[n("md-menu-item",{onClick:Ue=>Y(a.id),headline:e.$t("delete_message"),disabled:c(X)},null,8,Le)])]),default:h(()=>[n("div",be,[n("span",Te,v(e.$t(a.isMe?"me":"ai")),1),b((l(),u("span",xe,[z(v(c(G)(a.createdAt)),1)])),[[D,c(S)(a.createdAt)]]),f(s,{class:"bi bi-more"})])]),_:2},1024)):(l(),u("div",Ve,[n("span",De,v(e.$t(a.isMe?"me":"ai")),1),b((l(),u("span",He,[z(v(c(G)(a.createdAt)),1)])),[[D,c(S)(a.createdAt)]])])),n("div",{class:"chat-content md-container",innerHTML:a.md},null,8,Ne)]))),128)),C.value?(l(),u("div",Re,[n("div",Be,[n("span",Ke,v(e.$t("ai")),1)]),n("div",{class:"chat-content md-container",innerHTML:M.value},null,8,Se)])):K("",!0)],512)]),_:1}),f(c(Q),{class:"chat-input",size:"10","min-size":"5"},{default:h(()=>[b(n("md-outlined-text-field",{class:"textarea",type:"textarea","onUpdate:modelValue":t[0]||(t[0]=a=>i.value=a),autocomplete:"off",placeholder:e.$t("chat_input_hint"),onKeydown:[y(m($,["exact","prevent"]),["enter"]),t[1]||(t[1]=y(m(a=>i.value+=`
`,["shift","exact","prevent"]),["enter"])),t[2]||(t[2]=y(m(a=>i.value+=`
`,["ctrl","exact","prevent"]),["enter"])),t[3]||(t[3]=y(m(a=>i.value+=`
`,["alt","exact","prevent"]),["enter"])),t[4]||(t[4]=y(m(a=>i.value+=`
`,["meta","exact","prevent"]),["enter"]))]},null,40,ze),[[fe,i.value]]),n("div",Ge,[n("md-icon-button",{onClick:m($,["stop"])},[f(p)],8,Qe)])]),_:1})]),_:1})])])}}});const Oe=ge(Fe,[["__scopeId","data-v-16fd4492"]]);export{Oe as default};

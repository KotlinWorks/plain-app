import{D as ge,c as ve,u as ke,_ as be,a as ye,b as $e}from"./data-17e9864e.js";import{d as Ce,a as Ae,r as k,u as Te,B as we,p as Ie,C as De,D as Ve,E as qe,G as Se,H as Be,I as Qe,e as o,f as t,x as c,h as s,F as T,J as _,w as u,j as D,t as i,y as Re,A as E,K as Ue,L as Le,M as Me,aZ as Ne,k as ze,b4 as Fe,n as K,O as Z,o as n,P as He,z as Ge,R as j,g as J,S as O,T as Pe,U as Ee,X as b,b5 as W,V as X,a6 as Ke,a7 as Ze,W as je,a8 as Je,Y as Oe,Z as We,$ as Xe}from"./index-71d8bb76.js";import{_ as Ye}from"./Breadcrumb-91ff4b3f.js";import{n as xe}from"./list-6498ebd9.js";import{u as et,a as tt}from"./tags-779e8f21.js";import{t as at}from"./truncate-66113621.js";import"./vee-validate.esm-49ea0aba.js";import"./stringToArray-4eaf66ad.js";const st={class:"v-toolbar"},lt=t("md-ripple",null,null,-1),nt=t("md-ripple",null,null,-1),ot=["onClick"],it={class:"filters"},ct=["label"],dt={class:"form-label"},ut={type:"filter"},rt=["label","selected","onClick"],_t={class:"buttons"},pt=["onClick"],ht={class:"table-responsive"},mt={class:"table"},ft=["checked","indeterminate"],gt=t("th",null,"ID",-1),vt=t("th",null,null,-1),kt=["onClick"],bt=["checked"],yt=["onClick"],$t={class:"nowrap"},Ct={class:"action-btns"},At=["onClick"],Tt=t("md-ripple",null,null,-1),wt=["onClick"],It=t("md-ripple",null,null,-1),Dt={class:"nowrap"},Vt={class:"nowrap"},qt={key:0},St={colspan:"7"},Bt={class:"no-data-placeholder"},y=50,Pt=Ce({__name:"AIChatsView",setup(Qt){var F,H;const V=Ae(),p=k([]),q=k(),{t:Y}=Te(),d=we({text:"",tags:[]}),r=ge.AI_CHAT,S=Ie().query,$=k(parseInt(((F=S.page)==null?void 0:F.toString())??"1")),h=k(De(((H=S.q)==null?void 0:H.toString())??"")),C=k(""),{tags:A}=et(r,h,d,async e=>{e.push({name:"parent_id",op:"",value:""}),C.value=Le(e),await Me(),ne()}),{addToTags:x}=tt(r,p,A),{deleteItems:ee}=ve(Ne,()=>{I()},p),{allChecked:B,realAllChecked:w,selectRealAll:te,allCheckedAlertVisible:ae,clearSelection:Q,toggleAllChecked:R,toggleItemChecked:U,toggleRow:se,total:m,checked:L}=ke(p),{loading:le,load:ne,refetch:I}=Ve({handle:(e,l)=>{l?ze(Y(l),"error"):e&&(p.value=e.aiChats.map(v=>({...v,checked:!1})),m.value=e.aiChatCount)},document:Fe,variables:()=>({offset:($.value-1)*y,limit:y,query:C.value}),appApi:!0});qe($,e=>{K(V,`/aichats?page=${e}&q=${Z(h.value)}`)});function oe(e){d.tags.includes(e)?Pe(d.tags,l=>l.id===e.id):d.tags.push(e)}function ie(){h.value=Ee(d),M(),q.value.dismiss()}function M(){K(V,`/aichats?q=${Z(h.value)}`)}const N=e=>{e.type===r&&(Q(),I())},z=e=>{e.type===r&&I()};Se(()=>{b.on("item_tags_updated",z),b.on("items_tags_updated",N)}),Be(()=>{b.off("item_tags_updated",z),b.off("items_tags_updated",N)});function ce(e){W(`/aichats/${e.id}`)}function de(){W("/aichats/create")}function ue(e){X(Ze,{id:e.id,name:e.id,gql:Ke`
      mutation DeleteAIChat($query: String!) {
        deleteAIChats(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),appApi:!0,typeName:"AIChat",done:()=>{m.value--,e.tags.length&&b.emit("refetch_tags",r)}})}function re(e){X(je,{type:r,tags:A.value,item:{key:e.id,title:"",size:0},selected:A.value.filter(l=>e.tags.some(v=>v.id===l.id))})}return(e,l)=>{const v=Ye,G=Je,P=Oe,_e=be,pe=ye,he=We,me=Xe,fe=$e,f=Qe("tooltip");return n(),o(T,null,[t("div",st,[c(v,{current:()=>`${e.$t("page_title.aichats")} (${s(m)})`},null,8,["current"]),s(L)?(n(),o(T,{key:0},[_((n(),o("button",{class:"icon-button",onClick:l[0]||(l[0]=u(a=>s(ee)(s(w),C.value),["stop"]))},[lt,c(G)])),[[f,e.$t("delete")]]),_((n(),o("button",{class:"icon-button",onClick:l[1]||(l[1]=u(a=>s(x)(s(w),C.value),["stop"]))},[nt,c(P)])),[[f,e.$t("add_to_tags")]])],64)):D("",!0),t("md-outlined-button",{onClick:u(de,["prevent"])},i(e.$t("new_chat")),9,ot),c(_e,{ref_key:"searchInputRef",ref:q,modelValue:h.value,"onUpdate:modelValue":l[3]||(l[3]=a=>h.value=a),search:M},{filters:Re(()=>[t("div",it,[_(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":l[2]||(l[2]=a=>d.text=a),"keyup.enter":"applyAndDoSearch"},null,8,ct),[[He,d.text]]),t("label",dt,i(e.$t("tags")),1),t("md-chip-set",ut,[(n(!0),o(T,null,E(s(A),a=>(n(),o("md-filter-chip",{key:a.id,label:a.name,selected:d.tags.includes(a),onClick:g=>oe(a)},null,8,rt))),128))]),t("div",_t,[t("md-filled-button",{onClick:u(ie,["stop"])},i(e.$t("search")),9,pt)])])]),_:1},8,["modelValue"])]),c(pe,{limit:y,total:s(m),"all-checked-alert-visible":s(ae),"real-all-checked":s(w),"select-real-all":s(te),"clear-selection":s(Q)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",ht,[t("table",mt,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[4]||(l[4]=(...a)=>s(R)&&s(R)(...a)),checked:s(B),indeterminate:!s(B)&&s(L)},null,40,ft)]),gt,t("th",null,i(e.$t("content")),1),vt,t("th",null,i(e.$t("tags")),1),t("th",null,i(e.$t("updated_at")),1),t("th",null,i(e.$t("created_at")),1)])]),t("tbody",null,[(n(!0),o(T,null,E(p.value,a=>(n(),o("tr",{key:a.id,class:Ge({selected:a.checked}),onClick:u(g=>s(se)(a),["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[5]||(l[5]=(...g)=>s(U)&&s(U)(...g)),checked:a.checked},null,40,bt)]),t("td",null,[c(he,{id:a.id,raw:a},null,8,["id","raw"])]),t("td",null,[t("a",{href:"#",onClick:u(g=>ce(a),["prevent"])},i(s(at)(a.content,{length:200,omission:""})),9,yt)]),t("td",$t,[t("div",Ct,[_((n(),o("button",{class:"icon-button",onClick:u(g=>ue(a),["stop"])},[Tt,c(G)],8,At)),[[f,e.$t("delete")]]),_((n(),o("button",{class:"icon-button",onClick:u(g=>re(a),["stop"])},[It,c(P)],8,wt)),[[f,e.$t("add_to_tags")]])])]),t("td",null,[c(me,{tags:a.tags,type:s(r)},null,8,["tags","type"])]),t("td",Dt,[_((n(),o("span",null,[J(i(s(O)(a.updatedAt)),1)])),[[f,s(j)(a.updatedAt)]])]),t("td",Vt,[_((n(),o("span",null,[J(i(s(O)(a.updatedAt)),1)])),[[f,s(j)(a.createdAt)]])])],10,kt))),128))]),p.value.length?D("",!0):(n(),o("tfoot",qt,[t("tr",null,[t("td",St,[t("div",Bt,i(e.$t(s(xe)(s(le)))),1)])])]))])]),s(m)>y?(n(),Ue(fe,{key:0,modelValue:$.value,"onUpdate:modelValue":l[6]||(l[6]=a=>$.value=a),total:s(m),limit:y},null,8,["modelValue","total"])):D("",!0)],64)}}});export{Pt as default};

import{b as de,u as ue,_ as re,a as _e}from"./list-3f4b71c4.js";import{d as pe,p as he,r as m,u as me,C as fe,n as ge,D as ve,E as ke,G as be,b1 as ye,H as $e,t as Ce,b2 as Ae,J as Te,K as we,L as A,M as Ie,N as De,o as n,c as l,e as t,x as d,j as o,F as $,O as r,w as u,l as T,g as c,y as Ve,P as Se,A as R,z as qe,R as G,f as H,S as P,T as Be,B as E,U as K,V as Me,W as Ne,b3 as j,X as J,a7 as Qe,a8 as Le,Y as Ue,a9 as ze,Z as Fe,$ as Re,a0 as Ge}from"./index-df35a132.js";import{_ as He}from"./Breadcrumb-120bdd32.js";import{n as Pe}from"./list-6498ebd9.js";import{u as Ee,a as Ke}from"./tags-ecacebdb.js";import{t as je}from"./truncate-cc7a2700.js";import"./vee-validate.esm-aa1410cb.js";import"./stringToArray-a8dcbce9.js";const Je={class:"v-toolbar"},Oe=["onClick"],We={class:"filters"},Xe=["label"],Ye={class:"form-label"},Ze={type:"filter"},xe=["label","selected","onClick"],et={class:"buttons"},tt=["onClick"],st={class:"table-responsive"},at={class:"table"},ot=["checked"],nt=t("th",null,"ID",-1),lt=t("th",null,null,-1),ct=["onClick"],it=["checked"],dt=["onClick"],ut={class:"nowrap"},rt={class:"action-btns"},_t=["onClick"],pt=["onClick"],ht={class:"nowrap"},mt={class:"nowrap"},ft={key:0},gt={colspan:"7"},vt={class:"no-data-placeholder"},f="AI_CHAT",C=50,Vt=pe({__name:"AIChatsView",setup(kt){var L,U;const w=he(),_=m([]),I=m(),{t:O}=me(),i=fe({text:"",tags:[]}),D=ge().query,v=m(parseInt(((L=D.page)==null?void 0:L.toString())??"1")),k=m(0),p=m(ve(((U=D.q)==null?void 0:U.toString())??"")),V=m(""),{tags:b}=Ee(f,p,i,async e=>{e.push({name:"parent_id",op:"",value:""}),V.value=ke(e),await be(),Z()}),{addToTags:S}=Ke(f,_,b),{deleteItems:q}=de(ye,()=>{M()},_),{selectAll:W,toggleSelect:B,checked:X}=ue(_),{loading:Y,load:Z,refetch:M}=$e({handle:(e,a)=>{a?Ce(O(a),"error"):e&&(_.value=e.aiChats.map(g=>({...g,checked:!1})),k.value=e.aiChatCount)},document:Ae,variables:()=>({offset:(v.value-1)*C,limit:C,query:V.value}),appApi:!0});Te(v,e=>{E(w,`/aichats?page=${e}&q=${K(p.value)}`)});function x(e){i.tags.includes(e)?Me(i.tags,a=>a.id===e.id):i.tags.push(e)}function ee(){p.value=Ne(i),N(),I.value.dismiss()}function N(){E(w,`/aichats?q=${K(p.value)}`)}const Q=e=>{e===f&&M()};we(()=>{A.on("refetch_by_tag_type",Q)}),Ie(()=>{A.off("refetch_by_tag_type",Q)});function te(e){j(`/aichats/${e.id}`)}function se(){j("/aichats/create")}function ae(e){J(Le,{id:e.id,name:e.id,gql:Qe`
      mutation DeleteAIChat($id: ID!) {
        deleteAIChats(ids: [$id])
      }
    `,appApi:!0,typeName:"AIChat",done:()=>{e.tags.length&&A.emit("refetch_tags",f)}})}function oe(e){J(Ue,{tagType:f,tags:b.value,item:{key:e.id,title:"",size:0},selected:b.value.filter(a=>e.tags.some(g=>g.id===a.id))})}return(e,a)=>{const g=He,z=ze,F=Fe,ne=re,le=Re,ce=Ge,ie=_e,h=De("tooltip");return n(),l($,null,[t("div",Je,[d(g,{current:()=>`${e.$t("page_title.aichats")} (${k.value})`},null,8,["current"]),o(X)?(n(),l($,{key:0},[r((n(),l("md-icon-button",{onClick:a[0]||(a[0]=u((...s)=>o(q)&&o(q)(...s),["stop"]))},[d(z)])),[[h,e.$t("delete")]]),r((n(),l("md-icon-button",{onClick:a[1]||(a[1]=u((...s)=>o(S)&&o(S)(...s),["stop"]))},[d(F)])),[[h,e.$t("add_to_tags")]])],64)):T("",!0),t("md-outlined-button",{onClick:u(se,["prevent"])},c(e.$t("new_chat")),9,Oe),d(ne,{ref_key:"searchInputRef",ref:I,modelValue:p.value,"onUpdate:modelValue":a[3]||(a[3]=s=>p.value=s),search:N},{filters:Ve(()=>[t("div",We,[r(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":a[2]||(a[2]=s=>i.text=s),"keyup.enter":"applyAndDoSearch"},null,8,Xe),[[Se,i.text]]),t("label",Ye,c(e.$t("tags")),1),t("md-chip-set",Ze,[(n(!0),l($,null,R(o(b),s=>(n(),l("md-filter-chip",{key:s.id,label:s.name,selected:i.tags.includes(s),onClick:y=>x(s)},null,8,xe))),128))]),t("div",et,[t("md-filled-button",{onClick:u(ee,["stop"])},c(e.$t("search")),9,tt)])])]),_:1},8,["modelValue"])]),t("div",st,[t("table",at,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:a[4]||(a[4]=(...s)=>o(B)&&o(B)(...s)),checked:o(W)},null,40,ot)]),nt,t("th",null,c(e.$t("content")),1),lt,t("th",null,c(e.$t("tags")),1),t("th",null,c(e.$t("updated_at")),1),t("th",null,c(e.$t("created_at")),1)])]),t("tbody",null,[(n(!0),l($,null,R(_.value,s=>(n(),l("tr",{key:s.id,class:qe({selected:s.checked}),onClick:u(y=>s.checked=!s.checked,["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",checked:s.checked},null,8,it)]),t("td",null,[d(le,{id:s.id,raw:s},null,8,["id","raw"])]),t("td",null,[t("a",{href:"#",onClick:u(y=>te(s),["prevent"])},c(o(je)(s.content,{length:200,omission:""})),9,dt)]),t("td",ut,[t("div",rt,[r((n(),l("md-icon-button",{onClick:u(y=>ae(s),["stop"])},[d(z)],8,_t)),[[h,e.$t("delete")]]),r((n(),l("md-icon-button",{onClick:u(y=>oe(s),["stop"])},[d(F)],8,pt)),[[h,e.$t("add_to_tags")]])])]),t("td",null,[d(ce,{tags:s.tags,tagType:f},null,8,["tags"])]),t("td",ht,[r((n(),l("span",null,[H(c(o(P)(s.updatedAt)),1)])),[[h,o(G)(s.updatedAt)]])]),t("td",mt,[r((n(),l("span",null,[H(c(o(P)(s.updatedAt)),1)])),[[h,o(G)(s.createdAt)]])])],10,ct))),128))]),_.value.length?T("",!0):(n(),l("tfoot",ft,[t("tr",null,[t("td",gt,[t("div",vt,c(e.$t(o(Pe)(o(Y)))),1)])])]))])]),k.value>C?(n(),Be(ie,{key:0,modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=s=>v.value=s),total:k.value,limit:C},null,8,["modelValue","total"])):T("",!0)],64)}}});export{Vt as default};

import{D as fe,c as ge,u as ve,_ as ke,a as be,b as ye}from"./list-052a81ba.js";import{d as $e,a as Ce,r as k,u as Ae,B as Te,p as we,C as Ie,D as De,E as Ve,aY as qe,G as Se,t as Be,b3 as Qe,I as Ne,J as Ue,K as Le,L as Me,o as n,e as o,f as t,x as c,k as s,F as T,M as _,w as u,m as D,j as i,y as Re,N as ze,A as E,z as Fe,P as K,g as Y,Q as j,R as Ge,n as J,S as W,T as He,U as Pe,b4 as X,V as Z,a6 as Ee,$ as b,a7 as Ke,W as Ye,a8 as je,X as Je,Y as We,Z as Xe}from"./index-5e3ce573.js";import{_ as Ze}from"./Breadcrumb-db3f2c63.js";import{n as Oe}from"./list-6498ebd9.js";import{u as xe,a as et}from"./tags-25ba5c36.js";import{t as tt}from"./truncate-9ec3b65e.js";import"./vee-validate.esm-e8a787ff.js";import"./stringToArray-ca618d4a.js";const at={class:"v-toolbar"},st=t("md-ripple",null,null,-1),lt=t("md-ripple",null,null,-1),nt=["onClick"],ot={class:"filters"},it=["label"],ct={class:"form-label"},dt={type:"filter"},ut=["label","selected","onClick"],rt={class:"buttons"},_t=["onClick"],pt={class:"table-responsive"},ht={class:"table"},mt=["checked","indeterminate"],ft=t("th",null,"ID",-1),gt=t("th",null,null,-1),vt=["onClick"],kt=["checked"],bt=["onClick"],yt={class:"nowrap"},$t={class:"action-btns"},Ct=["onClick"],At=t("md-ripple",null,null,-1),Tt=["onClick"],wt=t("md-ripple",null,null,-1),It={class:"nowrap"},Dt={class:"nowrap"},Vt={key:0},qt={colspan:"7"},St={class:"no-data-placeholder"},y=50,Ht=$e({__name:"AIChatsView",setup(Bt){var F,G;const V=Ce(),p=k([]),q=k(),{t:O}=Ae(),d=Te({text:"",tags:[]}),r=fe.AI_CHAT,S=we().query,$=k(parseInt(((F=S.page)==null?void 0:F.toString())??"1")),h=k(Ie(((G=S.q)==null?void 0:G.toString())??"")),C=k(""),{tags:A}=xe(r,h,d,async e=>{e.push({name:"parent_id",op:"",value:""}),C.value=De(e),await Ve(),le()}),{addToTags:x}=et(r,p,A),{deleteItems:ee}=ge(qe,()=>{I()},p),{allChecked:B,realAllChecked:w,selectRealAll:te,allCheckedAlertVisible:ae,clearSelection:Q,toggleAllChecked:N,toggleItemChecked:U,total:m,checked:L}=ve(p),{loading:se,load:le,refetch:I}=Se({handle:(e,l)=>{l?Be(O(l),"error"):e&&(p.value=e.aiChats.map(v=>({...v,checked:!1})),m.value=e.aiChatCount)},document:Qe,variables:()=>({offset:($.value-1)*y,limit:y,query:C.value}),appApi:!0});Ne($,e=>{J(V,`/aichats?page=${e}&q=${W(h.value)}`)});function ne(e){d.tags.includes(e)?He(d.tags,l=>l.id===e.id):d.tags.push(e)}function oe(){h.value=Pe(d),M(),q.value.dismiss()}function M(){J(V,`/aichats?q=${W(h.value)}`)}const R=e=>{e.type===r&&(Q(),I())},z=e=>{e.type===r&&I()};Ue(()=>{b.on("item_tags_updated",z),b.on("items_tags_updated",R)}),Le(()=>{b.off("item_tags_updated",z),b.off("items_tags_updated",R)});function ie(e){X(`/aichats/${e.id}`)}function ce(){X("/aichats/create")}function de(e){Z(Ke,{id:e.id,name:e.id,gql:Ee`
      mutation DeleteAIChat($query: String!) {
        deleteAIChats(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),appApi:!0,typeName:"AIChat",done:()=>{m.value--,e.tags.length&&b.emit("refetch_tags",r)}})}function ue(e){Z(Ye,{type:r,tags:A.value,item:{key:e.id,title:"",size:0},selected:A.value.filter(l=>e.tags.some(v=>v.id===l.id))})}return(e,l)=>{const v=Ze,H=je,P=Je,re=ke,_e=be,pe=We,he=Xe,me=ye,f=Me("tooltip");return n(),o(T,null,[t("div",at,[c(v,{current:()=>`${e.$t("page_title.aichats")} (${s(m)})`},null,8,["current"]),s(L)?(n(),o(T,{key:0},[_((n(),o("button",{class:"icon-button",onClick:l[0]||(l[0]=u(a=>s(ee)(s(w),C.value),["stop"]))},[st,c(H)])),[[f,e.$t("delete")]]),_((n(),o("button",{class:"icon-button",onClick:l[1]||(l[1]=u(a=>s(x)(s(w),C.value),["stop"]))},[lt,c(P)])),[[f,e.$t("add_to_tags")]])],64)):D("",!0),t("md-outlined-button",{onClick:u(ce,["prevent"])},i(e.$t("new_chat")),9,nt),c(re,{ref_key:"searchInputRef",ref:q,modelValue:h.value,"onUpdate:modelValue":l[3]||(l[3]=a=>h.value=a),search:M},{filters:Re(()=>[t("div",ot,[_(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":l[2]||(l[2]=a=>d.text=a),"keyup.enter":"applyAndDoSearch"},null,8,it),[[ze,d.text]]),t("label",ct,i(e.$t("tags")),1),t("md-chip-set",dt,[(n(!0),o(T,null,E(s(A),a=>(n(),o("md-filter-chip",{key:a.id,label:a.name,selected:d.tags.includes(a),onClick:g=>ne(a)},null,8,ut))),128))]),t("div",rt,[t("md-filled-button",{onClick:u(oe,["stop"])},i(e.$t("search")),9,_t)])])]),_:1},8,["modelValue"])]),c(_e,{limit:y,total:s(m),"all-checked-alert-visible":s(ae),"real-all-checked":s(w),"select-real-all":s(te),"clear-selection":s(Q)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",pt,[t("table",ht,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[4]||(l[4]=(...a)=>s(N)&&s(N)(...a)),checked:s(B),indeterminate:!s(B)&&s(L)},null,40,mt)]),ft,t("th",null,i(e.$t("content")),1),gt,t("th",null,i(e.$t("tags")),1),t("th",null,i(e.$t("updated_at")),1),t("th",null,i(e.$t("created_at")),1)])]),t("tbody",null,[(n(!0),o(T,null,E(p.value,a=>(n(),o("tr",{key:a.id,class:Fe({selected:a.checked}),onClick:u(g=>a.checked=!a.checked,["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[5]||(l[5]=(...g)=>s(U)&&s(U)(...g)),checked:a.checked},null,40,kt)]),t("td",null,[c(pe,{id:a.id,raw:a},null,8,["id","raw"])]),t("td",null,[t("a",{href:"#",onClick:u(g=>ie(a),["prevent"])},i(s(tt)(a.content,{length:200,omission:""})),9,bt)]),t("td",yt,[t("div",$t,[_((n(),o("button",{class:"icon-button",onClick:u(g=>de(a),["stop"])},[At,c(H)],8,Ct)),[[f,e.$t("delete")]]),_((n(),o("button",{class:"icon-button",onClick:u(g=>ue(a),["stop"])},[wt,c(P)],8,Tt)),[[f,e.$t("add_to_tags")]])])]),t("td",null,[c(he,{tags:a.tags,type:s(r)},null,8,["tags","type"])]),t("td",It,[_((n(),o("span",null,[Y(i(s(j)(a.updatedAt)),1)])),[[f,s(K)(a.updatedAt)]])]),t("td",Dt,[_((n(),o("span",null,[Y(i(s(j)(a.updatedAt)),1)])),[[f,s(K)(a.createdAt)]])])],10,vt))),128))]),p.value.length?D("",!0):(n(),o("tfoot",Vt,[t("tr",null,[t("td",qt,[t("div",St,i(e.$t(s(Oe)(s(se)))),1)])])]))])]),s(m)>y?(n(),Ge(me,{key:0,modelValue:$.value,"onUpdate:modelValue":l[6]||(l[6]=a=>$.value=a),total:s(m),limit:y},null,8,["modelValue","total"])):D("",!0)],64)}}});export{Ht as default};

import{u as ye,D as $e,_ as be,a as Ce,b as we}from"./data-17e9864e.js";import{d as Ae,a9 as De,a as Se,r as k,u as Ie,s as Ve,c as Te,B as qe,aa as Be,p as Le,C as Qe,ab as Ue,L as J,i as ze,E as Fe,a0 as Pe,D as Re,G as Ge,H as Me,I as Ke,e as i,f as t,x as u,h as a,J as r,w as f,j as V,g as T,t as n,y as Ne,F as O,A as xe,K as Ee,k as He,ac as je,n as A,O as D,ad as Je,ae as Oe,o,P as Xe,z as Ze,m as We,R as X,S as Z,af as Ye,X as W,ag as et,Z as tt,a8 as st}from"./index-71d8bb76.js";import{_ as at}from"./Breadcrumb-91ff4b3f.js";import{n as lt}from"./list-6498ebd9.js";function nt(S,I){const g=S.findIndex(y=>y.id===I);g!==-1&&S.splice(g,1)}const ot={class:"v-toolbar"},it=t("md-ripple",null,null,-1),ct=["onClick"],dt=t("md-ripple",null,null,-1),ut={class:"filters"},rt={class:"form-row"},pt=["label"],_t={class:"buttons"},ht=["onClick"],ft={class:"table-responsive"},mt={class:"table"},kt=["checked","indeterminate"],vt=t("th",null,null,-1),gt=["onClick"],yt=["checked"],$t={class:"v-center"},bt={class:"nowrap"},Ct={class:"action-btns"},wt={key:0,indeterminate:"",class:"spinner-sm"},At=["onClick"],Dt=t("md-ripple",null,null,-1),St=["onClick"],It=t("md-ripple",null,null,-1),Vt={class:"nowrap"},Tt={class:"nowrap"},qt={class:"nowrap"},Bt={class:"nowrap"},Lt={key:0},Qt={colspan:"7"},Ut={class:"no-data-placeholder"},v=50,Gt=Ae({__name:"AppsView",setup(S){var E,H;const{input:I,upload:g,uploadChanged:y}=De(),$=Se(),c=k([]),q=k(),{t:Y}=Ie(),{app:ee,urlTokenKey:B}=Ve(Te()),b=qe({text:"",tags:[]}),{allChecked:L,realAllChecked:Q,selectRealAll:te,allCheckedAlertVisible:se,clearSelection:U,toggleAllChecked:z,toggleItemChecked:F,toggleRow:ae,total:m,checked:P}=ye(c),{downloadItems:le}=Be(B,$e.PACKAGE,c,U,"apps.zip"),{downloadFile:ne}=Ye(B),R=Le(),G=R.query,C=k(parseInt(((E=G.page)==null?void 0:E.toString())??"1")),d=k(Qe(((H=G.q)==null?void 0:H.toString())??"")),M=Ue(d.value),p=R.params.type;p&&M.push({name:"type",op:"",value:p});const K=k(J(M)),oe=()=>{g(ee.value.downloadsDir)},{loading:ie}=ze({handle:(e,l)=>{l?He(Y(l),"error"):e&&(c.value=e.packages.map(_=>({..._,checked:!1})),m.value=e.packageCount)},document:je,variables:()=>({offset:(C.value-1)*v,limit:v,query:K.value}),appApi:!0});Fe(C,e=>{p?A($,`/apps/${p}?page=${e}&q=${D(d.value)}`):A($,`/apps?page=${e}&q=${D(d.value)}`)});function ce(){const e=[];b.text&&e.push({name:"text",op:"",value:b.text}),d.value=J(e),N(),q.value.dismiss()}function N(){p?A($,`/apps/${p}?q=${D(d.value)}`):A($,`/apps?q=${D(d.value)}`)}const{mutate:de,onDone:ue}=Pe({document:Je,appApi:!0});function re(e){ue(()=>{e.isUninstalling=!0}),de({id:e.id})}const{loading:pe,load:_e,refetch:he}=Re({handle:(e,l)=>{if(e)for(const _ of e.packageStatuses)_.exist||nt(c.value,_.id)},document:Oe,variables:()=>({ids:c.value.filter(e=>e.isUninstalling).map(e=>e.id)}),appApi:!0}),x=e=>{e.status};return Ge(()=>{W.on("upload_task_done",x);let e=!0;setInterval(()=>{c.value.some(l=>l.isUninstalling)&&!pe.value&&(e?(_e(),e=!1):he())},1e3)}),Me(()=>{W.off("upload_task_done",x)}),(e,l)=>{const _=at,j=et,fe=be,me=Ce,ke=tt,ve=st,ge=we,h=Ke("tooltip");return o(),i(O,null,[t("div",ot,[u(_,{current:()=>`${e.$t("page_title.apps")} (${a(m)})`},null,8,["current"]),a(P)?r((o(),i("button",{key:0,class:"icon-button",onClick:l[0]||(l[0]=f(s=>a(le)(a(Q),K.value),["stop"]))},[it,u(j)])),[[h,e.$t("download")]]):V("",!0),t("button",{class:"icon-button",onClick:f(oe,["stop"]),style:{display:"none"}},[dt,T(" "+n(e.$t("install")),1)],8,ct),u(fe,{ref_key:"searchInputRef",ref:q,modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=s=>d.value=s),search:N},{filters:Ne(()=>[t("div",ut,[t("div",rt,[r(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":l[1]||(l[1]=s=>b.text=s),"keyup.enter":"applyAndDoSearch"},null,8,pt),[[Xe,b.text]])]),t("div",_t,[t("md-filled-button",{onClick:f(ce,["stop"])},n(e.$t("search")),9,ht)])])]),_:1},8,["modelValue"])]),u(me,{limit:v,total:a(m),"all-checked-alert-visible":a(se),"real-all-checked":a(Q),"select-real-all":a(te),"clear-selection":a(U)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",ft,[t("table",mt,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[3]||(l[3]=(...s)=>a(z)&&a(z)(...s)),checked:a(L),indeterminate:!a(L)&&a(P)},null,40,kt)]),t("th",null,n(e.$t("name")),1),vt,t("th",null,n(e.$t("size")),1),t("th",null,n(e.$t("type")),1),t("th",null,n(e.$t("installed_at")),1),t("th",null,n(e.$t("updated_at")),1)])]),t("tbody",null,[(o(!0),i(O,null,xe(c.value,s=>(o(),i("tr",{key:s.id,class:Ze({selected:s.checked}),onClick:f(w=>a(ae)(s),["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[4]||(l[4]=(...w)=>a(F)&&a(F)(...w)),checked:s.checked},null,40,yt)]),t("td",null,[t("strong",$t,n(s.name)+" ("+n(s.version)+")",1),u(ke,{id:s.id,raw:s},null,8,["id","raw"])]),t("td",bt,[t("div",Ct,[s.isUninstalling?r((o(),i("md-circular-progress",wt,null,512)),[[h,e.$t("uninstalling")]]):r((o(),i("button",{key:1,class:"icon-button",onClick:f(w=>re(s),["stop"])},[Dt,u(ve)],8,At)),[[h,e.$t("uninstall")]]),r((o(),i("button",{class:"icon-button",onClick:f(w=>a(ne)(s.path,`${s.name.replace(" ","")}-${s.id}.apk`),["stop"])},[It,u(j)],8,St)),[[h,e.$t("download")]])])]),t("td",Vt,n(a(We)(s.size)),1),t("td",Tt,n(e.$t("app_type."+s.type)),1),t("td",qt,[r((o(),i("span",null,[T(n(a(Z)(s.installedAt)),1)])),[[h,a(X)(s.installedAt)]])]),t("td",Bt,[r((o(),i("span",null,[T(n(a(Z)(s.updatedAt)),1)])),[[h,a(X)(s.updatedAt)]])])],10,gt))),128))]),c.value.length?V("",!0):(o(),i("tfoot",Lt,[t("tr",null,[t("td",Qt,[t("div",Ut,n(e.$t(a(lt)(a(ie)))),1)])])]))])]),a(m)>v?(o(),Ee(ge,{key:0,modelValue:C.value,"onUpdate:modelValue":l[5]||(l[5]=s=>C.value=s),total:a(m),limit:v},null,8,["modelValue","total"])):V("",!0),t("input",{ref_key:"fileInput",ref:I,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:l[6]||(l[6]=(...s)=>a(y)&&a(y)(...s))},null,544)],64)}}});export{Gt as default};

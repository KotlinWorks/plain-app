import{u as ie,_ as ue,a as ce}from"./list-99d4982b.js";import{_ as de}from"./FieldId-e37ba71f.js";import{_ as pe}from"./download-rounded-19708eb3.js";import{_ as re}from"./Breadcrumb-731a6814.js";import{d as _e,a2 as fe,p as he,r as f,u as me,s as ve,a as ke,B as ye,G as ge,a3 as be,n as $e,C as we,a4 as Ce,D as K,i as Se,t as Ve,a5 as Ae,J as Ie,Y as De,a6 as Ue,H as qe,a7 as Qe,K as Be,L as Le,o as u,c as d,b as t,e as h,g as o,w as _,k as I,f as n,x as Me,M as D,N as Te,O as ze,P as N,Q as Fe,F as G,z as Pe,y as xe,j as Ke,l as Ne,R,S as j,T as Ge,a8 as Re,A as C,U as S,a9 as je,aa as Ee,_ as He}from"./index-66bea2e9.js";import{n as Je}from"./list-6498ebd9.js";import"./VModal.vuevuetypescriptsetuptruelang-091ab08d.js";function Oe(c,V){const m=c.findIndex(v=>v.id===V);m!==-1&&c.splice(m,1)}const Ye=c=>(je("data-v-5ba739a6"),c=c(),Ee(),c),We={class:"v-toolbar"},Xe={class:"right-actions"},Ze=["title"],et=["onClick"],tt={class:"row mb-3"},st={class:"col-md-3 col-form-label"},at={class:"col-md-9"},nt=["onKeyup"],ot={class:"actions"},lt=["onClick"],it={class:"table"},ut={class:"actions"},ct=["onClick"],dt=["onUpdate:modelValue"],pt=Ye(()=>t("br",null,null,-1)),rt={class:"nowrap"},_t=["title"],ft=["title"],ht={class:"actions one"},mt={key:0},vt=["onClick"],kt={key:0},yt={colspan:"8"},gt={class:"no-data-placeholder"},bt=_e({__name:"AppsView",setup(c){var F,P;const{input:V,upload:m,uploadChanged:v}=fe(),k=he(),l=f([]),{t:E}=me(),{app:U}=ve(ke()),y=ye({text:"",tags:[]}),H=ge(()=>l.value.some(e=>e.checked)),{downloadItems:q}=be(l,"apps.zip"),{downloadFile:J}=Re(U),Q=$e(),B=Q.query,g=f(parseInt(((F=B.page)==null?void 0:F.toString())??"1")),b=50,$=f(0),i=f(we(((P=B.q)==null?void 0:P.toString())??"")),L=Ce(i.value),p=Q.params.type;p&&L.push({name:"type",op:"",value:p});const O=f(K(L)),Y=()=>{m(U.value.downloadsDir)},{selectAll:A,toggleSelect:M}=ie(l),{loading:W}=Se({handle:(e,a)=>{a?Ve(E(a),"error"):e&&(l.value=e.packages.map(r=>({...r,checked:!1})),$.value=e.packageCount)},document:Ae,variables:()=>({offset:(g.value-1)*b,limit:b,query:O.value}),appApi:!0});Ie(g,e=>{p?C(k,`/apps/${p}?page=${e}&q=${S(i.value)}`):C(k,`/apps?page=${e}&q=${S(i.value)}`)});function T(){const e=[];y.text&&e.push({name:"text",op:"",value:y.text}),i.value=K(e),z()}function z(){p?C(k,`/apps/${p}?q=${S(i.value)}`):C(k,`/apps?q=${S(i.value)}`)}const{mutate:X,onDone:Z}=De({document:Ue,appApi:!0});function ee(e){Z(()=>{e.isUninstalling=!0}),X({id:e.id})}const{loading:te,load:se,refetch:ae}=qe({handle:(e,a)=>{if(e)for(const r of e.packageStatuses)r.exist||Oe(l.value,r.id)},document:Qe,variables:()=>({ids:l.value.filter(e=>e.isUninstalling).map(e=>e.id)}),appApi:!0});return Be(()=>{Le.on("upload_task_done",a=>{a.status});let e=!0;setInterval(()=>{l.value.some(a=>a.isUninstalling)&&!te.value&&(e?(se(),e=!1):ae())},1e3)}),(e,a)=>{const r=re,x=pe,ne=ue,oe=de,le=ce;return u(),d(G,null,[t("div",We,[h(r,{current:()=>`${e.$t("page_title.apps")} (${$.value})`},null,8,["current"]),t("div",Xe,[o(H)?(u(),d("button",{key:0,type:"button",class:"btn btn-action",onClick:a[0]||(a[0]=_((...s)=>o(q)&&o(q)(...s),["stop"])),title:e.$t("download")},[h(x,{class:"bi"})],8,Ze)):I("",!0),t("button",{type:"button",class:"btn btn-action",onClick:_(Y,["stop"]),style:{display:"none"}},n(e.$t("install")),9,et),h(ne,{modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=s=>i.value=s),search:z},{filters:Me(()=>[t("div",tt,[t("label",st,n(e.$t("keywords")),1),t("div",at,[D(t("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=s=>y.text=s),class:"form-control",onKeyup:ze(T,["enter"])},null,40,nt),[[Te,y.text]])])]),t("div",ot,[t("button",{type:"button",class:"btn",onClick:_(T,["stop"])},n(e.$t("search")),9,lt)])]),_:1},8,["modelValue"])])]),t("table",it,[t("thead",null,[t("tr",null,[t("th",null,[D(t("input",{class:"form-check-input",type:"checkbox",onChange:a[3]||(a[3]=(...s)=>o(M)&&o(M)(...s)),"onUpdate:modelValue":a[4]||(a[4]=s=>Fe(A)?A.value=s:null)},null,544),[[N,o(A)]])]),t("th",null,n(e.$t("name")),1),t("th",null,n(e.$t("version")),1),t("th",null,n(e.$t("size")),1),t("th",null,n(e.$t("type")),1),t("th",null,n(e.$t("installed_at")),1),t("th",null,n(e.$t("updated_at")),1),t("th",ut,n(e.$t("actions")),1)])]),t("tbody",null,[(u(!0),d(G,null,Pe(l.value,s=>(u(),d("tr",{key:s.id,class:xe({checked:s.checked}),onClick:_(w=>s.checked=!s.checked,["stop"])},[t("td",null,[D(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":w=>s.checked=w},null,8,dt),[[N,s.checked]])]),t("td",null,[t("strong",null,[Ke(n(s.name)+" ",1),h(x,{class:"bi bi-btn",onClick:_(w=>o(J)(s.path,`${s.name.replace(" ","")}-${s.id}.apk`),["stop"])},null,8,["onClick"])]),pt,h(oe,{id:s.id,raw:s},null,8,["id","raw"])]),t("td",null,n(s.version),1),t("td",null,n(o(Ne)(s.size)),1),t("td",rt,n(e.$t("app_type."+s.type)),1),t("td",{class:"nowrap",title:o(R)(s.installedAt)},n(o(j)(s.installedAt)),9,_t),t("td",{class:"nowrap",title:o(R)(s.updatedAt)},n(o(j)(s.updatedAt)),9,ft),t("td",ht,[s.isUninstalling?(u(),d("span",mt,n(e.$t("uninstalling")),1)):(u(),d("a",{key:1,href:"#",class:"v-link",onClick:_(w=>ee(s),["stop"])},n(e.$t("uninstall")),9,vt))])],10,ct))),128))]),l.value.length?I("",!0):(u(),d("tfoot",kt,[t("tr",null,[t("td",yt,[t("div",gt,n(e.$t(o(Je)(o(W)))),1)])])]))]),$.value>b?(u(),Ge(le,{key:0,modelValue:g.value,"onUpdate:modelValue":a[5]||(a[5]=s=>g.value=s),total:$.value,limit:b},null,8,["modelValue","total"])):I("",!0),t("input",{ref_key:"fileInput",ref:V,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:a[6]||(a[6]=(...s)=>o(v)&&o(v)(...s))},null,544)],64)}}});const Dt=He(bt,[["__scopeId","data-v-5ba739a6"]]);export{Dt as default};

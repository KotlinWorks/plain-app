import{u as ye,_ as $e,a as be,b as we}from"./list-b9452752.js";import{d as Ce,ae as Se,e as Ae,r as k,u as De,s as Ie,f as Ve,K as Te,af as Ue,L as qe,D as Qe,M as Be,ag as Fe,T as J,g as Le,w as Pe,i as ze,N as Me,O as Re,P as O,Q as Ne,R as Ge,c as i,a as e,p as r,j as l,m as p,l as f,k as T,h as U,t as a,H as Ke,F as W,J as xe,S as je,x as Ee,ah as He,ai as Je,C as S,W as A,aj as Oe,ak as We,o,v as Ye,I as Ze,z as Xe,Y,Z,$ as et,al as tt,am as st,a5 as lt,ad as nt}from"./index-5e07ed19.js";import{_ as at}from"./Breadcrumb-91f57f67.js";function ot(D,I){const g=D.findIndex(y=>y.id===I);g!==-1&&D.splice(g,1)}const it={class:"v-toolbar"},dt=e("md-ripple",null,null,-1),ct=["onClick"],ut=e("md-ripple",null,null,-1),rt={class:"filters"},pt={class:"form-row"},_t=["label"],ht={class:"buttons"},ft=["onClick"],mt={class:"table-responsive"},kt={class:"table"},vt=["checked","indeterminate"],gt=e("th",null,null,-1),yt=e("th",null,null,-1),$t=["onClick"],bt=["checked"],wt=["src"],Ct={class:"v-center"},St={class:"nowrap"},At={class:"action-btns"},Dt={key:0,indeterminate:"",class:"spinner-sm"},It=["onClick"],Vt=e("md-ripple",null,null,-1),Tt=["onClick"],Ut=e("md-ripple",null,null,-1),qt={class:"nowrap"},Qt={class:"nowrap"},Bt={class:"nowrap"},Ft={class:"nowrap"},Lt={key:0},Pt={colspan:"8"},zt={class:"no-data-placeholder"},v=50,Gt=Ce({__name:"AppsView",setup(D){var j,E;const{input:I,upload:g,uploadChanged:y}=Se(),$=Ae(),d=k([]),q=k(),{t:X}=De(),{app:ee,urlTokenKey:V}=Ie(Ve()),b=Te({text:"",tags:[]}),{allChecked:Q,realAllChecked:B,selectRealAll:te,allCheckedAlertVisible:se,clearSelection:F,toggleAllChecked:L,toggleItemChecked:P,toggleRow:le,total:m,checked:z}=ye(d),{downloadItems:ne}=Ue(V,qe.PACKAGE,d,F,"apps.zip"),{downloadFile:ae}=tt(V),M=Qe(),R=M.query,w=k(parseInt(((j=R.page)==null?void 0:j.toString())??"1")),c=k(Be(((E=R.q)==null?void 0:E.toString())??"")),N=Fe(c.value),_=M.params.type;_&&N.push({name:"type",op:"",value:_});const G=k(J(N)),oe=()=>{g(ee.value.downloadsDir)},{loading:ie}=Le({handle:(t,n)=>{n?Ee(X(n),"error"):t&&(d.value=t.packages.map(u=>({...u,checked:!1,icon:He(V.value,"pkgicon://"+u.id)})),m.value=t.packageCount)},document:Je,variables:()=>({offset:(w.value-1)*v,limit:v,query:G.value}),appApi:!0});Pe(w,t=>{_?S($,`/apps/${_}?page=${t}&q=${A(c.value)}`):S($,`/apps?page=${t}&q=${A(c.value)}`)});function de(){const t=[];b.text&&t.push({name:"text",op:"",value:b.text}),c.value=J(t),K(),q.value.dismiss()}function K(){_?S($,`/apps/${_}?q=${A(c.value)}`):S($,`/apps?q=${A(c.value)}`)}const{mutate:ce,onDone:ue}=ze({document:Oe,appApi:!0});function re(t){ue(()=>{t.isUninstalling=!0}),ce({id:t.id})}const{loading:pe,load:_e,refetch:he}=Me({handle:(t,n)=>{if(t)for(const u of t.packageStatuses)u.exist||ot(d.value,u.id)},document:We,variables:()=>({ids:d.value.filter(t=>t.isUninstalling).map(t=>t.id)}),appApi:!0}),x=t=>{t.status};return Re(()=>{O.on("upload_task_done",x);let t=!0;setInterval(()=>{d.value.some(n=>n.isUninstalling)&&!pe.value&&(t?(_e(),t=!1):he())},1e3)}),Ne(()=>{O.off("upload_task_done",x)}),(t,n)=>{const u=at,H=st,fe=$e,me=be,ke=lt,ve=nt,ge=we,h=Ge("tooltip");return o(),i(W,null,[e("div",it,[r(u,{current:()=>`${t.$t("page_title.apps")} (${l(m)})`},null,8,["current"]),l(z)?p((o(),i("button",{key:0,class:"icon-button",onClick:n[0]||(n[0]=f(s=>l(ne)(l(B),G.value),["stop"]))},[dt,r(H)])),[[h,t.$t("download")]]):T("",!0),e("button",{class:"icon-button",onClick:f(oe,["stop"]),style:{display:"none"}},[ut,U(" "+a(t.$t("install")),1)],8,ct),r(fe,{ref_key:"searchInputRef",ref:q,modelValue:c.value,"onUpdate:modelValue":n[2]||(n[2]=s=>c.value=s),search:K},{filters:Ke(()=>[e("div",rt,[e("div",pt,[p(e("md-outlined-text-field",{label:t.$t("keywords"),"onUpdate:modelValue":n[1]||(n[1]=s=>b.text=s),"keyup.enter":"applyAndDoSearch"},null,8,_t),[[Ye,b.text]])]),e("div",ht,[e("md-filled-button",{onClick:f(de,["stop"])},a(t.$t("search")),9,ft)])])]),_:1},8,["modelValue"])]),r(me,{limit:v,total:l(m),"all-checked-alert-visible":l(se),"real-all-checked":l(B),"select-real-all":l(te),"clear-selection":l(F)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e("div",mt,[e("table",kt,[e("thead",null,[e("tr",null,[e("th",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:n[3]||(n[3]=(...s)=>l(L)&&l(L)(...s)),checked:l(Q),indeterminate:!l(Q)&&l(z)},null,40,vt)]),gt,e("th",null,a(t.$t("name")),1),yt,e("th",null,a(t.$t("size")),1),e("th",null,a(t.$t("type")),1),e("th",null,a(t.$t("installed_at")),1),e("th",null,a(t.$t("updated_at")),1)])]),e("tbody",null,[(o(!0),i(W,null,xe(d.value,s=>(o(),i("tr",{key:s.id,class:Ze({selected:s.checked}),onClick:f(C=>l(le)(s),["stop"])},[e("td",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:n[4]||(n[4]=(...C)=>l(P)&&l(P)(...C)),checked:s.checked},null,40,bt)]),e("td",null,[e("img",{width:"50",height:"50",src:s.icon},null,8,wt)]),e("td",null,[e("strong",Ct,a(s.name)+" ("+a(s.version)+")",1),r(ke,{id:s.id,raw:s},null,8,["id","raw"])]),e("td",St,[e("div",At,[s.isUninstalling?p((o(),i("md-circular-progress",Dt,null,512)),[[h,t.$t("uninstalling")]]):p((o(),i("button",{key:1,class:"icon-button",onClick:f(C=>re(s),["stop"])},[Vt,r(ve)],8,It)),[[h,t.$t("uninstall")]]),p((o(),i("button",{class:"icon-button",onClick:f(C=>l(ae)(s.path,`${s.name.replace(" ","")}-${s.id}.apk`),["stop"])},[Ut,r(H)],8,Tt)),[[h,t.$t("download")]])])]),e("td",qt,a(l(Xe)(s.size)),1),e("td",Qt,a(t.$t("app_type."+s.type)),1),e("td",Bt,[p((o(),i("span",null,[U(a(l(Z)(s.installedAt)),1)])),[[h,l(Y)(s.installedAt)]])]),e("td",Ft,[p((o(),i("span",null,[U(a(l(Z)(s.updatedAt)),1)])),[[h,l(Y)(s.updatedAt)]])])],10,$t))),128))]),d.value.length?T("",!0):(o(),i("tfoot",Lt,[e("tr",null,[e("td",Pt,[e("div",zt,a(t.$t(l(et)(l(ie)))),1)])])]))])]),l(m)>v?(o(),je(ge,{key:0,modelValue:w.value,"onUpdate:modelValue":n[5]||(n[5]=s=>w.value=s),total:l(m),limit:v},null,8,["modelValue","total"])):T("",!0),e("input",{ref_key:"fileInput",ref:I,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:n[6]||(n[6]=(...s)=>l(y)&&l(y)(...s))},null,544)],64)}}});export{Gt as default};

import{u as ie,_ as ue,a as ce}from"./list-8da24cd9.js";import{_ as de}from"./FieldId-1f1b2728.js";import{_ as pe}from"./download-rounded-9a7f7213.js";import{_ as re}from"./Breadcrumb-f423bf18.js";import{d as _e,p as fe,r as f,u as me,s as he,a as ve,A as ke,D as ye,n as ge,B as be,i as $e,t as we,$ as Ce,H as Se,V as Ve,a0 as Ie,E as Ae,a1 as De,I as Ue,J as qe,o as u,c as d,b as t,e as m,g as n,w as _,k as A,f as o,v as Qe,K as D,L as Be,M as Le,N as K,O as Me,F as N,y as ze,x as Fe,j as Te,l as Pe,P as R,Q as G,R as xe,z as C,S,a2 as Ke,a3 as Ne,_ as Re}from"./index-474238de.js";import{n as Ge}from"./list-6498ebd9.js";import{c as Ee,b as E}from"./search-c45b9009.js";import{u as je,a as He,b as Je}from"./files-2e4c4e6b.js";import"./VModal.vuevuetypescriptsetuptruelang-f74ab29e.js";import"./baseIndexOf-70b929c6.js";import"./toInteger-7eb45424.js";function Oe(c,V){const h=c.findIndex(v=>v.id===V);h!==-1&&c.splice(h,1)}const We=c=>(Ke("data-v-5ba739a6"),c=c(),Ne(),c),Xe={class:"v-toolbar"},Ye={class:"right-actions"},Ze=["title"],et=["onClick"],tt={class:"row mb-3"},st={class:"col-md-3 col-form-label"},at={class:"col-md-9"},ot=["onKeyup"],nt={class:"actions"},lt=["onClick"],it={class:"table"},ut={class:"actions"},ct=["onClick"],dt=["onUpdate:modelValue"],pt=We(()=>t("br",null,null,-1)),rt={class:"nowrap"},_t=["title"],ft=["title"],mt={class:"actions one"},ht={key:0},vt=["onClick"],kt={key:0},yt={colspan:"8"},gt={class:"no-data-placeholder"},bt=_e({__name:"AppsView",setup(c){var T,P;const{input:V,upload:h,uploadChanged:v}=je(),k=fe(),l=f([]),{t:j}=me(),{app:U}=he(ve()),y=ke({text:"",tags:[]}),H=ye(()=>l.value.some(e=>e.checked)),{downloadItems:q}=He(l,"apps.zip"),{downloadFile:J}=Je(U),Q=ge(),B=Q.query,g=f(parseInt(((T=B.page)==null?void 0:T.toString())??"1")),b=50,$=f(0),i=f(be(((P=B.q)==null?void 0:P.toString())??"")),L=Ee(i.value),p=Q.params.type;p&&L.push({name:"type",op:"",value:p});const O=f(E(L)),W=()=>{h(U.value.downloadsDir)},{selectAll:I,toggleSelect:M}=ie(l),{loading:X}=$e({handle:(e,a)=>{a?we(j(a),"error"):e&&(l.value=e.packages.map(r=>({...r,checked:!1})),$.value=e.packageCount)},document:Ce,variables:()=>({offset:(g.value-1)*b,limit:b,query:O.value}),appApi:!0});Se(g,e=>{p?C(k,`/apps/${p}?page=${e}&q=${S(i.value)}`):C(k,`/apps?page=${e}&q=${S(i.value)}`)});function z(){const e=[];y.text&&e.push({name:"text",op:"",value:y.text}),i.value=E(e),F()}function F(){p?C(k,`/apps/${p}?q=${S(i.value)}`):C(k,`/apps?q=${S(i.value)}`)}const{mutate:Y,onDone:Z}=Ve({document:Ie,appApi:!0});function ee(e){Z(()=>{e.isUninstalling=!0}),Y({id:e.id})}const{loading:te,load:se,refetch:ae}=Ae({handle:(e,a)=>{if(e)for(const r of e.packageStatuses)r.exist||Oe(l.value,r.id)},document:De,variables:()=>({ids:l.value.filter(e=>e.isUninstalling).map(e=>e.id)}),appApi:!0});return Ue(()=>{qe.on("upload_task_done",a=>{a.status});let e=!0;setInterval(()=>{l.value.some(a=>a.isUninstalling)&&!te.value&&(e?(se(),e=!1):ae())},1e3)}),(e,a)=>{const r=re,x=pe,oe=ue,ne=de,le=ce;return u(),d(N,null,[t("div",Xe,[m(r,{current:()=>`${e.$t("page_title.apps")} (${$.value})`},null,8,["current"]),t("div",Ye,[n(H)?(u(),d("button",{key:0,type:"button",class:"btn btn-action",onClick:a[0]||(a[0]=_((...s)=>n(q)&&n(q)(...s),["stop"])),title:e.$t("download")},[m(x,{class:"bi"})],8,Ze)):A("",!0),t("button",{type:"button",class:"btn btn-action",onClick:_(W,["stop"]),style:{display:"none"}},o(e.$t("install")),9,et),m(oe,{modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=s=>i.value=s),search:F},{filters:Qe(()=>[t("div",tt,[t("label",st,o(e.$t("keywords")),1),t("div",at,[D(t("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=s=>y.text=s),class:"form-control",onKeyup:Le(z,["enter"])},null,40,ot),[[Be,y.text]])])]),t("div",nt,[t("button",{type:"button",class:"btn",onClick:_(z,["stop"])},o(e.$t("search")),9,lt)])]),_:1},8,["modelValue"])])]),t("table",it,[t("thead",null,[t("tr",null,[t("th",null,[D(t("input",{class:"form-check-input",type:"checkbox",onChange:a[3]||(a[3]=(...s)=>n(M)&&n(M)(...s)),"onUpdate:modelValue":a[4]||(a[4]=s=>Me(I)?I.value=s:null)},null,544),[[K,n(I)]])]),t("th",null,o(e.$t("name")),1),t("th",null,o(e.$t("version")),1),t("th",null,o(e.$t("size")),1),t("th",null,o(e.$t("type")),1),t("th",null,o(e.$t("installed_at")),1),t("th",null,o(e.$t("updated_at")),1),t("th",ut,o(e.$t("actions")),1)])]),t("tbody",null,[(u(!0),d(N,null,ze(l.value,s=>(u(),d("tr",{key:s.id,class:Fe({checked:s.checked}),onClick:_(w=>s.checked=!s.checked,["stop"])},[t("td",null,[D(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":w=>s.checked=w},null,8,dt),[[K,s.checked]])]),t("td",null,[t("strong",null,[Te(o(s.name)+" ",1),m(x,{class:"bi bi-btn",onClick:_(w=>n(J)(s.path,`${s.name.replace(" ","")}-${s.id}.apk`),["stop"])},null,8,["onClick"])]),pt,m(ne,{id:s.id,raw:s},null,8,["id","raw"])]),t("td",null,o(s.version),1),t("td",null,o(n(Pe)(s.size)),1),t("td",rt,o(e.$t("app_type."+s.type)),1),t("td",{class:"nowrap",title:n(R)(s.installedAt)},o(n(G)(s.installedAt)),9,_t),t("td",{class:"nowrap",title:n(R)(s.updatedAt)},o(n(G)(s.updatedAt)),9,ft),t("td",mt,[s.isUninstalling?(u(),d("span",ht,o(e.$t("uninstalling")),1)):(u(),d("a",{key:1,href:"#",class:"v-link",onClick:_(w=>ee(s),["stop"])},o(e.$t("uninstall")),9,vt))])],10,ct))),128))]),l.value.length?A("",!0):(u(),d("tfoot",kt,[t("tr",null,[t("td",yt,[t("div",gt,o(e.$t(n(Ge)(n(X)))),1)])])]))]),$.value>b?(u(),xe(le,{key:0,modelValue:g.value,"onUpdate:modelValue":a[5]||(a[5]=s=>g.value=s),total:$.value,limit:b},null,8,["modelValue","total"])):A("",!0),t("input",{ref_key:"fileInput",ref:V,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:a[6]||(a[6]=(...s)=>n(v)&&n(v)(...s))},null,544)],64)}}});const Bt=Re(bt,[["__scopeId","data-v-5ba739a6"]]);export{Bt as default};

import{D as Me,u as Pe,_ as ze,a as Le,b as Qe}from"./list-c18b89b9.js";import{o as l,e as a,f as e,a2 as le,aH as Fe,u as ae,$ as v,t as ie,r as D,aI as He,d as Ne,a as Ue,s as Ge,c as Ke,B as je,p as xe,C as Je,D as Oe,E as We,ay as Xe,aa as Ye,ax as et,G as tt,aJ as ot,I as nt,J as st,K as lt,L as at,x as d,k as o,F as M,M as m,w as p,m as z,y as it,N as dt,j as h,A as te,z as ct,aC as ut,a4 as rt,l as _t,R as pt,af as mt,n as oe,S as ne,an as ht,T as ft,U as gt,V as yt,W as vt,a8 as kt,ag as bt,X as $t,Y as Tt,Z as qt}from"./index-2c8e7849.js";import{_ as Ct,a as wt}from"./ConfirmModal.vuevuetypescriptsetuptruelang-9dd98671.js";import{_ as At}from"./Breadcrumb-01ba2071.js";import{n as It}from"./list-6498ebd9.js";import{u as Dt,a as St}from"./tags-9332a6bc.js";import"./vee-validate.esm-83a41e33.js";const Vt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Bt=e("path",{fill:"currentColor",d:"M9.5 9.325v5.35q0 .6.525.875t1.025-.05l4.15-2.65q.475-.275.475-.85t-.475-.85L11.05 8.5q-.5-.325-1.025-.05t-.525.875ZM12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Zm0-10Zm0 8q3.325 0 5.663-2.337T20 12q0-3.325-2.337-5.663T12 4Q8.675 4 6.337 6.337T4 12q0 3.325 2.337 5.663T12 20Z"},null,-1),Rt=[Bt];function Zt(f,g){return l(),a("svg",Vt,Rt)}const Et={name:"material-symbols-play-circle-outline-rounded",render:Zt},Mt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Pt=e("path",{fill:"currentColor",d:"M10 16q.425 0 .713-.288T11 15V8.975q0-.425-.288-.7T10 8q-.425 0-.713.288T9 9v6.025q0 .425.288.7T10 16Zm4 0q.425 0 .713-.288T15 15V8.975q0-.425-.288-.7T14 8q-.425 0-.713.288T13 9v6.025q0 .425.288.7T14 16Zm-2 6q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Zm0-10Zm0 8q3.325 0 5.663-2.337T20 12q0-3.325-2.337-5.663T12 4Q8.675 4 6.337 6.337T4 12q0 3.325 2.337 5.663T12 20Z"},null,-1),zt=[Pt];function Lt(f,g){return l(),a("svg",Mt,zt)}const Qt={name:"material-symbols-pause-circle-outline-rounded",render:Lt},Ft={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ht=e("path",{fill:"currentColor",d:"M3 16v-2h7v2H3Zm0-4v-2h11v2H3Zm0-4V6h11v2H3Zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4h-2Z"},null,-1),Nt=[Ht];function Ut(f,g){return l(),a("svg",Ft,Nt)}const Gt={name:"material-symbols-playlist-add",render:Ut};function se(f,g,c=500){const u=f.cloneNode(!0),_=f.getBoundingClientRect(),C=g.getBoundingClientRect();u.style.position="absolute",u.style.top=_.top+"px",u.style.left=_.left+"px",u.style.opacity=1,document.body.appendChild(u);let k=0;function $(r){k||(k=r);const T=r-k,i=Math.min(T/c,1);u.style.top=_.top+(C.top-_.top)*i+"px",u.style.left=_.left+(C.left-_.left)*i+"px",i<1?requestAnimationFrame($):document.body.removeChild(u)}requestAnimationFrame($)}const Kt=(f,g)=>{const{mutate:c,loading:u,onDone:_}=le({document:Fe,appApi:!0}),{t:C}=ae();return _(()=>{v.emit("refetch_app"),g()}),{loading:u,addItemsToPlaylist:(k,$,r)=>{let T=r;if(!$){const S=f.value.filter(q=>q.checked);if(S.length===0){ie(C("select_first"),"error");return}T=`ids:${S.map(q=>q.id).join(",")}`}const i=k.target,L=document.getElementById("quick-audio");se(i,L),c({query:T})},addToPlaylist:(k,$)=>{const r=k.target,T=document.getElementById("quick-audio");se(r,T),c({query:`ids:${$.id}`})}}},jt=()=>{const f=D(""),{mutate:g,loading:c,onDone:u}=le({document:He,appApi:!0});return u(()=>{v.emit("play_audio")}),{loading:c,playPath:f,play:_=>{f.value=_.path,g({path:_.path})},pause:()=>{v.emit("pause_audio")}}},xt={class:"v-toolbar"},Jt=e("md-ripple",null,null,-1),Ot=e("md-ripple",null,null,-1),Wt=e("md-ripple",null,null,-1),Xt=e("md-ripple",null,null,-1),Yt=["onClick"],eo=e("md-ripple",null,null,-1),to={class:"filters"},oo=["label"],no={class:"form-label"},so={type:"filter"},lo=["label","selected","onClick"],ao={class:"buttons"},io=["onClick"],co={class:"table-responsive"},uo={class:"table"},ro=["checked","indeterminate"],_o=e("th",null,"ID",-1),po=e("th",null,null,-1),mo=["onClick"],ho=["checked"],fo={class:"nowrap"},go={class:"action-btns"},yo=["onClick"],vo=e("md-ripple",null,null,-1),ko=["onClick"],bo=e("md-ripple",null,null,-1),$o=["onClick"],To=e("md-ripple",null,null,-1),qo=["onClick"],Co=e("md-ripple",null,null,-1),wo={key:0,indeterminate:"",class:"spinner-sm"},Ao=e("md-ripple",null,null,-1),Io=["onClick"],Do=e("md-ripple",null,null,-1),So={class:"nowrap"},Vo={key:0},Bo={colspan:"8"},Ro={class:"no-data-placeholder"},Z=50,Fo=Ne({__name:"AudiosView",setup(f){var J,O;const g=Ue(),c=D([]),u=D(),{t:_}=ae(),{app:C,urlTokenKey:k,audioPlaying:$}=Ge(Ke()),r=je({text:"",tags:[]}),T=t=>{var s;return $.value&&((s=C.value)==null?void 0:s.audioCurrent)===t.path},i=Me.AUDIO,S=xe().query,q=D(parseInt(((J=S.page)==null?void 0:J.toString())??"1")),w=D(Je(((O=S.q)==null?void 0:O.toString())??"")),A=D(""),{tags:E}=Dt(i,w,r,async t=>{A.value=Oe(t),await We(),Te()}),{addToTags:de}=St(i,c,E),{deleteItems:ce,deleteItem:ue}=Xe(),{allChecked:Q,realAllChecked:V,selectRealAll:re,allCheckedAlertVisible:_e,clearSelection:B,toggleAllChecked:F,toggleItemChecked:H,total:I,checked:N}=Pe(c),{downloadItems:pe}=Ye(k,i,c,B,"audios.zip"),{downloadFile:me}=mt(k),{addItemsToPlaylist:he,addToPlaylist:fe}=Kt(c,B),ge=et(),{play:ye,playPath:ve,loading:ke,pause:be}=jt(),{loading:$e,load:Te,refetch:P}=tt({handle:(t,s)=>{s?ie(_(s),"error"):t&&(c.value=t.audios.map(R=>({...R,checked:!1})),I.value=t.audioCount)},document:ot,variables:()=>({offset:(q.value-1)*Z,limit:Z,query:A.value}),appApi:!0});nt(q,t=>{oe(g,`/audios?page=${t}&q=${ne(w.value)}`)});function qe(){ge.push("/files"),ht(Ct,{message:_("upload_audios")})}function Ce(t){r.tags.includes(t)?ft(r.tags,s=>s.id===t.id):r.tags.push(t)}function we(){w.value=gt(r),U(),u.value.dismiss()}function U(){oe(g,`/audios?q=${ne(w.value)}`)}const G=t=>{t.type===i&&(B(),P())},K=t=>{t.type===i&&P()},j=t=>{t.type===i&&(B(),P())},x=()=>{I.value--};st(()=>{v.on("item_tags_updated",K),v.on("items_tags_updated",G),v.on("media_item_deleted",x),v.on("media_items_deleted",j)}),lt(()=>{v.off("item_tags_updated",K),v.off("items_tags_updated",G),v.off("media_item_deleted",x),v.off("media_items_deleted",j)});function Ae(t){yt(vt,{type:i,tags:E.value,item:{key:t.id,title:t.title,size:t.size},selected:E.value.filter(s=>t.tags.some(R=>R.id===s.id))})}return(t,s)=>{const R=At,W=kt,X=bt,Y=Gt,ee=$t,Ie=wt,De=ze,Se=Le,Ve=Tt,Be=Qt,Re=Et,Ze=qt,Ee=Qe,y=at("tooltip");return l(),a(M,null,[e("div",xt,[d(R,{current:()=>`${t.$t("page_title.audios")} (${o(I)})`},null,8,["current"]),o(N)?(l(),a(M,{key:0},[m((l(),a("button",{class:"icon-button",onClick:s[0]||(s[0]=p(n=>o(ce)(o(i),c.value,o(V),A.value),["stop"]))},[Jt,d(W)])),[[y,t.$t("delete")]]),m((l(),a("button",{class:"icon-button",onClick:s[1]||(s[1]=p(n=>o(pe)(o(V),A.value),["stop"]))},[Ot,d(X)])),[[y,t.$t("download")]]),m((l(),a("button",{class:"icon-button",onClick:s[2]||(s[2]=p(n=>o(he)(n,o(V),A.value),["stop"]))},[Wt,d(Y)])),[[y,t.$t("add_to_playlist")]]),m((l(),a("button",{class:"icon-button",onClick:s[3]||(s[3]=p(n=>o(de)(o(V),A.value),["stop"]))},[Xt,d(ee)])),[[y,t.$t("add_to_tags")]])],64)):z("",!0),m((l(),a("button",{class:"icon-button",onClick:p(qe,["stop"])},[eo,d(Ie)],8,Yt)),[[y,t.$t("upload")]]),d(De,{ref_key:"searchInputRef",ref:u,modelValue:w.value,"onUpdate:modelValue":s[5]||(s[5]=n=>w.value=n),search:U},{filters:it(()=>[e("div",to,[m(e("md-outlined-text-field",{label:t.$t("keywords"),"onUpdate:modelValue":s[4]||(s[4]=n=>r.text=n),"keyup.enter":"applyAndDoSearch"},null,8,oo),[[dt,r.text]]),e("label",no,h(t.$t("tags")),1),e("md-chip-set",so,[(l(!0),a(M,null,te(o(E),n=>(l(),a("md-filter-chip",{key:n.id,label:n.name,selected:r.tags.includes(n),onClick:b=>Ce(n)},null,8,lo))),128))]),e("div",ao,[e("md-filled-button",{onClick:p(we,["stop"])},h(t.$t("search")),9,io)])])]),_:1},8,["modelValue"])]),d(Se,{limit:Z,total:o(I),"all-checked-alert-visible":o(_e),"real-all-checked":o(V),"select-real-all":o(re),"clear-selection":o(B)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e("div",co,[e("table",uo,[e("thead",null,[e("tr",null,[e("th",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:s[6]||(s[6]=(...n)=>o(F)&&o(F)(...n)),checked:o(Q),indeterminate:!o(Q)&&o(N)},null,40,ro)]),_o,e("th",null,h(t.$t("name")),1),po,e("th",null,h(t.$t("artist")),1),e("th",null,h(t.$t("tags")),1),e("th",null,h(t.$t("duration")),1),e("th",null,h(t.$t("file_size")),1)])]),e("tbody",null,[(l(!0),a(M,null,te(c.value,n=>(l(),a("tr",{key:n.id,class:ct({selected:n.checked}),onClick:p(b=>n.checked=!n.checked,["stop"])},[e("td",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:s[7]||(s[7]=(...b)=>o(H)&&o(H)(...b)),checked:n.checked},null,40,ho)]),e("td",null,[d(Ve,{id:n.id,raw:n},null,8,["id","raw"])]),e("td",null,h(n.title),1),e("td",fo,[e("div",go,[m((l(),a("button",{class:"icon-button",onClick:p(b=>o(ue)(o(i),n),["stop"])},[vo,d(W)],8,yo)),[[y,t.$t("delete")]]),m((l(),a("button",{class:"icon-button",onClick:p(b=>o(me)(n.path,o(ut)(n.path).replace(" ","-")),["stop"])},[bo,d(X)],8,ko)),[[y,t.$t("download")]]),m((l(),a("button",{class:"icon-button",onClick:p(b=>o(fe)(b,n),["stop"])},[To,d(Y)],8,$o)),[[y,t.$t("add_to_playlist")]]),m((l(),a("button",{class:"icon-button",onClick:p(b=>Ae(n),["stop"])},[Co,d(ee)],8,qo)),[[y,t.$t("add_to_tags")]]),o(ke)&&n.path===o(ve)?(l(),a("md-circular-progress",wo)):T(n)?m((l(),a("button",{key:1,class:"icon-button",onClick:s[8]||(s[8]=p(b=>o(be)(),["stop"]))},[Ao,d(Be)])),[[y,t.$t("pause")]]):m((l(),a("button",{key:2,class:"icon-button",onClick:p(b=>o(ye)(n),["stop"])},[Do,d(Re)],8,Io)),[[y,t.$t("play")]])])]),e("td",null,h(n.artist),1),e("td",null,[d(Ze,{tags:n.tags,type:o(i)},null,8,["tags","type"])]),e("td",So,h(o(rt)(n.duration)),1),e("td",null,h(o(_t)(n.size)),1)],10,mo))),128))]),c.value.length?z("",!0):(l(),a("tfoot",Vo,[e("tr",null,[e("td",Bo,[e("div",Ro,h(t.$t(o(It)(o($e),o(C).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])]),o(I)>Z?(l(),pt(Ee,{key:0,modelValue:q.value,"onUpdate:modelValue":s[9]||(s[9]=n=>q.value=n),total:o(I),limit:Z},null,8,["modelValue","total"])):z("",!0)],64)}}});export{Fo as default};

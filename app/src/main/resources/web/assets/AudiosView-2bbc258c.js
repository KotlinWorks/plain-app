import{u as kt,_ as $t,a as Ct}from"./list-a58e063e.js";import{o as d,c as p,b as t,V as j,ao as Tt,u as tt,J as g,t as D,r as v,ap as wt,d as qt,p as Vt,s as It,a as At,A as St,D as A,n as Mt,B as Dt,C as Lt,ah as Bt,E as Qt,aq as Rt,H as Ft,I as Pt,e as i,g as n,F as w,w as u,k as S,f as a,v as Ut,K as M,L as Zt,M as zt,N as O,O as Nt,y as X,x as Et,ar as Gt,R as J,X as Kt,l as Ht,z as W,S as Y,aa as xt,Y as Ot,as as Xt,a2 as Jt,a3 as Wt,_ as Yt}from"./index-e9c32210.js";import{_ as jt}from"./FieldId-4a415062.js";import{_ as to}from"./Multiselect-c3137869.js";import{_ as oo,a as eo}from"./label-outline-rounded-f22b3f2e.js";import{a as so,b as no,_ as ao}from"./files-ae28db41.js";import{_ as lo}from"./delete-outline-rounded-def56673.js";import{_ as io}from"./Breadcrumb-2d9a8da6.js";import{b as uo,a as co}from"./search-72516736.js";import{n as ro}from"./list-6498ebd9.js";import{u as _o,a as po,b as mo}from"./tags-811ca43d.js";import{u as ho,_ as bo}from"./ConfirmModal.vuevuetypescriptsetuptruelang-90c8ef08.js";import{_ as fo}from"./DeleteConfirm.vuevuetypescriptsetuptruelang-f8a248cf.js";import"./VModal.vuevuetypescriptsetuptruelang-22961625.js";import"./baseIndexOf-70b929c6.js";import"./toInteger-6e276fa2.js";import"./vee-validate.esm-1d79c7d3.js";const yo={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},vo=t("path",{fill:"currentColor",d:"M9.5 9.325v5.35q0 .6.525.875t1.025-.05l4.15-2.65q.475-.275.475-.85t-.475-.85L11.05 8.5q-.5-.325-1.025-.05t-.525.875ZM12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Zm0-10Zm0 8q3.325 0 5.663-2.337T20 12q0-3.325-2.337-5.663T12 4Q8.675 4 6.337 6.337T4 12q0 3.325 2.337 5.663T12 20Z"},null,-1),go=[vo];function ko(c,m){return d(),p("svg",yo,go)}const $o={name:"material-symbols-play-circle-outline-rounded",render:ko},Co={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},To=t("path",{fill:"currentColor",d:"M3 16v-2h7v2H3Zm0-4v-2h11v2H3Zm0-4V6h11v2H3Zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4h-2Z"},null,-1),wo=[To];function qo(c,m){return d(),p("svg",Co,wo)}const Vo={name:"material-symbols-playlist-add",render:qo},Io=c=>{const{mutate:m,loading:l,onDone:f}=j({document:Tt,appApi:!0}),{t:_}=tt();return f(()=>{g.emit("refetch_app"),D(_("added_to_playlist"))}),{loading:l,addItemsToPlaylist:()=>{const r=c.value.filter(k=>k.checked);if(r.length===0){D(_("select_first"),"error");return}m({paths:r.map(k=>k.path)})},addToPlaylist:r=>{m({paths:[r.path]})}}},Ao=()=>{const c=v(""),{mutate:m,loading:l,onDone:f}=j({document:wt,appApi:!0});return f(()=>{g.emit("refetch_app"),g.emit("play_audio")}),{loading:l,playing:c,play:_=>{c.value=_.path,m({path:_.path})}}},ot=c=>(Jt("data-v-79bf2fe1"),c=c(),Wt(),c),So={class:"v-toolbar"},Mo={class:"right-actions"},Do=["title"],Lo=["title"],Bo=["title"],Qo=["title"],Ro=["title"],Fo=["onClick"],Po={class:"row mb-3"},Uo={class:"col-md-3 col-form-label"},Zo={class:"col-md-9"},zo=["onKeyup"],No={class:"row mb-3"},Eo={class:"col-md-3 col-form-label"},Go={class:"col-md-9"},Ko={class:"actions"},Ho=["onClick"],xo={class:"table"},Oo=ot(()=>t("th",null,"ID",-1)),Xo=ot(()=>t("th",null,null,-1)),Jo=["onClick"],Wo=["onUpdate:modelValue"],Yo={class:"nowrap"},jo={class:"audio-btns"},te={key:0,class:"spinner spinner-sm"},oe={class:"badge"},ee={key:0},se={colspan:"8"},ne={class:"no-data-placeholder"},ae=qt({__name:"AudiosView",setup(c){var E,G;const m=Vt(),l=v([]),{t:f}=tt(),{app:_}=It(At()),r=St({text:"",tags:[]}),k=A(()=>_.value.audios??[]);A(()=>{const e=_.value.audioCurrent;return k.value.find(s=>s.path==e)});const et=A(()=>l.value.some(e=>e.checked)),b="AUDIO",L=Mt().query,$=v(parseInt(((E=L.page)==null?void 0:E.toString())??"1")),C=50,T=v(0),y=v(Dt(((G=L.q)==null?void 0:G.toString())??"")),B=v(""),{tags:q}=_o(b,y,r,async e=>{B.value=uo(e),await Lt(),ct()}),{addItemsToPlaylist:Q,addToPlaylist:st}=Io(l),{addToTags:R}=po(b,l,q),{removeFromTags:F}=mo(b,l,q),{deleteItems:P}=ho(b,l),{downloadItems:U}=so(l,"audios.zip"),{downloadFile:nt}=no(_),at=Bt(),{play:lt,playing:it,loading:ut}=Ao(),{selectAll:V,toggleSelect:Z}=kt(l),{loading:dt,load:ct,refetch:rt}=Qt({handle:(e,s)=>{s?D(f(s),"error"):e&&(l.value=e.audios.map(I=>({...I,checked:!1})),T.value=e.audioCount)},document:Rt,variables:()=>({offset:($.value-1)*C,limit:C,query:B.value}),appApi:!0});Ft($,e=>{W(m,`/audios?page=${e}&q=${Y(y.value)}`)});function _t(){at.push("/files"),xt(bo,{message:f("upload_audios")})}function z(){y.value=co(r),N()}function N(){W(m,`/audios?q=${Y(y.value)}`)}Pt(()=>{g.on("refetch_by_tag_type",e=>{e===b&&rt()})});function pt(e){Ot(fo,{id:e.id,name:e.title,gql:Xt,variables:()=>({tagType:b,id:e.id}),appApi:!0,typeName:"Audio",done:()=>{g.emit("refetch_app"),g.emit("refetch_by_tag_type",b)}})}return(e,s)=>{const I=io,K=lo,H=ao,x=Vo,mt=oo,ht=eo,bt=to,ft=$t,yt=jt,vt=$o,gt=Ct;return d(),p(w,null,[t("div",So,[i(I,{current:()=>`${e.$t("page_title.audios")} (${T.value})`},null,8,["current"]),t("div",Mo,[n(et)?(d(),p(w,{key:0},[t("button",{type:"button",class:"btn btn-action",onClick:s[0]||(s[0]=u((...o)=>n(P)&&n(P)(...o),["stop"])),title:e.$t("delete")},[i(K,{class:"bi"})],8,Do),t("button",{type:"button",class:"btn btn-action",onClick:s[1]||(s[1]=u((...o)=>n(U)&&n(U)(...o),["stop"])),title:e.$t("download")},[i(H,{class:"bi"})],8,Lo),t("button",{type:"button",class:"btn btn-action",onClick:s[2]||(s[2]=u((...o)=>n(Q)&&n(Q)(...o),["stop"])),title:e.$t("add_to_playlist")},[i(x,{class:"bi"})],8,Bo),t("button",{type:"button",class:"btn btn-action",onClick:s[3]||(s[3]=u((...o)=>n(R)&&n(R)(...o),["stop"])),title:e.$t("add_to_tags")},[i(mt,{class:"bi"})],8,Qo),t("button",{type:"button",class:"btn btn-action",onClick:s[4]||(s[4]=u((...o)=>n(F)&&n(F)(...o),["stop"])),title:e.$t("remove_from_tags")},[i(ht,{class:"bi"})],8,Ro)],64)):S("",!0),t("button",{type:"button",class:"btn btn-action",onClick:u(_t,["stop"])},a(e.$t("upload")),9,Fo),i(ft,{modelValue:y.value,"onUpdate:modelValue":s[7]||(s[7]=o=>y.value=o),search:N},{filters:Ut(()=>[t("div",Po,[t("label",Uo,a(e.$t("keywords")),1),t("div",Zo,[M(t("input",{type:"text","onUpdate:modelValue":s[5]||(s[5]=o=>r.text=o),class:"form-control",onKeyup:zt(z,["enter"])},null,40,zo),[[Zt,r.text]])])]),t("div",No,[t("label",Eo,a(e.$t("tags")),1),t("div",Go,[i(bt,{modelValue:r.tags,"onUpdate:modelValue":s[6]||(s[6]=o=>r.tags=o),label:"name","track-by":"id",options:n(q)},null,8,["modelValue","options"])])]),t("div",Ko,[t("button",{type:"button",class:"btn",onClick:u(z,["stop"])},a(e.$t("search")),9,Ho)])]),_:1},8,["modelValue"])])]),t("table",xo,[t("thead",null,[t("tr",null,[t("th",null,[M(t("input",{class:"form-check-input",type:"checkbox",onChange:s[8]||(s[8]=(...o)=>n(Z)&&n(Z)(...o)),"onUpdate:modelValue":s[9]||(s[9]=o=>Nt(V)?V.value=o:null)},null,544),[[O,n(V)]])]),Oo,t("th",null,a(e.$t("name")),1),Xo,t("th",null,a(e.$t("artist")),1),t("th",null,a(e.$t("tags")),1),t("th",null,a(e.$t("duration")),1),t("th",null,a(e.$t("file_size")),1)])]),t("tbody",null,[(d(!0),p(w,null,X(l.value,o=>(d(),p("tr",{key:o.id,class:Et({checked:o.checked}),onClick:u(h=>o.checked=!o.checked,["stop"])},[t("td",null,[M(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":h=>o.checked=h},null,8,Wo),[[O,o.checked]])]),t("td",null,[i(yt,{id:o.id,raw:o},null,8,["id","raw"])]),t("td",null,a(o.title),1),t("td",Yo,[t("span",jo,[i(K,{class:"bi bi-btn",onClick:u(h=>pt(o),["stop"])},null,8,["onClick"]),i(H,{class:"bi bi-btn",onClick:u(h=>n(nt)(o.path,n(Gt)(o.path).replace(" ","-")),["stop"])},null,8,["onClick"]),i(x,{class:"bi bi-btn",onClick:u(h=>n(st)(o),["stop"])},null,8,["onClick"]),n(ut)&&o.path===n(it)?(d(),p("i",te)):(d(),J(vt,{key:1,class:"bi bi-btn",onClick:u(h=>n(lt)(o),["stop"])},null,8,["onClick"]))])]),t("td",null,a(o.artist),1),t("td",null,[(d(!0),p(w,null,X(o.tags,h=>(d(),p("span",oe,a(h.name),1))),256))]),t("td",null,a(n(Kt)(o.duration)),1),t("td",null,a(n(Ht)(o.size)),1)],10,Jo))),128))]),l.value.length?S("",!0):(d(),p("tfoot",ee,[t("tr",null,[t("td",se,[t("div",ne,a(e.$t(n(ro)(n(dt),n(_).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))]),T.value>C?(d(),J(gt,{key:0,modelValue:$.value,"onUpdate:modelValue":s[10]||(s[10]=o=>$.value=o),total:T.value,limit:C},null,8,["modelValue","total"])):S("",!0)],64)}}});const Te=Yt(ae,[["__scopeId","data-v-79bf2fe1"]]);export{Te as default};

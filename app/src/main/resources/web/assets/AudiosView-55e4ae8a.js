import{u as ze,_ as Le,a as Qe,b as Fe}from"./list-d530dbcb.js";import{o as l,e as a,f as e,a1 as ae,aJ as He,u as ie,Y as k,k as de,r as S,aK as Ne,d as Ue,a as Ge,s as Ke,c as xe,B as je,D as Je,p as Oe,C as We,az as Xe,ab as Ye,ay as et,E as tt,G as ot,H as st,I as nt,J as lt,x as d,h as o,F as M,K as f,w as m,j as L,y as at,t as g,A as oe,L as it,M as dt,N as ct,aL as ut,n as se,P as ne,Q as rt,z as _t,aD as pt,a5 as mt,m as ht,au as ft,av as gt,ag as vt,ao as yt,U as kt,V as bt,W as $t,X as Tt,a9 as qt,ah as Ct,Z as wt,$ as It,a0 as At,_ as Dt}from"./index-642041e3.js";import{_ as St,a as Vt}from"./ConfirmModal.vuevuetypescriptsetuptruelang-6079afa9.js";import{_ as Bt}from"./Breadcrumb-ace66a87.js";import{n as Rt}from"./list-6498ebd9.js";import{u as Zt,a as Et}from"./tags-8a481a23.js";import"./vee-validate.esm-805f179c.js";const Pt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Mt=e("path",{fill:"currentColor",d:"M9.5 9.325v5.35q0 .6.525.875t1.025-.05l4.15-2.65q.475-.275.475-.85t-.475-.85L11.05 8.5q-.5-.325-1.025-.05t-.525.875ZM12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Zm0-10Zm0 8q3.325 0 5.663-2.337T20 12q0-3.325-2.337-5.663T12 4Q8.675 4 6.337 6.337T4 12q0 3.325 2.337 5.663T12 20Z"},null,-1),zt=[Mt];function Lt(c,v){return l(),a("svg",Pt,zt)}const Qt={name:"material-symbols-play-circle-outline-rounded",render:Lt},Ft={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ht=e("path",{fill:"currentColor",d:"M10 16q.425 0 .713-.288T11 15V8.975q0-.425-.288-.7T10 8q-.425 0-.713.288T9 9v6.025q0 .425.288.7T10 16Zm4 0q.425 0 .713-.288T15 15V8.975q0-.425-.288-.7T14 8q-.425 0-.713.288T13 9v6.025q0 .425.288.7T14 16Zm-2 6q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Zm0-10Zm0 8q3.325 0 5.663-2.337T20 12q0-3.325-2.337-5.663T12 4Q8.675 4 6.337 6.337T4 12q0 3.325 2.337 5.663T12 20Z"},null,-1),Nt=[Ht];function Ut(c,v){return l(),a("svg",Ft,Nt)}const Gt={name:"material-symbols-pause-circle-outline-rounded",render:Ut},Kt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},xt=e("path",{fill:"currentColor",d:"M3 16v-2h7v2H3Zm0-4v-2h11v2H3Zm0-4V6h11v2H3Zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4h-2Z"},null,-1),jt=[xt];function Jt(c,v){return l(),a("svg",Kt,jt)}const Ot={name:"material-symbols-playlist-add",render:Jt};function le(c,v,u=500){const r=c.cloneNode(!0),p=c.getBoundingClientRect(),w=v.getBoundingClientRect();r.style.position="absolute",r.style.top=p.top+"px",r.style.left=p.left+"px",r.style.opacity=1,document.body.appendChild(r);let b=0;function T(_){b||(b=_);const q=_-b,i=Math.min(q/u,1);r.style.top=p.top+(w.top-p.top)*i+"px",r.style.left=p.left+(w.left-p.left)*i+"px",i<1?requestAnimationFrame(T):document.body.removeChild(r)}requestAnimationFrame(T)}const Wt=(c,v)=>{const{mutate:u,loading:r,onDone:p}=ae({document:He,appApi:!0}),{t:w}=ie();return p(()=>{k.emit("refetch_app"),v()}),{loading:r,addItemsToPlaylist:(b,T,_)=>{let q=_;if(!T){const V=c.value.filter(C=>C.checked);if(V.length===0){de(w("select_first"),"error");return}q=`ids:${V.map(C=>C.id).join(",")}`}const i=b.target,Q=document.getElementById("quick-audio");le(i,Q),u({query:q})},addToPlaylist:(b,T)=>{const _=b.target,q=document.getElementById("quick-audio");le(_,q),u({query:`ids:${T.id}`})}}},Xt=()=>{const c=S(""),{mutate:v,loading:u,onDone:r}=ae({document:Ne,appApi:!0});return r(()=>{k.emit("play_audio")}),{loading:u,playPath:c,play:p=>{c.value=p.path,v({path:p.path})},pause:()=>{k.emit("pause_audio")}}},h=c=>(ft("data-v-79d67fe6"),c=c(),gt(),c),Yt={class:"v-toolbar"},eo=h(()=>e("md-ripple",null,null,-1)),to=h(()=>e("md-ripple",null,null,-1)),oo=h(()=>e("md-ripple",null,null,-1)),so=h(()=>e("md-ripple",null,null,-1)),no=["onClick"],lo=h(()=>e("md-ripple",null,null,-1)),ao={class:"filters"},io=["label"],co={class:"form-label"},uo={type:"filter"},ro=["label","selected","onClick"],_o={class:"buttons"},po=["onClick"],mo={class:"table-responsive"},ho={class:"table"},fo=["checked","indeterminate"],go=h(()=>e("th",null,"ID",-1)),vo=h(()=>e("th",null,null,-1)),yo={class:"artist"},ko=["onClick"],bo=["checked"],$o={class:"title"},To={class:"nowrap"},qo={class:"action-btns"},Co=["onClick"],wo=h(()=>e("md-ripple",null,null,-1)),Io=["onClick"],Ao=h(()=>e("md-ripple",null,null,-1)),Do=["onClick"],So=h(()=>e("md-ripple",null,null,-1)),Vo=["onClick"],Bo=h(()=>e("md-ripple",null,null,-1)),Ro={key:0,indeterminate:"",class:"spinner-sm"},Zo=h(()=>e("md-ripple",null,null,-1)),Eo=["onClick"],Po=h(()=>e("md-ripple",null,null,-1)),Mo={class:"nowrap"},zo={class:"nowrap"},Lo={key:0},Qo={colspan:"8"},Fo={class:"no-data-placeholder"},E=50,Ho=Ue({__name:"AudiosView",setup(c){var O,W;const v=Ge(),u=S([]),r=S(),{t:p}=ie(),{app:w,urlTokenKey:b,audioPlaying:T}=Ke(xe()),_=je({text:"",tags:[]}),q=t=>{var n;return T.value&&((n=w.value)==null?void 0:n.audioCurrent)===t.path},i=Je.AUDIO,V=Oe().query,C=S(parseInt(((O=V.page)==null?void 0:O.toString())??"1")),I=S(We(((W=V.q)==null?void 0:W.toString())??"")),A=S(""),{tags:P}=Zt(i,I,_,async t=>{A.value=dt(t),await ct(),Ce()}),{addToTags:ce}=Et(i,u,P),{deleteItems:ue,deleteItem:re}=Xe(),{allChecked:F,realAllChecked:B,selectRealAll:_e,allCheckedAlertVisible:pe,clearSelection:R,toggleAllChecked:H,toggleRow:me,toggleItemChecked:N,total:D,checked:U}=ze(u),{downloadItems:he}=Ye(b,i,u,R,"audios.zip"),{downloadFile:fe}=vt(b),{addItemsToPlaylist:ge,addToPlaylist:ve}=Wt(u,R),ye=et(),{play:ke,playPath:be,loading:$e,pause:Te}=Xt(),{loading:qe,load:Ce,refetch:z}=tt({handle:(t,n)=>{n?de(p(n),"error"):t&&(u.value=t.audios.map(Z=>({...Z,checked:!1})),D.value=t.audioCount)},document:ut,variables:()=>({offset:(C.value-1)*E,limit:E,query:A.value}),appApi:!0});ot(C,t=>{se(v,`/audios?page=${t}&q=${ne(I.value)}`)});function we(){ye.push("/files"),yt(St,{message:p("upload_audios")})}function Ie(t){_.tags.includes(t)?kt(_.tags,n=>n.id===t.id):_.tags.push(t)}function Ae(){I.value=bt(_),G(),r.value.dismiss()}function G(){se(v,`/audios?q=${ne(I.value)}`)}const K=t=>{t.type===i&&(R(),z())},x=t=>{t.type===i&&z()},j=t=>{t.type===i&&(R(),z())},J=()=>{D.value--};st(()=>{k.on("item_tags_updated",x),k.on("items_tags_updated",K),k.on("media_item_deleted",J),k.on("media_items_deleted",j)}),nt(()=>{k.off("item_tags_updated",x),k.off("items_tags_updated",K),k.off("media_item_deleted",J),k.off("media_items_deleted",j)});function De(t){$t(Tt,{type:i,tags:P.value,item:{key:t.id,title:t.title,size:t.size},selected:P.value.filter(n=>t.tags.some(Z=>Z.id===n.id))})}return(t,n)=>{const Z=Bt,X=qt,Y=Ct,ee=Ot,te=wt,Se=Vt,Ve=Le,Be=Qe,Re=It,Ze=Gt,Ee=Qt,Pe=At,Me=Fe,y=lt("tooltip");return l(),a(M,null,[e("div",Yt,[d(Z,{current:()=>`${t.$t("page_title.audios")} (${o(D)})`},null,8,["current"]),o(U)?(l(),a(M,{key:0},[f((l(),a("button",{class:"icon-button",onClick:n[0]||(n[0]=m(s=>o(ue)(o(i),u.value,o(B),A.value),["stop"]))},[eo,d(X)])),[[y,t.$t("delete")]]),f((l(),a("button",{class:"icon-button",onClick:n[1]||(n[1]=m(s=>o(he)(o(B),A.value),["stop"]))},[to,d(Y)])),[[y,t.$t("download")]]),f((l(),a("button",{class:"icon-button",onClick:n[2]||(n[2]=m(s=>o(ge)(s,o(B),A.value),["stop"]))},[oo,d(ee)])),[[y,t.$t("add_to_playlist")]]),f((l(),a("button",{class:"icon-button",onClick:n[3]||(n[3]=m(s=>o(ce)(o(B),A.value),["stop"]))},[so,d(te)])),[[y,t.$t("add_to_tags")]])],64)):L("",!0),f((l(),a("button",{class:"icon-button",onClick:m(we,["stop"])},[lo,d(Se)],8,no)),[[y,t.$t("upload")]]),d(Ve,{ref_key:"searchInputRef",ref:r,modelValue:I.value,"onUpdate:modelValue":n[5]||(n[5]=s=>I.value=s),search:G},{filters:at(()=>[e("div",ao,[f(e("md-outlined-text-field",{label:t.$t("keywords"),"onUpdate:modelValue":n[4]||(n[4]=s=>_.text=s),"keyup.enter":"applyAndDoSearch"},null,8,io),[[rt,_.text]]),e("label",co,g(t.$t("tags")),1),e("md-chip-set",uo,[(l(!0),a(M,null,oe(o(P),s=>(l(),a("md-filter-chip",{key:s.id,label:s.name,selected:_.tags.includes(s),onClick:$=>Ie(s)},null,8,ro))),128))]),e("div",_o,[e("md-filled-button",{onClick:m(Ae,["stop"])},g(t.$t("search")),9,po)])])]),_:1},8,["modelValue"])]),d(Be,{limit:E,total:o(D),"all-checked-alert-visible":o(pe),"real-all-checked":o(B),"select-real-all":o(_e),"clear-selection":o(R)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e("div",mo,[e("table",ho,[e("thead",null,[e("tr",null,[e("th",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:n[6]||(n[6]=(...s)=>o(H)&&o(H)(...s)),checked:o(F),indeterminate:!o(F)&&o(U)},null,40,fo)]),go,e("th",null,g(t.$t("name")),1),vo,e("th",yo,g(t.$t("artist")),1),e("th",null,g(t.$t("tags")),1),e("th",null,g(t.$t("duration")),1),e("th",null,g(t.$t("file_size")),1)])]),e("tbody",null,[(l(!0),a(M,null,oe(u.value,s=>(l(),a("tr",{key:s.id,class:_t({selected:s.checked}),onClick:m($=>o(me)(s),["stop"])},[e("td",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:n[7]||(n[7]=(...$)=>o(N)&&o(N)(...$)),checked:s.checked},null,40,bo)]),e("td",null,[d(Re,{id:s.id,raw:s},null,8,["id","raw"])]),e("td",$o,g(s.title),1),e("td",To,[e("div",qo,[f((l(),a("button",{class:"icon-button",onClick:m($=>o(re)(o(i),s),["stop"])},[wo,d(X)],8,Co)),[[y,t.$t("delete")]]),f((l(),a("button",{class:"icon-button",onClick:m($=>o(fe)(s.path,o(pt)(s.path).replace(" ","-")),["stop"])},[Ao,d(Y)],8,Io)),[[y,t.$t("download")]]),f((l(),a("button",{class:"icon-button",onClick:m($=>o(ve)($,s),["stop"])},[So,d(ee)],8,Do)),[[y,t.$t("add_to_playlist")]]),f((l(),a("button",{class:"icon-button",onClick:m($=>De(s),["stop"])},[Bo,d(te)],8,Vo)),[[y,t.$t("add_to_tags")]]),o($e)&&s.path===o(be)?(l(),a("md-circular-progress",Ro)):q(s)?f((l(),a("button",{key:1,class:"icon-button",onClick:n[8]||(n[8]=m($=>o(Te)(),["stop"]))},[Zo,d(Ze)])),[[y,t.$t("pause")]]):f((l(),a("button",{key:2,class:"icon-button",onClick:m($=>o(ke)(s),["stop"])},[Po,d(Ee)],8,Eo)),[[y,t.$t("play")]])])]),e("td",null,g(s.artist),1),e("td",null,[d(Pe,{tags:s.tags,type:o(i)},null,8,["tags","type"])]),e("td",Mo,g(o(mt)(s.duration)),1),e("td",zo,g(o(ht)(s.size)),1)],10,ko))),128))]),u.value.length?L("",!0):(l(),a("tfoot",Lo,[e("tr",null,[e("td",Qo,[e("div",Fo,g(t.$t(o(Rt)(o(qe),o(w).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])]),o(D)>E?(l(),it(Me,{key:0,modelValue:C.value,"onUpdate:modelValue":n[9]||(n[9]=s=>C.value=s),total:o(D),limit:E},null,8,["modelValue","total"])):L("",!0)],64)}}});const Oo=Dt(Ho,[["__scopeId","data-v-79d67fe6"]]);export{Oo as default};

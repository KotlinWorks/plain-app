import{u as It,_ as At,a as Bt}from"./list-3f4b71c4.js";import{o as a,c as l,e as o,a3 as Y,aG as Dt,u as tt,L as I,t as et,r as q,aH as St,d as Vt,p as Et,s as Zt,a as Mt,C as Pt,n as Rt,D as zt,E as Lt,G as Qt,az as Ft,ab as Nt,ay as Gt,H as Ht,aI as Ut,J as Kt,K as Ot,M as Wt,N as Xt,x as c,j as s,F as V,O as h,w as _,l as Z,y as jt,P as xt,g as f,A as X,z as Jt,aD as Yt,a5 as te,k as ee,T as oe,ag as ne,B as j,U as x,ao as se,V as ae,W as le,X as ie,Y as de,a9 as ce,ah as ue,Z as re,$ as _e,a0 as pe}from"./index-df35a132.js";import{_ as me,a as he}from"./ConfirmModal.vuevuetypescriptsetuptruelang-7328d99c.js";import{_ as fe}from"./Breadcrumb-120bdd32.js";import{n as ge}from"./list-6498ebd9.js";import{u as ye,a as ve}from"./tags-ecacebdb.js";import"./vee-validate.esm-aa1410cb.js";const ke={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},$e=o("path",{fill:"currentColor",d:"M9.5 9.325v5.35q0 .6.525.875t1.025-.05l4.15-2.65q.475-.275.475-.85t-.475-.85L11.05 8.5q-.5-.325-1.025-.05t-.525.875ZM12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Zm0-10Zm0 8q3.325 0 5.663-2.337T20 12q0-3.325-2.337-5.663T12 4Q8.675 4 6.337 6.337T4 12q0 3.325 2.337 5.663T12 20Z"},null,-1),be=[$e];function Te(p,m){return a(),l("svg",ke,be)}const qe={name:"material-symbols-play-circle-outline-rounded",render:Te},Ce={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},we=o("path",{fill:"currentColor",d:"M10 16q.425 0 .713-.288T11 15V8.975q0-.425-.288-.7T10 8q-.425 0-.713.288T9 9v6.025q0 .425.288.7T10 16Zm4 0q.425 0 .713-.288T15 15V8.975q0-.425-.288-.7T14 8q-.425 0-.713.288T13 9v6.025q0 .425.288.7T14 16Zm-2 6q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Zm0-10Zm0 8q3.325 0 5.663-2.337T20 12q0-3.325-2.337-5.663T12 4Q8.675 4 6.337 6.337T4 12q0 3.325 2.337 5.663T12 20Z"},null,-1),Ie=[we];function Ae(p,m){return a(),l("svg",Ce,Ie)}const Be={name:"material-symbols-pause-circle-outline-rounded",render:Ae},De={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Se=o("path",{fill:"currentColor",d:"M3 16v-2h7v2H3Zm0-4v-2h11v2H3Zm0-4V6h11v2H3Zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4h-2Z"},null,-1),Ve=[Se];function Ee(p,m){return a(),l("svg",De,Ve)}const Ze={name:"material-symbols-playlist-add",render:Ee};function J(p,m,u=500){const i=p.cloneNode(!0),r=p.getBoundingClientRect(),g=m.getBoundingClientRect();i.style.position="absolute",i.style.top=r.top+"px",i.style.left=r.left+"px",i.style.opacity=1,document.body.appendChild(i);let v=0;function k(d){v||(v=d);const b=d-v,A=Math.min(b/u,1);i.style.top=r.top+(g.top-r.top)*A+"px",i.style.left=r.left+(g.left-r.left)*A+"px",A<1?requestAnimationFrame(k):document.body.removeChild(i)}requestAnimationFrame(k)}const Me=p=>{const{mutate:m,loading:u,onDone:i}=Y({document:Dt,appApi:!0}),{t:r}=tt();return i(()=>{I.emit("refetch_app"),p.value.forEach(g=>{g.checked=!1})}),{loading:u,addItemsToPlaylist:g=>{const v=p.value.filter(b=>b.checked);if(v.length===0){et(r("select_first"),"error");return}const k=g.target,d=document.getElementById("quick-audio");J(k,d),m({paths:v.map(b=>b.path)})},addToPlaylist:(g,v)=>{const k=g.target,d=document.getElementById("quick-audio");J(k,d),m({paths:[v.path]})}}},Pe=()=>{const p=q(""),{mutate:m,loading:u,onDone:i}=Y({document:St,appApi:!0});return i(()=>{I.emit("play_audio")}),{loading:u,playPath:p,play:r=>{p.value=r.path,m({path:r.path})},pause:()=>{I.emit("pause_audio")}}},Re={class:"v-toolbar"},ze=["onClick"],Le={class:"filters"},Qe=["label"],Fe={class:"form-label"},Ne={type:"filter"},Ge=["label","selected","onClick"],He={class:"buttons"},Ue=["onClick"],Ke={class:"table-responsive"},Oe={class:"table"},We=["checked"],Xe=o("th",null,"ID",-1),je=o("th",null,null,-1),xe=["onClick"],Je=["checked"],Ye={class:"nowrap"},to={class:"action-btns"},eo=["onClick"],oo=["onClick"],no=["onClick"],so=["onClick"],ao={key:0,indeterminate:"",class:"spinner-sm"},lo=["onClick"],io={class:"nowrap"},co={key:0},uo={colspan:"8"},ro={class:"no-data-placeholder"},T="AUDIO",E=50,vo=Vt({__name:"AudiosView",setup(p){var G,H;const m=Et(),u=q([]),i=q(),{t:r}=tt(),{app:g,fileIdKey:v,audioPlaying:k}=Zt(Mt()),d=Pt({text:"",tags:[]}),b=t=>{var n;return((n=g.value)==null?void 0:n.audioCurrent)===t.path&&k.value},M=Rt().query,B=q(parseInt(((G=M.page)==null?void 0:G.toString())??"1")),D=q(0),C=q(zt(((H=M.q)==null?void 0:H.toString())??"")),P=q(""),{tags:S}=ye(T,C,d,async t=>{P.value=Lt(t),await Qt(),mt()}),{addItemsToPlaylist:R,addToPlaylist:ot}=Me(u),{addToTags:z}=ve(T,u,S),{deleteItems:nt,deleteItem:st}=Ft(),{downloadItems:L}=Nt(u,"audios.zip"),{downloadFile:at}=ne(v),lt=Gt(),{play:it,playPath:dt,loading:ct,pause:ut}=Pe(),{selectAll:rt,toggleSelect:Q,checked:_t}=It(u),{loading:pt,load:mt,refetch:ht}=Ht({handle:(t,n)=>{n?et(r(n),"error"):t&&(u.value=t.audios.map(w=>({...w,checked:!1})),D.value=t.audioCount)},document:Ut,variables:()=>({offset:(B.value-1)*E,limit:E,query:P.value}),appApi:!0});Kt(B,t=>{j(m,`/audios?page=${t}&q=${x(C.value)}`)});function ft(){lt.push("/files"),se(me,{message:r("upload_audios")})}function gt(t){d.tags.includes(t)?ae(d.tags,n=>n.id===t.id):d.tags.push(t)}function yt(){C.value=le(d),F(),i.value.dismiss()}function F(){j(m,`/audios?q=${x(C.value)}`)}const N=t=>{t===T&&ht()};Ot(()=>{I.on("refetch_by_tag_type",N)}),Wt(()=>{I.off("refetch_by_tag_type",N)});function vt(t){ie(de,{tagType:T,tags:S.value,item:{key:t.id,title:t.title,size:t.size},selected:S.value.filter(n=>t.tags.some(w=>w.id===n.id))})}return(t,n)=>{const w=fe,U=ce,K=ue,O=Ze,W=re,kt=he,$t=At,bt=_e,Tt=Be,qt=qe,Ct=pe,wt=Bt,y=Xt("tooltip");return a(),l(V,null,[o("div",Re,[c(w,{current:()=>`${t.$t("page_title.audios")} (${D.value})`},null,8,["current"]),s(_t)?(a(),l(V,{key:0},[h((a(),l("md-icon-button",{onClick:n[0]||(n[0]=_(e=>s(nt)(T,u.value),["stop"]))},[c(U)])),[[y,t.$t("delete")]]),h((a(),l("md-icon-button",{onClick:n[1]||(n[1]=_((...e)=>s(L)&&s(L)(...e),["stop"]))},[c(K)])),[[y,t.$t("download")]]),h((a(),l("md-icon-button",{onClick:n[2]||(n[2]=_((...e)=>s(R)&&s(R)(...e),["stop"]))},[c(O)])),[[y,t.$t("add_to_playlist")]]),h((a(),l("md-icon-button",{onClick:n[3]||(n[3]=_((...e)=>s(z)&&s(z)(...e),["stop"]))},[c(W)])),[[y,t.$t("add_to_tags")]])],64)):Z("",!0),h((a(),l("md-icon-button",{onClick:_(ft,["stop"])},[c(kt)],8,ze)),[[y,t.$t("upload")]]),c($t,{ref_key:"searchInputRef",ref:i,modelValue:C.value,"onUpdate:modelValue":n[5]||(n[5]=e=>C.value=e),search:F},{filters:jt(()=>[o("div",Le,[h(o("md-outlined-text-field",{label:t.$t("keywords"),"onUpdate:modelValue":n[4]||(n[4]=e=>d.text=e),"keyup.enter":"applyAndDoSearch"},null,8,Qe),[[xt,d.text]]),o("label",Fe,f(t.$t("tags")),1),o("md-chip-set",Ne,[(a(!0),l(V,null,X(s(S),e=>(a(),l("md-filter-chip",{key:e.id,label:e.name,selected:d.tags.includes(e),onClick:$=>gt(e)},null,8,Ge))),128))]),o("div",He,[o("md-filled-button",{onClick:_(yt,["stop"])},f(t.$t("search")),9,Ue)])])]),_:1},8,["modelValue"])]),o("div",Ke,[o("table",Oe,[o("thead",null,[o("tr",null,[o("th",null,[o("md-checkbox",{"touch-target":"wrapper",onChange:n[6]||(n[6]=(...e)=>s(Q)&&s(Q)(...e)),checked:s(rt)},null,40,We)]),Xe,o("th",null,f(t.$t("name")),1),je,o("th",null,f(t.$t("artist")),1),o("th",null,f(t.$t("tags")),1),o("th",null,f(t.$t("duration")),1),o("th",null,f(t.$t("file_size")),1)])]),o("tbody",null,[(a(!0),l(V,null,X(u.value,e=>(a(),l("tr",{key:e.id,class:Jt({selected:e.checked}),onClick:_($=>e.checked=!e.checked,["stop"])},[o("td",null,[o("md-checkbox",{"touch-target":"wrapper",checked:e.checked},null,8,Je)]),o("td",null,[c(bt,{id:e.id,raw:e},null,8,["id","raw"])]),o("td",null,f(e.title),1),o("td",Ye,[o("div",to,[h((a(),l("md-icon-button",{onClick:_($=>s(st)(T,e),["stop"])},[c(U)],8,eo)),[[y,t.$t("delete")]]),h((a(),l("md-icon-button",{onClick:_($=>s(at)(e.path,s(Yt)(e.path).replace(" ","-")),["stop"])},[c(K)],8,oo)),[[y,t.$t("download")]]),h((a(),l("md-icon-button",{onClick:_($=>s(ot)($,e),["stop"])},[c(O)],8,no)),[[y,t.$t("add_to_playlist")]]),h((a(),l("md-icon-button",{onClick:_($=>vt(e),["stop"])},[c(W)],8,so)),[[y,t.$t("add_to_tags")]]),s(ct)&&e.path===s(dt)?(a(),l("md-circular-progress",ao)):b(e)?h((a(),l("md-icon-button",{key:1,onClick:n[7]||(n[7]=_($=>s(ut)(),["stop"]))},[c(Tt)])),[[y,t.$t("pause")]]):h((a(),l("md-icon-button",{key:2,onClick:_($=>s(it)(e),["stop"])},[c(qt)],8,lo)),[[y,t.$t("play")]])])]),o("td",null,f(e.artist),1),o("td",null,[c(Ct,{tags:e.tags,tagType:T},null,8,["tags"])]),o("td",io,f(s(te)(e.duration)),1),o("td",null,f(s(ee)(e.size)),1)],10,xe))),128))]),u.value.length?Z("",!0):(a(),l("tfoot",co,[o("tr",null,[o("td",uo,[o("div",ro,f(t.$t(s(ge)(s(pt),s(g).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])]),D.value>E?(a(),oe(wt,{key:0,modelValue:B.value,"onUpdate:modelValue":n[8]||(n[8]=e=>B.value=e),total:D.value,limit:E},null,8,["modelValue","total"])):Z("",!0)],64)}}});export{vo as default};

import{u as Ge,_ as Ke,a as Oe,b as je}from"./list-be40ed35.js";import{o as l,c as a,a as e,i as ce,aL as We,u as ue,P as b,x as _e,r as D,aM as xe,d as Je,e as Xe,s as le,f as Ye,K as et,L as tt,D as ot,M as st,aB as nt,af as lt,aA as at,N as it,w as dt,O as ct,Q as ut,R as _t,p as d,j as o,F as P,m,l as h,k as F,H,t as f,J as N,S as rt,T as pt,U as mt,aN as ht,C as ae,W as ie,at as ft,v as vt,I as gt,aF as yt,a9 as bt,z as kt,$ as $t,A as Tt,B as qt,al as Ct,aG as wt,as as It,aH as At,a0 as St,a1 as Bt,a2 as Dt,a3 as Vt,ad as Rt,am as Mt,a4 as Pt,a5 as Zt,a6 as Et,_ as Lt}from"./index-a9bbc323.js";import{_ as Qt}from"./sort-rounded-a0681bba.js";import{_ as zt}from"./upload-rounded-8f3d4361.js";import{_ as Ft}from"./Breadcrumb-7b5128ab.js";import{u as Ht,a as Nt}from"./tags-7e5964e8.js";import"./vee-validate.esm-d674d968.js";const Ut={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Gt=e("path",{fill:"currentColor",d:"M9.5 9.325v5.35q0 .6.525.875t1.025-.05l4.15-2.65q.475-.275.475-.85t-.475-.85L11.05 8.5q-.5-.325-1.025-.05t-.525.875ZM12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Zm0-10Zm0 8q3.325 0 5.663-2.337T20 12q0-3.325-2.337-5.663T12 4Q8.675 4 6.337 6.337T4 12q0 3.325 2.337 5.663T12 20Z"},null,-1),Kt=[Gt];function Ot(c,v){return l(),a("svg",Ut,Kt)}const jt={name:"material-symbols-play-circle-outline-rounded",render:Ot},Wt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},xt=e("path",{fill:"currentColor",d:"M10 16q.425 0 .713-.288T11 15V8.975q0-.425-.288-.7T10 8q-.425 0-.713.288T9 9v6.025q0 .425.288.7T10 16Zm4 0q.425 0 .713-.288T15 15V8.975q0-.425-.288-.7T14 8q-.425 0-.713.288T13 9v6.025q0 .425.288.7T14 16Zm-2 6q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Zm0-10Zm0 8q3.325 0 5.663-2.337T20 12q0-3.325-2.337-5.663T12 4Q8.675 4 6.337 6.337T4 12q0 3.325 2.337 5.663T12 20Z"},null,-1),Jt=[xt];function Xt(c,v){return l(),a("svg",Wt,Jt)}const Yt={name:"material-symbols-pause-circle-outline-rounded",render:Xt},eo={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},to=e("path",{fill:"currentColor",d:"M3 16v-2h7v2H3Zm0-4v-2h11v2H3Zm0-4V6h11v2H3Zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4h-2Z"},null,-1),oo=[to];function so(c,v){return l(),a("svg",eo,oo)}const no={name:"material-symbols-playlist-add",render:so};function de(c,v,k=500){const i=c.cloneNode(!0),_=c.getBoundingClientRect(),C=v.getBoundingClientRect();i.style.position="absolute",i.style.top=_.top+"px",i.style.left=_.left+"px",i.style.opacity=1,document.body.appendChild(i);let $=0;function T(q){$||($=q);const u=q-$,w=Math.min(u/k,1);i.style.top=_.top+(C.top-_.top)*w+"px",i.style.left=_.left+(C.left-_.left)*w+"px",w<1?requestAnimationFrame(T):document.body.removeChild(i)}requestAnimationFrame(T)}const lo=(c,v)=>{const{mutate:k,loading:i,onDone:_}=ce({document:We,appApi:!0}),{t:C}=ue();return _(()=>{b.emit("refetch_app"),v()}),{loading:i,addItemsToPlaylist:($,T,q)=>{let u=q;if(!T){const Q=c.value.filter(I=>I.checked);if(Q.length===0){_e(C("select_first"),"error");return}u=`ids:${Q.map(I=>I.id).join(",")}`}const w=$.target,g=document.getElementById("quick-audio");de(w,g),k({query:u})},addToPlaylist:($,T)=>{const q=$.target,u=document.getElementById("quick-audio");de(q,u),k({query:`ids:${T.id}`})}}},ao=()=>{const c=D(""),{mutate:v,loading:k,onDone:i}=ce({document:xe,appApi:!0});return i(()=>{b.emit("play_audio")}),{loading:k,playPath:c,play:_=>{c.value=_.path,v({path:_.path})},pause:()=>{b.emit("pause_audio")}}},p=c=>(Tt("data-v-dd874a81"),c=c(),qt(),c),io={class:"v-toolbar"},co=p(()=>e("md-ripple",null,null,-1)),uo=p(()=>e("md-ripple",null,null,-1)),_o=p(()=>e("md-ripple",null,null,-1)),ro=p(()=>e("md-ripple",null,null,-1)),po=["onClick"],mo=p(()=>e("md-ripple",null,null,-1)),ho={class:"icon-button btn-sort"},fo=p(()=>e("md-ripple",null,null,-1)),vo={class:"menu-items"},go=["onClick","selected"],yo={slot:"headline"},bo={class:"filters"},ko=["label"],$o={class:"form-label"},To=["label","selected","onClick"],qo={class:"buttons"},Co=["onClick"],wo={class:"table-responsive"},Io={class:"table"},Ao=["checked","indeterminate"],So=p(()=>e("th",null,"ID",-1)),Bo=p(()=>e("th",null,null,-1)),Do={class:"artist"},Vo=["onClick"],Ro=["checked"],Mo={class:"title"},Po={class:"nowrap"},Zo={class:"action-btns"},Eo=["onClick"],Lo=p(()=>e("md-ripple",null,null,-1)),Qo=["onClick"],zo=p(()=>e("md-ripple",null,null,-1)),Fo=["onClick"],Ho=p(()=>e("md-ripple",null,null,-1)),No=["onClick"],Uo=p(()=>e("md-ripple",null,null,-1)),Go={key:0,indeterminate:"",class:"spinner-sm"},Ko=p(()=>e("md-ripple",null,null,-1)),Oo=["onClick"],jo=p(()=>e("md-ripple",null,null,-1)),Wo={class:"nowrap"},xo={class:"nowrap"},Jo={key:0},Xo={colspan:"8"},Yo={class:"no-data-placeholder"},Z=50,es=Je({__name:"AudiosView",setup(c){var Y,ee;const v=Xe(),{audioSortBy:k}=le(v),i=D([]),_=D(),{t:C}=ue(),{app:$,urlTokenKey:T,audioPlaying:q}=le(Ye()),u=et({text:"",tags:[]}),w=t=>{var n;return q.value&&((n=$.value)==null?void 0:n.audioCurrent)===t.path},g=tt.AUDIO,I=ot().query,E=D(parseInt(((Y=I.page)==null?void 0:Y.toString())??"1")),A=D(st(((ee=I.q)==null?void 0:ee.toString())??"")),S=D(""),{tags:L}=Ht(g,A,u,async t=>{S.value=pt(t),await mt(),Se()}),{addToTags:re}=Nt(g,i,L),{deleteItems:pe,deleteItem:me}=nt(),{allChecked:U,realAllChecked:V,selectRealAll:he,allCheckedAlertVisible:fe,clearSelection:R,toggleAllChecked:G,toggleRow:ve,toggleItemChecked:K,total:B,checked:O}=Ge(i),{downloadItems:ge}=lt(T,g,i,R,"audios.zip"),{downloadFile:ye}=Ct(T),{addItemsToPlaylist:be,addToPlaylist:ke}=lo(i,R),$e=wt(),Te=at(),{play:qe,playPath:Ce,loading:we,pause:Ie}=ao(),{loading:Ae,load:Se,refetch:z}=it({handle:(t,n)=>{n?_e(C(n),"error"):t&&(i.value=t.audios.map(M=>({...M,checked:!1})),B.value=t.audioCount)},document:ht,variables:()=>({offset:(E.value-1)*Z,limit:Z,query:S.value,sortBy:k.value}),appApi:!0});dt(E,t=>{ae(v,`/audios?page=${t}&q=${ie(A.value)}`)});function Be(){Te.push("/files"),It(At,{message:C("upload_audios")})}function De(t,n){k.value=n,t.close()}function Ve(t){u.tags.includes(t)?St(u.tags,n=>n.id===t.id):u.tags.push(t)}function Re(){A.value=Bt(u),j(),_.value.dismiss()}function j(){ae(v,`/audios?q=${ie(A.value)}`)}const W=t=>{t.type===g&&(R(),z())},x=t=>{t.type===g&&z()},J=t=>{t.type===g&&(R(),z())},X=()=>{B.value--};ct(()=>{b.on("item_tags_updated",x),b.on("items_tags_updated",W),b.on("media_item_deleted",X),b.on("media_items_deleted",J)}),ut(()=>{b.off("item_tags_updated",x),b.off("items_tags_updated",W),b.off("media_item_deleted",X),b.off("media_items_deleted",J)});function Me(t){Dt(Vt,{type:g,tags:L.value,item:{key:t.id,title:t.title,size:t.size},selected:L.value.filter(n=>t.tags.some(M=>M.id===n.id))})}return(t,n)=>{const M=Ft,te=Rt,oe=Mt,se=no,ne=Pt,Pe=zt,Ze=Qt,Ee=ft,Le=Ke,Qe=Oe,ze=Zt,Fe=Yt,He=jt,Ne=Et,Ue=je,y=_t("tooltip");return l(),a(P,null,[e("div",io,[d(M,{current:()=>`${t.$t("page_title.audios")} (${o(B)})`},null,8,["current"]),o(O)?(l(),a(P,{key:0},[m((l(),a("button",{class:"icon-button",onClick:n[0]||(n[0]=h(s=>o(pe)(o(g),i.value,o(V),S.value),["stop"]))},[co,d(te)])),[[y,t.$t("delete")]]),m((l(),a("button",{class:"icon-button",onClick:n[1]||(n[1]=h(s=>o(ge)(o(V),S.value),["stop"]))},[uo,d(oe)])),[[y,t.$t("download")]]),m((l(),a("button",{class:"icon-button",onClick:n[2]||(n[2]=h(s=>o(be)(s,o(V),S.value),["stop"]))},[_o,d(se)])),[[y,t.$t("add_to_playlist")]]),m((l(),a("button",{class:"icon-button",onClick:n[3]||(n[3]=h(s=>o(re)(o(V),S.value),["stop"]))},[ro,d(ne)])),[[y,t.$t("add_to_tags")]])],64)):F("",!0),m((l(),a("button",{class:"icon-button",onClick:h(Be,["stop"])},[mo,d(Pe)],8,po)),[[y,t.$t("upload")]]),d(Ee,null,{content:H(s=>[e("div",vo,[(l(!0),a(P,null,N(o($e),r=>(l(),a("md-menu-item",{onClick:ts=>De(s,r.value),selected:r.value===o(k)},[e("div",yo,f(t.$t(r.label)),1)],8,go))),256))])]),default:H(()=>[m((l(),a("button",ho,[fo,d(Ze)])),[[y,t.$t("sort")]])]),_:1}),d(Le,{ref_key:"searchInputRef",ref:_,modelValue:A.value,"onUpdate:modelValue":n[5]||(n[5]=s=>A.value=s),search:j},{filters:H(()=>[e("div",bo,[m(e("md-outlined-text-field",{label:t.$t("keywords"),"onUpdate:modelValue":n[4]||(n[4]=s=>u.text=s),"keyup.enter":"applyAndDoSearch"},null,8,ko),[[vt,u.text]]),e("label",$o,f(t.$t("tags")),1),e("md-chip-set",null,[(l(!0),a(P,null,N(o(L),s=>(l(),a("md-filter-chip",{key:s.id,label:s.name,selected:u.tags.includes(s),onClick:r=>Ve(s)},null,8,To))),128))]),e("div",qo,[e("md-filled-button",{onClick:h(Re,["stop"])},f(t.$t("search")),9,Co)])])]),_:1},8,["modelValue"])]),d(Qe,{limit:Z,total:o(B),"all-checked-alert-visible":o(fe),"real-all-checked":o(V),"select-real-all":o(he),"clear-selection":o(R)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e("div",wo,[e("table",Io,[e("thead",null,[e("tr",null,[e("th",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:n[6]||(n[6]=(...s)=>o(G)&&o(G)(...s)),checked:o(U),indeterminate:!o(U)&&o(O)},null,40,Ao)]),So,e("th",null,f(t.$t("name")),1),Bo,e("th",Do,f(t.$t("artist")),1),e("th",null,f(t.$t("tags")),1),e("th",null,f(t.$t("duration")),1),e("th",null,f(t.$t("file_size")),1)])]),e("tbody",null,[(l(!0),a(P,null,N(i.value,s=>(l(),a("tr",{key:s.id,class:gt({selected:s.checked}),onClick:h(r=>o(ve)(s),["stop"])},[e("td",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:n[7]||(n[7]=(...r)=>o(K)&&o(K)(...r)),checked:s.checked},null,40,Ro)]),e("td",null,[d(ze,{id:s.id,raw:s},null,8,["id","raw"])]),e("td",Mo,f(s.title),1),e("td",Po,[e("div",Zo,[m((l(),a("button",{class:"icon-button",onClick:h(r=>o(me)(o(g),s),["stop"])},[Lo,d(te)],8,Eo)),[[y,t.$t("delete")]]),m((l(),a("button",{class:"icon-button",onClick:h(r=>o(ye)(s.path,o(yt)(s.path).replace(" ","-")),["stop"])},[zo,d(oe)],8,Qo)),[[y,t.$t("download")]]),m((l(),a("button",{class:"icon-button",onClick:h(r=>o(ke)(r,s),["stop"])},[Ho,d(se)],8,Fo)),[[y,t.$t("add_to_playlist")]]),m((l(),a("button",{class:"icon-button",onClick:h(r=>Me(s),["stop"])},[Uo,d(ne)],8,No)),[[y,t.$t("add_to_tags")]]),o(we)&&s.path===o(Ce)?(l(),a("md-circular-progress",Go)):w(s)?m((l(),a("button",{key:1,class:"icon-button",onClick:n[8]||(n[8]=h(r=>o(Ie)(),["stop"]))},[Ko,d(Fe)])),[[y,t.$t("pause")]]):m((l(),a("button",{key:2,class:"icon-button",onClick:h(r=>o(qe)(s),["stop"])},[jo,d(He)],8,Oo)),[[y,t.$t("play")]])])]),e("td",null,f(s.artist),1),e("td",null,[d(Ne,{tags:s.tags,type:o(g)},null,8,["tags","type"])]),e("td",Wo,f(o(bt)(s.duration)),1),e("td",xo,f(o(kt)(s.size)),1)],10,Vo))),128))]),i.value.length?F("",!0):(l(),a("tfoot",Jo,[e("tr",null,[e("td",Xo,[e("div",Yo,f(t.$t(o($t)(o(Ae),o($).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])]),o(B)>Z?(l(),rt(Ue,{key:0,modelValue:E.value,"onUpdate:modelValue":n[9]||(n[9]=s=>E.value=s),total:o(B),limit:Z},null,8,["modelValue","total"])):F("",!0)],64)}}});const cs=Lt(es,[["__scopeId","data-v-dd874a81"]]);export{cs as default};

import{b as ae,u as le,_ as ce,a as de}from"./list-e3388e63.js";import{_ as ie}from"./FieldId-7f31c269.js";import{_ as ue}from"./Multiselect-a3c8b9c6.js";import{_ as re}from"./Dropdown.vuevuetypescriptsetuptruelang-0680b1f0.js";import{_ as pe}from"./Breadcrumb-a2d00dde.js";import{d as _e,p as me,r as d,u as fe,A as he,n as ve,B as ge,c1 as be,D as ye,t as Q,c2 as ke,i as $e,C as we,c3 as Ce,G as Ve,H as Fe,I as R,U as Te,c4 as Ee,o as i,c as p,b as e,e as y,w as T,f as a,v as Qe,J as D,K as De,L as Se,M as z,g as u,N as Ue,F as S,y as P,x as Ae,ab as Ie,k as U,O as qe,P as Be,Q as Le,z as H,R as J,m as Me}from"./index-bf00d94e.js";import{c as xe,k as O,b as Ge,a as Ke}from"./search-26cd7c25.js";import{n as Ne}from"./list-6498ebd9.js";import{a as Re,b as ze}from"./tags-ac73dd49.js";import"./VModal.vuevuetypescriptsetuptruelang-31725e85.js";import"./baseIndexOf-70b929c6.js";import"./vee-validate.esm-4409073a.js";const Pe={class:"v-toolbar"},He={class:"right-actions"},Je=["disabled","onClick"],Oe={class:"row mb-3"},Ye={class:"col-md-3 col-form-label"},je={class:"col-md-9"},We=["onKeyup"],Xe={class:"row mb-3"},Ze={class:"col-md-3 col-form-label"},et={class:"col-md-9"},tt={class:"actions"},st=["onClick"],ot={class:"table"},nt=e("th",null,"ID",-1),at=e("th",null,null,-1),lt=["onClick"],ct=["onUpdate:modelValue"],dt=["src"],it=["href","onClick"],ut={class:"badge"},rt=["title"],pt={key:0},_t={colspan:"7"},mt={class:"no-data-placeholder"},Qt=_e({__name:"FeedsView",setup(ft){var K,N;const A=me(),r=d([]),{t:_}=fe(),l=he({text:"",feeds:[],tags:[]}),k="FEED_ENTRY",I=ve().query,$=d(parseInt(((K=I.page)==null?void 0:K.toString())??"1")),w=50,C=d(0),V=d([]),Y=d([]),m=d(ge(((N=I.q)==null?void 0:N.toString())??"")),q=d(""),{addToTags:j}=Re(k,r,V),{removeFromTags:W}=ze(k,r,V),{deleteItems:X}=ae(be,()=>{L()},r),F=d(!1),Z=[{text:_("add_to_tags"),click:j},{text:_("remove_from_tags"),click:W},{text:_("delete"),click:X}],{selectAll:E,toggleSelect:B}=le(r),{loading:ee,load:te,refetch:L}=ye({handle:(t,o)=>{o?Q(_(o),"error"):t&&(r.value=t.feedEntries.map(f=>({...f,checked:!1})),C.value=t.feedEntryCount)},document:ke,variables:()=>({offset:($.value-1)*w,limit:w,query:q.value}),appApi:!0});$e({handle:async(t,o)=>{if(o)Q(_(o),"error");else if(t){V.value=t.tags,Y.value=t.feeds;const f=xe(m.value);l.tags=[];const h=[],v=[];f.forEach(n=>{if(n.name==="text")l.text=n.value;else if(n.name==="tag"){const c=t.tags.find(s=>O(s.name)===n.value);c?(l.tags.push(c),h.push(c.id)):h.push("invalid")}else if(n.name==="feed"){const c=t.feeds.find(s=>O(s.name)===n.value);c?(l.feeds.push(c),v.push(c.id)):v.push("invalid")}});const g=[...f].filter(n=>n.name!=="tag"&&n.name!=="feed");h.forEach(n=>{g.push({name:"tag_id",op:"",value:n})}),v.forEach(n=>{g.push({name:"feed_id",op:"",value:n})}),q.value=Ge(g),await we(),te()}},document:Ce,variables:{type:k},appApi:!0}),Ve($,t=>{H(A,`/feeds?page=${t}&q=${J(m.value)}`)});function M(){m.value=Ke(l),x()}function x(){H(A,`/feeds?q=${J(m.value)}`)}Fe(()=>{R.on("refetch_by_tag_type",t=>{t===k&&L()}),R.on("feeds_fetched",t=>{F.value=!1,Q(t.error||_("feeds_synced"))})});function se(t){Me.push(G(t))}function G(t){return`/feeds/${t.feedId}/entries/${t.id}`}const{mutate:oe}=Te({document:Ee,appApi:!0});function ne(){F.value=!0,oe({id:""})}return(t,o)=>{const f=pe,h=re,v=ue,g=ce,n=ie,c=de;return i(),p(S,null,[e("div",Pe,[y(f,{current:()=>`${t.$t("page_title.feeds")} (${C.value})`},null,8,["current"]),e("div",He,[e("button",{class:"btn btn-action",disabled:F.value,type:"button",onClick:T(ne,["prevent"])},a(F.value?t.$t("syncing"):t.$t("sync_feeds")),9,Je),y(h,{title:t.$t("actions"),items:Z},null,8,["title"]),y(g,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=s=>m.value=s),search:x},{filters:Qe(()=>[e("div",Oe,[e("label",Ye,a(t.$t("keywords")),1),e("div",je,[D(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>l.text=s),class:"form-control",onKeyup:Se(M,["enter"])},null,40,We),[[De,l.text]])])]),e("div",Xe,[e("label",Ze,a(t.$t("tags")),1),e("div",et,[y(v,{modelValue:l.tags,"onUpdate:modelValue":o[1]||(o[1]=s=>l.tags=s),label:"name","track-by":"id",options:V.value},null,8,["modelValue","options"])])]),e("div",tt,[e("button",{type:"button",class:"btn",onClick:T(M,["stop"])},a(t.$t("search")),9,st)])]),_:1},8,["modelValue"])])]),e("table",ot,[e("thead",null,[e("tr",null,[e("th",null,[D(e("input",{class:"form-check-input",type:"checkbox",onChange:o[3]||(o[3]=(...s)=>u(B)&&u(B)(...s)),"onUpdate:modelValue":o[4]||(o[4]=s=>Ue(E)?E.value=s:null)},null,544),[[z,u(E)]])]),nt,at,e("th",null,a(t.$t("title")),1),e("th",null,a(t.$t("source")),1),e("th",null,a(t.$t("tags")),1),e("th",null,a(t.$t("published_at")),1)])]),e("tbody",null,[(i(!0),p(S,null,P(r.value,s=>(i(),p("tr",{key:s.id,class:Ae({checked:s.checked}),onClick:T(b=>s.checked=!s.checked,["stop"])},[e("td",null,[D(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":b=>s.checked=b},null,8,ct),[[z,s.checked]])]),e("td",null,[y(n,{id:s.id,raw:s},null,8,["id","raw"])]),e("td",null,[s.image?(i(),p("img",{key:0,src:u(Ie)(s.image)+"&w=200&h=200",width:"50",height:"50"},null,8,dt)):U("",!0)]),e("td",null,[e("a",{href:G(s),onClick:T(b=>se(s),["prevent"])},a(s.title||t.$t("no_content")),9,it)]),e("td",null,a(s.author),1),e("td",null,[(i(!0),p(S,null,P(s.tags,b=>(i(),p("span",ut,a(b.name),1))),256))]),e("td",{class:"nowrap",title:u(qe)(s.publishedAt)},a(u(Be)(s.publishedAt)),9,rt)],10,lt))),128))]),r.value.length?U("",!0):(i(),p("tfoot",pt,[e("tr",null,[e("td",_t,[e("div",mt,a(t.$t(u(Ne)(u(ee)))),1)])])]))]),C.value>w?(i(),Le(c,{key:0,modelValue:$.value,"onUpdate:modelValue":o[5]||(o[5]=s=>$.value=s),total:C.value,limit:w},null,8,["modelValue","total"])):U("",!0)],64)}}});export{Qt as default};

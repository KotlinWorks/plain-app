import{D as ke,c as ye,u as be,_ as $e,a as Ce,b as we}from"./list-052a81ba.js";import{d as Te,a as De,r as f,u as Fe,B as Ae,p as Ee,C as Se,$ as h,ch as Ve,G as qe,t as L,ci as Ie,i as Qe,ab as Ue,bD as x,D as Be,E as Le,cj as Ne,I as Me,J as Re,K as Ge,a2 as ze,ck as He,L as je,o,e as d,f as t,x as r,k as l,F as q,M as C,w as m,m as I,j as c,y as Ke,N as Pe,A as ee,z as Ye,as as Je,P as We,g as Xe,Q as Ze,R as Oe,V as te,a6 as xe,a7 as et,W as tt,n as se,S as le,T as st,U as lt,aT as nt,a8 as at,X as ot,Y as dt,Z as it}from"./index-5e3ce573.js";import{_ as ct}from"./Breadcrumb-db3f2c63.js";import{n as ut}from"./list-6498ebd9.js";import{a as rt}from"./tags-25ba5c36.js";import"./vee-validate.esm-e8a787ff.js";const _t={class:"v-toolbar"},pt=t("md-ripple",null,null,-1),ft=t("md-ripple",null,null,-1),ht=["disabled","onClick"],mt={class:"filters"},gt=["label"],vt={class:"form-label"},kt={type:"filter"},yt=["label","selected","onClick"],bt={class:"buttons"},$t=["onClick"],Ct={class:"table-responsive"},wt={class:"table"},Tt=["checked","indeterminate"],Dt=t("th",null,"ID",-1),Ft=t("th",null,null,-1),At=t("th",null,null,-1),Et=["onClick"],St=["checked"],Vt=["src"],qt=["href","onClick"],It={class:"nowrap"},Qt={class:"action-btns"},Ut=["onClick"],Bt=t("md-ripple",null,null,-1),Lt=["onClick"],Nt=t("md-ripple",null,null,-1),Mt={class:"nowrap"},Rt={class:"nowrap"},Gt={key:0},zt={colspan:"8"},Ht={class:"no-data-placeholder"},A=50,Ot=Te({__name:"FeedsView",setup(jt){var Z,O;const N=De(),g=f([]),M=f(),{t:Q}=Fe(),i=Ae({text:"",feeds:[],tags:[]}),_=ke.FEED_ENTRY,R=Ee().query,E=f(parseInt(((Z=R.page)==null?void 0:Z.toString())??"1")),w=f([]),ne=f([]),v=f(Se(((O=R.q)==null?void 0:O.toString())??"")),S=f(""),{addToTags:ae}=rt(_,g,w),{deleteItems:oe}=ye(Ve,()=>{B(),g.value.some(e=>e.tags.length)&&h.emit("refetch_tags",_)},g),V=f(!1),{allChecked:G,realAllChecked:U,selectRealAll:de,allCheckedAlertVisible:ie,clearSelection:z,toggleAllChecked:H,toggleItemChecked:j,total:k,checked:K}=be(g),{loading:ce,load:ue,refetch:B}=qe({handle:(e,n)=>{n?L(Q(n),"error"):e&&(g.value=e.feedEntries.map(p=>({...p,checked:!1})),k.value=e.feedEntryCount)},document:Ie,variables:()=>({offset:(E.value-1)*A,limit:A,query:S.value}),appApi:!0});function re(e){te(et,{id:e.id,name:e.title,gql:xe`
      mutation deleteFeedEntry($query: String!) {
        deleteFeedEntries(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),appApi:!0,typeName:"FeedEntry",done:()=>{k.value--,e.tags.length&&h.emit("refetch_tags",_)}})}Qe({handle:async(e,n)=>{if(n)L(Q(n),"error");else if(e){w.value=e.tags,ne.value=e.feeds;const p=Ue(v.value);i.tags=[];const y=[],b=[];p.forEach(a=>{if(a.name==="text")i.text=a.value;else if(a.name==="tag"){const u=e.tags.find(D=>x(D.name)===a.value);u?(i.tags.push(u),y.push(u.id)):y.push("invalid")}else if(a.name==="feed"){const u=e.feeds.find(D=>x(D.name)===a.value);u?(i.feeds.push(u),b.push(u.id)):b.push("invalid")}});const T=[...p].filter(a=>a.name!=="tag"&&a.name!=="feed");y.forEach(a=>{T.push({name:"tag_id",op:"",value:a})}),b.forEach(a=>{T.push({name:"feed_id",op:"",value:a})}),S.value=Be(T),await Le(),ue()}},document:Ne,variables:{type:_},appApi:!0});function _e(e){te(tt,{type:_,tags:w.value,item:{key:e.id,title:"",size:0},selected:w.value.filter(n=>e.tags.some(p=>p.id===n.id))})}Me(E,e=>{se(N,`/feeds?page=${e}&q=${le(v.value)}`)});function pe(e){i.tags.includes(e)?st(i.tags,n=>n.id===e.id):i.tags.push(e)}function fe(){v.value=lt(i),P(),M.value.dismiss()}function P(){se(N,`/feeds?q=${le(v.value)}`)}const Y=e=>{V.value=!1,L(e.error||Q("feeds_synced"))},J=e=>{e.type===_&&(z(),B())},W=e=>{e.type===_&&B()};Re(()=>{h.on("item_tags_updated",W),h.on("items_tags_updated",J),h.on("feeds_fetched",Y)}),Ge(()=>{h.off("item_tags_updated",W),h.off("items_tags_updated",J),h.off("feeds_fetched",Y)});function he(e){nt.push(X(e))}function X(e){return`/feeds/${e.feedId}/entries/${e.id}`}const{mutate:me}=ze({document:He,appApi:!0});function ge(){V.value=!0,me({id:""})}return(e,n)=>{const p=ct,y=at,b=ot,T=$e,a=Ce,u=dt,D=it,ve=we,F=je("tooltip");return o(),d(q,null,[t("div",_t,[r(p,{current:()=>`${e.$t("page_title.feeds")} (${l(k)})`},null,8,["current"]),l(K)?(o(),d(q,{key:0},[C((o(),d("button",{class:"icon-button",onClick:n[0]||(n[0]=m(s=>l(oe)(l(U),S.value),["stop"]))},[pt,r(y)])),[[F,e.$t("delete")]]),C((o(),d("button",{class:"icon-button",onClick:n[1]||(n[1]=m(s=>l(ae)(l(U),S.value),["stop"]))},[ft,r(b)])),[[F,e.$t("add_to_tags")]])],64)):I("",!0),t("md-outlined-button",{disabled:V.value,onClick:m(ge,["prevent"])},c(V.value?e.$t("syncing"):e.$t("sync_feeds")),9,ht),r(T,{ref_key:"searchInputRef",ref:M,modelValue:v.value,"onUpdate:modelValue":n[3]||(n[3]=s=>v.value=s),search:P},{filters:Ke(()=>[t("div",mt,[C(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":n[2]||(n[2]=s=>i.text=s),"keyup.enter":"applyAndDoSearch"},null,8,gt),[[Pe,i.text]]),t("label",vt,c(e.$t("tags")),1),t("md-chip-set",kt,[(o(!0),d(q,null,ee(w.value,s=>(o(),d("md-filter-chip",{key:s.id,label:s.name,selected:i.tags.includes(s),onClick:$=>pe(s)},null,8,yt))),128))]),t("div",bt,[t("md-filled-button",{onClick:m(fe,["stop"])},c(e.$t("search")),9,$t)])])]),_:1},8,["modelValue"])]),r(a,{limit:A,total:l(k),"all-checked-alert-visible":l(ie),"real-all-checked":l(U),"select-real-all":l(de),"clear-selection":l(z)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",Ct,[t("table",wt,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:n[4]||(n[4]=(...s)=>l(H)&&l(H)(...s)),checked:l(G),indeterminate:!l(G)&&l(K)},null,40,Tt)]),Dt,Ft,t("th",null,c(e.$t("title")),1),At,t("th",null,c(e.$t("source")),1),t("th",null,c(e.$t("tags")),1),t("th",null,c(e.$t("published_at")),1)])]),t("tbody",null,[(o(!0),d(q,null,ee(g.value,s=>(o(),d("tr",{key:s.id,class:Ye({selected:s.checked}),onClick:m($=>s.checked=!s.checked,["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:n[5]||(n[5]=(...$)=>l(j)&&l(j)(...$)),checked:s.checked},null,40,St)]),t("td",null,[r(u,{id:s.id,raw:s},null,8,["id","raw"])]),t("td",null,[s.image?(o(),d("img",{key:0,src:l(Je)(s.image)+"&w=300&h=300",width:"50",height:"50"},null,8,Vt)):I("",!0)]),t("td",null,[t("a",{href:X(s),onClick:m($=>he(s),["prevent"])},c(s.title||e.$t("no_content")),9,qt)]),t("td",It,[t("div",Qt,[C((o(),d("button",{class:"icon-button",onClick:m($=>re(s),["stop"])},[Bt,r(y)],8,Ut)),[[F,e.$t("delete")]]),C((o(),d("button",{class:"icon-button",onClick:m($=>_e(s),["stop"])},[Nt,r(b)],8,Lt)),[[F,e.$t("add_to_tags")]])])]),t("td",Mt,c(s.author),1),t("td",null,[r(D,{tags:s.tags,type:l(_)},null,8,["tags","type"])]),t("td",Rt,[C((o(),d("span",null,[Xe(c(l(Ze)(s.publishedAt)),1)])),[[F,l(We)(s.publishedAt)]])])],10,Et))),128))]),g.value.length?I("",!0):(o(),d("tfoot",Gt,[t("tr",null,[t("td",zt,[t("div",Ht,c(e.$t(l(ut)(l(ce)))),1)])])]))])]),l(k)>A?(o(),Oe(ve,{key:0,modelValue:E.value,"onUpdate:modelValue":n[6]||(n[6]=s=>E.value=s),total:l(k),limit:A},null,8,["modelValue","total"])):I("",!0)],64)}}});export{Ot as default};

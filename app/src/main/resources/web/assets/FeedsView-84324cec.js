import{c as ke,u as ye,_ as be,a as $e,b as Ce}from"./list-0d4e7717.js";import{d as we,e as Te,r as _,u as Fe,K as Ee,L as Se,D as qe,M as Ae,N as Ve,g as De,w as Ie,O as Qe,P as f,Q as Ue,i as Le,R as Me,c as d,a as t,p as h,j as l,F as I,m as C,l as m,k as Q,t as c,H as Ne,J as X,S as Re,ch as Be,x as N,ci as Ge,ag as He,bJ as ee,T as ze,U as Ye,cj as je,C as te,W as se,ck as Je,o,v as Ke,I as Pe,ax as xe,Y as Oe,h as We,Z as Ze,$ as Xe,a2 as le,ab as et,ac as tt,a3 as st,a0 as lt,a1 as at,aY as nt,ad as ot,a4 as dt,a6 as it}from"./index-c1ff76a9.js";import{_ as ct}from"./Breadcrumb-aaa94fae.js";import{a as ut}from"./tags-3e568fc1.js";import"./vee-validate.esm-9ec67176.js";const rt={class:"v-toolbar"},pt=t("md-ripple",null,null,-1),_t=t("md-ripple",null,null,-1),ft=["disabled","onClick"],ht={class:"filters"},mt=["label"],gt={class:"form-label"},vt=["label","selected","onClick"],kt={class:"buttons"},yt=["onClick"],bt={class:"table-responsive"},$t={class:"table"},Ct=["checked","indeterminate"],wt=t("th",null,null,-1),Tt=t("th",null,null,-1),Ft=["onClick"],Et=["checked"],St=["src"],qt={style:{"min-width":"200px"}},At=["href","onClick"],Vt={class:"nowrap"},Dt={class:"action-btns"},It=["onClick"],Qt=t("md-ripple",null,null,-1),Ut=["onClick"],Lt=t("md-ripple",null,null,-1),Mt={class:"nowrap"},Nt={class:"nowrap"},Rt={key:0},Bt={colspan:"7"},Gt={class:"no-data-placeholder"},S=50,xt=we({__name:"FeedsView",setup(Ht){var W,Z;const R=Te(),g=_([]),B=_(),{t:U}=Fe(),i=Ee({text:"",feeds:[],tags:[]}),r=Se.FEED_ENTRY,G=qe().query,q=_(parseInt(((W=G.page)==null?void 0:W.toString())??"1")),w=_([]),ae=_([]),v=_(Ae(((Z=G.q)==null?void 0:Z.toString())??"")),A=_(""),{addToTags:ne}=ut(r,g,w),{deleteItems:oe}=ke(Be,()=>{D(),M(),g.value.some(e=>e.tags.length)&&f.emit("refetch_tags",r)},g),V=_(!1),{allChecked:H,realAllChecked:L,selectRealAll:de,allCheckedAlertVisible:ie,clearSelection:D,toggleAllChecked:z,toggleItemChecked:Y,toggleRow:ce,total:k,checked:j}=ye(g),{loading:ue,load:re,refetch:M}=Ve({handle:(e,a)=>{a?N(U(a),"error"):e&&(g.value=e.feedEntries.map(p=>({...p,checked:!1})),k.value=e.feedEntryCount)},document:Ge,variables:()=>({offset:(q.value-1)*S,limit:S,query:A.value}),appApi:!0});function pe(e){le(tt,{id:e.id,name:e.title,gql:et`
      mutation deleteFeedEntry($query: String!) {
        deleteFeedEntries(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),appApi:!0,typeName:"FeedEntry",done:()=>{D(),k.value--,e.tags.length&&f.emit("refetch_tags",r)}})}De({handle:async(e,a)=>{if(a)N(U(a),"error");else if(e){w.value=e.tags,ae.value=e.feeds;const p=He(v.value);i.tags=[];const y=[],b=[];p.forEach(n=>{if(n.name==="text")i.text=n.value;else if(n.name==="tag"){const u=e.tags.find(F=>ee(F.name)===n.value);u?(i.tags.push(u),y.push(u.id)):y.push("invalid")}else if(n.name==="feed"){const u=e.feeds.find(F=>ee(F.name)===n.value);u?(i.feeds.push(u),b.push(u.id)):b.push("invalid")}});const T=[...p].filter(n=>n.name!=="tag"&&n.name!=="feed");y.forEach(n=>{T.push({name:"tag_id",op:"",value:n})}),b.forEach(n=>{T.push({name:"feed_id",op:"",value:n})}),A.value=ze(T),await Ye(),re()}},document:je,variables:{type:r},appApi:!0});function _e(e){le(st,{type:r,tags:w.value,item:{key:e.id,title:"",size:0},selected:w.value.filter(a=>e.tags.some(p=>p.id===a.id))})}Ie(q,e=>{te(R,`/feeds?page=${e}&q=${se(v.value)}`)});function fe(e){i.tags.includes(e)?lt(i.tags,a=>a.id===e.id):i.tags.push(e)}function he(){v.value=at(i),J(),B.value.dismiss()}function J(){te(R,`/feeds?q=${se(v.value)}`)}const K=e=>{V.value=!1,N(e.error||U("feeds_synced"))},P=e=>{e.type===r&&(D(),M())},x=e=>{e.type===r&&M()};Qe(()=>{f.on("item_tags_updated",x),f.on("items_tags_updated",P),f.on("feeds_fetched",K)}),Ue(()=>{f.off("item_tags_updated",x),f.off("items_tags_updated",P),f.off("feeds_fetched",K)});function me(e){nt.push(O(e))}function O(e){return`/feeds/${e.feedId}/entries/${e.id}`}const{mutate:ge}=Le({document:Je,appApi:!0});function ve(){V.value=!0,ge({id:""})}return(e,a)=>{const p=ct,y=ot,b=dt,T=be,n=$e,u=it,F=Ce,E=Me("tooltip");return o(),d(I,null,[t("div",rt,[h(p,{current:()=>`${e.$t("page_title.feeds")} (${l(k)})`},null,8,["current"]),l(j)?(o(),d(I,{key:0},[C((o(),d("button",{class:"icon-button",onClick:a[0]||(a[0]=m(s=>l(oe)(l(L),A.value),["stop"]))},[pt,h(y)])),[[E,e.$t("delete")]]),C((o(),d("button",{class:"icon-button",onClick:a[1]||(a[1]=m(s=>l(ne)(l(L),A.value),["stop"]))},[_t,h(b)])),[[E,e.$t("add_to_tags")]])],64)):Q("",!0),t("md-outlined-button",{disabled:V.value,onClick:m(ve,["prevent"])},c(V.value?e.$t("syncing"):e.$t("sync_feeds")),9,ft),h(T,{ref_key:"searchInputRef",ref:B,modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=s=>v.value=s),search:J},{filters:Ne(()=>[t("div",ht,[C(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":a[2]||(a[2]=s=>i.text=s),"keyup.enter":"applyAndDoSearch"},null,8,mt),[[Ke,i.text]]),t("label",gt,c(e.$t("tags")),1),t("md-chip-set",null,[(o(!0),d(I,null,X(w.value,s=>(o(),d("md-filter-chip",{key:s.id,label:s.name,selected:i.tags.includes(s),onClick:$=>fe(s)},null,8,vt))),128))]),t("div",kt,[t("md-filled-button",{onClick:m(he,["stop"])},c(e.$t("search")),9,yt)])])]),_:1},8,["modelValue"])]),h(n,{limit:S,total:l(k),"all-checked-alert-visible":l(ie),"real-all-checked":l(L),"select-real-all":l(de),"clear-selection":l(D)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",bt,[t("table",$t,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:a[4]||(a[4]=(...s)=>l(z)&&l(z)(...s)),checked:l(H),indeterminate:!l(H)&&l(j)},null,40,Ct)]),wt,t("th",null,c(e.$t("title")),1),Tt,t("th",null,c(e.$t("source")),1),t("th",null,c(e.$t("tags")),1),t("th",null,c(e.$t("published_at")),1)])]),t("tbody",null,[(o(!0),d(I,null,X(g.value,s=>(o(),d("tr",{key:s.id,class:Pe({selected:s.checked}),onClick:m($=>l(ce)(s),["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:a[5]||(a[5]=(...$)=>l(Y)&&l(Y)(...$)),checked:s.checked},null,40,Et)]),t("td",null,[s.image?(o(),d("img",{key:0,src:l(xe)(s.image)+"&w=300&h=300",width:"50",height:"50"},null,8,St)):Q("",!0)]),t("td",qt,[t("a",{href:O(s),onClick:m($=>me(s),["stop","prevent"])},c(s.title||e.$t("no_content")),9,At)]),t("td",Vt,[t("div",Dt,[C((o(),d("button",{class:"icon-button",onClick:m($=>pe(s),["stop"])},[Qt,h(y)],8,It)),[[E,e.$t("delete")]]),C((o(),d("button",{class:"icon-button",onClick:m($=>_e(s),["stop"])},[Lt,h(b)],8,Ut)),[[E,e.$t("add_to_tags")]])])]),t("td",Mt,c(s.author),1),t("td",null,[h(u,{tags:s.tags,type:l(r)},null,8,["tags","type"])]),t("td",Nt,[C((o(),d("span",null,[We(c(l(Ze)(s.publishedAt)),1)])),[[E,l(Oe)(s.publishedAt)]])])],10,Ft))),128))]),g.value.length?Q("",!0):(o(),d("tfoot",Rt,[t("tr",null,[t("td",Bt,[t("div",Gt,c(e.$t(l(Xe)(l(ue)))),1)])])]))])]),l(k)>S?(o(),Re(F,{key:0,modelValue:q.value,"onUpdate:modelValue":a[6]||(a[6]=s=>q.value=s),total:l(k),limit:S},null,8,["modelValue","total"])):Q("",!0)],64)}}});export{xt as default};

import{D as ye,c as be,u as $e,_ as Ce,a as we,b as Te}from"./data-17e9864e.js";import{d as Ee,a as Fe,r as f,u as Ae,B as De,p as Se,C as Ve,D as qe,i as Ie,E as Qe,G as Ue,H as Be,a0 as Le,I as Re,e as d,f as t,x as r,h as l,F as q,J as C,w as h,j as I,t as c,y as Me,A as x,K as Ne,X as m,ch as Ge,k as L,ci as ze,ab as He,bE as ee,L as je,M as Ke,cj as Pe,n as te,O as se,ck as Ye,o,P as Je,z as Oe,as as We,R as Xe,g as Ze,S as xe,V as le,a6 as et,a7 as tt,W as st,T as lt,U as nt,aU as at,a8 as ot,Y as dt,Z as it,$ as ct}from"./index-71d8bb76.js";import{_ as ut}from"./Breadcrumb-91ff4b3f.js";import{n as rt}from"./list-6498ebd9.js";import{a as _t}from"./tags-779e8f21.js";import"./vee-validate.esm-49ea0aba.js";const pt={class:"v-toolbar"},ft=t("md-ripple",null,null,-1),ht=t("md-ripple",null,null,-1),mt=["disabled","onClick"],gt={class:"filters"},vt=["label"],kt={class:"form-label"},yt={type:"filter"},bt=["label","selected","onClick"],$t={class:"buttons"},Ct=["onClick"],wt={class:"table-responsive"},Tt={class:"table"},Et=["checked","indeterminate"],Ft=t("th",null,"ID",-1),At=t("th",null,null,-1),Dt=t("th",null,null,-1),St=["onClick"],Vt=["checked"],qt=["src"],It=["href","onClick"],Qt={class:"nowrap"},Ut={class:"action-btns"},Bt=["onClick"],Lt=t("md-ripple",null,null,-1),Rt=["onClick"],Mt=t("md-ripple",null,null,-1),Nt={class:"nowrap"},Gt={class:"nowrap"},zt={key:0},Ht={colspan:"8"},jt={class:"no-data-placeholder"},A=50,xt=Ee({__name:"FeedsView",setup(Kt){var X,Z;const R=Fe(),g=f([]),M=f(),{t:Q}=Ae(),i=De({text:"",feeds:[],tags:[]}),_=ye.FEED_ENTRY,N=Se().query,D=f(parseInt(((X=N.page)==null?void 0:X.toString())??"1")),w=f([]),ne=f([]),v=f(Ve(((Z=N.q)==null?void 0:Z.toString())??"")),S=f(""),{addToTags:ae}=_t(_,g,w),{deleteItems:oe}=be(Ge,()=>{B(),g.value.some(e=>e.tags.length)&&m.emit("refetch_tags",_)},g),V=f(!1),{allChecked:G,realAllChecked:U,selectRealAll:de,allCheckedAlertVisible:ie,clearSelection:z,toggleAllChecked:H,toggleItemChecked:j,toggleRow:ce,total:k,checked:K}=$e(g),{loading:ue,load:re,refetch:B}=qe({handle:(e,n)=>{n?L(Q(n),"error"):e&&(g.value=e.feedEntries.map(p=>({...p,checked:!1})),k.value=e.feedEntryCount)},document:ze,variables:()=>({offset:(D.value-1)*A,limit:A,query:S.value}),appApi:!0});function _e(e){le(tt,{id:e.id,name:e.title,gql:et`
      mutation deleteFeedEntry($query: String!) {
        deleteFeedEntries(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),appApi:!0,typeName:"FeedEntry",done:()=>{k.value--,e.tags.length&&m.emit("refetch_tags",_)}})}Ie({handle:async(e,n)=>{if(n)L(Q(n),"error");else if(e){w.value=e.tags,ne.value=e.feeds;const p=He(v.value);i.tags=[];const y=[],b=[];p.forEach(a=>{if(a.name==="text")i.text=a.value;else if(a.name==="tag"){const u=e.tags.find(E=>ee(E.name)===a.value);u?(i.tags.push(u),y.push(u.id)):y.push("invalid")}else if(a.name==="feed"){const u=e.feeds.find(E=>ee(E.name)===a.value);u?(i.feeds.push(u),b.push(u.id)):b.push("invalid")}});const T=[...p].filter(a=>a.name!=="tag"&&a.name!=="feed");y.forEach(a=>{T.push({name:"tag_id",op:"",value:a})}),b.forEach(a=>{T.push({name:"feed_id",op:"",value:a})}),S.value=je(T),await Ke(),re()}},document:Pe,variables:{type:_},appApi:!0});function pe(e){le(st,{type:_,tags:w.value,item:{key:e.id,title:"",size:0},selected:w.value.filter(n=>e.tags.some(p=>p.id===n.id))})}Qe(D,e=>{te(R,`/feeds?page=${e}&q=${se(v.value)}`)});function fe(e){i.tags.includes(e)?lt(i.tags,n=>n.id===e.id):i.tags.push(e)}function he(){v.value=nt(i),P(),M.value.dismiss()}function P(){te(R,`/feeds?q=${se(v.value)}`)}const Y=e=>{V.value=!1,L(e.error||Q("feeds_synced"))},J=e=>{e.type===_&&(z(),B())},O=e=>{e.type===_&&B()};Ue(()=>{m.on("item_tags_updated",O),m.on("items_tags_updated",J),m.on("feeds_fetched",Y)}),Be(()=>{m.off("item_tags_updated",O),m.off("items_tags_updated",J),m.off("feeds_fetched",Y)});function me(e){at.push(W(e))}function W(e){return`/feeds/${e.feedId}/entries/${e.id}`}const{mutate:ge}=Le({document:Ye,appApi:!0});function ve(){V.value=!0,ge({id:""})}return(e,n)=>{const p=ut,y=ot,b=dt,T=Ce,a=we,u=it,E=ct,ke=Te,F=Re("tooltip");return o(),d(q,null,[t("div",pt,[r(p,{current:()=>`${e.$t("page_title.feeds")} (${l(k)})`},null,8,["current"]),l(K)?(o(),d(q,{key:0},[C((o(),d("button",{class:"icon-button",onClick:n[0]||(n[0]=h(s=>l(oe)(l(U),S.value),["stop"]))},[ft,r(y)])),[[F,e.$t("delete")]]),C((o(),d("button",{class:"icon-button",onClick:n[1]||(n[1]=h(s=>l(ae)(l(U),S.value),["stop"]))},[ht,r(b)])),[[F,e.$t("add_to_tags")]])],64)):I("",!0),t("md-outlined-button",{disabled:V.value,onClick:h(ve,["prevent"])},c(V.value?e.$t("syncing"):e.$t("sync_feeds")),9,mt),r(T,{ref_key:"searchInputRef",ref:M,modelValue:v.value,"onUpdate:modelValue":n[3]||(n[3]=s=>v.value=s),search:P},{filters:Me(()=>[t("div",gt,[C(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":n[2]||(n[2]=s=>i.text=s),"keyup.enter":"applyAndDoSearch"},null,8,vt),[[Je,i.text]]),t("label",kt,c(e.$t("tags")),1),t("md-chip-set",yt,[(o(!0),d(q,null,x(w.value,s=>(o(),d("md-filter-chip",{key:s.id,label:s.name,selected:i.tags.includes(s),onClick:$=>fe(s)},null,8,bt))),128))]),t("div",$t,[t("md-filled-button",{onClick:h(he,["stop"])},c(e.$t("search")),9,Ct)])])]),_:1},8,["modelValue"])]),r(a,{limit:A,total:l(k),"all-checked-alert-visible":l(ie),"real-all-checked":l(U),"select-real-all":l(de),"clear-selection":l(z)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",wt,[t("table",Tt,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:n[4]||(n[4]=(...s)=>l(H)&&l(H)(...s)),checked:l(G),indeterminate:!l(G)&&l(K)},null,40,Et)]),Ft,At,t("th",null,c(e.$t("title")),1),Dt,t("th",null,c(e.$t("source")),1),t("th",null,c(e.$t("tags")),1),t("th",null,c(e.$t("published_at")),1)])]),t("tbody",null,[(o(!0),d(q,null,x(g.value,s=>(o(),d("tr",{key:s.id,class:Oe({selected:s.checked}),onClick:h($=>l(ce)(s),["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:n[5]||(n[5]=(...$)=>l(j)&&l(j)(...$)),checked:s.checked},null,40,Vt)]),t("td",null,[r(u,{id:s.id,raw:s},null,8,["id","raw"])]),t("td",null,[s.image?(o(),d("img",{key:0,src:l(We)(s.image)+"&w=300&h=300",width:"50",height:"50"},null,8,qt)):I("",!0)]),t("td",null,[t("a",{href:W(s),onClick:h($=>me(s),["prevent"])},c(s.title||e.$t("no_content")),9,It)]),t("td",Qt,[t("div",Ut,[C((o(),d("button",{class:"icon-button",onClick:h($=>_e(s),["stop"])},[Lt,r(y)],8,Bt)),[[F,e.$t("delete")]]),C((o(),d("button",{class:"icon-button",onClick:h($=>pe(s),["stop"])},[Mt,r(b)],8,Rt)),[[F,e.$t("add_to_tags")]])])]),t("td",Nt,c(s.author),1),t("td",null,[r(E,{tags:s.tags,type:l(_)},null,8,["tags","type"])]),t("td",Gt,[C((o(),d("span",null,[Ze(c(l(xe)(s.publishedAt)),1)])),[[F,l(Xe)(s.publishedAt)]])])],10,St))),128))]),g.value.length?I("",!0):(o(),d("tfoot",zt,[t("tr",null,[t("td",Ht,[t("div",jt,c(e.$t(l(rt)(l(ue)))),1)])])]))])]),l(k)>A?(o(),Ne(ke,{key:0,modelValue:D.value,"onUpdate:modelValue":n[6]||(n[6]=s=>D.value=s),total:l(k),limit:A},null,8,["modelValue","total"])):I("",!0)],64)}}});export{xt as default};

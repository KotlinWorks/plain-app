import{o as a,c as r,e as i,d as De,a3 as $e,a7 as st,aj as nt,g as d,j as n,u as at,r as $,n as lt,D as it,ac as rt,p as ct,a as ut,s as he,b4 as dt,b5 as mt,b6 as pt,b7 as _t,b8 as ht,b9 as ft,aa as fe,ba as bt,aA as vt,J as kt,K as gt,L as be,M as yt,N as Tt,x as k,F as g,O as E,w,l as h,f as y,y as j,A as ve,T as K,z as Ct,bb as ke,bc as ge,at as qt,S as Dt,k as v,ag as $t,bd as wt,X as L,a9 as Vt,ah as Ft,be as It,bf as Mt,bg as St,bh as xt,_ as Bt}from"./index-df35a132.js";import{_ as At}from"./Breadcrumb-120bdd32.js";import{c as ye}from"./index-4e369b28.js";import{g as Te,M as Et}from"./splitpanes.es-c959884b.js";import{n as Lt}from"./list-6498ebd9.js";import{t as Pt}from"./truncate-cc7a2700.js";import{E as Ce}from"./EditValueModal-46b4c4bb.js";import"./stringToArray-a8dcbce9.js";import"./vee-validate.esm-aa1410cb.js";const Zt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Nt=i("path",{fill:"currentColor",d:"M19.6 21.6L12 14l-2.35 2.35q.2.375.275.8T10 18q0 1.65-1.175 2.825T6 22q-1.65 0-2.825-1.175T2 18q0-1.65 1.175-2.825T6 14q.425 0 .85.075t.8.275L10 12L7.65 9.65q-.375.2-.8.275T6 10q-1.65 0-2.825-1.175T2 6q0-1.65 1.175-2.825T6 2q1.65 0 2.825 1.175T10 6q0 .425-.075.85t-.275.8L21.6 19.6q.425.425.425 1t-.425 1q-.425.425-1 .425t-1-.425ZM15 11l-2-2l6.6-6.6q.425-.425 1-.425t1 .425q.425.425.425 1t-.425 1L15 11ZM6 8q.825 0 1.413-.588T8 6q0-.825-.588-1.413T6 4q-.825 0-1.413.588T4 6q0 .825.588 1.413T6 8Zm6 4.5q.225 0 .363-.138T12.5 12q0-.225-.138-.363T12 11.5q-.225 0-.363.138T11.5 12q0 .225.138.363T12 12.5ZM6 20q.825 0 1.413-.588T8 18q0-.825-.588-1.413T6 16q-.825 0-1.413.588T4 18q0 .825.588 1.413T6 20Z"},null,-1),Wt=[Nt];function zt(T,s){return a(),r("svg",Zt,Wt)}const Rt={name:"material-symbols-content-cut-rounded",render:zt},Ut={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ht=i("path",{fill:"currentColor",d:"M9 18q-.825 0-1.413-.588T7 16V4q0-.825.588-1.413T9 2h9q.825 0 1.413.588T20 4v12q0 .825-.588 1.413T18 18H9Zm0-2h9V4H9v12Zm-4 6q-.825 0-1.413-.588T3 20V7q0-.425.288-.713T4 6q.425 0 .713.288T5 7v13h10q.425 0 .713.288T16 21q0 .425-.288.713T15 22H5ZM9 4v12V4Z"},null,-1),Ot=[Ht];function jt(T,s){return a(),r("svg",Ut,Ot)}const Kt={name:"material-symbols-content-copy-outline-rounded",render:jt},Gt={id:"form",slot:"content",method:"dialog"},Jt={slot:"actions"},Qt={form:"form",value:"cancel",autofocus:""},Xt=["disabled"],qe=De({__name:"DeleteFileConfirm",props:{onDone:{type:Function,required:!0},files:{type:Array,required:!0}},setup(T){const s=T,{mutate:P,loading:V,onDone:Z}=$e({document:st`
    mutation DeleteFiles($paths: [String!]!) {
      deleteFiles(paths: $paths)
    }
  `,appApi:!0});function u(){P({paths:s.files.map(f=>f.path)})}return Z(()=>{s.onDone(s.files),nt()}),(f,F)=>(a(),r("md-dialog",null,[i("form",Gt,d(f.$t("confirm_to_delete_name",{name:n(Pt)(T.files.map(_=>_.name).join(", "),{length:200})})),1),i("div",Jt,[i("md-outlined-button",Qt,d(f.$t("cancel")),1),i("md-filled-button",{form:"form",value:"delete",disabled:n(V),onClick:u},d(f.$t("delete")),9,Xt)])]))}}),Yt={class:"v-toolbar"},eo={class:"right-actions"},to=["onClick"],oo=["onClick"],so={class:"form-check mt-2 me-3 ms-3"},no={class:"form-check-label"},ao=["checked"],lo={class:"form-check mt-2"},io={class:"form-check-label"},ro=["checked"],co={class:"file-items"},uo=["onClick","onDblclick","onContextmenu"],mo=["checked"],po=["src"],_o={class:"title"},ho={style:{"font-size":"0.75rem"}},fo=["onContextmenu"],bo={key:0,class:"no-files"},vo={key:0,class:"file-item-info"},ko=De({__name:"FilesVIew",setup(T){var ue,de,me,pe;const{t:s}=at(),P=$([]),V=lt(),Z=V.query,u=V.params.type,f=$(it(((ue=Z.q)==null?void 0:ue.toString())??"")),F=rt(f.value),_=$(((de=F.find(e=>e.name==="path"))==null?void 0:de.value)??"");let I=((me=F.find(e=>e.name==="dir"))==null?void 0:me.value)??"";I||(((pe=F.find(t=>t.name==="isDir"))==null?void 0:pe.value)==="1"?I=_.value:I=_.value.substring(0,_.value.lastIndexOf("/")));const we=$(I),C=$(!1),G=ct(),J=ut(),{app:q,fileIdKey:N,selectedFiles:Ve}=he(J);let M=q.value.internalStoragePath;u&&(u==="sdcard"?M=q.value.sdcardPath:u.startsWith("usb")?M=q.value.usbDiskPaths[parseInt(u.substring(3))-1]:u==="app"&&(M=q.value.externalFilesDir));const{loading:Fe,panels:p,currentDir:W,refetch:Q}=dt(N,M,we.value),{createPath:Ie,createVariables:Me,createMutation:Se}=mt(N,p),{renameValue:xe,renamePath:Be,renameDone:Ae,renameMutation:Ee,renameVariables:Le}=pt(p),{internal:X,sdcard:Y,usb:Pe,refetch:z}=_t(),{onDeleted:ee}=Mt(p,W,z),{downloadFile:te,downloadDir:Ze,downloadFiles:Ne}=$t(N),{view:R}=St(P,(e,t)=>{J.lightbox={sources:e,index:t,visible:!0}}),{selectedItem:S,select:We}=ht(W,u,f,G),{canPaste:oe,copy:U,cut:se,paste:H}=ft(Ve,Q,z),{input:ze,upload:ne,uploadChanged:ae}=fe(),{input:Re,upload:le,uploadChanged:ie}=fe(),{mutate:Ue,onDone:He}=$e({document:bt,appApi:!0});He(e=>{Ne(e.data.setTempValue.key)});const D=()=>{const e=[];return p.value.forEach(t=>{t.items.forEach(o=>{o.checked&&(o.panel=t,e.push(o))})}),e};function Oe(e){C.value=e.target.checked}const je=()=>{Ue({key:wt(),value:JSON.stringify(D().map(e=>({path:e.path})))})},Ke=vt(()=>D().length>0),Ge=()=>{L(qe,{files:D(),onDone:ee})},{fileShowHidden:x}=he(G);_.value&&kt(()=>p.value.length,()=>{if(p.value.length>0&&_.value){const t=p.value[p.value.length-1].items.find(o=>o.path===_.value);t&&(S.value=t,_.value="")}});function Je(){var e,t,o,c;if(u){if(u==="sdcard")return`${s("sdcard")} (${s("storage_free_total",{free:v(((e=Y.value)==null?void 0:e.freeBytes)??0),total:v(((t=Y.value)==null?void 0:t.totalBytes)??0)})})`;if(u==="app")return s("app_name");if(u.startsWith("usb")){const B=parseInt(u.substring(3)),b=Pe.value[B-1];return`${s("usb_storage")} ${B} (${s("storage_free_total",{free:v((b==null?void 0:b.freeBytes)??0),total:v((b==null?void 0:b.totalBytes)??0)})})`}}return`${s("page_title.files")} (${s("storage_free_total",{free:v(((o=X.value)==null?void 0:o.freeBytes)??0),total:v(((c=X.value)==null?void 0:c.totalBytes)??0)})})`}function Qe(e,t){if(C.value){t.checked=!t.checked;return}We(e,t)}function re(e){return ke(e.name)||ge(e.name)||xt(e.name)}function Xe(e,t){t.isDir||(re(t)?R(x?e.items:e.items.filter(o=>!o.name.startsWith(".")),t):te(t.path))}function Ye(e,t){e.preventDefault();const o=[{label:s("create_folder"),onClick:()=>{Ie.value=t,L(Ce,{title:s("name"),placeholder:s("name"),mutation:Se,getVariables:Me})}},{label:s("upload_files"),onClick:()=>{ne(t)}},{label:s("upload_folder"),onClick:()=>{le(t)}}];oe()&&o.push({label:s("paste"),onClick:()=>{H(t)}}),ye({x:e.x,y:e.y,items:o})}function et(e,t,o){e.preventDefault();let c;o.isDir?c=[{label:s("upload_files"),onClick:()=>{ne(o.path)}},{label:s("upload_folder"),onClick:()=>{le(o.path)}},{label:s("download"),onClick:()=>{Ze(o.path)}}]:(c=[],re(o)&&c.push({label:s("open"),onClick:()=>{R(t.items,o)}}),c.push({label:s("download"),onClick:()=>{te(o.path)}})),c.push({label:s("duplicate"),onClick:()=>{U([o]),H(t.dir)}}),c.push({label:s("cut"),onClick:()=>{o.panel=t,se([o])}}),c.push({label:s("copy"),onClick:()=>{U([o])}}),o.isDir&&oe()&&c.push({label:s("paste"),onClick:()=>{H(o.path)}}),c=[...c,{label:s("rename"),onClick:()=>{xe.value=o.name,Be.value=o.path,L(Ce,{title:s("rename"),placeholder:s("name"),value:o.name,mutation:Ee,getVariables:Le,done:Ae})}},{label:s("delete"),onClick:()=>{L(qe,{files:[o],onDone:ee})}}],ye({x:e.x,y:e.y,items:c})}const ce=e=>{e.status==="done"&&setTimeout(()=>{Q(e.dir),z()},1e3)};return gt(()=>{be.on("upload_task_done",ce)}),yt(()=>{be.off("upload_task_done",ce)}),(e,t)=>{const o=At,c=Kt,B=Rt,b=Vt,tt=Ft,ot=It,A=Tt("tooltip");return a(),r(g,null,[i("div",Yt,[k(o,{current:Je}),i("div",eo,[C.value&&Ke.value?(a(),r(g,{key:0},[E((a(),r("md-icon-button",{onClick:t[0]||(t[0]=w(()=>n(U)(D()),["stop"]))},[k(c)])),[[A,e.$t("copy")]]),E((a(),r("md-icon-button",{onClick:t[1]||(t[1]=w(()=>n(se)(D()),["stop"]))},[k(B)])),[[A,e.$t("cut")]]),E((a(),r("md-icon-button",{onClick:w(Ge,["stop"])},[k(b)],8,to)),[[A,e.$t("delete")]]),E((a(),r("md-icon-button",{onClick:w(je,["stop"])},[k(tt)],8,oo)),[[A,e.$t("download")]])],64)):h("",!0),i("div",so,[i("label",no,[i("md-checkbox",{"touch-target":"wrapper",onChange:Oe,checked:C.value},null,40,ao),y(" "+d(e.$t("select_mode")),1)])]),i("div",lo,[i("label",io,[i("md-checkbox",{"touch-target":"wrapper",checked:n(x)},null,8,ro),y(d(e.$t("show_hidden")),1)])])])]),k(n(Et),{class:"panel-container"},{default:j(()=>[(a(!0),r(g,null,ve(n(p),m=>(a(),K(n(Te),{key:m.dir},{default:j(()=>[i("div",co,[(a(!0),r(g,null,ve(m.items,l=>{var _e;return a(),r(g,{key:l.path},[!l.name.startsWith(".")||n(x)?(a(),r("div",{key:0,class:Ct(["file-item",{active:(n(W)+"/").startsWith(l.path+"/")||((_e=n(S))==null?void 0:_e.path)===l.path}]),onClick:O=>Qe(m,l),onDblclick:w(O=>Xe(m,l),["prevent"]),onContextmenu:O=>et(O,m,l)},[C.value?(a(),r("md-checkbox",{key:0,"touch-target":"wrapper",checked:l.checked},null,8,mo)):h("",!0),l.isDir?(a(),K(ot,{key:1})):h("",!0),n(ke)(l.name)||n(ge)(l.name)?(a(),r("img",{key:2,src:n(qt)(l.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,po)):h("",!0),i("div",_o,[y(d(l.name)+" ",1),i("div",ho,[y(d(n(Dt)(l.updatedAt)),1),l.isDir?h("",!0):(a(),r(g,{key:0},[y(", "+d(n(v)(l.size)),1)],64))])])],42,uo)):h("",!0)],64)}),128)),i("div",{class:"empty",onContextmenu:l=>Ye(l,m.dir)},[m.items.filter(l=>!l.name.startsWith(".")||n(x)).length===0?(a(),r("div",bo,d(e.$t("no_files")),1)):h("",!0)],40,fo)])]),_:2},1024))),128)),n(p).length===0?(a(),K(n(Te),{key:0,class:"no-data-placeholder"},{default:j(()=>[y(d(e.$t(n(Lt)(n(Fe),n(q).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):h("",!0)]),_:1}),n(S)?(a(),r("div",vo,d(e.$t("path"))+": "+d(n(S).path),1)):h("",!0),i("input",{ref_key:"fileInput",ref:ze,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...m)=>n(ae)&&n(ae)(...m))},null,544),i("input",{ref_key:"dirFileInput",ref:Re,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[3]||(t[3]=(...m)=>n(ie)&&n(ie)(...m))},null,544)],64)}}});const Fo=Bt(ko,[["__scopeId","data-v-fbeb15af"]]);export{Fo as default};

import{o as i,c as d,b as r,d as ve,U as ke,Y as Ze,a1 as Je,Q as V,v as q,f as p,g as o,u as Xe,r as C,n as Ke,B as Ye,p as et,s as ie,a as tt,ae as st,aM as at,t as re,aN as ot,X as M,G as nt,H as lt,I as it,e as A,k as h,J as H,M as R,N as rt,F as D,y as ce,x as ct,aO as ue,aP as de,ab as ut,j as S,P as dt,l as w,aj as pt,aQ as mt,_ as ht}from"./index-bf00d94e.js";import{_ as _t}from"./Dropdown.vuevuetypescriptsetuptruelang-0680b1f0.js";import{_ as ft}from"./Breadcrumb-a2d00dde.js";import{c as pe}from"./index-a2ad7536.js";import{g as me,M as vt}from"./splitpanes.es-f68e6bb8.js";import{n as kt}from"./list-6498ebd9.js";import{b as yt,c as bt,d as gt,e as Ct,f as Dt,g as wt,h as he,i as Vt,a as xt,j as $t}from"./files-0cf0fe0f.js";import{_ as Ft}from"./VModal.vuevuetypescriptsetuptruelang-31725e85.js";import{t as It}from"./truncate-64da8598.js";import{_ as _e}from"./EditValueModal.vuevuetypescriptsetuptruelang-8b3d484f.js";import{c as Tt}from"./search-26cd7c25.js";import"./baseIndexOf-70b929c6.js";import"./toInteger-af75cc11.js";import"./stringToArray-11593afd.js";import"./vee-validate.esm-4409073a.js";const Mt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},St=r("path",{fill:"currentColor",d:"M4 20q-.825 0-1.413-.588T2 18V6q0-.825.588-1.413T4 4h5.175q.4 0 .763.15t.637.425L12 6h8q.825 0 1.413.588T22 8v10q0 .825-.588 1.413T20 20H4ZM4 6v12h16V8h-8.825l-2-2H4Zm0 0v12V6Z"},null,-1),qt=[St];function Bt(x,s){return i(),d("svg",Mt,qt)}const Pt={name:"material-symbols-folder-outline-rounded",render:Bt},Ut=["disabled"],fe=ve({__name:"DeleteFileConfirm",props:{onDone:{type:Function,required:!0},files:{type:Array,required:!0}},setup(x){const s=x,{mutate:$,loading:F,onDone:B}=ke({document:Ze`
    mutation DeleteFiles($paths: [String!]!) {
      deleteFiles(paths: $paths)
    }
  `,appApi:!0});function _(){$({paths:s.files.map(f=>f.path)})}return B(()=>{s.onDone(s.files),Je()}),(f,I)=>{const m=Ft;return i(),V(m,{class:"delete-modal",title:f.$t("confirm_to_delete_name",{name:o(It)(x.files.map(k=>k.name).join(", "),{length:200})})},{action:q(()=>[r("button",{type:"button",disabled:o(F),class:"btn",onClick:_},p(f.$t("delete")),9,Ut)]),_:1},8,["title"])}}}),Et={class:"v-toolbar"},Nt={class:"right-actions"},At={class:"form-check mt-2 me-4"},Ht={class:"form-check-label",for:"select-mode"},Rt={class:"form-check mt-2"},zt={class:"form-check-label",for:"show-hidden"},jt={class:"file-items"},Lt=["onClick","onDblclick","onContextmenu"],Ot=["onUpdate:modelValue"],Qt=["src"],Wt={class:"title"},Gt={style:{"font-size":"0.75rem"}},Zt=["onContextmenu"],Jt={key:0,class:"no-files"},Xt={key:0,class:"file-item-info"},Kt=ve({__name:"FilesVIew",setup(x){var se,ae,oe,ne;const{t:s}=Xe(),$=C([]),F=Ke(),B=F.query,_=F.params.type,f=C(Ye(((se=B.q)==null?void 0:se.toString())??"")),I=Tt(f.value),m=C(((ae=I.find(e=>e.name==="path"))==null?void 0:ae.value)??"");let k=((oe=I.find(e=>e.name==="dir"))==null?void 0:oe.value)??"";k||(((ne=I.find(t=>t.name==="isDir"))==null?void 0:ne.value)==="1"?k=m.value:k=m.value.substring(0,m.value.lastIndexOf("/")));const ye=C(k),y=C(!1),z=et(),{app:v}=ie(tt());let P=v.value.internalStoragePath;_==="sdcard"?P=v.value.sdcardPath:_==="app"&&(P=v.value.externalFilesDir);const{loading:be,panels:u,currentDir:U,refetch:j}=yt(v,P,ye.value),{visible:ge,index:Ce,view:De,hide:we}=st(),{createPath:Ve,createVariables:xe,createMutation:$e}=bt(v,u),{renameValue:Fe,renamePath:Ie,renameDone:Te,renameMutation:Me,renameVariables:Se}=gt(u),{internal:L,sdcard:O,refetch:E}=Ct(),{onDeleted:Q}=Vt(u,U,E),{downloadFile:W,downloadDir:qe,downloadFiles:Be}=xt(v),{view:G}=$t($,De),{selectedItem:T,select:Pe}=Dt(U,_,f,z),{canPaste:Z,copy:J,cut:Ue,paste:N}=wt(j,E),{input:Ee,upload:X,uploadChanged:K}=he(),{input:Ne,upload:Y,uploadChanged:ee}=he(),{mutate:Ae,onDone:He}=ke({document:at,appApi:!0});He(e=>{Be(e.data.setTempValue.key)});const Re=[{text:s("download"),click:()=>{const e=[];if(u.value.forEach(t=>{t.items.forEach(a=>{a.checked&&e.push({path:a.path})})}),e.length===0){re(s("select_first"),"error");return}Ae({key:ot(),value:JSON.stringify(e)})}},{text:s("delete"),click:()=>{const e=[];if(u.value.forEach(t=>{t.items.forEach(a=>{a.checked&&e.push(a)})}),e.length===0){re(s("select_first"),"error");return}M(fe,{files:e,onDone:Q})}}],{fileShowHidden:b}=ie(z);m.value&&nt(()=>u.value.length,()=>{if(u.value.length>0&&m.value){const t=u.value[u.value.length-1].items.find(a=>a.path===m.value);t&&(T.value=t,m.value="")}});function ze(){var e,t,a,l;return _==="sdcard"?`${s("sdcard")} (${s("storage_free_total",{free:w((e=O.value)==null?void 0:e.freeBytes),total:w((t=O.value)==null?void 0:t.totalBytes)})})`:_==="app"?s("app_name"):`${s("page_title.files")} (${s("storage_free_total",{free:w((a=L.value)==null?void 0:a.freeBytes),total:w((l=L.value)==null?void 0:l.totalBytes)})})`}function je(e,t){if(y.value){t.checked=!t.checked;return}Pe(e,t)}function te(e){return ue(e.name)||de(e.name)||mt(e.name)}function Le(e,t){t.isDir||(te(t)?G(e.items,t):W(t.path))}function Oe(e,t){e.preventDefault();const a=[{label:s("create_folder"),onClick:()=>{Ve.value=t,M(_e,{title:s("name"),placeholder:s("name"),mutation:$e,getVariables:xe})}},{label:s("upload_files"),onClick:()=>{X(t)}},{label:s("upload_folder"),onClick:()=>{Y(t)}}];Z()&&a.push({label:s("paste"),onClick:()=>{N(t)}}),pe({x:e.x,y:e.y,items:a})}function Qe(e,t,a){e.preventDefault();let l;a.isDir?l=[{label:s("upload_files"),onClick:()=>{X(a.path)}},{label:s("upload_folder"),onClick:()=>{Y(a.path)}},{label:s("download"),onClick:()=>{qe(a.path)}}]:(l=[],te(a)&&l.push({label:s("open"),onClick:()=>{G(t.items,a)}}),l.push({label:s("download"),onClick:()=>{W(a.path)}})),l.push({label:s("duplicate"),onClick:()=>{J(a),N(t.dir)}}),l.push({label:s("cut"),onClick:()=>{Ue(t,a)}}),l.push({label:s("copy"),onClick:()=>{J(a)}}),a.isDir&&Z()&&l.push({label:s("paste"),onClick:()=>{N(a.path)}}),l=[...l,{label:s("rename"),onClick:()=>{Fe.value=a.name,Ie.value=a.path,M(_e,{title:s("rename"),placeholder:s("name"),value:a.name,mutation:Me,getVariables:Se,done:Te})}},{label:s("delete"),onClick:()=>{M(fe,{files:[a],onDone:Q})}}],pe({x:e.x,y:e.y,items:l})}return lt(()=>{it.on("upload_task_done",e=>{e.status==="done"&&setTimeout(()=>{j(e.dir),E()},1e3)})}),(e,t)=>{const a=ft,l=_t,We=Pt,Ge=pt;return i(),d(D,null,[r("div",Et,[A(a,{current:ze}),r("div",Nt,[y.value?(i(),V(l,{key:0,title:e.$t("actions"),items:Re},null,8,["title"])):h("",!0),r("div",At,[H(r("input",{class:"form-check-input","onUpdate:modelValue":t[0]||(t[0]=c=>y.value=c),id:"select-mode",type:"checkbox"},null,512),[[R,y.value]]),r("label",Ht,p(e.$t("select_mode")),1)]),r("div",Rt,[H(r("input",{class:"form-check-input","onUpdate:modelValue":t[1]||(t[1]=c=>rt(b)?b.value=c:null),id:"show-hidden",type:"checkbox"},null,512),[[R,o(b)]]),r("label",zt,p(e.$t("show_hidden")),1)])])]),A(o(vt),{class:"panel-container"},{default:q(()=>[(i(!0),d(D,null,ce(o(u),c=>(i(),V(o(me),{key:c.dir},{default:q(()=>[r("div",jt,[(i(!0),d(D,null,ce(c.items,n=>{var le;return i(),d(D,{key:n.path},[!n.name.startsWith(".")||o(b)?(i(),d("div",{key:0,class:ct(["file-item",{active:(o(U)+"/").startsWith(n.path+"/")||((le=o(T))==null?void 0:le.path)===n.path}]),onClick:g=>je(c,n),onDblclick:g=>Le(c,n),onContextmenu:g=>Qe(g,c,n)},[y.value?H((i(),d("input",{key:0,class:"form-check-input","onUpdate:modelValue":g=>n.checked=g,type:"checkbox"},null,8,Ot)),[[R,n.checked]]):h("",!0),n.isDir?(i(),V(We,{key:1,class:"bi"})):h("",!0),o(ue)(n.name)||o(de)(n.name)?(i(),d("img",{key:2,src:o(ut)(n.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,Qt)):h("",!0),r("div",Wt,[S(p(n.name)+" ",1),r("div",Gt,[S(p(o(dt)(n.updatedAt)),1),n.isDir?h("",!0):(i(),d(D,{key:0},[S(", "+p(o(w)(n.size)),1)],64))])])],42,Lt)):h("",!0)],64)}),128)),r("div",{class:"empty",onContextmenu:n=>Oe(n,c.dir)},[c.items.filter(n=>!n.name.startsWith(".")||o(b)).length===0?(i(),d("div",Jt,p(e.$t("no_files")),1)):h("",!0)],40,Zt)])]),_:2},1024))),128)),o(u).length===0?(i(),V(o(me),{key:0,class:"no-data-placeholder"},{default:q(()=>[S(p(e.$t(o(kt)(o(be),o(v).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):h("",!0)]),_:1}),o(T)?(i(),d("div",Xt,p(e.$t("path"))+": "+p(o(T).path),1)):h("",!0),A(Ge,{visible:o(ge),index:o(Ce),sources:$.value,onHide:o(we)},null,8,["visible","index","sources","onHide"]),r("input",{ref_key:"fileInput",ref:Ee,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...c)=>o(K)&&o(K)(...c))},null,544),r("input",{ref_key:"dirFileInput",ref:Ne,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[3]||(t[3]=(...c)=>o(ee)&&o(ee)(...c))},null,544)],64)}}});const hs=ht(Kt,[["__scopeId","data-v-591cf29d"]]);export{hs as default};

import{o as i,e as c,f as a,d as rt,u as ut,r as $,p as dt,C as _t,ac as pt,a as mt,s as ve,c as ht,b8 as ft,b9 as bt,ba as vt,bb as kt,bc as yt,bd as gt,aa as ke,a1 as Tt,aA as Ct,G as qt,H as Dt,I as $t,J as wt,x as f,F as k,K as w,w as S,j as p,g,t as m,h as n,y as I,ag as St,be as It,ap as Vt,A as j,z as ye,L as J,bf as ge,bg as Te,at as Mt,T as xt,m as y,au as Et,av as Ft,bh as At,W as B,bi as Ce,aE as qe,Y as Z,a9 as Bt,ah as Zt,bj as Ht,bk as Lt,bl as Pt,bm as zt,_ as Nt}from"./index-5dfa21ef.js";import{_ as Wt}from"./Breadcrumb-99dc37b3.js";import{g as De,M as Rt}from"./splitpanes.es-1537f4f0.js";import{n as Ut}from"./list-6498ebd9.js";import{E as $e}from"./EditValueModal-0534cbc8.js";import"./vee-validate.esm-63d2b06b.js";const Gt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Kt=a("path",{fill:"currentColor",d:"M8 18H4q-.425 0-.713-.288T3 17q0-.425.288-.713T4 16h4q.425 0 .713.288T9 17q0 .425-.288.713T8 18ZM20 8H4q-.425 0-.713-.288T3 7q0-.425.288-.713T4 6h16q.425 0 .713.288T21 7q0 .425-.288.713T20 8Zm-6 5H4q-.425 0-.713-.288T3 12q0-.425.288-.713T4 11h10q.425 0 .713.288T15 12q0 .425-.288.713T14 13Z"},null,-1),Ot=[Kt];function jt(b,o){return i(),c("svg",Gt,Ot)}const Jt={name:"material-symbols-sort-rounded",render:jt},Qt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Xt=a("path",{fill:"currentColor",d:"M19.6 21.6L12 14l-2.35 2.35q.2.375.275.8T10 18q0 1.65-1.175 2.825T6 22q-1.65 0-2.825-1.175T2 18q0-1.65 1.175-2.825T6 14q.425 0 .85.075t.8.275L10 12L7.65 9.65q-.375.2-.8.275T6 10q-1.65 0-2.825-1.175T2 6q0-1.65 1.175-2.825T6 2q1.65 0 2.825 1.175T10 6q0 .425-.075.85t-.275.8L21.6 19.6q.425.425.425 1t-.425 1q-.425.425-1 .425t-1-.425ZM15 11l-2-2l6.6-6.6q.425-.425 1-.425t1 .425q.425.425.425 1t-.425 1L15 11ZM6 8q.825 0 1.413-.588T8 6q0-.825-.588-1.413T6 4q-.825 0-1.413.588T4 6q0 .825.588 1.413T6 8Zm6 4.5q.225 0 .363-.138T12.5 12q0-.225-.138-.363T12 11.5q-.225 0-.363.138T11.5 12q0 .225.138.363T12 12.5ZM6 20q.825 0 1.413-.588T8 18q0-.825-.588-1.413T6 16q-.825 0-1.413.588T4 18q0 .825.588 1.413T6 20Z"},null,-1),Yt=[Xt];function es(b,o){return i(),c("svg",Qt,Yt)}const ts={name:"material-symbols-content-cut-rounded",render:es},ss={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},os=a("path",{fill:"currentColor",d:"M9 18q-.825 0-1.413-.588T7 16V4q0-.825.588-1.413T9 2h9q.825 0 1.413.588T20 4v12q0 .825-.588 1.413T18 18H9Zm0-2h9V4H9v12Zm-4 6q-.825 0-1.413-.588T3 20V7q0-.425.288-.713T4 6q.425 0 .713.288T5 7v13h10q.425 0 .713.288T16 21q0 .425-.288.713T15 22H5ZM9 4v12V4Z"},null,-1),ns=[os];function ls(b,o){return i(),c("svg",ss,ns)}const as={name:"material-symbols-content-copy-outline-rounded",render:ls},V=b=>(Et("data-v-fcd0ef0f"),b=b(),Ft(),b),is={class:"v-toolbar"},cs={class:"right-actions"},rs=V(()=>a("md-ripple",null,null,-1)),us=V(()=>a("md-ripple",null,null,-1)),ds=["onClick"],_s=V(()=>a("md-ripple",null,null,-1)),ps=["onClick"],ms=V(()=>a("md-ripple",null,null,-1)),hs={class:"form-check"},fs={class:"form-check-label"},bs=["checked"],vs={class:"form-check"},ks={class:"form-check-label"},ys=["checked"],gs={class:"icon-button btn-sort"},Ts=V(()=>a("md-ripple",null,null,-1)),Cs={class:"menu-items"},qs=["onClick","headline"],Ds={class:"file-items"},$s=["onClick","onDblclick","onContextmenu"],ws=["checked"],Ss=["src"],Is={class:"title"},Vs={style:{"font-size":"0.75rem"}},Ms=["onContextmenu"],xs={key:0,class:"no-files"},Es={key:0,class:"file-item-info"},Fs=rt({__name:"FilesView",setup(b){var me,he,fe,be;const{t:o}=ut(),we=$([]),Q=dt(),Se=Q.query,d=Q.params.type,X=$(_t(((me=Se.q)==null?void 0:me.toString())??"")),H=pt(X.value),v=$(((he=H.find(e=>e.name==="path"))==null?void 0:he.value)??"");let M=((fe=H.find(e=>e.name==="dir"))==null?void 0:fe.value)??"";M||(((be=H.find(t=>t.name==="isDir"))==null?void 0:be.value)==="1"?M=v.value:M=v.value.substring(0,v.value.lastIndexOf("/")));const Ie=$(M),Ve=[{label:"sort_by.date_asc",value:"DATE_ASC"},{label:"sort_by.date_desc",value:"DATE_DESC"},{label:"sort_by.size_asc",value:"SIZE_ASC"},{label:"sort_by.size_desc",value:"SIZE_DESC"},{label:"sort_by.name_asc",value:"NAME_ASC"},{label:"sort_by.name_desc",value:"NAME_DESC"}],T=$(!1),Y=mt(),{fileShowHidden:x,fileSortBy:L}=ve(Y),ee=ht(),{app:C,urlTokenKey:P,selectedFiles:Me}=ve(ee);let E=C.value.internalStoragePath;d&&(d==="sdcard"?E=C.value.sdcardPath:d.startsWith("usb")?E=C.value.usbDiskPaths[parseInt(d.substring(3))-1]:d==="app"&&(E=C.value.externalFilesDir));const{loading:xe,panels:_,currentDir:z,refetch:te}=ft(P,E,Ie.value,L),{createPath:Ee,createVariables:Fe,createMutation:Ae}=bt(P,_),{renameValue:Be,renamePath:Ze,renameDone:He,renameMutation:Le,renameVariables:Pe}=vt(_),{internal:se,sdcard:oe,usb:ze,refetch:N}=kt(),{onDeleted:W}=Lt(_,z,N),{downloadFile:ne,downloadDir:Ne,downloadFiles:We}=St(P),{view:R}=Pt(we,(e,t)=>{ee.lightbox={sources:e,index:t,visible:!0}}),{selectedItem:F,select:Re}=yt(z,d,X,Y),{canPaste:le,copy:U,cut:ae,paste:G}=gt(Me,te,N),{input:Ue,upload:ie,uploadChanged:ce}=ke(),{input:Ge,upload:re,uploadChanged:ue}=ke(),{mutate:Ke,onDone:Oe}=Tt({document:It,appApi:!0});Oe(e=>{We(e.data.setTempValue.key)});const q=()=>{const e=[];return _.value.forEach(t=>{t.items.forEach(s=>{s.checked&&(s.panel=t,e.push(s))})}),e};function je(e){T.value=e.target.checked}const Je=()=>{Ke({key:At(),value:JSON.stringify(q().map(e=>({path:e.path})))})},Qe=Ct(()=>q().length>0),Xe=()=>{B(Ce,{files:q(),onDone:W})};v.value&&qt(()=>_.value.length,()=>{if(_.value.length>0&&v.value){const t=_.value[_.value.length-1].items.find(s=>s.path===v.value);t&&(F.value=t,v.value="")}});function Ye(){var e,t,s,r;if(d){if(d==="sdcard")return`${o("sdcard")} (${o("storage_free_total",{free:y(((e=oe.value)==null?void 0:e.freeBytes)??0),total:y(((t=oe.value)==null?void 0:t.totalBytes)??0)})})`;if(d==="app")return o("app_name");if(d.startsWith("usb")){const A=parseInt(d.substring(3)),h=ze.value[A-1];return`${o("usb_storage")} ${A} (${o("storage_free_total",{free:y((h==null?void 0:h.freeBytes)??0),total:y((h==null?void 0:h.totalBytes)??0)})})`}}return`${o("page_title.files")} (${o("storage_free_total",{free:y(((s=se.value)==null?void 0:s.freeBytes)??0),total:y(((r=se.value)==null?void 0:r.totalBytes)??0)})})`}function et(e,t){if(T.value){t.checked=!t.checked;return}Re(e,t)}function de(e){return ge(e.name)||Te(e.name)||zt(e.name)}function tt(e,t){L.value=t,e.close()}function st(e,t){t.isDir||(de(t)?R(x?e.items:e.items.filter(s=>!s.name.startsWith(".")),t):ne(t.path))}function ot(e,t){e.preventDefault();const s=[{label:o("create_folder"),onClick:()=>{Ee.value=t,B($e,{title:o("name"),placeholder:o("name"),mutation:Ae,getVariables:Fe})}},{label:o("upload_files"),onClick:()=>{ie(t)}},{label:o("upload_folder"),onClick:()=>{re(t)}}];le()&&s.push({label:o("paste"),onClick:()=>{G(t)}}),qe({x:e.x,y:e.y,items:s})}function nt(e,t,s){e.preventDefault();let r;s.isDir?r=[{label:o("upload_files"),onClick:()=>{ie(s.path)}},{label:o("upload_folder"),onClick:()=>{re(s.path)}},{label:o("download"),onClick:()=>{Ne(s.path)}}]:(r=[],de(s)&&r.push({label:o("open"),onClick:()=>{R(t.items,s)}}),r.push({label:o("download"),onClick:()=>{ne(s.path)}})),r.push({label:o("duplicate"),onClick:()=>{U([s]),G(t.dir)}}),r.push({label:o("cut"),onClick:()=>{s.panel=t,ae([s])}}),r.push({label:o("copy"),onClick:()=>{U([s])}}),s.isDir&&le()&&r.push({label:o("paste"),onClick:()=>{G(s.path)}}),r=[...r,{label:o("rename"),onClick:()=>{Be.value=s.name,Ze.value=s.path,B($e,{title:o("rename"),placeholder:o("name"),value:s.name,mutation:Le,getVariables:Pe,done:He})}},{label:o("delete"),onClick:()=>{B(Ce,{files:[s],onDone:W})}}],qe({x:e.x,y:e.y,items:r})}const _e=e=>{e.status==="done"&&setTimeout(()=>{te(e.dir),N()},1e3)},pe=e=>{W([e.item])};return Dt(()=>{Z.on("upload_task_done",_e),Z.on("file_deleted",pe)}),$t(()=>{Z.off("upload_task_done",_e),Z.off("file_deleted",pe)}),(e,t)=>{const s=Wt,r=as,A=ts,h=Bt,lt=Zt,at=Jt,it=Vt,ct=Ht,D=wt("tooltip");return i(),c(k,null,[a("div",is,[f(s,{current:Ye}),a("div",cs,[T.value&&Qe.value?(i(),c(k,{key:0},[w((i(),c("button",{class:"icon-button",onClick:t[0]||(t[0]=S(()=>n(U)(q()),["stop"]))},[rs,f(r)])),[[D,e.$t("copy")]]),w((i(),c("button",{class:"icon-button",onClick:t[1]||(t[1]=S(()=>n(ae)(q()),["stop"]))},[us,f(A)])),[[D,e.$t("cut")]]),w((i(),c("button",{class:"icon-button",onClick:S(Xe,["stop"])},[_s,f(h)],8,ds)),[[D,e.$t("delete")]]),w((i(),c("button",{class:"icon-button",onClick:S(Je,["stop"])},[ms,f(lt)],8,ps)),[[D,e.$t("download")]])],64)):p("",!0),a("div",hs,[a("label",fs,[a("md-checkbox",{"touch-target":"wrapper",onChange:je,checked:T.value},null,40,bs),g(" "+m(e.$t("select_mode")),1)])]),a("div",vs,[a("label",ks,[a("md-checkbox",{"touch-target":"wrapper",checked:n(x)},null,8,ys),g(m(e.$t("show_hidden")),1)])]),f(it,null,{content:I(u=>[a("div",Cs,[(i(),c(k,null,j(Ve,l=>a("md-menu-item",{onClick:K=>tt(u,l.value),headline:e.$t(l.label),class:ye({selected:l.value===n(L)})},null,10,qs)),64))])]),default:I(()=>[w((i(),c("button",gs,[Ts,f(at)])),[[D,e.$t("sort")]])]),_:1})])]),f(n(Rt),{class:"panel-container"},{default:I(()=>[(i(!0),c(k,null,j(n(_),u=>(i(),J(n(De),{key:u.dir},{default:I(()=>[a("div",Ds,[(i(!0),c(k,null,j(u.items,l=>{var K;return i(),c(k,{key:l.path},[!l.name.startsWith(".")||n(x)?(i(),c("div",{key:0,class:ye(["file-item",{active:(n(z)+"/").startsWith(l.path+"/")||((K=n(F))==null?void 0:K.path)===l.path}]),onClick:O=>et(u,l),onDblclick:S(O=>st(u,l),["prevent"]),onContextmenu:O=>nt(O,u,l)},[T.value?(i(),c("md-checkbox",{key:0,"touch-target":"wrapper",checked:l.checked},null,8,ws)):p("",!0),l.isDir?(i(),J(ct,{key:1})):p("",!0),n(ge)(l.name)||n(Te)(l.name)?(i(),c("img",{key:2,src:n(Mt)(l.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,Ss)):p("",!0),a("div",Is,[g(m(l.name)+" ",1),a("div",Vs,[g(m(n(xt)(l.updatedAt)),1),l.isDir?p("",!0):(i(),c(k,{key:0},[g(", "+m(n(y)(l.size)),1)],64))])])],42,$s)):p("",!0)],64)}),128)),a("div",{class:"empty",onContextmenu:l=>ot(l,u.dir)},[u.items.filter(l=>!l.name.startsWith(".")||n(x)).length===0?(i(),c("div",xs,m(e.$t("no_files")),1)):p("",!0)],40,Ms)])]),_:2},1024))),128)),n(_).length===0?(i(),J(n(De),{key:0,class:"no-data-placeholder"},{default:I(()=>[g(m(e.$t(n(Ut)(n(xe),n(C).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):p("",!0)]),_:1}),n(F)?(i(),c("div",Es,m(e.$t("path"))+": "+m(n(F).path),1)):p("",!0),a("input",{ref_key:"fileInput",ref:Ue,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...u)=>n(ce)&&n(ce)(...u))},null,544),a("input",{ref_key:"dirFileInput",ref:Ge,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[3]||(t[3]=(...u)=>n(ue)&&n(ue)(...u))},null,544)],64)}}});const zs=Nt(Fs,[["__scopeId","data-v-fcd0ef0f"]]);export{zs as default};

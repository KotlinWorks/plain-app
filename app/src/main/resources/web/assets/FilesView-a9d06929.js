import{o as i,e as c,f as l,d as ut,u as dt,r as S,p as _t,C as pt,ac as mt,a as ht,s as ve,c as bt,b6 as ft,b7 as vt,b8 as kt,b9 as yt,ba as gt,bb as Tt,aa as ke,a1 as Ct,aA as qt,G as wt,H as Dt,I as A,J as $t,K as St,x as b,F as k,L as I,w as M,j as p,g,t as m,h as n,y as V,ag as It,bc as Mt,ap as Vt,A as j,z as ye,M as J,bd as Et,be as Ft,at as xt,U as Bt,m as y,au as Zt,av as At,bf as Ht,bg as Pt,X as H,bh as ge,bi as Te,bj as Ce,bk as Q,aE as qe,a9 as Lt,ah as zt,bl as Nt,bm as Ut,_ as Wt}from"./index-bfd324f1.js";import{_ as Rt}from"./Breadcrumb-d5b3180f.js";import{g as we,M as Ot}from"./splitpanes.es-685e4e64.js";import{n as Gt}from"./list-6498ebd9.js";import{E as De}from"./EditValueModal-289a29d7.js";import"./vee-validate.esm-4679beb0.js";const Kt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},jt=l("path",{fill:"currentColor",d:"M8 18H4q-.425 0-.713-.288T3 17q0-.425.288-.713T4 16h4q.425 0 .713.288T9 17q0 .425-.288.713T8 18ZM20 8H4q-.425 0-.713-.288T3 7q0-.425.288-.713T4 6h16q.425 0 .713.288T21 7q0 .425-.288.713T20 8Zm-6 5H4q-.425 0-.713-.288T3 12q0-.425.288-.713T4 11h10q.425 0 .713.288T15 12q0 .425-.288.713T14 13Z"},null,-1),Jt=[jt];function Qt(f,o){return i(),c("svg",Kt,Jt)}const Xt={name:"material-symbols-sort-rounded",render:Qt},Yt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},es=l("path",{fill:"currentColor",d:"M19.6 21.6L12 14l-2.35 2.35q.2.375.275.8T10 18q0 1.65-1.175 2.825T6 22q-1.65 0-2.825-1.175T2 18q0-1.65 1.175-2.825T6 14q.425 0 .85.075t.8.275L10 12L7.65 9.65q-.375.2-.8.275T6 10q-1.65 0-2.825-1.175T2 6q0-1.65 1.175-2.825T6 2q1.65 0 2.825 1.175T10 6q0 .425-.075.85t-.275.8L21.6 19.6q.425.425.425 1t-.425 1q-.425.425-1 .425t-1-.425ZM15 11l-2-2l6.6-6.6q.425-.425 1-.425t1 .425q.425.425.425 1t-.425 1L15 11ZM6 8q.825 0 1.413-.588T8 6q0-.825-.588-1.413T6 4q-.825 0-1.413.588T4 6q0 .825.588 1.413T6 8Zm6 4.5q.225 0 .363-.138T12.5 12q0-.225-.138-.363T12 11.5q-.225 0-.363.138T11.5 12q0 .225.138.363T12 12.5ZM6 20q.825 0 1.413-.588T8 18q0-.825-.588-1.413T6 16q-.825 0-1.413.588T4 18q0 .825.588 1.413T6 20Z"},null,-1),ts=[es];function ss(f,o){return i(),c("svg",Yt,ts)}const os={name:"material-symbols-content-cut-rounded",render:ss},ns={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},as=l("path",{fill:"currentColor",d:"M9 18q-.825 0-1.413-.588T7 16V4q0-.825.588-1.413T9 2h9q.825 0 1.413.588T20 4v12q0 .825-.588 1.413T18 18H9Zm0-2h9V4H9v12Zm-4 6q-.825 0-1.413-.588T3 20V7q0-.425.288-.713T4 6q.425 0 .713.288T5 7v13h10q.425 0 .713.288T16 21q0 .425-.288.713T15 22H5ZM9 4v12V4Z"},null,-1),ls=[as];function is(f,o){return i(),c("svg",ns,ls)}const cs={name:"material-symbols-content-copy-outline-rounded",render:is},E=f=>(Zt("data-v-0ce2f86b"),f=f(),At(),f),rs={class:"v-toolbar"},us={class:"right-actions"},ds=E(()=>l("md-ripple",null,null,-1)),_s=E(()=>l("md-ripple",null,null,-1)),ps=["onClick"],ms=E(()=>l("md-ripple",null,null,-1)),hs=["onClick"],bs=E(()=>l("md-ripple",null,null,-1)),fs={class:"form-check"},vs={class:"form-check-label"},ks=["checked"],ys={class:"form-check"},gs={class:"form-check-label"},Ts=["checked"],Cs={class:"icon-button btn-sort"},qs=E(()=>l("md-ripple",null,null,-1)),ws={class:"menu-items"},Ds=["onClick","headline"],$s={class:"file-items"},Ss=["onClick","onDblclick","onContextmenu"],Is=["checked"],Ms=["src"],Vs={class:"title"},Es={style:{"font-size":"0.75rem"}},Fs=["onContextmenu"],xs={key:0,class:"no-files"},Bs={key:0,class:"file-item-info"},Zs=ut({__name:"FilesView",setup(f){var me,he,be,fe;const{t:o}=dt(),$e=S([]),X=_t(),Se=X.query,d=X.params.type,Y=S(pt(((me=Se.q)==null?void 0:me.toString())??"")),P=mt(Y.value),v=S(((he=P.find(e=>e.name==="path"))==null?void 0:he.value)??"");let F=((be=P.find(e=>e.name==="dir"))==null?void 0:be.value)??"";F||(((fe=P.find(t=>t.name==="isDir"))==null?void 0:fe.value)==="1"?F=v.value:F=v.value.substring(0,v.value.lastIndexOf("/")));const Ie=S(F),Me=[{label:"sort_by.date_asc",value:"DATE_ASC"},{label:"sort_by.date_desc",value:"DATE_DESC"},{label:"sort_by.size_asc",value:"SIZE_ASC"},{label:"sort_by.size_desc",value:"SIZE_DESC"},{label:"sort_by.name_asc",value:"NAME_ASC"},{label:"sort_by.name_desc",value:"NAME_DESC"}],T=S(!1),ee=ht(),{fileShowHidden:C,fileSortBy:L}=ve(ee),te=bt(),{app:q,urlTokenKey:w,selectedFiles:Ve}=ve(te);let x=q.value.internalStoragePath;d&&(d==="sdcard"?x=q.value.sdcardPath:d.startsWith("usb")?x=q.value.usbDiskPaths[parseInt(d.substring(3))-1]:d==="app"&&(x=q.value.externalFilesDir));const{loading:Ee,panels:_,currentDir:z,refetch:se}=ft(w,x,Ie.value,L),{createPath:Fe,createVariables:xe,createMutation:Be}=vt(w,_),{renameValue:Ze,renamePath:Ae,renameDone:He,renameMutation:Pe,renameVariables:Le}=kt(_),{internal:oe,sdcard:ne,usb:ze,refetch:N}=yt(),{onDeleted:U}=Ht(_,z,N),{downloadFile:ae,downloadDir:Ne,downloadFiles:Ue}=It(w),{view:W}=Ut($e,(e,t)=>{te.lightbox={sources:e,index:t,visible:!0}}),{selectedItem:B,select:We}=gt(z,d,Y,ee),{canPaste:le,copy:R,cut:ie,paste:O}=Tt(Ve,se,N),{input:Re,upload:ce,uploadChanged:re}=ke(),{input:Oe,upload:ue,uploadChanged:de}=ke(),{mutate:Ge,onDone:Ke}=Ct({document:Mt,appApi:!0});Ke(e=>{Ue(e.data.setTempValue.key),_.value.forEach(t=>{t.items.forEach(s=>{s.checked=!1})})});const D=()=>{const e=[];return _.value.forEach(t=>{t.items.forEach(s=>{s.checked&&(s.panel=t,e.push(s))})}),e};function je(e){T.value=e.target.checked}function Je(e){C.value=e.target.checked}const Qe=()=>{Ge({key:Pt(),value:JSON.stringify(D().map(e=>({path:e.path})))})},Xe=qt(()=>D().length>0),Ye=()=>{H(ge,{files:D(),onDone:U})};v.value&&wt(()=>_.value.length,()=>{if(_.value.length>0&&v.value){const t=_.value[_.value.length-1].items.find(s=>s.path===v.value);t&&(B.value=t,v.value="")}});function et(){var e,t,s,r;if(d){if(d==="sdcard")return`${o("sdcard")} (${o("storage_free_total",{free:y(((e=ne.value)==null?void 0:e.freeBytes)??0),total:y(((t=ne.value)==null?void 0:t.totalBytes)??0)})})`;if(d==="app")return o("app_name");if(d.startsWith("usb")){const Z=parseInt(d.substring(3)),h=ze.value[Z-1];return`${o("usb_storage")} ${Z} (${o("storage_free_total",{free:y((h==null?void 0:h.freeBytes)??0),total:y((h==null?void 0:h.totalBytes)??0)})})`}}return`${o("page_title.files")} (${o("storage_free_total",{free:y(((s=oe.value)==null?void 0:s.freeBytes)??0),total:y(((r=oe.value)==null?void 0:r.totalBytes)??0)})})`}function tt(e,t){if(T.value){t.checked=!t.checked;return}We(e,t)}function st(e,t){L.value=t,e.close()}function ot(e,t){t.isDir||(Te(t.name)?window.open(Ce(w.value,t.path),"_blank"):Q(t.name)?W(C?e.items:e.items.filter(s=>!s.name.startsWith(".")),t):ae(t.path))}function nt(e,t){e.preventDefault();const s=[{label:o("create_folder"),onClick:()=>{Fe.value=t,H(De,{title:o("name"),placeholder:o("name"),mutation:Be,getVariables:xe})}},{label:o("upload_files"),onClick:()=>{ce(t)}},{label:o("upload_folder"),onClick:()=>{ue(t)}}];le()&&s.push({label:o("paste"),onClick:()=>{O(t)}}),qe({x:e.x,y:e.y,items:s})}function at(e,t,s){e.preventDefault();let r;s.isDir?r=[{label:o("upload_files"),onClick:()=>{ce(s.path)}},{label:o("upload_folder"),onClick:()=>{ue(s.path)}},{label:o("download"),onClick:()=>{Ne(s.path)}}]:(r=[],(Te(s.name)||Q(s.name))&&r.push({label:o("open"),onClick:()=>{Q(s.name)?W(t.items,s):window.open(Ce(w.value,s.path),"_blank")}}),r.push({label:o("download"),onClick:()=>{ae(s.path)}})),r.push({label:o("duplicate"),onClick:()=>{R([s]),O(t.dir)}}),r.push({label:o("cut"),onClick:()=>{s.panel=t,ie([s])}}),r.push({label:o("copy"),onClick:()=>{R([s])}}),s.isDir&&le()&&r.push({label:o("paste"),onClick:()=>{O(s.path)}}),r=[...r,{label:o("rename"),onClick:()=>{Ze.value=s.name,Ae.value=s.path,H(De,{title:o("rename"),placeholder:o("name"),value:s.name,mutation:Pe,getVariables:Le,done:He})}},{label:o("delete"),onClick:()=>{H(ge,{files:[s],onDone:U})}}],qe({x:e.x,y:e.y,items:r})}const _e=e=>{e.status==="done"&&setTimeout(()=>{se(e.dir),N()},1e3)},pe=e=>{U([e.item])};return Dt(()=>{A.on("upload_task_done",_e),A.on("file_deleted",pe)}),$t(()=>{A.off("upload_task_done",_e),A.off("file_deleted",pe)}),(e,t)=>{const s=Rt,r=cs,Z=os,h=Lt,lt=zt,it=Xt,ct=Vt,rt=Nt,$=St("tooltip");return i(),c(k,null,[l("div",rs,[b(s,{current:et}),l("div",us,[T.value&&Xe.value?(i(),c(k,{key:0},[I((i(),c("button",{class:"icon-button",onClick:t[0]||(t[0]=M(()=>n(R)(D()),["stop"]))},[ds,b(r)])),[[$,e.$t("copy")]]),I((i(),c("button",{class:"icon-button",onClick:t[1]||(t[1]=M(()=>n(ie)(D()),["stop"]))},[_s,b(Z)])),[[$,e.$t("cut")]]),I((i(),c("button",{class:"icon-button",onClick:M(Ye,["stop"])},[ms,b(h)],8,ps)),[[$,e.$t("delete")]]),I((i(),c("button",{class:"icon-button",onClick:M(Qe,["stop"])},[bs,b(lt)],8,hs)),[[$,e.$t("download")]])],64)):p("",!0),l("div",fs,[l("label",vs,[l("md-checkbox",{"touch-target":"wrapper",onChange:je,checked:T.value},null,40,ks),g(" "+m(e.$t("select_mode")),1)])]),l("div",ys,[l("label",gs,[l("md-checkbox",{"touch-target":"wrapper",onChange:Je,checked:n(C)},null,40,Ts),g(m(e.$t("show_hidden")),1)])]),b(ct,null,{content:V(u=>[l("div",ws,[(i(),c(k,null,j(Me,a=>l("md-menu-item",{onClick:G=>st(u,a.value),headline:e.$t(a.label),class:ye({selected:a.value===n(L)})},null,10,Ds)),64))])]),default:V(()=>[I((i(),c("button",Cs,[qs,b(it)])),[[$,e.$t("sort")]])]),_:1})])]),b(n(Ot),{class:"panel-container"},{default:V(()=>[(i(!0),c(k,null,j(n(_),u=>(i(),J(n(we),{key:u.dir},{default:V(()=>[l("div",$s,[(i(!0),c(k,null,j(u.items,a=>{var G;return i(),c(k,{key:a.path},[!a.name.startsWith(".")||n(C)?(i(),c("div",{key:0,class:ye(["file-item",{active:(n(z)+"/").startsWith(a.path+"/")||((G=n(B))==null?void 0:G.path)===a.path}]),onClick:K=>tt(u,a),onDblclick:M(K=>ot(u,a),["prevent"]),onContextmenu:K=>at(K,u,a)},[T.value?(i(),c("md-checkbox",{key:0,"touch-target":"wrapper",checked:a.checked},null,8,Is)):p("",!0),a.isDir?(i(),J(rt,{key:1})):p("",!0),n(Et)(a.name)||n(Ft)(a.name)?(i(),c("img",{key:2,src:n(xt)(a.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,Ms)):p("",!0),l("div",Vs,[g(m(a.name)+" ",1),l("div",Es,[g(m(n(Bt)(a.updatedAt)),1),a.isDir?p("",!0):(i(),c(k,{key:0},[g(", "+m(n(y)(a.size)),1)],64))])])],42,Ss)):p("",!0)],64)}),128)),l("div",{class:"empty",onContextmenu:a=>nt(a,u.dir)},[u.items.filter(a=>!a.name.startsWith(".")||n(C)).length===0?(i(),c("div",xs,m(e.$t("no_files")),1)):p("",!0)],40,Fs)])]),_:2},1024))),128)),n(_).length===0?(i(),J(n(we),{key:0,class:"no-data-placeholder"},{default:V(()=>[g(m(e.$t(n(Gt)(n(Ee),n(q).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):p("",!0)]),_:1}),n(B)?(i(),c("div",Bs,m(e.$t("path"))+": "+m(n(B).path),1)):p("",!0),l("input",{ref_key:"fileInput",ref:Re,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...u)=>n(re)&&n(re)(...u))},null,544),l("input",{ref_key:"dirFileInput",ref:Oe,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[3]||(t[3]=(...u)=>n(de)&&n(de)(...u))},null,544)],64)}}});const Us=Wt(Zs,[["__scopeId","data-v-0ce2f86b"]]);export{Us as default};

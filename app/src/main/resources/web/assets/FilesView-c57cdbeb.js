import{o as a,c,a as i,d as dt,u as _t,r as V,D as pt,M as mt,ag as ht,e as ft,s as ve,f as bt,bb as vt,bc as kt,bd as gt,be as yt,bf as Ct,bg as Tt,ae as ke,i as qt,aC as wt,w as Dt,O as $t,P as H,Q as It,R as St,p as m,F as v,m as C,l as F,k as h,h as T,t as p,j as n,H as M,al as Vt,bh as Ft,at as Mt,J,S as K,I as Bt,bi as xt,bj as Et,ax as Pt,Z as Zt,z as k,$ as Ht,A as Lt,B as Rt,aG as Ut,bk as Wt,bl as zt,a2 as L,bm as ge,bn as ye,ah as Ce,bo as X,aI as Te,ad as Nt,am as At,bp as Ot,bq as Gt,_ as Qt}from"./index-a2f7ba62.js";import{_ as jt}from"./sort-rounded-d106ce95.js";import{_ as Jt}from"./refresh-rounded-ebc80f4c.js";import{_ as Kt}from"./Breadcrumb-5a2db2f2.js";import{g as qe,M as Xt}from"./splitpanes.es-c92d6cec.js";import{E as we}from"./EditValueModal-57f76dda.js";import"./vee-validate.esm-2308d982.js";const Yt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},eo=i("path",{fill:"currentColor",d:"M19.6 21.6L12 14l-2.35 2.35q.2.375.275.8T10 18q0 1.65-1.175 2.825T6 22q-1.65 0-2.825-1.175T2 18q0-1.65 1.175-2.825T6 14q.425 0 .85.075t.8.275L10 12L7.65 9.65q-.375.2-.8.275T6 10q-1.65 0-2.825-1.175T2 6q0-1.65 1.175-2.825T6 2q1.65 0 2.825 1.175T10 6q0 .425-.075.85t-.275.8L21.6 19.6q.425.425.425 1t-.425 1q-.425.425-1 .425t-1-.425ZM15 11l-2-2l6.6-6.6q.425-.425 1-.425t1 .425q.425.425.425 1t-.425 1L15 11ZM6 8q.825 0 1.413-.588T8 6q0-.825-.588-1.413T6 4q-.825 0-1.413.588T4 6q0 .825.588 1.413T6 8Zm6 4.5q.225 0 .363-.138T12.5 12q0-.225-.138-.363T12 11.5q-.225 0-.363.138T11.5 12q0 .225.138.363T12 12.5ZM6 20q.825 0 1.413-.588T8 18q0-.825-.588-1.413T6 16q-.825 0-1.413.588T4 18q0 .825.588 1.413T6 20Z"},null,-1),to=[eo];function oo(g,s){return a(),c("svg",Yt,to)}const so={name:"material-symbols-content-cut-rounded",render:oo},no={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},lo=i("path",{fill:"currentColor",d:"M9 18q-.825 0-1.413-.588T7 16V4q0-.825.588-1.413T9 2h9q.825 0 1.413.588T20 4v12q0 .825-.588 1.413T18 18H9Zm0-2h9V4H9v12Zm-4 6q-.825 0-1.413-.588T3 20V7q0-.425.288-.713T4 6q.425 0 .713.288T5 7v13h10q.425 0 .713.288T16 21q0 .425-.288.713T15 22H5ZM9 4v12V4Z"},null,-1),ao=[lo];function io(g,s){return a(),c("svg",no,ao)}const co={name:"material-symbols-content-copy-outline-rounded",render:io},q=g=>(Lt("data-v-1bb14a91"),g=g(),Rt(),g),ro={class:"v-toolbar"},uo={class:"right-actions"},_o=q(()=>i("md-ripple",null,null,-1)),po=q(()=>i("md-ripple",null,null,-1)),mo=["onClick"],ho=q(()=>i("md-ripple",null,null,-1)),fo=["onClick"],bo=q(()=>i("md-ripple",null,null,-1)),vo={class:"form-check"},ko={class:"form-check-label"},go=["checked"],yo={class:"form-check"},Co={class:"form-check-label"},To=["checked"],qo=q(()=>i("md-ripple",null,null,-1)),wo={class:"icon-button btn-sort"},Do=q(()=>i("md-ripple",null,null,-1)),$o={class:"menu-items"},Io=["onClick","selected"],So={slot:"headline"},Vo={class:"file-items"},Fo=["onClick","onDblclick","onContextmenu"],Mo=["checked"],Bo=["src"],xo={class:"title"},Eo={style:{"font-size":"0.75rem"}},Po=["onContextmenu"],Zo={key:0,class:"no-files"},Ho={key:0,class:"file-item-info"},Lo=dt({__name:"FilesView",setup(g){var me,he,fe,be;const{t:s}=_t(),De=V([]),Y=pt(),$e=Y.query,d=Y.params.type,ee=V(mt(((me=$e.q)==null?void 0:me.toString())??"")),R=ht(ee.value),b=V(((he=R.find(e=>e.name==="path"))==null?void 0:he.value)??"");let B=((fe=R.find(e=>e.name==="dir"))==null?void 0:fe.value)??"";B||(((be=R.find(t=>t.name==="isDir"))==null?void 0:be.value)==="1"?B=b.value:B=b.value.substring(0,b.value.lastIndexOf("/")));const Ie=V(B),Se=Ut(),w=V(!1),te=ft(),{fileShowHidden:D,fileSortBy:U}=ve(te),oe=bt(),{app:$,urlTokenKey:I,selectedFiles:Ve}=ve(oe);let x=$.value.internalStoragePath;d&&(d==="sdcard"?x=$.value.sdcardPath:d.startsWith("usb")?x=$.value.usbDiskPaths[parseInt(d.substring(3))-1]:d==="app"&&(x=$.value.externalFilesDir));const{loading:Fe,panels:_,currentDir:E,refetch:W}=vt(I,x,Ie.value,U),{createPath:Me,createVariables:Be,createMutation:xe}=kt(I,_),{renameValue:Ee,renamePath:Pe,renameDone:Ze,renameMutation:He,renameVariables:Le}=gt(_),{internal:se,sdcard:ne,usb:Re,refetch:z}=yt(),{onDeleted:N}=Wt(_,E,z),{downloadFile:le,downloadDir:Ue,downloadFiles:We}=Vt(I),{view:A}=Gt(De,(e,t)=>{oe.lightbox={sources:e,index:t,visible:!0}}),{selectedItem:P,select:ze}=Ct(E,d,ee,te),{canPaste:ae,copy:O,cut:ie,paste:G}=Tt(Ve,W,z),{input:Ne,upload:ce,uploadChanged:re}=ke(),{input:Ae,upload:ue,uploadChanged:de}=ke(),{mutate:Oe,onDone:Ge}=qt({document:Ft,appApi:!0});Ge(e=>{We(e.data.setTempValue.key),_.value.forEach(t=>{t.items.forEach(o=>{o.checked=!1})})});const S=()=>{const e=[];return _.value.forEach(t=>{t.items.forEach(o=>{o.checked&&(o.panel=t,e.push(o))})}),e};function Qe(e){w.value=e.target.checked}function je(e){D.value=e.target.checked}const Je=()=>{Oe({key:zt(),value:JSON.stringify(S().map(e=>({path:e.path})))})},Ke=wt(()=>S().length>0),Xe=()=>{L(ge,{files:S(),onDone:N})};b.value&&Dt(()=>_.value.length,()=>{if(_.value.length>0&&b.value){const t=_.value[_.value.length-1].items.find(o=>o.path===b.value);t&&(P.value=t,b.value="")}});function Ye(){var e,t,o,r;if(d){if(d==="sdcard")return`${s("sdcard")} (${s("storage_free_total",{free:k(((e=ne.value)==null?void 0:e.freeBytes)??0),total:k(((t=ne.value)==null?void 0:t.totalBytes)??0)})})`;if(d==="app")return s("app_name");if(d.startsWith("usb")){const Z=parseInt(d.substring(3)),f=Re.value[Z-1];return`${s("usb_storage")} ${Z} (${s("storage_free_total",{free:k((f==null?void 0:f.freeBytes)??0),total:k((f==null?void 0:f.totalBytes)??0)})})`}}return`${s("page_title.files")} (${s("storage_free_total",{free:k(((o=se.value)==null?void 0:o.freeBytes)??0),total:k(((r=se.value)==null?void 0:r.totalBytes)??0)})})`}function et(e,t){if(w.value){t.checked=!t.checked;return}ze(e,t)}function tt(e,t){U.value=t,e.close()}function ot(){W(E.value)}function st(e,t){t.isDir||(ye(t.name)?window.open(Ce(I.value,t.path),"_blank"):X(t.name)?A(D?e.items:e.items.filter(o=>!o.name.startsWith(".")),t):le(t.path))}function nt(e,t){e.preventDefault();const o=[{label:s("create_folder"),onClick:()=>{Me.value=t,L(we,{title:s("name"),placeholder:s("name"),mutation:xe,getVariables:Be})}},{label:s("upload_files"),onClick:()=>{ce(t)}},{label:s("upload_folder"),onClick:()=>{ue(t)}}];ae()&&o.push({label:s("paste"),onClick:()=>{G(t)}}),Te({x:e.x,y:e.y,items:o})}function lt(e,t,o){e.preventDefault();let r;o.isDir?r=[{label:s("upload_files"),onClick:()=>{ce(o.path)}},{label:s("upload_folder"),onClick:()=>{ue(o.path)}},{label:s("download"),onClick:()=>{Ue(o.path)}}]:(r=[],(ye(o.name)||X(o.name))&&r.push({label:s("open"),onClick:()=>{X(o.name)?A(t.items,o):window.open(Ce(I.value,o.path),"_blank")}}),r.push({label:s("download"),onClick:()=>{le(o.path)}})),r.push({label:s("duplicate"),onClick:()=>{O([o]),G(t.dir)}}),r.push({label:s("cut"),onClick:()=>{o.panel=t,ie([o])}}),r.push({label:s("copy"),onClick:()=>{O([o])}}),o.isDir&&ae()&&r.push({label:s("paste"),onClick:()=>{G(o.path)}}),r=[...r,{label:s("rename"),onClick:()=>{Ee.value=o.name,Pe.value=o.path,L(we,{title:s("rename"),placeholder:s("name"),value:o.name,mutation:He,getVariables:Le,done:Ze})}},{label:s("delete"),onClick:()=>{L(ge,{files:[o],onDone:N})}}],Te({x:e.x,y:e.y,items:r})}const _e=e=>{e.status==="done"&&setTimeout(()=>{W(e.dir),z()},1e3)},pe=e=>{N([e.item])};return $t(()=>{H.on("upload_task_done",_e),H.on("file_deleted",pe)}),It(()=>{H.off("upload_task_done",_e),H.off("file_deleted",pe)}),(e,t)=>{const o=Kt,r=co,Z=so,f=Nt,at=At,it=Jt,ct=jt,rt=Mt,ut=Ot,y=St("tooltip");return a(),c(v,null,[i("div",ro,[m(o,{current:Ye}),i("div",uo,[w.value&&Ke.value?(a(),c(v,{key:0},[C((a(),c("button",{class:"icon-button",onClick:t[0]||(t[0]=F(()=>n(O)(S()),["stop"]))},[_o,m(r)])),[[y,e.$t("copy")]]),C((a(),c("button",{class:"icon-button",onClick:t[1]||(t[1]=F(()=>n(ie)(S()),["stop"]))},[po,m(Z)])),[[y,e.$t("cut")]]),C((a(),c("button",{class:"icon-button",onClick:F(Xe,["stop"])},[ho,m(f)],8,mo)),[[y,e.$t("delete")]]),C((a(),c("button",{class:"icon-button",onClick:F(Je,["stop"])},[bo,m(at)],8,fo)),[[y,e.$t("download")]])],64)):h("",!0),i("div",vo,[i("label",ko,[i("md-checkbox",{"touch-target":"wrapper",onChange:Qe,checked:w.value},null,40,go),T(" "+p(e.$t("select_mode")),1)])]),i("div",yo,[i("label",Co,[i("md-checkbox",{"touch-target":"wrapper",onChange:je,checked:n(D)},null,40,To),T(p(e.$t("show_hidden")),1)])]),C((a(),c("button",{class:"icon-button btn-refresh",onClick:ot},[qo,m(it)])),[[y,e.$t("refresh")]]),m(rt,null,{content:M(u=>[i("div",$o,[(a(!0),c(v,null,J(n(Se),l=>(a(),c("md-menu-item",{onClick:Q=>tt(u,l.value),selected:l.value===n(U)},[i("div",So,p(e.$t(l.label)),1)],8,Io))),256))])]),default:M(()=>[C((a(),c("button",wo,[Do,m(ct)])),[[y,e.$t("sort")]])]),_:1})])]),m(n(Xt),{class:"panel-container"},{default:M(()=>[(a(!0),c(v,null,J(n(_),u=>(a(),K(n(qe),{key:u.dir},{default:M(()=>[i("div",Vo,[(a(!0),c(v,null,J(u.items,l=>{var Q;return a(),c(v,{key:l.path},[!l.name.startsWith(".")||n(D)?(a(),c("div",{key:0,class:Bt(["file-item",{active:(n(E)+"/").startsWith(l.path+"/")||((Q=n(P))==null?void 0:Q.path)===l.path}]),onClick:j=>et(u,l),onDblclick:F(j=>st(u,l),["prevent"]),onContextmenu:j=>lt(j,u,l)},[w.value?(a(),c("md-checkbox",{key:0,"touch-target":"wrapper",checked:l.checked},null,8,Mo)):h("",!0),l.isDir?(a(),K(ut,{key:1})):h("",!0),n(xt)(l.name)||n(Et)(l.name)?(a(),c("img",{key:2,src:n(Pt)(l.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,Bo)):h("",!0),i("div",xo,[T(p(l.name)+" ",1),i("div",Eo,[T(p(n(Zt)(l.updatedAt)),1),l.isDir?h("",!0):(a(),c(v,{key:0},[T(", "+p(n(k)(l.size)),1)],64))])])],42,Fo)):h("",!0)],64)}),128)),i("div",{class:"empty",onContextmenu:l=>nt(l,u.dir)},[u.items.filter(l=>!l.name.startsWith(".")||n(D)).length===0?(a(),c("div",Zo,p(e.$t("no_files")),1)):h("",!0)],40,Po)])]),_:2},1024))),128)),n(_).length===0?(a(),K(n(qe),{key:0,class:"no-data-placeholder"},{default:M(()=>[T(p(e.$t(n(Ht)(n(Fe),n($).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):h("",!0)]),_:1}),n(P)?(a(),c("div",Ho,p(e.$t("path"))+": "+p(n(P).path),1)):h("",!0),i("input",{ref_key:"fileInput",ref:Ne,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...u)=>n(re)&&n(re)(...u))},null,544),i("input",{ref_key:"dirFileInput",ref:Ae,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[3]||(t[3]=(...u)=>n(de)&&n(de)(...u))},null,544)],64)}}});const Go=Qt(Lo,[["__scopeId","data-v-1bb14a91"]]);export{Go as default};

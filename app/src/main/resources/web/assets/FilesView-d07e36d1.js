import{o as i,e as c,f as a,d as Se,a0 as Ie,a6 as ut,ai as dt,t as _,h as n,u as _t,r as w,p as pt,C as mt,ab as ht,a as ft,s as ve,c as bt,b6 as vt,b7 as kt,b8 as yt,b9 as gt,ba as Tt,bb as Ct,a9 as ke,az as qt,E as Dt,G as $t,H as wt,I as St,x as k,F as y,J as S,w as I,j as f,g as T,y as V,af as It,bc as Vt,ao as Mt,A as Q,z as ye,K as X,bd as ge,be as Te,as as Ft,S as Et,m as g,at as xt,au as At,bf as Bt,V as H,aD as Ce,X as qe,a8 as Zt,ag as zt,bg as Ht,bh as Pt,bi as Lt,bj as Nt,_ as Wt}from"./index-71d8bb76.js";import{_ as Rt}from"./Breadcrumb-91ff4b3f.js";import{g as De,M as Ut}from"./splitpanes.es-85db08aa.js";import{n as jt}from"./list-6498ebd9.js";import{t as Gt}from"./truncate-66113621.js";import{E as $e}from"./EditValueModal-7e22b6d3.js";import"./stringToArray-4eaf66ad.js";import"./vee-validate.esm-49ea0aba.js";const Kt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ot=a("path",{fill:"currentColor",d:"M8 18H4q-.425 0-.713-.288T3 17q0-.425.288-.713T4 16h4q.425 0 .713.288T9 17q0 .425-.288.713T8 18ZM20 8H4q-.425 0-.713-.288T3 7q0-.425.288-.713T4 6h16q.425 0 .713.288T21 7q0 .425-.288.713T20 8Zm-6 5H4q-.425 0-.713-.288T3 12q0-.425.288-.713T4 11h10q.425 0 .713.288T15 12q0 .425-.288.713T14 13Z"},null,-1),Jt=[Ot];function Qt(p,o){return i(),c("svg",Kt,Jt)}const Xt={name:"material-symbols-sort-rounded",render:Qt},Yt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},eo=a("path",{fill:"currentColor",d:"M19.6 21.6L12 14l-2.35 2.35q.2.375.275.8T10 18q0 1.65-1.175 2.825T6 22q-1.65 0-2.825-1.175T2 18q0-1.65 1.175-2.825T6 14q.425 0 .85.075t.8.275L10 12L7.65 9.65q-.375.2-.8.275T6 10q-1.65 0-2.825-1.175T2 6q0-1.65 1.175-2.825T6 2q1.65 0 2.825 1.175T10 6q0 .425-.075.85t-.275.8L21.6 19.6q.425.425.425 1t-.425 1q-.425.425-1 .425t-1-.425ZM15 11l-2-2l6.6-6.6q.425-.425 1-.425t1 .425q.425.425.425 1t-.425 1L15 11ZM6 8q.825 0 1.413-.588T8 6q0-.825-.588-1.413T6 4q-.825 0-1.413.588T4 6q0 .825.588 1.413T6 8Zm6 4.5q.225 0 .363-.138T12.5 12q0-.225-.138-.363T12 11.5q-.225 0-.363.138T11.5 12q0 .225.138.363T12 12.5ZM6 20q.825 0 1.413-.588T8 18q0-.825-.588-1.413T6 16q-.825 0-1.413.588T4 18q0 .825.588 1.413T6 20Z"},null,-1),to=[eo];function oo(p,o){return i(),c("svg",Yt,to)}const so={name:"material-symbols-content-cut-rounded",render:oo},no={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ao=a("path",{fill:"currentColor",d:"M9 18q-.825 0-1.413-.588T7 16V4q0-.825.588-1.413T9 2h9q.825 0 1.413.588T20 4v12q0 .825-.588 1.413T18 18H9Zm0-2h9V4H9v12Zm-4 6q-.825 0-1.413-.588T3 20V7q0-.425.288-.713T4 6q.425 0 .713.288T5 7v13h10q.425 0 .713.288T16 21q0 .425-.288.713T15 22H5ZM9 4v12V4Z"},null,-1),lo=[ao];function io(p,o){return i(),c("svg",no,lo)}const co={name:"material-symbols-content-copy-outline-rounded",render:io},ro={id:"form",slot:"content",method:"dialog"},uo={slot:"actions"},_o={form:"form",value:"cancel"},po=["disabled"],we=Se({__name:"DeleteFileConfirm",props:{onDone:{type:Function,required:!0},files:{type:Array,required:!0}},setup(p){const o=p,{mutate:P,loading:F,onDone:L}=Ie({document:ut`
    mutation DeleteFiles($paths: [String!]!) {
      deleteFiles(paths: $paths)
    }
  `,appApi:!0});function u(){P({paths:o.files.map(b=>b.path)})}return L(()=>{o.onDone(o.files),dt()}),(b,E)=>(i(),c("md-dialog",null,[a("form",ro,_(b.$t("confirm_to_delete_name",{name:n(Gt)(p.files.map(h=>h.name).join(", "),{length:200})})),1),a("div",uo,[a("md-outlined-button",_o,_(b.$t("cancel")),1),a("md-filled-button",{form:"form",value:"delete",disabled:n(F),onClick:u,autofocus:""},_(b.$t("delete")),9,po)])]))}}),M=p=>(xt("data-v-b6b29b8a"),p=p(),At(),p),mo={class:"v-toolbar"},ho={class:"right-actions"},fo=M(()=>a("md-ripple",null,null,-1)),bo=M(()=>a("md-ripple",null,null,-1)),vo=["onClick"],ko=M(()=>a("md-ripple",null,null,-1)),yo=["onClick"],go=M(()=>a("md-ripple",null,null,-1)),To={class:"form-check"},Co={class:"form-check-label"},qo=["checked"],Do={class:"form-check"},$o={class:"form-check-label"},wo=["checked"],So={class:"icon-button btn-sort"},Io=M(()=>a("md-ripple",null,null,-1)),Vo={class:"menu-items"},Mo=["onClick","headline"],Fo={class:"file-items"},Eo=["onClick","onDblclick","onContextmenu"],xo=["checked"],Ao=["src"],Bo={class:"title"},Zo={style:{"font-size":"0.75rem"}},zo=["onContextmenu"],Ho={key:0,class:"no-files"},Po={key:0,class:"file-item-info"},Lo=Se({__name:"FilesView",setup(p){var me,he,fe,be;const{t:o}=_t(),P=w([]),F=pt(),L=F.query,u=F.params.type,b=w(mt(((me=L.q)==null?void 0:me.toString())??"")),E=ht(b.value),h=w(((he=E.find(e=>e.name==="path"))==null?void 0:he.value)??"");let x=((fe=E.find(e=>e.name==="dir"))==null?void 0:fe.value)??"";x||(((be=E.find(t=>t.name==="isDir"))==null?void 0:be.value)==="1"?x=h.value:x=h.value.substring(0,h.value.lastIndexOf("/")));const Ve=w(x),Me=[{label:"sort_by.date_asc",value:"DATE_ASC"},{label:"sort_by.date_desc",value:"DATE_DESC"},{label:"sort_by.size_asc",value:"SIZE_ASC"},{label:"sort_by.size_desc",value:"SIZE_DESC"},{label:"sort_by.name_asc",value:"NAME_ASC"},{label:"sort_by.name_desc",value:"NAME_DESC"}],C=w(!1),Y=ft(),{fileShowHidden:A,fileSortBy:N}=ve(Y),ee=bt(),{app:q,urlTokenKey:W,selectedFiles:Fe}=ve(ee);let B=q.value.internalStoragePath;u&&(u==="sdcard"?B=q.value.sdcardPath:u.startsWith("usb")?B=q.value.usbDiskPaths[parseInt(u.substring(3))-1]:u==="app"&&(B=q.value.externalFilesDir));const{loading:Ee,panels:m,currentDir:R,refetch:te}=vt(W,B,Ve.value,N),{createPath:xe,createVariables:Ae,createMutation:Be}=kt(W,m),{renameValue:Ze,renamePath:ze,renameDone:He,renameMutation:Pe,renameVariables:Le}=yt(m),{internal:oe,sdcard:se,usb:Ne,refetch:U}=gt(),{onDeleted:ne}=Pt(m,R,U),{downloadFile:ae,downloadDir:We,downloadFiles:Re}=It(W),{view:j}=Lt(P,(e,t)=>{ee.lightbox={sources:e,index:t,visible:!0}}),{selectedItem:Z,select:Ue}=Tt(R,u,b,Y),{canPaste:le,copy:G,cut:ie,paste:K}=Ct(Fe,te,U),{input:je,upload:ce,uploadChanged:re}=ke(),{input:Ge,upload:ue,uploadChanged:de}=ke(),{mutate:Ke,onDone:Oe}=Ie({document:Vt,appApi:!0});Oe(e=>{Re(e.data.setTempValue.key)});const D=()=>{const e=[];return m.value.forEach(t=>{t.items.forEach(s=>{s.checked&&(s.panel=t,e.push(s))})}),e};function Je(e){C.value=e.target.checked}const Qe=()=>{Ke({key:Bt(),value:JSON.stringify(D().map(e=>({path:e.path})))})},Xe=qt(()=>D().length>0),Ye=()=>{H(we,{files:D(),onDone:ne})};h.value&&Dt(()=>m.value.length,()=>{if(m.value.length>0&&h.value){const t=m.value[m.value.length-1].items.find(s=>s.path===h.value);t&&(Z.value=t,h.value="")}});function et(){var e,t,s,r;if(u){if(u==="sdcard")return`${o("sdcard")} (${o("storage_free_total",{free:g(((e=se.value)==null?void 0:e.freeBytes)??0),total:g(((t=se.value)==null?void 0:t.totalBytes)??0)})})`;if(u==="app")return o("app_name");if(u.startsWith("usb")){const z=parseInt(u.substring(3)),v=Ne.value[z-1];return`${o("usb_storage")} ${z} (${o("storage_free_total",{free:g((v==null?void 0:v.freeBytes)??0),total:g((v==null?void 0:v.totalBytes)??0)})})`}}return`${o("page_title.files")} (${o("storage_free_total",{free:g(((s=oe.value)==null?void 0:s.freeBytes)??0),total:g(((r=oe.value)==null?void 0:r.totalBytes)??0)})})`}function tt(e,t){if(C.value){t.checked=!t.checked;return}Ue(e,t)}function _e(e){return ge(e.name)||Te(e.name)||Nt(e.name)}function ot(e,t){N.value=t,e.close()}function st(e,t){t.isDir||(_e(t)?j(A?e.items:e.items.filter(s=>!s.name.startsWith(".")),t):ae(t.path))}function nt(e,t){e.preventDefault();const s=[{label:o("create_folder"),onClick:()=>{xe.value=t,H($e,{title:o("name"),placeholder:o("name"),mutation:Be,getVariables:Ae})}},{label:o("upload_files"),onClick:()=>{ce(t)}},{label:o("upload_folder"),onClick:()=>{ue(t)}}];le()&&s.push({label:o("paste"),onClick:()=>{K(t)}}),Ce({x:e.x,y:e.y,items:s})}function at(e,t,s){e.preventDefault();let r;s.isDir?r=[{label:o("upload_files"),onClick:()=>{ce(s.path)}},{label:o("upload_folder"),onClick:()=>{ue(s.path)}},{label:o("download"),onClick:()=>{We(s.path)}}]:(r=[],_e(s)&&r.push({label:o("open"),onClick:()=>{j(t.items,s)}}),r.push({label:o("download"),onClick:()=>{ae(s.path)}})),r.push({label:o("duplicate"),onClick:()=>{G([s]),K(t.dir)}}),r.push({label:o("cut"),onClick:()=>{s.panel=t,ie([s])}}),r.push({label:o("copy"),onClick:()=>{G([s])}}),s.isDir&&le()&&r.push({label:o("paste"),onClick:()=>{K(s.path)}}),r=[...r,{label:o("rename"),onClick:()=>{Ze.value=s.name,ze.value=s.path,H($e,{title:o("rename"),placeholder:o("name"),value:s.name,mutation:Pe,getVariables:Le,done:He})}},{label:o("delete"),onClick:()=>{H(we,{files:[s],onDone:ne})}}],Ce({x:e.x,y:e.y,items:r})}const pe=e=>{e.status==="done"&&setTimeout(()=>{te(e.dir),U()},1e3)};return $t(()=>{qe.on("upload_task_done",pe)}),wt(()=>{qe.off("upload_task_done",pe)}),(e,t)=>{const s=Rt,r=co,z=so,v=Zt,lt=zt,it=Xt,ct=Mt,rt=Ht,$=St("tooltip");return i(),c(y,null,[a("div",mo,[k(s,{current:et}),a("div",ho,[C.value&&Xe.value?(i(),c(y,{key:0},[S((i(),c("button",{class:"icon-button",onClick:t[0]||(t[0]=I(()=>n(G)(D()),["stop"]))},[fo,k(r)])),[[$,e.$t("copy")]]),S((i(),c("button",{class:"icon-button",onClick:t[1]||(t[1]=I(()=>n(ie)(D()),["stop"]))},[bo,k(z)])),[[$,e.$t("cut")]]),S((i(),c("button",{class:"icon-button",onClick:I(Ye,["stop"])},[ko,k(v)],8,vo)),[[$,e.$t("delete")]]),S((i(),c("button",{class:"icon-button",onClick:I(Qe,["stop"])},[go,k(lt)],8,yo)),[[$,e.$t("download")]])],64)):f("",!0),a("div",To,[a("label",Co,[a("md-checkbox",{"touch-target":"wrapper",onChange:Je,checked:C.value},null,40,qo),T(" "+_(e.$t("select_mode")),1)])]),a("div",Do,[a("label",$o,[a("md-checkbox",{"touch-target":"wrapper",checked:n(A)},null,8,wo),T(_(e.$t("show_hidden")),1)])]),k(ct,null,{content:V(d=>[a("div",Vo,[(i(),c(y,null,Q(Me,l=>a("md-menu-item",{onClick:O=>ot(d,l.value),headline:e.$t(l.label),class:ye({selected:l.value===n(N)})},null,10,Mo)),64))])]),default:V(()=>[S((i(),c("button",So,[Io,k(it)])),[[$,e.$t("sort")]])]),_:1})])]),k(n(Ut),{class:"panel-container"},{default:V(()=>[(i(!0),c(y,null,Q(n(m),d=>(i(),X(n(De),{key:d.dir},{default:V(()=>[a("div",Fo,[(i(!0),c(y,null,Q(d.items,l=>{var O;return i(),c(y,{key:l.path},[!l.name.startsWith(".")||n(A)?(i(),c("div",{key:0,class:ye(["file-item",{active:(n(R)+"/").startsWith(l.path+"/")||((O=n(Z))==null?void 0:O.path)===l.path}]),onClick:J=>tt(d,l),onDblclick:I(J=>st(d,l),["prevent"]),onContextmenu:J=>at(J,d,l)},[C.value?(i(),c("md-checkbox",{key:0,"touch-target":"wrapper",checked:l.checked},null,8,xo)):f("",!0),l.isDir?(i(),X(rt,{key:1})):f("",!0),n(ge)(l.name)||n(Te)(l.name)?(i(),c("img",{key:2,src:n(Ft)(l.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,Ao)):f("",!0),a("div",Bo,[T(_(l.name)+" ",1),a("div",Zo,[T(_(n(Et)(l.updatedAt)),1),l.isDir?f("",!0):(i(),c(y,{key:0},[T(", "+_(n(g)(l.size)),1)],64))])])],42,Eo)):f("",!0)],64)}),128)),a("div",{class:"empty",onContextmenu:l=>nt(l,d.dir)},[d.items.filter(l=>!l.name.startsWith(".")||n(A)).length===0?(i(),c("div",Ho,_(e.$t("no_files")),1)):f("",!0)],40,zo)])]),_:2},1024))),128)),n(m).length===0?(i(),X(n(De),{key:0,class:"no-data-placeholder"},{default:V(()=>[T(_(e.$t(n(jt)(n(Ee),n(q).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):f("",!0)]),_:1}),n(Z)?(i(),c("div",Po,_(e.$t("path"))+": "+_(n(Z).path),1)):f("",!0),a("input",{ref_key:"fileInput",ref:je,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...d)=>n(re)&&n(re)(...d))},null,544),a("input",{ref_key:"dirFileInput",ref:Ge,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[3]||(t[3]=(...d)=>n(de)&&n(de)(...d))},null,544)],64)}}});const Jo=Wt(Lo,[["__scopeId","data-v-b6b29b8a"]]);export{Jo as default};

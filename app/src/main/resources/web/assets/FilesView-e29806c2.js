import{o as l,e as c,f as a,d as $e,a2 as we,a6 as nt,ai as at,j as d,k as n,u as lt,r as $,p as it,C as ct,ab as rt,a as ut,c as dt,s as fe,b5 as pt,b6 as mt,b7 as _t,b8 as ht,b9 as ft,ba as vt,a9 as ve,bb as bt,az as kt,I as gt,J as yt,K as Ct,L as Tt,x as g,F as y,M as E,w,m as f,g as C,y as O,A as be,R as Q,z as qt,bc as ke,bd as ge,as as Dt,Q as $t,l as k,af as wt,be as Vt,V as L,bf as ye,a8 as Ft,ag as It,bg as St,au as Mt,av as xt,bh as Bt,bi as At,bj as Et,$ as Ce,_ as Lt}from"./index-2c8e7849.js";import{_ as Pt}from"./Breadcrumb-01ba2071.js";import{g as Te,M as Zt}from"./splitpanes.es-c9c152ea.js";import{n as zt}from"./list-6498ebd9.js";import{t as Rt}from"./truncate-74788062.js";import{E as qe}from"./EditValueModal-66c9db73.js";import"./stringToArray-36968540.js";import"./vee-validate.esm-83a41e33.js";const Wt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Nt=a("path",{fill:"currentColor",d:"M19.6 21.6L12 14l-2.35 2.35q.2.375.275.8T10 18q0 1.65-1.175 2.825T6 22q-1.65 0-2.825-1.175T2 18q0-1.65 1.175-2.825T6 14q.425 0 .85.075t.8.275L10 12L7.65 9.65q-.375.2-.8.275T6 10q-1.65 0-2.825-1.175T2 6q0-1.65 1.175-2.825T6 2q1.65 0 2.825 1.175T10 6q0 .425-.075.85t-.275.8L21.6 19.6q.425.425.425 1t-.425 1q-.425.425-1 .425t-1-.425ZM15 11l-2-2l6.6-6.6q.425-.425 1-.425t1 .425q.425.425.425 1t-.425 1L15 11ZM6 8q.825 0 1.413-.588T8 6q0-.825-.588-1.413T6 4q-.825 0-1.413.588T4 6q0 .825.588 1.413T6 8Zm6 4.5q.225 0 .363-.138T12.5 12q0-.225-.138-.363T12 11.5q-.225 0-.363.138T11.5 12q0 .225.138.363T12 12.5ZM6 20q.825 0 1.413-.588T8 18q0-.825-.588-1.413T6 16q-.825 0-1.413.588T4 18q0 .825.588 1.413T6 20Z"},null,-1),Ht=[Nt];function Ut(_,s){return l(),c("svg",Wt,Ht)}const jt={name:"material-symbols-content-cut-rounded",render:Ut},Kt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ot=a("path",{fill:"currentColor",d:"M9 18q-.825 0-1.413-.588T7 16V4q0-.825.588-1.413T9 2h9q.825 0 1.413.588T20 4v12q0 .825-.588 1.413T18 18H9Zm0-2h9V4H9v12Zm-4 6q-.825 0-1.413-.588T3 20V7q0-.425.288-.713T4 6q.425 0 .713.288T5 7v13h10q.425 0 .713.288T16 21q0 .425-.288.713T15 22H5ZM9 4v12V4Z"},null,-1),Qt=[Ot];function Gt(_,s){return l(),c("svg",Kt,Qt)}const Jt={name:"material-symbols-content-copy-outline-rounded",render:Gt},Xt={id:"form",slot:"content",method:"dialog"},Yt={slot:"actions"},eo={form:"form",value:"cancel"},to=["disabled"],De=$e({__name:"DeleteFileConfirm",props:{onDone:{type:Function,required:!0},files:{type:Array,required:!0}},setup(_){const s=_,{mutate:Z,loading:V,onDone:z}=we({document:nt`
    mutation DeleteFiles($paths: [String!]!) {
      deleteFiles(paths: $paths)
    }
  `,appApi:!0});function u(){Z({paths:s.files.map(v=>v.path)})}return z(()=>{s.onDone(s.files),at()}),(v,F)=>(l(),c("md-dialog",null,[a("form",Xt,d(v.$t("confirm_to_delete_name",{name:n(Rt)(_.files.map(h=>h.name).join(", "),{length:200})})),1),a("div",Yt,[a("md-outlined-button",eo,d(v.$t("cancel")),1),a("md-filled-button",{form:"form",value:"delete",disabled:n(V),onClick:u,autofocus:""},d(v.$t("delete")),9,to)])]))}}),P=_=>(Mt("data-v-038f26e9"),_=_(),xt(),_),oo={class:"v-toolbar"},so={class:"right-actions"},no=P(()=>a("md-ripple",null,null,-1)),ao=P(()=>a("md-ripple",null,null,-1)),lo=["onClick"],io=P(()=>a("md-ripple",null,null,-1)),co=["onClick"],ro=P(()=>a("md-ripple",null,null,-1)),uo={class:"form-check mt-2 me-3 ms-3"},po={class:"form-check-label"},mo=["checked"],_o={class:"form-check mt-2"},ho={class:"form-check-label"},fo=["checked"],vo={class:"file-items"},bo=["onClick","onDblclick","onContextmenu"],ko=["checked"],go=["src"],yo={class:"title"},Co={style:{"font-size":"0.75rem"}},To=["onContextmenu"],qo={key:0,class:"no-files"},Do={key:0,class:"file-item-info"},$o=$e({__name:"FilesView",setup(_){var de,pe,me,_e;const{t:s}=lt(),Z=$([]),V=it(),z=V.query,u=V.params.type,v=$(ct(((de=z.q)==null?void 0:de.toString())??"")),F=rt(v.value),h=$(((pe=F.find(e=>e.name==="path"))==null?void 0:pe.value)??"");let I=((me=F.find(e=>e.name==="dir"))==null?void 0:me.value)??"";I||(((_e=F.find(t=>t.name==="isDir"))==null?void 0:_e.value)==="1"?I=h.value:I=h.value.substring(0,h.value.lastIndexOf("/")));const Ve=$(I),T=$(!1),G=ut(),J=dt(),{app:q,urlTokenKey:R,selectedFiles:Fe}=fe(J);let S=q.value.internalStoragePath;u&&(u==="sdcard"?S=q.value.sdcardPath:u.startsWith("usb")?S=q.value.usbDiskPaths[parseInt(u.substring(3))-1]:u==="app"&&(S=q.value.externalFilesDir));const{loading:Ie,panels:m,currentDir:W,refetch:X}=pt(R,S,Ve.value),{createPath:Se,createVariables:Me,createMutation:xe}=mt(R,m),{renameValue:Be,renamePath:Ae,renameDone:Ee,renameMutation:Le,renameVariables:Pe}=_t(m),{internal:Y,sdcard:ee,usb:Ze,refetch:N}=ht(),{onDeleted:te}=Bt(m,W,N),{downloadFile:oe,downloadDir:ze,downloadFiles:Re}=wt(R),{view:H}=At(Z,(e,t)=>{J.lightbox={sources:e,index:t,visible:!0}}),{selectedItem:M,select:We}=ft(W,u,v,G),{canPaste:se,copy:U,cut:ne,paste:j}=vt(Fe,X,N),{input:Ne,upload:ae,uploadChanged:le}=ve(),{input:He,upload:ie,uploadChanged:ce}=ve(),{mutate:Ue,onDone:je}=we({document:bt,appApi:!0});je(e=>{Re(e.data.setTempValue.key)});const D=()=>{const e=[];return m.value.forEach(t=>{t.items.forEach(o=>{o.checked&&(o.panel=t,e.push(o))})}),e};function Ke(e){T.value=e.target.checked}const Oe=()=>{Ue({key:Vt(),value:JSON.stringify(D().map(e=>({path:e.path})))})},Qe=kt(()=>D().length>0),Ge=()=>{L(De,{files:D(),onDone:te})},{fileShowHidden:x}=fe(G);h.value&&gt(()=>m.value.length,()=>{if(m.value.length>0&&h.value){const t=m.value[m.value.length-1].items.find(o=>o.path===h.value);t&&(M.value=t,h.value="")}});function Je(){var e,t,o,r;if(u){if(u==="sdcard")return`${s("sdcard")} (${s("storage_free_total",{free:k(((e=ee.value)==null?void 0:e.freeBytes)??0),total:k(((t=ee.value)==null?void 0:t.totalBytes)??0)})})`;if(u==="app")return s("app_name");if(u.startsWith("usb")){const B=parseInt(u.substring(3)),b=Ze.value[B-1];return`${s("usb_storage")} ${B} (${s("storage_free_total",{free:k((b==null?void 0:b.freeBytes)??0),total:k((b==null?void 0:b.totalBytes)??0)})})`}}return`${s("page_title.files")} (${s("storage_free_total",{free:k(((o=Y.value)==null?void 0:o.freeBytes)??0),total:k(((r=Y.value)==null?void 0:r.totalBytes)??0)})})`}function Xe(e,t){if(T.value){t.checked=!t.checked;return}We(e,t)}function re(e){return ke(e.name)||ge(e.name)||Et(e.name)}function Ye(e,t){t.isDir||(re(t)?H(x?e.items:e.items.filter(o=>!o.name.startsWith(".")),t):oe(t.path))}function et(e,t){e.preventDefault();const o=[{label:s("create_folder"),onClick:()=>{Se.value=t,L(qe,{title:s("name"),placeholder:s("name"),mutation:xe,getVariables:Me})}},{label:s("upload_files"),onClick:()=>{ae(t)}},{label:s("upload_folder"),onClick:()=>{ie(t)}}];se()&&o.push({label:s("paste"),onClick:()=>{j(t)}}),ye({x:e.x,y:e.y,items:o})}function tt(e,t,o){e.preventDefault();let r;o.isDir?r=[{label:s("upload_files"),onClick:()=>{ae(o.path)}},{label:s("upload_folder"),onClick:()=>{ie(o.path)}},{label:s("download"),onClick:()=>{ze(o.path)}}]:(r=[],re(o)&&r.push({label:s("open"),onClick:()=>{H(t.items,o)}}),r.push({label:s("download"),onClick:()=>{oe(o.path)}})),r.push({label:s("duplicate"),onClick:()=>{U([o]),j(t.dir)}}),r.push({label:s("cut"),onClick:()=>{o.panel=t,ne([o])}}),r.push({label:s("copy"),onClick:()=>{U([o])}}),o.isDir&&se()&&r.push({label:s("paste"),onClick:()=>{j(o.path)}}),r=[...r,{label:s("rename"),onClick:()=>{Be.value=o.name,Ae.value=o.path,L(qe,{title:s("rename"),placeholder:s("name"),value:o.name,mutation:Le,getVariables:Pe,done:Ee})}},{label:s("delete"),onClick:()=>{L(De,{files:[o],onDone:te})}}],ye({x:e.x,y:e.y,items:r})}const ue=e=>{e.status==="done"&&setTimeout(()=>{X(e.dir),N()},1e3)};return yt(()=>{Ce.on("upload_task_done",ue)}),Ct(()=>{Ce.off("upload_task_done",ue)}),(e,t)=>{const o=Pt,r=Jt,B=jt,b=Ft,ot=It,st=St,A=Tt("tooltip");return l(),c(y,null,[a("div",oo,[g(o,{current:Je}),a("div",so,[T.value&&Qe.value?(l(),c(y,{key:0},[E((l(),c("button",{class:"icon-button",onClick:t[0]||(t[0]=w(()=>n(U)(D()),["stop"]))},[no,g(r)])),[[A,e.$t("copy")]]),E((l(),c("button",{class:"icon-button",onClick:t[1]||(t[1]=w(()=>n(ne)(D()),["stop"]))},[ao,g(B)])),[[A,e.$t("cut")]]),E((l(),c("button",{class:"icon-button",onClick:w(Ge,["stop"])},[io,g(b)],8,lo)),[[A,e.$t("delete")]]),E((l(),c("button",{class:"icon-button",onClick:w(Oe,["stop"])},[ro,g(ot)],8,co)),[[A,e.$t("download")]])],64)):f("",!0),a("div",uo,[a("label",po,[a("md-checkbox",{"touch-target":"wrapper",onChange:Ke,checked:T.value},null,40,mo),C(" "+d(e.$t("select_mode")),1)])]),a("div",_o,[a("label",ho,[a("md-checkbox",{"touch-target":"wrapper",checked:n(x)},null,8,fo),C(d(e.$t("show_hidden")),1)])])])]),g(n(Zt),{class:"panel-container"},{default:O(()=>[(l(!0),c(y,null,be(n(m),p=>(l(),Q(n(Te),{key:p.dir},{default:O(()=>[a("div",vo,[(l(!0),c(y,null,be(p.items,i=>{var he;return l(),c(y,{key:i.path},[!i.name.startsWith(".")||n(x)?(l(),c("div",{key:0,class:qt(["file-item",{active:(n(W)+"/").startsWith(i.path+"/")||((he=n(M))==null?void 0:he.path)===i.path}]),onClick:K=>Xe(p,i),onDblclick:w(K=>Ye(p,i),["prevent"]),onContextmenu:K=>tt(K,p,i)},[T.value?(l(),c("md-checkbox",{key:0,"touch-target":"wrapper",checked:i.checked},null,8,ko)):f("",!0),i.isDir?(l(),Q(st,{key:1})):f("",!0),n(ke)(i.name)||n(ge)(i.name)?(l(),c("img",{key:2,src:n(Dt)(i.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,go)):f("",!0),a("div",yo,[C(d(i.name)+" ",1),a("div",Co,[C(d(n($t)(i.updatedAt)),1),i.isDir?f("",!0):(l(),c(y,{key:0},[C(", "+d(n(k)(i.size)),1)],64))])])],42,bo)):f("",!0)],64)}),128)),a("div",{class:"empty",onContextmenu:i=>et(i,p.dir)},[p.items.filter(i=>!i.name.startsWith(".")||n(x)).length===0?(l(),c("div",qo,d(e.$t("no_files")),1)):f("",!0)],40,To)])]),_:2},1024))),128)),n(m).length===0?(l(),Q(n(Te),{key:0,class:"no-data-placeholder"},{default:O(()=>[C(d(e.$t(n(zt)(n(Ie),n(q).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):f("",!0)]),_:1}),n(M)?(l(),c("div",Do,d(e.$t("path"))+": "+d(n(M).path),1)):f("",!0),a("input",{ref_key:"fileInput",ref:Ne,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...p)=>n(le)&&n(le)(...p))},null,544),a("input",{ref_key:"dirFileInput",ref:He,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[3]||(t[3]=(...p)=>n(ce)&&n(ce)(...p))},null,544)],64)}}});const Ao=Lt($o,[["__scopeId","data-v-038f26e9"]]);export{Ao as default};

import{u as Ge,_ as xe,a as Ke,b as Oe}from"./list-749f5b0f.js";import{d as We,aA as Pe,e as Xe,s as _e,r as D,u as je,f as Je,K as Ye,L as Ze,D as et,M as tt,aB as st,af as ot,aC as lt,N as nt,w as at,O as it,P as k,Q as dt,R as ct,c as a,a as s,p as i,j as t,F as C,m,l as _,k as y,S as L,H as Q,J as F,t as r,T as ut,U as _t,x as rt,aD as pt,aE as mt,C as re,W as pe,at as ht,o as n,v as gt,z as me,I as vt,ax as he,aF as M,$ as ge,A as ft,B as kt,al as yt,aG as bt,a2 as $t,a3 as wt,a0 as Ct,a1 as Tt,as as It,aH as Vt,aI as St,ad as Dt,am as At,a4 as Rt,a5 as zt,a6 as Et,_ as Bt}from"./index-8658c612.js";import{_ as Ft}from"./sort-rounded-b9dc2257.js";import{_ as Mt}from"./upload-rounded-21a94c2f.js";import{_ as Ut,a as qt}from"./grid-view-outline-rounded-b433a634.js";import{_ as Nt}from"./Breadcrumb-d12d7841.js";import{u as Ht,a as Lt}from"./tags-435dbeeb.js";import"./vee-validate.esm-80895fcc.js";const u=R=>(ft("data-v-d2032d39"),R=R(),kt(),R),Qt={class:"v-toolbar"},Gt=u(()=>s("md-ripple",null,null,-1)),xt=u(()=>s("md-ripple",null,null,-1)),Kt=u(()=>s("md-ripple",null,null,-1)),Ot=["onClick"],Wt=u(()=>s("md-ripple",null,null,-1)),Pt=["onClick"],Xt=u(()=>s("md-ripple",null,null,-1)),jt={class:"icon-button btn-sort"},Jt=u(()=>s("md-ripple",null,null,-1)),Yt={class:"menu-items"},Zt=["onClick","selected"],es={slot:"headline"},ts={class:"filters"},ss=["label"],os={class:"form-label"},ls=["label","selected","onClick"],ns={class:"buttons"},as=["onClick"],is={key:0,class:"image-container",style:{"margin-bottom":"24px"}},ds=["onClick","onContextmenu"],cs=["src"],us={class:"duration"},_s={key:1,class:"table-responsive"},rs={class:"table"},ps=["checked","indeterminate"],ms=u(()=>s("th",null,"ID",-1)),hs=u(()=>s("th",null,null,-1)),gs=u(()=>s("th",null,null,-1)),vs=["onClick"],fs=["checked"],ks=["src","onClick"],ys={class:"nowrap"},bs={class:"action-btns"},$s=["onClick"],ws=u(()=>s("md-ripple",null,null,-1)),Cs=["onClick"],Ts=u(()=>s("md-ripple",null,null,-1)),Is=["onClick"],Vs=u(()=>s("md-ripple",null,null,-1)),Ss={class:"nowrap"},Ds={key:0},As={colspan:"7"},Rs={class:"no-data-placeholder"},zs={key:2,class:"no-data-placeholder"},A=48,Es=We({__name:"ImagesView",setup(R){var ie,de;const ve=Pe(),d=Xe(),{imageSortBy:U}=_e(d),g=D([]),G=D(),{t:T}=je(),x=Je(),{app:K,urlTokenKey:q}=_e(x),v=Ye({text:"",tags:[]}),c=Ze.IMAGE,O=et().query,I=D(parseInt(((ie=O.page)==null?void 0:ie.toString())??"1")),b=D(tt(((de=O.q)==null?void 0:de.toString())??"")),V=D(""),{tags:z}=Ht(c,b,v,async e=>{V.value=ut(e),await _t(),Ie()}),{addToTags:fe}=Lt(c,g,z),{deleteItems:ke,deleteItem:W}=st(),{allChecked:P,realAllChecked:E,selectRealAll:ye,allCheckedAlertVisible:be,clearSelection:B,toggleAllChecked:X,toggleItemChecked:j,toggleRow:$e,total:$,checked:J}=Ge(g),{downloadItems:we}=ot(q,c,g,B,"images.zip"),{downloadFile:Y}=yt(q),Ce=bt(),N=lt(()=>g.value.map(e=>({src:he(e.fileId),name:M(e.path),duration:0,size:e.size,path:e.path,type:c,data:e})));function Z(e){x.lightbox={sources:N.value,index:e,visible:!0}}function ee(e){$t(wt,{type:c,tags:z.value,item:{key:e.id,title:e.title,size:e.size},selected:z.value.filter(l=>e.tags.some(w=>w.id===l.id))})}function Te(e,l){U.value=l,e.close()}const{loading:te,load:Ie,refetch:H}=nt({handle:async(e,l)=>{if(l)rt(T(l),"error");else if(e){const w=[];for(const S of e.images)w.push({...S,checked:!1,fileId:pt(q.value,S.path)});g.value=w,$.value=e.imageCount}},document:mt,variables:()=>({offset:(I.value-1)*A,limit:A,query:V.value,sortBy:U.value}),appApi:!0});function Ve(){re(d,`/images?page=${I.value}&q=${pe(b.value)}`)}at(I,()=>{Ve()});function Se(e){v.tags.includes(e)?Ct(v.tags,l=>l.id===e.id):v.tags.push(e)}function De(){b.value=Tt(v),se(),G.value.dismiss()}function se(){re(d,`/images?q=${pe(b.value)}`)}function Ae(){d.imageViewType==="grid"?d.imageViewType="list":d.imageViewType="grid"}function Re(){ve.push("/files"),It(Vt,{message:T("upload_images")})}function ze(e,l){e.preventDefault(),St({x:e.x,y:e.y,items:[{label:T("add_to_tags"),onClick:()=>{ee(l)}},{label:T("download"),onClick:()=>{Y(l.path,M(l.path).replace(" ","-"))}},{label:T("delete"),onClick:()=>{W(c,l)}}]})}const oe=e=>{e.type===c&&(B(),H())},le=e=>{e.type===c&&H()},ne=e=>{e.type===c&&(B(),H())},ae=()=>{$.value--};return it(()=>{k.on("item_tags_updated",le),k.on("items_tags_updated",oe),k.on("media_item_deleted",ae),k.on("media_items_deleted",ne)}),dt(()=>{k.off("item_tags_updated",le),k.off("items_tags_updated",oe),k.off("media_item_deleted",ae),k.off("media_items_deleted",ne)}),(e,l)=>{const w=Nt,S=Dt,ce=At,ue=Rt,Ee=Ut,Be=qt,Fe=Mt,Me=Ft,Ue=ht,qe=xe,Ne=Ke,He=zt,Le=Et,Qe=Oe,h=ct("tooltip");return n(),a(C,null,[s("div",Qt,[i(w,{current:()=>`${e.$t("page_title.images")} (${t($)})`},null,8,["current"]),t(J)&&t(d).imageViewType==="list"?(n(),a(C,{key:0},[m((n(),a("button",{class:"icon-button",onClick:l[0]||(l[0]=_(o=>t(ke)(t(c),g.value,t(E),V.value),["stop"]))},[Gt,i(S)])),[[h,e.$t("delete")]]),m((n(),a("button",{class:"icon-button",onClick:l[1]||(l[1]=_(o=>t(we)(t(E),V.value),["stop"]))},[xt,i(ce)])),[[h,e.$t("download")]]),m((n(),a("button",{class:"icon-button",onClick:l[2]||(l[2]=_(o=>t(fe)(t(E),V.value),["stop"]))},[Kt,i(ue)])),[[h,e.$t("add_to_tags")]])],64)):y("",!0),m((n(),a("button",{class:"icon-button",onClick:_(Ae,["stop"])},[Wt,t(d).imageViewType==="list"?(n(),L(Ee,{key:0})):y("",!0),t(d).imageViewType==="grid"?(n(),L(Be,{key:1})):y("",!0)],8,Ot)),[[h,e.$t(t(d).imageViewType==="list"?"view_as_grid":"view_as_list")]]),m((n(),a("button",{class:"icon-button",onClick:_(Re,["prevent"])},[Xt,i(Fe)],8,Pt)),[[h,e.$t("upload")]]),i(Ue,null,{content:Q(o=>[s("div",Yt,[(n(!0),a(C,null,F(t(Ce),f=>(n(),a("md-menu-item",{onClick:p=>Te(o,f.value),selected:f.value===t(U)},[s("div",es,r(e.$t(f.label)),1)],8,Zt))),256))])]),default:Q(()=>[m((n(),a("button",jt,[Jt,i(Me)])),[[h,e.$t("sort")]])]),_:1}),i(qe,{ref_key:"searchInputRef",ref:G,modelValue:b.value,"onUpdate:modelValue":l[4]||(l[4]=o=>b.value=o),search:se},{filters:Q(()=>[s("div",ts,[m(s("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":l[3]||(l[3]=o=>v.text=o),"keyup.enter":"applyAndDoSearch"},null,8,ss),[[gt,v.text]]),s("label",os,r(e.$t("tags")),1),s("md-chip-set",null,[(n(!0),a(C,null,F(t(z),o=>(n(),a("md-filter-chip",{key:o.id,label:o.name,selected:v.tags.includes(o),onClick:f=>Se(o)},null,8,ls))),128))]),s("div",ns,[s("md-filled-button",{onClick:_(De,["stop"])},r(e.$t("search")),9,as)])])]),_:1},8,["modelValue"])]),t(d).imageViewType==="grid"?(n(),a("div",is,[(n(!0),a(C,null,F(N.value,(o,f)=>(n(),a("div",{class:"item",onClick:p=>Z(f),onContextmenu:p=>ze(p,o.data)},[s("img",{class:"image",src:o.src+"&w=300&h=300"},null,8,cs),s("span",us,r(t(me)(o.size)),1)],40,ds))),256))])):y("",!0),i(Ne,{limit:A,total:t($),"all-checked-alert-visible":t(be),"real-all-checked":t(E),"select-real-all":t(ye),"clear-selection":t(B)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t(d).imageViewType==="list"?(n(),a("div",_s,[s("table",rs,[s("thead",null,[s("tr",null,[s("th",null,[s("md-checkbox",{"touch-target":"wrapper",onChange:l[5]||(l[5]=(...o)=>t(X)&&t(X)(...o)),checked:t(P),indeterminate:!t(P)&&t(J)},null,40,ps)]),ms,hs,s("th",null,r(e.$t("name")),1),gs,s("th",null,r(e.$t("tags")),1),s("th",null,r(e.$t("file_size")),1)])]),s("tbody",null,[(n(!0),a(C,null,F(g.value,(o,f)=>(n(),a("tr",{key:o.id,class:vt({selected:o.checked}),onClick:_(p=>t($e)(o),["stop"])},[s("td",null,[s("md-checkbox",{"touch-target":"wrapper",onChange:l[6]||(l[6]=(...p)=>t(j)&&t(j)(...p)),checked:o.checked},null,40,fs)]),s("td",null,[i(He,{id:o.id,raw:o},null,8,["id","raw"])]),s("td",null,[s("img",{src:t(he)(o.fileId)+"&w=300&h=300",width:"50",height:"50",onClick:_(p=>Z(f),["stop"]),style:{cursor:"pointer"}},null,8,ks)]),s("td",null,r(t(M)(o.path)),1),s("td",ys,[s("div",bs,[m((n(),a("button",{class:"icon-button",onClick:_(p=>t(W)(t(c),o),["stop"])},[ws,i(S)],8,$s)),[[h,e.$t("delete")]]),m((n(),a("button",{class:"icon-button",onClick:_(p=>t(Y)(o.path,t(M)(o.path).replace(" ","-")),["stop"])},[Ts,i(ce)],8,Cs)),[[h,e.$t("download")]]),m((n(),a("button",{class:"icon-button",onClick:_(p=>ee(o),["stop"])},[Vs,i(ue)],8,Is)),[[h,e.$t("add_to_tags")]])])]),s("td",null,[i(Le,{tags:o.tags,type:t(c)},null,8,["tags","type"])]),s("td",Ss,r(t(me)(o.size)),1)],10,vs))),128))]),g.value.length?y("",!0):(n(),a("tfoot",Ds,[s("tr",null,[s("td",As,[s("div",Rs,r(e.$t(t(ge)(t(te),t(K).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])])):y("",!0),t(d).imageViewType==="grid"&&N.value.length===0?(n(),a("div",zs,r(e.$t(t(ge)(t(te),t(K).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):y("",!0),t($)>A?(n(),L(Qe,{key:3,modelValue:I.value,"onUpdate:modelValue":l[7]||(l[7]=o=>I.value=o),total:t($),limit:A},null,8,["modelValue","total"])):y("",!0)],64)}}});const Gs=Bt(Es,[["__scopeId","data-v-d2032d39"]]);export{Gs as default};

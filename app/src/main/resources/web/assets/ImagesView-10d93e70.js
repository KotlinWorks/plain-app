import{u as Ue,_ as Be,a as qe,b as Ne}from"./list-52cf89a9.js";import{d as xe,aA as He,e as Le,r as V,u as Qe,f as Ge,s as Ke,K as Oe,L as Xe,D as Pe,M as We,aB as Je,ag as je,aC as Ye,N as Ze,O as et,P as tt,Q as v,R as st,S as ot,c as a,a as s,p as c,k as t,F as S,m,w as u,l as k,T as N,H as lt,J as x,t as r,U as nt,V as at,x as it,aD as dt,aE as ct,C as ce,X as ue,o as n,v as ut,z as _e,I as _t,ax as re,aF as M,a0 as pe,A as rt,B as pt,am as mt,a3 as gt,a4 as ht,a1 as ft,a2 as vt,as as kt,aG as yt,aH as bt,ae as wt,an as Ct,a5 as $t,a6 as Tt,a7 as It,_ as Vt}from"./index-6ca6ab55.js";import{_ as St}from"./upload-rounded-1ac5cb7b.js";import{_ as Dt,a as At}from"./grid-view-outline-rounded-2276f7cc.js";import{_ as Rt}from"./Breadcrumb-1bb571cf.js";import{u as zt,a as Et}from"./tags-00196dbb.js";import"./vee-validate.esm-42364128.js";const _=A=>(rt("data-v-f48b5108"),A=A(),pt(),A),Ft={class:"v-toolbar"},Mt=_(()=>s("md-ripple",null,null,-1)),Ut=_(()=>s("md-ripple",null,null,-1)),Bt=_(()=>s("md-ripple",null,null,-1)),qt=["onClick"],Nt=_(()=>s("md-ripple",null,null,-1)),xt=["onClick"],Ht=_(()=>s("md-ripple",null,null,-1)),Lt={class:"filters"},Qt=["label"],Gt={class:"form-label"},Kt=["label","selected","onClick"],Ot={class:"buttons"},Xt=["onClick"],Pt={key:0,class:"image-container",style:{"margin-bottom":"24px"}},Wt=["onClick","onContextmenu"],Jt=["src"],jt={class:"duration"},Yt={key:1,class:"table-responsive"},Zt={class:"table"},es=["checked","indeterminate"],ts=_(()=>s("th",null,"ID",-1)),ss=_(()=>s("th",null,null,-1)),os=_(()=>s("th",null,null,-1)),ls=["onClick"],ns=["checked"],as=["src","onClick"],is={class:"nowrap"},ds={class:"action-btns"},cs=["onClick"],us=_(()=>s("md-ripple",null,null,-1)),_s=["onClick"],rs=_(()=>s("md-ripple",null,null,-1)),ps=["onClick"],ms=_(()=>s("md-ripple",null,null,-1)),gs={class:"nowrap"},hs={key:0},fs={colspan:"7"},vs={class:"no-data-placeholder"},ks={key:2,class:"no-data-placeholder"},D=48,ys=xe({__name:"ImagesView",setup(A){var ne,ae;const me=He(),i=Le(),g=V([]),H=V(),{t:C}=Qe(),L=Ge(),{app:Q,urlTokenKey:U}=Ke(L),h=Oe({text:"",tags:[]}),d=Xe.IMAGE,G=Pe().query,$=V(parseInt(((ne=G.page)==null?void 0:ne.toString())??"1")),y=V(We(((ae=G.q)==null?void 0:ae.toString())??"")),T=V(""),{tags:R}=zt(d,y,h,async e=>{T.value=nt(e),await at(),be()}),{addToTags:ge}=Et(d,g,R),{deleteItems:he,deleteItem:K}=Je(),{allChecked:O,realAllChecked:z,selectRealAll:fe,allCheckedAlertVisible:ve,clearSelection:E,toggleAllChecked:X,toggleItemChecked:P,toggleRow:ke,total:b,checked:W}=Ue(g),{downloadItems:ye}=je(U,d,g,E,"images.zip"),{downloadFile:J}=mt(U),B=Ye(()=>g.value.map(e=>({src:re(e.fileId),name:M(e.path),duration:0,size:e.size,path:e.path,type:d,data:e})));function j(e){L.lightbox={sources:B.value,index:e,visible:!0}}function Y(e){gt(ht,{type:d,tags:R.value,item:{key:e.id,title:e.title,size:e.size},selected:R.value.filter(l=>e.tags.some(w=>w.id===l.id))})}const{loading:Z,load:be,refetch:q}=Ze({handle:async(e,l)=>{if(l)it(C(l),"error");else if(e){const w=[];for(const I of e.images)w.push({...I,checked:!1,fileId:dt(U.value,I.path)});g.value=w,b.value=e.imageCount}},document:ct,variables:()=>({offset:($.value-1)*D,limit:D,query:T.value}),appApi:!0});function we(){ce(i,`/images?page=${$.value}&q=${ue(y.value)}`)}et($,()=>{we()});function Ce(e){h.tags.includes(e)?ft(h.tags,l=>l.id===e.id):h.tags.push(e)}function $e(){y.value=vt(h),ee(),H.value.dismiss()}function ee(){ce(i,`/images?q=${ue(y.value)}`)}function Te(){i.imageViewType==="grid"?i.imageViewType="list":i.imageViewType="grid"}function Ie(){me.push("/files"),kt(yt,{message:C("upload_images")})}function Ve(e,l){e.preventDefault(),bt({x:e.x,y:e.y,items:[{label:C("add_to_tags"),onClick:()=>{Y(l)}},{label:C("download"),onClick:()=>{J(l.path,M(l.path).replace(" ","-"))}},{label:C("delete"),onClick:()=>{K(d,l)}}]})}const te=e=>{e.type===d&&(E(),q())},se=e=>{e.type===d&&q()},oe=e=>{e.type===d&&(E(),q())},le=()=>{b.value--};return tt(()=>{v.on("item_tags_updated",se),v.on("items_tags_updated",te),v.on("media_item_deleted",le),v.on("media_items_deleted",oe)}),st(()=>{v.off("item_tags_updated",se),v.off("items_tags_updated",te),v.off("media_item_deleted",le),v.off("media_items_deleted",oe)}),(e,l)=>{const w=Rt,I=wt,ie=Ct,de=$t,Se=Dt,De=At,Ae=St,Re=Be,ze=qe,Ee=Tt,Fe=It,Me=Ne,f=ot("tooltip");return n(),a(S,null,[s("div",Ft,[c(w,{current:()=>`${e.$t("page_title.images")} (${t(b)})`},null,8,["current"]),t(W)&&t(i).imageViewType==="list"?(n(),a(S,{key:0},[m((n(),a("button",{class:"icon-button",onClick:l[0]||(l[0]=u(o=>t(he)(t(d),g.value,t(z),T.value),["stop"]))},[Mt,c(I)])),[[f,e.$t("delete")]]),m((n(),a("button",{class:"icon-button",onClick:l[1]||(l[1]=u(o=>t(ye)(t(z),T.value),["stop"]))},[Ut,c(ie)])),[[f,e.$t("download")]]),m((n(),a("button",{class:"icon-button",onClick:l[2]||(l[2]=u(o=>t(ge)(t(z),T.value),["stop"]))},[Bt,c(de)])),[[f,e.$t("add_to_tags")]])],64)):k("",!0),m((n(),a("button",{class:"icon-button",onClick:u(Te,["stop"])},[Nt,t(i).imageViewType==="list"?(n(),N(Se,{key:0})):k("",!0),t(i).imageViewType==="grid"?(n(),N(De,{key:1})):k("",!0)],8,qt)),[[f,e.$t(t(i).imageViewType==="list"?"view_as_grid":"view_as_list")]]),m((n(),a("button",{class:"icon-button",onClick:u(Ie,["prevent"])},[Ht,c(Ae)],8,xt)),[[f,e.$t("upload")]]),c(Re,{ref_key:"searchInputRef",ref:H,modelValue:y.value,"onUpdate:modelValue":l[4]||(l[4]=o=>y.value=o),search:ee},{filters:lt(()=>[s("div",Lt,[m(s("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":l[3]||(l[3]=o=>h.text=o),"keyup.enter":"applyAndDoSearch"},null,8,Qt),[[ut,h.text]]),s("label",Gt,r(e.$t("tags")),1),s("md-chip-set",null,[(n(!0),a(S,null,x(t(R),o=>(n(),a("md-filter-chip",{key:o.id,label:o.name,selected:h.tags.includes(o),onClick:F=>Ce(o)},null,8,Kt))),128))]),s("div",Ot,[s("md-filled-button",{onClick:u($e,["stop"])},r(e.$t("search")),9,Xt)])])]),_:1},8,["modelValue"])]),t(i).imageViewType==="grid"?(n(),a("div",Pt,[(n(!0),a(S,null,x(B.value,(o,F)=>(n(),a("div",{class:"item",onClick:p=>j(F),onContextmenu:p=>Ve(p,o.data)},[s("img",{class:"image",src:o.src+"&w=300&h=300"},null,8,Jt),s("span",jt,r(t(_e)(o.size)),1)],40,Wt))),256))])):k("",!0),c(ze,{limit:D,total:t(b),"all-checked-alert-visible":t(ve),"real-all-checked":t(z),"select-real-all":t(fe),"clear-selection":t(E)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t(i).imageViewType==="list"?(n(),a("div",Yt,[s("table",Zt,[s("thead",null,[s("tr",null,[s("th",null,[s("md-checkbox",{"touch-target":"wrapper",onChange:l[5]||(l[5]=(...o)=>t(X)&&t(X)(...o)),checked:t(O),indeterminate:!t(O)&&t(W)},null,40,es)]),ts,ss,s("th",null,r(e.$t("name")),1),os,s("th",null,r(e.$t("tags")),1),s("th",null,r(e.$t("file_size")),1)])]),s("tbody",null,[(n(!0),a(S,null,x(g.value,(o,F)=>(n(),a("tr",{key:o.id,class:_t({selected:o.checked}),onClick:u(p=>t(ke)(o),["stop"])},[s("td",null,[s("md-checkbox",{"touch-target":"wrapper",onChange:l[6]||(l[6]=(...p)=>t(P)&&t(P)(...p)),checked:o.checked},null,40,ns)]),s("td",null,[c(Ee,{id:o.id,raw:o},null,8,["id","raw"])]),s("td",null,[s("img",{src:t(re)(o.fileId)+"&w=300&h=300",width:"50",height:"50",onClick:u(p=>j(F),["stop"]),style:{cursor:"pointer"}},null,8,as)]),s("td",null,r(t(M)(o.path)),1),s("td",is,[s("div",ds,[m((n(),a("button",{class:"icon-button",onClick:u(p=>t(K)(t(d),o),["stop"])},[us,c(I)],8,cs)),[[f,e.$t("delete")]]),m((n(),a("button",{class:"icon-button",onClick:u(p=>t(J)(o.path,t(M)(o.path).replace(" ","-")),["stop"])},[rs,c(ie)],8,_s)),[[f,e.$t("download")]]),m((n(),a("button",{class:"icon-button",onClick:u(p=>Y(o),["stop"])},[ms,c(de)],8,ps)),[[f,e.$t("add_to_tags")]])])]),s("td",null,[c(Fe,{tags:o.tags,type:t(d)},null,8,["tags","type"])]),s("td",gs,r(t(_e)(o.size)),1)],10,ls))),128))]),g.value.length?k("",!0):(n(),a("tfoot",hs,[s("tr",null,[s("td",fs,[s("div",vs,r(e.$t(t(pe)(t(Z),t(Q).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])])):k("",!0),t(i).imageViewType==="grid"&&B.value.length===0?(n(),a("div",ks,r(e.$t(t(pe)(t(Z),t(Q).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):k("",!0),t(b)>D?(n(),N(Me,{key:3,modelValue:$.value,"onUpdate:modelValue":l[7]||(l[7]=o=>$.value=o),total:t(b),limit:D},null,8,["modelValue","total"])):k("",!0)],64)}}});const Ds=Vt(ys,[["__scopeId","data-v-f48b5108"]]);export{Ds as default};

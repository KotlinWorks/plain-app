import{u as Me,_ as Ue,a as qe,b as Ne}from"./list-d530dbcb.js";import{d as Le,ay as Qe,a as xe,r as V,u as Ge,c as He,s as Ke,B as We,D as Xe,p as Oe,C as Pe,az as je,ab as Je,aA as Ye,E as Ze,G as et,H as tt,I as st,J as ot,e as n,f as s,x as c,h as t,F as S,K as m,w as u,j as v,L as N,y as lt,A as L,t as r,M as at,N as nt,k as it,aB as dt,aC as ct,n as ce,P as ue,o as a,Q as ut,m as _e,z as _t,at as re,aD as F,au as rt,av as pt,ag as mt,W as ht,X as gt,U as ft,V as vt,ao as kt,aE as yt,Y as k,a9 as bt,ah as wt,Z as Ct,$ as $t,a0 as Tt,_ as It}from"./index-642041e3.js";import{_ as Vt,a as St}from"./ConfirmModal.vuevuetypescriptsetuptruelang-6079afa9.js";import{_ as Dt,a as At}from"./grid-view-outline-rounded-32e92927.js";import{_ as zt}from"./Breadcrumb-ace66a87.js";import{n as pe}from"./list-6498ebd9.js";import{u as Rt,a as Et}from"./tags-8a481a23.js";import"./vee-validate.esm-805f179c.js";const _=A=>(rt("data-v-0620da54"),A=A(),pt(),A),Bt={class:"v-toolbar"},Ft=_(()=>s("md-ripple",null,null,-1)),Mt=_(()=>s("md-ripple",null,null,-1)),Ut=_(()=>s("md-ripple",null,null,-1)),qt=["onClick"],Nt=_(()=>s("md-ripple",null,null,-1)),Lt=["onClick"],Qt=_(()=>s("md-ripple",null,null,-1)),xt={class:"filters"},Gt=["label"],Ht={class:"form-label"},Kt={type:"filter"},Wt=["label","selected","onClick"],Xt={class:"buttons"},Ot=["onClick"],Pt={key:0,class:"image-container",style:{"margin-bottom":"24px"}},jt=["onClick","onContextmenu"],Jt=["src"],Yt={class:"duration"},Zt={key:1,class:"table-responsive"},es={class:"table"},ts=["checked","indeterminate"],ss=_(()=>s("th",null,"ID",-1)),os=_(()=>s("th",null,null,-1)),ls=_(()=>s("th",null,null,-1)),as=["onClick"],ns=["checked"],is=["src","onClick"],ds={class:"nowrap"},cs={class:"action-btns"},us=["onClick"],_s=_(()=>s("md-ripple",null,null,-1)),rs=["onClick"],ps=_(()=>s("md-ripple",null,null,-1)),ms=["onClick"],hs=_(()=>s("md-ripple",null,null,-1)),gs={class:"nowrap"},fs={key:0},vs={colspan:"7"},ks={class:"no-data-placeholder"},ys={key:2,class:"no-data-placeholder"},D=48,bs=Le({__name:"ImagesView",setup(A){var ae,ne;const me=Qe(),i=xe(),h=V([]),Q=V(),{t:C}=Ge(),x=He(),{app:G,urlTokenKey:M}=Ke(x),g=We({text:"",tags:[]}),d=Xe.IMAGE,H=Oe().query,$=V(parseInt(((ae=H.page)==null?void 0:ae.toString())??"1")),y=V(Pe(((ne=H.q)==null?void 0:ne.toString())??"")),T=V(""),{tags:z}=Rt(d,y,g,async e=>{T.value=at(e),await nt(),be()}),{addToTags:he}=Et(d,h,z),{deleteItems:ge,deleteItem:K}=je(),{allChecked:W,realAllChecked:R,selectRealAll:fe,allCheckedAlertVisible:ve,clearSelection:E,toggleAllChecked:X,toggleItemChecked:O,toggleRow:ke,total:b,checked:P}=Me(h),{downloadItems:ye}=Je(M,d,h,E,"images.zip"),{downloadFile:j}=mt(M),U=Ye(()=>h.value.map(e=>({src:re(e.fileId),name:F(e.path),duration:0,size:e.size,path:e.path,type:d,data:e})));function J(e){x.lightbox={sources:U.value,index:e,visible:!0}}function Y(e){ht(gt,{type:d,tags:z.value,item:{key:e.id,title:e.title,size:e.size},selected:z.value.filter(l=>e.tags.some(w=>w.id===l.id))})}const{loading:Z,load:be,refetch:q}=Ze({handle:async(e,l)=>{if(l)it(C(l),"error");else if(e){const w=[];for(const I of e.images)w.push({...I,checked:!1,fileId:dt(M.value,I.path)});h.value=w,b.value=e.imageCount}},document:ct,variables:()=>({offset:($.value-1)*D,limit:D,query:T.value}),appApi:!0});function we(){ce(i,`/images?page=${$.value}&q=${ue(y.value)}`)}et($,()=>{we()});function Ce(e){g.tags.includes(e)?ft(g.tags,l=>l.id===e.id):g.tags.push(e)}function $e(){y.value=vt(g),ee(),Q.value.dismiss()}function ee(){ce(i,`/images?q=${ue(y.value)}`)}function Te(){i.imageViewType==="grid"?i.imageViewType="list":i.imageViewType="grid"}function Ie(){me.push("/files"),kt(Vt,{message:C("upload_images")})}function Ve(e,l){e.preventDefault(),yt({x:e.x,y:e.y,items:[{label:C("add_to_tags"),onClick:()=>{Y(l)}},{label:C("download"),onClick:()=>{j(l.path,F(l.path).replace(" ","-"))}},{label:C("delete"),onClick:()=>{K(d,l)}}]})}const te=e=>{e.type===d&&(E(),q())},se=e=>{e.type===d&&q()},oe=e=>{e.type===d&&(E(),q())},le=()=>{b.value--};return tt(()=>{k.on("item_tags_updated",se),k.on("items_tags_updated",te),k.on("media_item_deleted",le),k.on("media_items_deleted",oe)}),st(()=>{k.off("item_tags_updated",se),k.off("items_tags_updated",te),k.off("media_item_deleted",le),k.off("media_items_deleted",oe)}),(e,l)=>{const w=zt,I=bt,ie=wt,de=Ct,Se=Dt,De=At,Ae=St,ze=Ue,Re=qe,Ee=$t,Be=Tt,Fe=Ne,f=ot("tooltip");return a(),n(S,null,[s("div",Bt,[c(w,{current:()=>`${e.$t("page_title.images")} (${t(b)})`},null,8,["current"]),t(P)&&t(i).imageViewType==="list"?(a(),n(S,{key:0},[m((a(),n("button",{class:"icon-button",onClick:l[0]||(l[0]=u(o=>t(ge)(t(d),h.value,t(R),T.value),["stop"]))},[Ft,c(I)])),[[f,e.$t("delete")]]),m((a(),n("button",{class:"icon-button",onClick:l[1]||(l[1]=u(o=>t(ye)(t(R),T.value),["stop"]))},[Mt,c(ie)])),[[f,e.$t("download")]]),m((a(),n("button",{class:"icon-button",onClick:l[2]||(l[2]=u(o=>t(he)(t(R),T.value),["stop"]))},[Ut,c(de)])),[[f,e.$t("add_to_tags")]])],64)):v("",!0),m((a(),n("button",{class:"icon-button",onClick:u(Te,["stop"])},[Nt,t(i).imageViewType==="list"?(a(),N(Se,{key:0})):v("",!0),t(i).imageViewType==="grid"?(a(),N(De,{key:1})):v("",!0)],8,qt)),[[f,e.$t(t(i).imageViewType==="list"?"view_as_grid":"view_as_list")]]),m((a(),n("button",{class:"icon-button",onClick:u(Ie,["prevent"])},[Qt,c(Ae)],8,Lt)),[[f,e.$t("upload")]]),c(ze,{ref_key:"searchInputRef",ref:Q,modelValue:y.value,"onUpdate:modelValue":l[4]||(l[4]=o=>y.value=o),search:ee},{filters:lt(()=>[s("div",xt,[m(s("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":l[3]||(l[3]=o=>g.text=o),"keyup.enter":"applyAndDoSearch"},null,8,Gt),[[ut,g.text]]),s("label",Ht,r(e.$t("tags")),1),s("md-chip-set",Kt,[(a(!0),n(S,null,L(t(z),o=>(a(),n("md-filter-chip",{key:o.id,label:o.name,selected:g.tags.includes(o),onClick:B=>Ce(o)},null,8,Wt))),128))]),s("div",Xt,[s("md-filled-button",{onClick:u($e,["stop"])},r(e.$t("search")),9,Ot)])])]),_:1},8,["modelValue"])]),t(i).imageViewType==="grid"?(a(),n("div",Pt,[(a(!0),n(S,null,L(U.value,(o,B)=>(a(),n("div",{class:"item",onClick:p=>J(B),onContextmenu:p=>Ve(p,o.data)},[s("img",{class:"image",src:o.src+"&w=300&h=300"},null,8,Jt),s("span",Yt,r(t(_e)(o.size)),1)],40,jt))),256))])):v("",!0),c(Re,{limit:D,total:t(b),"all-checked-alert-visible":t(ve),"real-all-checked":t(R),"select-real-all":t(fe),"clear-selection":t(E)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t(i).imageViewType==="list"?(a(),n("div",Zt,[s("table",es,[s("thead",null,[s("tr",null,[s("th",null,[s("md-checkbox",{"touch-target":"wrapper",onChange:l[5]||(l[5]=(...o)=>t(X)&&t(X)(...o)),checked:t(W),indeterminate:!t(W)&&t(P)},null,40,ts)]),ss,os,s("th",null,r(e.$t("name")),1),ls,s("th",null,r(e.$t("tags")),1),s("th",null,r(e.$t("file_size")),1)])]),s("tbody",null,[(a(!0),n(S,null,L(h.value,(o,B)=>(a(),n("tr",{key:o.id,class:_t({selected:o.checked}),onClick:u(p=>t(ke)(o),["stop"])},[s("td",null,[s("md-checkbox",{"touch-target":"wrapper",onChange:l[6]||(l[6]=(...p)=>t(O)&&t(O)(...p)),checked:o.checked},null,40,ns)]),s("td",null,[c(Ee,{id:o.id,raw:o},null,8,["id","raw"])]),s("td",null,[s("img",{src:t(re)(o.fileId)+"&w=300&h=300",width:"50",height:"50",onClick:u(p=>J(B),["stop"]),style:{cursor:"pointer"}},null,8,is)]),s("td",null,r(t(F)(o.path)),1),s("td",ds,[s("div",cs,[m((a(),n("button",{class:"icon-button",onClick:u(p=>t(K)(t(d),o),["stop"])},[_s,c(I)],8,us)),[[f,e.$t("delete")]]),m((a(),n("button",{class:"icon-button",onClick:u(p=>t(j)(o.path,t(F)(o.path).replace(" ","-")),["stop"])},[ps,c(ie)],8,rs)),[[f,e.$t("download")]]),m((a(),n("button",{class:"icon-button",onClick:u(p=>Y(o),["stop"])},[hs,c(de)],8,ms)),[[f,e.$t("add_to_tags")]])])]),s("td",null,[c(Be,{tags:o.tags,type:t(d)},null,8,["tags","type"])]),s("td",gs,r(t(_e)(o.size)),1)],10,as))),128))]),h.value.length?v("",!0):(a(),n("tfoot",fs,[s("tr",null,[s("td",vs,[s("div",ks,r(e.$t(t(pe)(t(Z),t(G).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])])):v("",!0),t(i).imageViewType==="grid"&&U.value.length===0?(a(),n("div",ys,r(e.$t(t(pe)(t(Z),t(G).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):v("",!0),t(b)>D?(a(),N(Fe,{key:3,modelValue:$.value,"onUpdate:modelValue":l[7]||(l[7]=o=>$.value=o),total:t(b),limit:D},null,8,["modelValue","total"])):v("",!0)],64)}}});const zs=It(bs,[["__scopeId","data-v-0620da54"]]);export{zs as default};

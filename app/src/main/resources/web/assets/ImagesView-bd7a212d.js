import{u as Ve,_ as ze,a as Ae}from"./list-3f4b71c4.js";import{d as De,ay as Ee,p as Re,r as v,u as Be,a as Fe,s as Me,C as qe,n as Ne,D as Ue,E as Le,G as Ge,az as Qe,ab as Ke,aA as Oe,H as We,t as Xe,aB as He,aC as Pe,J as te,K as je,L as se,M as Je,N as Ye,o,c as l,e as s,x as c,j as n,F as w,O as r,w as d,l as h,T as D,y as Ze,P as xe,g as u,A as E,k as oe,z as et,at as ne,aD as R,ag as tt,X as st,Y as ot,V as nt,W as at,B as ae,U as le,ao as lt,a9 as it,ah as ct,Z as dt,$ as ut,a0 as rt,av as _t,aw as pt,_ as mt}from"./index-df35a132.js";import{_ as ht,a as gt}from"./ConfirmModal.vuevuetypescriptsetuptruelang-7328d99c.js";import{_ as vt,a as ft}from"./grid-view-outline-rounded-89da8be1.js";import{_ as kt}from"./Breadcrumb-120bdd32.js";import{n as ie}from"./list-6498ebd9.js";import{u as yt,a as bt}from"./tags-ecacebdb.js";import"./vee-validate.esm-aa1410cb.js";const B=C=>(_t("data-v-81d7ceba"),C=C(),pt(),C),$t={class:"v-toolbar"},wt=["onClick"],Ct=["onClick"],It={class:"filters"},Tt=["label"],St={class:"form-label"},Vt={type:"filter"},zt=["label","selected","onClick"],At={class:"buttons"},Dt=["onClick"],Et={key:0,class:"image-container",style:{"margin-bottom":"24px"}},Rt=["onClick"],Bt=["src"],Ft={class:"duration"},Mt={class:"table-responsive"},qt={key:0,class:"table"},Nt=["checked"],Ut=B(()=>s("th",null,"ID",-1)),Lt=B(()=>s("th",null,null,-1)),Gt=B(()=>s("th",null,null,-1)),Qt=["onClick"],Kt=["checked"],Ot=["src","onClick"],Wt={class:"nowrap"},Xt={class:"action-btns"},Ht=["onClick"],Pt=["onClick"],jt=["onClick"],Jt={key:0},Yt={colspan:"7"},Zt={class:"no-data-placeholder"},xt={key:1,class:"no-data-placeholder"},g="IMAGE",V=50,es=De({__name:"ImagesView",setup(C){var J,Y,Z;const ce=Ee(),F=Re(),_=v([]),M=v(),{t:q}=Be(),N=Fe(),{app:U,fileIdKey:L}=Me(N),p=qe({text:"",tags:[]}),z=Ne().query,y=v(parseInt(((J=z.page)==null?void 0:J.toString())??"1")),I=v(0),f=v(Ue(((Y=z.q)==null?void 0:Y.toString())??"")),G=v(""),{tags:T}=yt(g,f,p,async e=>{G.value=Le(e),await Ge(),he()}),i=v(((Z=z.view)==null?void 0:Z.toString())??"grid"),{addToTags:Q}=bt(g,_,T),{deleteItems:de,deleteItem:ue}=Qe(),{downloadItems:K}=Ke(_,"images.zip"),{downloadFile:re}=tt(L),A=Oe(()=>_.value.map(e=>({src:ne(e.fileId),name:R(e.path),duration:0,size:e.size,path:e.path,tagType:g,data:e})));function O(e){N.lightbox={sources:A.value,index:e,visible:!0}}function _e(e){st(ot,{tagType:g,tags:T.value,item:{key:e.id,title:e.title,size:e.size},selected:T.value.filter(a=>e.tags.some(k=>k.id===a.id))})}const{selectAll:pe,toggleSelect:W,checked:me}=Ve(_),{loading:X,load:he,refetch:ge}=We({handle:async(e,a)=>{if(a)Xe(q(a),"error");else if(e){const k=[];for(const b of e.images)k.push({...b,checked:!1,fileId:He(L.value,b.path)});_.value=k,I.value=e.imageCount}},document:Pe,variables:()=>({offset:(y.value-1)*V,limit:V,query:G.value}),appApi:!0});function H(){ae(F,`/images?page=${y.value}&q=${le(f.value)}&view=${i.value}`)}te(y,()=>{H()}),te(i,()=>{H()});function ve(e){p.tags.includes(e)?nt(p.tags,a=>a.id===e.id):p.tags.push(e)}function fe(){f.value=at(p),P(),M.value.dismiss()}function P(){ae(F,`/images?q=${le(f.value)}&view=${i.value}`)}function ke(){i.value==="grid"?i.value="list":i.value="grid"}function ye(){ce.push("/files"),lt(ht,{message:q("upload_images")})}const j=e=>{e===g&&ge()};return je(()=>{se.on("refetch_by_tag_type",j)}),Je(()=>{se.off("refetch_by_tag_type",j)}),(e,a)=>{const k=kt,b=it,x=ct,ee=dt,be=vt,$e=ft,we=gt,Ce=ze,Ie=ut,Te=rt,Se=Ae,m=Ye("tooltip");return o(),l(w,null,[s("div",$t,[c(k,{current:()=>`${e.$t("page_title.images")} (${I.value})`},null,8,["current"]),n(me)&&i.value==="list"?(o(),l(w,{key:0},[r((o(),l("md-icon-button",{onClick:a[0]||(a[0]=d(t=>n(de)(g,_.value),["stop"]))},[c(b)])),[[m,e.$t("delete")]]),r((o(),l("md-icon-button",{onClick:a[1]||(a[1]=d((...t)=>n(K)&&n(K)(...t),["stop"]))},[c(x)])),[[m,e.$t("download")]]),r((o(),l("md-icon-button",{onClick:a[2]||(a[2]=d((...t)=>n(Q)&&n(Q)(...t),["stop"]))},[c(ee)])),[[m,e.$t("add_to_tags")]])],64)):h("",!0),r((o(),l("md-icon-button",{onClick:d(ke,["stop"])},[i.value==="list"?(o(),D(be,{key:0})):h("",!0),i.value==="grid"?(o(),D($e,{key:1})):h("",!0)],8,wt)),[[m,e.$t(i.value==="list"?"view_as_grid":"view_as_list")]]),r((o(),l("md-icon-button",{onClick:d(ye,["prevent"])},[c(we)],8,Ct)),[[m,e.$t("upload")]]),c(Ce,{ref_key:"searchInputRef",ref:M,modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=t=>f.value=t),search:P},{filters:Ze(()=>[s("div",It,[r(s("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":a[3]||(a[3]=t=>p.text=t),"keyup.enter":"applyAndDoSearch"},null,8,Tt),[[xe,p.text]]),s("label",St,u(e.$t("tags")),1),s("md-chip-set",Vt,[(o(!0),l(w,null,E(n(T),t=>(o(),l("md-filter-chip",{key:t.id,label:t.name,selected:p.tags.includes(t),onClick:S=>ve(t)},null,8,zt))),128))]),s("div",At,[s("md-filled-button",{onClick:d(fe,["stop"])},u(e.$t("search")),9,Dt)])])]),_:1},8,["modelValue"])]),i.value==="grid"?(o(),l("div",Et,[(o(!0),l(w,null,E(A.value,(t,S)=>(o(),l("div",{class:"item",onClick:$=>O(S)},[s("img",{class:"image",src:t.src+"&w=300&h=300"},null,8,Bt),s("span",Ft,u(n(oe)(t.size)),1)],8,Rt))),256))])):h("",!0),s("div",Mt,[i.value==="list"?(o(),l("table",qt,[s("thead",null,[s("tr",null,[s("th",null,[s("md-checkbox",{"touch-target":"wrapper",onChange:a[5]||(a[5]=(...t)=>n(W)&&n(W)(...t)),checked:n(pe)},null,40,Nt)]),Ut,Lt,s("th",null,u(e.$t("name")),1),Gt,s("th",null,u(e.$t("tags")),1),s("th",null,u(e.$t("file_size")),1)])]),s("tbody",null,[(o(!0),l(w,null,E(_.value,(t,S)=>(o(),l("tr",{key:t.id,class:et({selected:t.checked}),onClick:d($=>t.checked=!t.checked,["stop"])},[s("td",null,[s("md-checkbox",{"touch-target":"wrapper",checked:t.checked},null,8,Kt)]),s("td",null,[c(Ie,{id:t.id,raw:t},null,8,["id","raw"])]),s("td",null,[s("img",{src:n(ne)(t.fileId)+"&w=300&h=300",width:"50",height:"50",onClick:d($=>O(S),["stop"]),style:{cursor:"pointer"}},null,8,Ot)]),s("td",null,u(n(R)(t.path)),1),s("td",Wt,[s("div",Xt,[r((o(),l("md-icon-button",{onClick:d($=>n(ue)(g,t),["stop"])},[c(b)],8,Ht)),[[m,e.$t("delete")]]),r((o(),l("md-icon-button",{onClick:d($=>n(re)(t.path,n(R)(t.path).replace(" ","-")),["stop"])},[c(x)],8,Pt)),[[m,e.$t("download")]]),r((o(),l("md-icon-button",{onClick:d($=>_e(t),["stop"])},[c(ee)],8,jt)),[[m,e.$t("add_to_tags")]])])]),s("td",null,[c(Te,{tags:t.tags,tagType:g},null,8,["tags"])]),s("td",null,u(n(oe)(t.size)),1)],10,Qt))),128))]),_.value.length?h("",!0):(o(),l("tfoot",Jt,[s("tr",null,[s("td",Yt,[s("div",Zt,u(e.$t(n(ie)(n(X),n(U).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])):h("",!0)]),i.value==="grid"&&A.value.length===0?(o(),l("div",xt,u(e.$t(n(ie)(n(X),n(U).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):h("",!0),I.value>V?(o(),D(Se,{key:2,modelValue:y.value,"onUpdate:modelValue":a[6]||(a[6]=t=>y.value=t),total:I.value,limit:V},null,8,["modelValue","total"])):h("",!0)],64)}}});const us=mt(es,[["__scopeId","data-v-81d7ceba"]]);export{us as default};

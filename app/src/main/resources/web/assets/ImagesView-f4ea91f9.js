import{d as Ie,ao as Te,p as Ve,r as b,u as Se,s as Ee,a as Re,B as ze,n as Ae,C as Ue,D as Fe,E as Me,ap as qe,a3 as De,G as j,am as Y,aq as Z,H as Be,t as Ne,ar as xe,as as Le,J as ee,K as Qe,L as Ge,o as a,c as u,b as e,e as d,g as s,F as f,w as _,k as r,T as A,f as l,x as Ke,M as U,N as He,O as Oe,z as F,l as te,P as se,Q as Pe,y as We,V as Xe,A as oe,U as ne,ah as Je,at as je,a9 as Ye,aa as Ze,_ as et}from"./index-66bea2e9.js";import{u as tt,_ as st,a as ot}from"./list-99d4982b.js";import{_ as nt}from"./FieldId-e37ba71f.js";import{_ as at}from"./Multiselect-346d4eab.js";import{_ as lt,a as it}from"./grid-view-outline-rounded-0d59c2bc.js";import{_ as ut,a as ct}from"./label-outline-rounded-657ec04e.js";import{_ as dt}from"./download-rounded-19708eb3.js";import{_ as _t}from"./delete-outline-rounded-182ee2de.js";import{_ as rt}from"./Breadcrumb-731a6814.js";import{n as ae}from"./list-6498ebd9.js";import{u as pt,a as mt,b as gt}from"./tags-4fd68896.js";import{u as bt,_ as ht}from"./ConfirmModal.vuevuetypescriptsetuptruelang-1e4d94da.js";import"./VModal.vuevuetypescriptsetuptruelang-091ab08d.js";import"./vee-validate.esm-18b68f3d.js";const le=y=>(Ye("data-v-fb33aefd"),y=y(),Ze(),y),vt={class:"v-toolbar"},ft={class:"right-actions"},yt=["title"],kt=["title"],wt=["title"],$t=["title"],Ct=["onClick"],It=["onClick"],Tt={class:"row mb-3"},Vt={class:"col-md-3 col-form-label"},St={class:"col-md-9"},Et=["onKeyup"],Rt={class:"row mb-3"},zt={class:"col-md-3 col-form-label"},At={class:"col-md-9"},Ut={class:"actions"},Ft=["onClick"],Mt={key:0,class:"row row-cols-6 g-1",style:{"margin-bottom":"24px"}},qt=["onClick"],Dt=["src"],Bt={class:"duration"},Nt={key:1,class:"table"},xt=le(()=>e("th",null,"ID",-1)),Lt=le(()=>e("th",null,null,-1)),Qt=["onClick"],Gt=["onUpdate:modelValue"],Kt=["src","onClick"],Ht={class:"badge"},Ot={key:0},Pt={colspan:"6"},Wt={class:"no-data-placeholder"},Xt={key:2,class:"no-data-placeholder"},Jt=Ie({__name:"ImagesView",setup(y){var W,X,J;const ie=Te(),M=Ve(),c=b([]),{t:q}=Se(),{app:I}=Ee(Re()),p=ze({text:"",tags:[]}),h="IMAGE",T=Ae().query,v=b(parseInt(((W=T.page)==null?void 0:W.toString())??"1")),k=54,w=b(0),m=b(Ue(((X=T.q)==null?void 0:X.toString())??"")),D=b(""),{tags:V}=pt(h,m,p,async o=>{D.value=Fe(o),await Me(),re()}),i=b(((J=T.view)==null?void 0:J.toString())??"grid"),{visible:ue,index:ce,view:B,hide:de}=qe(),{addToTags:N}=mt(h,c,V),{removeFromTags:x}=gt(h,c,V),{deleteItems:L}=bt(h,c),{downloadItems:Q}=De(c,"images.zip"),S=j(()=>c.value.map(o=>({src:Y(o.fileId),name:Z(o.path),duration:0,size:o.size}))),_e=j(()=>c.value.some(o=>o.checked)),{selectAll:E,toggleSelect:G}=tt(c),{loading:K,load:re,refetch:pe}=Be({handle:async(o,n)=>{if(n)Ne(q(n),"error");else if(o){const{fileIdToken:R}=I.value,$=[];for(const C of o.images)$.push({...C,checked:!1,fileId:await xe(R,C.path)});c.value=$,w.value=o.imageCount}},document:Le,variables:()=>({offset:(v.value-1)*k,limit:k,query:D.value}),appApi:!0});function H(){oe(M,`/images?page=${v.value}&q=${ne(m.value)}&view=${i.value}`)}ee(v,()=>{H()}),ee(i,()=>{H()});function O(){m.value=Xe(p),P()}function P(){oe(M,`/images?q=${ne(m.value)}&view=${i.value}`)}function me(){i.value==="grid"?i.value="list":i.value="grid"}function ge(){ie.push("/files"),Je(ht,{message:q("upload_images")})}return Qe(()=>{Ge.on("refetch_by_tag_type",o=>{o===h&&pe()})}),(o,n)=>{const R=rt,$=_t,C=dt,be=ut,he=ct,ve=lt,fe=it,ye=at,ke=st,we=nt,$e=ot,Ce=je;return a(),u(f,null,[e("div",vt,[d(R,{current:()=>`${o.$t("page_title.images")} (${w.value})`},null,8,["current"]),e("div",ft,[s(_e)&&i.value==="list"?(a(),u(f,{key:0},[e("button",{type:"button",class:"btn btn-action",onClick:n[0]||(n[0]=_((...t)=>s(L)&&s(L)(...t),["stop"])),title:o.$t("delete")},[d($,{class:"bi"})],8,yt),e("button",{type:"button",class:"btn btn-action",onClick:n[1]||(n[1]=_((...t)=>s(Q)&&s(Q)(...t),["stop"])),title:o.$t("download")},[d(C,{class:"bi"})],8,kt),e("button",{type:"button",class:"btn btn-action",onClick:n[2]||(n[2]=_((...t)=>s(N)&&s(N)(...t),["stop"])),title:o.$t("add_to_tags")},[d(be,{class:"bi"})],8,wt),e("button",{type:"button",class:"btn btn-action",onClick:n[3]||(n[3]=_((...t)=>s(x)&&s(x)(...t),["stop"])),title:o.$t("remove_from_tags")},[d(he,{class:"bi"})],8,$t)],64)):r("",!0),e("button",{type:"button",class:"btn btn-action",onClick:_(me,["stop"])},[i.value==="list"?(a(),A(ve,{key:0,class:"bi"})):r("",!0),i.value==="grid"?(a(),A(fe,{key:1,class:"bi"})):r("",!0)],8,Ct),e("button",{type:"button",class:"btn btn-action",onClick:_(ge,["stop"])},l(o.$t("upload")),9,It),d(ke,{modelValue:m.value,"onUpdate:modelValue":n[6]||(n[6]=t=>m.value=t),search:P},{filters:Ke(()=>[e("div",Tt,[e("label",Vt,l(o.$t("keywords")),1),e("div",St,[U(e("input",{type:"text","onUpdate:modelValue":n[4]||(n[4]=t=>p.text=t),class:"form-control",onKeyup:Oe(O,["enter"])},null,40,Et),[[He,p.text]])])]),e("div",Rt,[e("label",zt,l(o.$t("tags")),1),e("div",At,[d(ye,{modelValue:p.tags,"onUpdate:modelValue":n[5]||(n[5]=t=>p.tags=t),label:"name","track-by":"id",options:s(V)},null,8,["modelValue","options"])])]),e("div",Ut,[e("button",{type:"button",class:"btn",onClick:_(O,["stop"])},l(o.$t("search")),9,Ft)])]),_:1},8,["modelValue"])])]),i.value==="grid"?(a(),u("div",Mt,[(a(!0),u(f,null,F(s(S),(t,z)=>(a(),u("div",{class:"col",onClick:g=>s(B)(z)},[e("img",{class:"image",src:t.src+"&w=200&h=200"},null,8,Dt),e("span",Bt,l(s(te)(t.size)),1)],8,qt))),256))])):r("",!0),i.value==="list"?(a(),u("table",Nt,[e("thead",null,[e("tr",null,[e("th",null,[U(e("input",{class:"form-check-input",type:"checkbox",onChange:n[7]||(n[7]=(...t)=>s(G)&&s(G)(...t)),"onUpdate:modelValue":n[8]||(n[8]=t=>Pe(E)?E.value=t:null)},null,544),[[se,s(E)]])]),xt,Lt,e("th",null,l(o.$t("name")),1),e("th",null,l(o.$t("tags")),1),e("th",null,l(o.$t("file_size")),1)])]),e("tbody",null,[(a(!0),u(f,null,F(c.value,(t,z)=>(a(),u("tr",{key:t.id,class:We({checked:t.checked}),onClick:_(g=>t.checked=!t.checked,["stop"])},[e("td",null,[U(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":g=>t.checked=g},null,8,Gt),[[se,t.checked]])]),e("td",null,[d(we,{id:t.id,raw:t},null,8,["id","raw"])]),e("td",null,[e("img",{src:s(Y)(t.fileId)+"&w=200&h=200",width:"50",height:"50",onClick:_(g=>s(B)(z),["stop"])},null,8,Kt)]),e("td",null,l(s(Z)(t.path)),1),e("td",null,[(a(!0),u(f,null,F(t.tags,g=>(a(),u("span",Ht,l(g.name),1))),256))]),e("td",null,l(s(te)(t.size)),1)],10,Qt))),128))]),c.value.length?r("",!0):(a(),u("tfoot",Ot,[e("tr",null,[e("td",Pt,[e("div",Wt,l(o.$t(s(ae)(s(K),s(I).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])):r("",!0),i.value==="grid"&&s(S).length===0?(a(),u("div",Xt,l(o.$t(s(ae)(s(K),s(I).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):r("",!0),w.value>k?(a(),A($e,{key:3,modelValue:v.value,"onUpdate:modelValue":n[9]||(n[9]=t=>v.value=t),total:w.value,limit:k},null,8,["modelValue","total"])):r("",!0),d(Ce,{visible:s(ue),index:s(ce),sources:s(S),onHide:s(de)},null,8,["visible","index","sources","onHide"])],64)}}});const rs=et(Jt,[["__scopeId","data-v-fb33aefd"]]);export{rs as default};

import{D as qe,u as Me,_ as Ne,a as Le,b as Ge}from"./list-052a81ba.js";import{d as Qe,ax as He,a as Ke,r as C,u as We,c as Xe,s as Oe,B as je,p as Je,C as Pe,D as Ye,E as Ze,ay as xe,aa as et,az as tt,G as st,t as ot,aA as lt,aB as nt,I as ce,J as at,K as it,L as dt,o as n,e as a,f as t,x as d,k as s,F as S,M as p,w as u,m as v,R as M,y as ct,N as ut,j as r,A as N,l as ue,z as _t,as as _e,aC as L,af as rt,V as pt,W as mt,T as ht,U as gt,n as re,S as pe,an as vt,a8 as ft,ag as kt,X as bt,Y as yt,Z as $t,au as Ct,av as wt,$ as f,_ as It}from"./index-5e3ce573.js";import{_ as Tt,a as St}from"./ConfirmModal.vuevuetypescriptsetuptruelang-bdc9ac2b.js";import{_ as At,a as Dt}from"./grid-view-outline-rounded-1bce7077.js";import{_ as Vt}from"./Breadcrumb-db3f2c63.js";import{n as me}from"./list-6498ebd9.js";import{u as zt,a as Rt}from"./tags-25ba5c36.js";import"./vee-validate.esm-e8a787ff.js";const _=D=>(Ct("data-v-a42797ac"),D=D(),wt(),D),Et={class:"v-toolbar"},Bt=_(()=>t("md-ripple",null,null,-1)),Ft=_(()=>t("md-ripple",null,null,-1)),Ut=_(()=>t("md-ripple",null,null,-1)),qt=["onClick"],Mt=_(()=>t("md-ripple",null,null,-1)),Nt=["onClick"],Lt=_(()=>t("md-ripple",null,null,-1)),Gt={class:"filters"},Qt=["label"],Ht={class:"form-label"},Kt={type:"filter"},Wt=["label","selected","onClick"],Xt={class:"buttons"},Ot=["onClick"],jt={key:0,class:"image-container",style:{"margin-bottom":"24px"}},Jt=["onClick"],Pt=["src"],Yt={class:"duration"},Zt={class:"table-responsive"},xt={key:0,class:"table"},es=["checked","indeterminate"],ts=_(()=>t("th",null,"ID",-1)),ss=_(()=>t("th",null,null,-1)),os=_(()=>t("th",null,null,-1)),ls=["onClick"],ns=["checked"],as=["src","onClick"],is={class:"nowrap"},ds={class:"action-btns"},cs=["onClick"],us=_(()=>t("md-ripple",null,null,-1)),_s=["onClick"],rs=_(()=>t("md-ripple",null,null,-1)),ps=["onClick"],ms=_(()=>t("md-ripple",null,null,-1)),hs={key:0},gs={colspan:"7"},vs={class:"no-data-placeholder"},fs={key:1,class:"no-data-placeholder"},A=50,ks=Qe({__name:"ImagesView",setup(D){var le,ne,ae;const he=He(),G=Ke(),m=C([]),Q=C(),{t:H}=We(),K=Xe(),{app:W,urlTokenKey:B}=Oe(K),h=je({text:"",tags:[]}),c=qe.IMAGE,F=Je().query,w=C(parseInt(((le=F.page)==null?void 0:le.toString())??"1")),b=C(Pe(((ne=F.q)==null?void 0:ne.toString())??"")),I=C(""),{tags:V}=zt(c,b,h,async e=>{I.value=Ye(e),await Ze(),we()}),i=C(((ae=F.view)==null?void 0:ae.toString())??"grid"),{addToTags:ge}=Rt(c,m,V),{deleteItems:ve,deleteItem:fe}=xe(),{allChecked:X,realAllChecked:z,selectRealAll:ke,allCheckedAlertVisible:be,clearSelection:R,toggleAllChecked:O,toggleItemChecked:j,total:y,checked:J}=Me(m),{downloadItems:ye}=et(B,c,m,R,"images.zip"),{downloadFile:$e}=rt(B),U=tt(()=>m.value.map(e=>({src:_e(e.fileId),name:L(e.path),duration:0,size:e.size,path:e.path,type:c,data:e})));function P(e){K.lightbox={sources:U.value,index:e,visible:!0}}function Ce(e){pt(mt,{type:c,tags:V.value,item:{key:e.id,title:e.title,size:e.size},selected:V.value.filter(l=>e.tags.some($=>$.id===l.id))})}const{loading:Y,load:we,refetch:q}=st({handle:async(e,l)=>{if(l)ot(H(l),"error");else if(e){const $=[];for(const T of e.images)$.push({...T,checked:!1,fileId:lt(B.value,T.path)});m.value=$,y.value=e.imageCount}},document:nt,variables:()=>({offset:(w.value-1)*A,limit:A,query:I.value}),appApi:!0});function Z(){re(G,`/images?page=${w.value}&q=${pe(b.value)}&view=${i.value}`)}ce(w,()=>{Z()}),ce(i,()=>{Z()});function Ie(e){h.tags.includes(e)?ht(h.tags,l=>l.id===e.id):h.tags.push(e)}function Te(){b.value=gt(h),x(),Q.value.dismiss()}function x(){re(G,`/images?q=${pe(b.value)}&view=${i.value}`)}function Se(){i.value==="grid"?i.value="list":i.value="grid"}function Ae(){he.push("/files"),vt(Tt,{message:H("upload_images")})}const ee=e=>{e.type===c&&(R(),q())},te=e=>{e.type===c&&q()},se=e=>{e.type===c&&(R(),q())},oe=()=>{y.value--};return at(()=>{f.on("item_tags_updated",te),f.on("items_tags_updated",ee),f.on("media_item_deleted",oe),f.on("media_items_deleted",se)}),it(()=>{f.off("item_tags_updated",te),f.off("items_tags_updated",ee),f.off("media_item_deleted",oe),f.off("media_items_deleted",se)}),(e,l)=>{const $=Vt,T=ft,ie=kt,de=bt,De=At,Ve=Dt,ze=St,Re=Ne,Ee=Le,Be=yt,Fe=$t,Ue=Ge,g=dt("tooltip");return n(),a(S,null,[t("div",Et,[d($,{current:()=>`${e.$t("page_title.images")} (${s(y)})`},null,8,["current"]),s(J)&&i.value==="list"?(n(),a(S,{key:0},[p((n(),a("button",{class:"icon-button",onClick:l[0]||(l[0]=u(o=>s(ve)(s(c),m.value,s(z),I.value),["stop"]))},[Bt,d(T)])),[[g,e.$t("delete")]]),p((n(),a("button",{class:"icon-button",onClick:l[1]||(l[1]=u(o=>s(ye)(s(z),I.value),["stop"]))},[Ft,d(ie)])),[[g,e.$t("download")]]),p((n(),a("button",{class:"icon-button",onClick:l[2]||(l[2]=u(o=>s(ge)(s(z),I.value),["stop"]))},[Ut,d(de)])),[[g,e.$t("add_to_tags")]])],64)):v("",!0),p((n(),a("button",{class:"icon-button",onClick:u(Se,["stop"])},[Mt,i.value==="list"?(n(),M(De,{key:0})):v("",!0),i.value==="grid"?(n(),M(Ve,{key:1})):v("",!0)],8,qt)),[[g,e.$t(i.value==="list"?"view_as_grid":"view_as_list")]]),p((n(),a("button",{class:"icon-button",onClick:u(Ae,["prevent"])},[Lt,d(ze)],8,Nt)),[[g,e.$t("upload")]]),d(Re,{ref_key:"searchInputRef",ref:Q,modelValue:b.value,"onUpdate:modelValue":l[4]||(l[4]=o=>b.value=o),search:x},{filters:ct(()=>[t("div",Gt,[p(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":l[3]||(l[3]=o=>h.text=o),"keyup.enter":"applyAndDoSearch"},null,8,Qt),[[ut,h.text]]),t("label",Ht,r(e.$t("tags")),1),t("md-chip-set",Kt,[(n(!0),a(S,null,N(s(V),o=>(n(),a("md-filter-chip",{key:o.id,label:o.name,selected:h.tags.includes(o),onClick:E=>Ie(o)},null,8,Wt))),128))]),t("div",Xt,[t("md-filled-button",{onClick:u(Te,["stop"])},r(e.$t("search")),9,Ot)])])]),_:1},8,["modelValue"])]),i.value==="grid"?(n(),a("div",jt,[(n(!0),a(S,null,N(U.value,(o,E)=>(n(),a("div",{class:"item",onClick:k=>P(E)},[t("img",{class:"image",src:o.src+"&w=300&h=300"},null,8,Pt),t("span",Yt,r(s(ue)(o.size)),1)],8,Jt))),256))])):v("",!0),d(Ee,{limit:A,total:s(y),"all-checked-alert-visible":s(be),"real-all-checked":s(z),"select-real-all":s(ke),"clear-selection":s(R)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",Zt,[i.value==="list"?(n(),a("table",xt,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[5]||(l[5]=(...o)=>s(O)&&s(O)(...o)),checked:s(X),indeterminate:!s(X)&&s(J)},null,40,es)]),ts,ss,t("th",null,r(e.$t("name")),1),os,t("th",null,r(e.$t("tags")),1),t("th",null,r(e.$t("file_size")),1)])]),t("tbody",null,[(n(!0),a(S,null,N(m.value,(o,E)=>(n(),a("tr",{key:o.id,class:_t({selected:o.checked}),onClick:u(k=>o.checked=!o.checked,["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[6]||(l[6]=(...k)=>s(j)&&s(j)(...k)),checked:o.checked},null,40,ns)]),t("td",null,[d(Be,{id:o.id,raw:o},null,8,["id","raw"])]),t("td",null,[t("img",{src:s(_e)(o.fileId)+"&w=300&h=300",width:"50",height:"50",onClick:u(k=>P(E),["stop"]),style:{cursor:"pointer"}},null,8,as)]),t("td",null,r(s(L)(o.path)),1),t("td",is,[t("div",ds,[p((n(),a("button",{class:"icon-button",onClick:u(k=>s(fe)(s(c),o),["stop"])},[us,d(T)],8,cs)),[[g,e.$t("delete")]]),p((n(),a("button",{class:"icon-button",onClick:u(k=>s($e)(o.path,s(L)(o.path).replace(" ","-")),["stop"])},[rs,d(ie)],8,_s)),[[g,e.$t("download")]]),p((n(),a("button",{class:"icon-button",onClick:u(k=>Ce(o),["stop"])},[ms,d(de)],8,ps)),[[g,e.$t("add_to_tags")]])])]),t("td",null,[d(Fe,{tags:o.tags,type:s(c)},null,8,["tags","type"])]),t("td",null,r(s(ue)(o.size)),1)],10,ls))),128))]),m.value.length?v("",!0):(n(),a("tfoot",hs,[t("tr",null,[t("td",gs,[t("div",vs,r(e.$t(s(me)(s(Y),s(W).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])):v("",!0)]),i.value==="grid"&&U.value.length===0?(n(),a("div",fs,r(e.$t(s(me)(s(Y),s(W).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):v("",!0),s(y)>A?(n(),M(Ue,{key:2,modelValue:w.value,"onUpdate:modelValue":l[7]||(l[7]=o=>w.value=o),total:s(y),limit:A},null,8,["modelValue","total"])):v("",!0)],64)}}});const Ds=It(ks,[["__scopeId","data-v-a42797ac"]]);export{Ds as default};

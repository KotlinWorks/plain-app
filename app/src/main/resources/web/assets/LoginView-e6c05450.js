import{d as z,r as y,u as J,a4 as G,c9 as Q,ca as X,cb as Y,cc as Z,cd as ee,ce as se,cf as ne,m as j,o as E,c as T,b as u,e as te,f as p,K as h,a6 as S,w as oe,g as w,O as re,L as ie,k as C,j as ae,F as ce,b7 as de,cg as le,ch as ue,_ as me}from"./index-9f7eccb0.js";import{u as fe,a as we}from"./vee-validate.esm-d2a0b94e.js";function N(s){let n=s;if(typeof n>"u"){if(typeof navigator>"u"||!navigator)return"";n=navigator.userAgent||""}return n.toLowerCase()}function R(s,n){try{return new RegExp(s,"g").exec(n)}catch{return null}}function M(){if(typeof navigator>"u"||!navigator||!navigator.userAgentData)return!1;const n=navigator.userAgentData.brands;return!!(n&&n.length)}function ve(s,n){const t=R(`(${s})((?:\\/|\\s|:)([0-9|\\.|_]+))`,n);return t?t[3]:""}function B(s){return s.replace(/_/g,".")}function V(s,n){let t=null,e="-1";return s.some(r=>{const c=R(`(${r.test})((?:\\/|\\s|:)([0-9|\\.|_]+))?`,n);return!c||r.brand?!1:(t=r,e=c[3]||"-1",r.versionAlias?e=r.versionAlias:r.versionTest&&(e=ve(r.versionTest.toLowerCase(),n)||e),e=B(e),!0)}),{preset:t,version:e}}function _(s,n){const t={brand:"",version:"-1"};return s.some(e=>{const r=O(n,e);return r?(t.brand=e.id,t.version=e.versionAlias||r.version,t.version!=="-1"):!1}),t}function O(s,n){return s.find(t=>R(`${n.test}`,t.brand.toLowerCase()))}const I=[{test:"phantomjs",id:"phantomjs"},{test:"whale",id:"whale"},{test:"edgios|edge|edg",id:"edge"},{test:"msie|trident|windows phone",id:"ie",versionTest:"iemobile|msie|rv"},{test:"miuibrowser",id:"miui browser"},{test:"samsungbrowser",id:"samsung internet"},{test:"samsung",id:"samsung internet",versionTest:"version"},{test:"chrome|crios",id:"chrome"},{test:"firefox|fxios",id:"firefox"},{test:"android",id:"android browser",versionTest:"version"},{test:"safari|iphone|ipad|ipod",id:"safari",versionTest:"version"}],W=[{test:"(?=.*applewebkit/(53[0-7]|5[0-2]|[0-4]))(?=.*\\schrome)",id:"chrome",versionTest:"chrome"},{test:"chromium",id:"chrome"},{test:"whale",id:"chrome",versionAlias:"-1",brand:!0}],P=[{test:"applewebkit",id:"webkit",versionTest:"applewebkit|safari"}],F=[{test:"(?=(iphone|ipad))(?!(.*version))",id:"webview"},{test:"(?=(android|iphone|ipad))(?=.*(naver|daum|; wv))",id:"webview"},{test:"webview",id:"webview"}],U=[{test:"windows phone",id:"windows phone"},{test:"windows 2000",id:"window",versionAlias:"5.0"},{test:"windows nt",id:"window"},{test:"win32|windows",id:"window"},{test:"iphone|ipad|ipod",id:"ios",versionTest:"iphone os|cpu os"},{test:"macos|macintel|mac os x",id:"mac"},{test:"android|linux armv81",id:"android"},{test:"tizen",id:"tizen"},{test:"webos|web0s",id:"webos"}];function D(s){return!!V(F,s).preset}function be(s){const n=N(s),t=!!/mobi/g.exec(n),e={name:"unknown",version:"-1",majorVersion:-1,webview:D(n),chromium:!1,chromiumVersion:"-1",webkit:!1,webkitVersion:"-1"},r={name:"unknown",version:"-1",majorVersion:-1},{preset:c,version:d}=V(I,n),{preset:o,version:a}=V(U,n),m=V(W,n);if(e.chromium=!!m.preset,e.chromiumVersion=m.version,!e.chromium){const v=V(P,n);e.webkit=!!v.preset,e.webkitVersion=v.version}return o&&(r.name=o.id,r.version=a,r.majorVersion=parseInt(a,10)),c&&(e.name=c.id,e.version=d,e.webview&&r.name==="ios"&&e.name!=="safari"&&(e.webview=!1)),e.majorVersion=parseInt(e.version,10),{browser:e,os:r,isMobile:t,isHints:!1}}function H(s){const n=navigator.userAgentData,t=[...n.brands],e=s&&s.fullVersionList,r=n.mobile||!1,c=t[0],d=(s&&s.platform||n.platform||navigator.platform).toLowerCase(),o={name:c.brand,version:c.version,majorVersion:-1,webkit:!1,webkitVersion:"-1",chromium:!1,chromiumVersion:"-1",webview:!!_(F,t).brand||D(N())},a={name:"unknown",version:"-1",majorVersion:-1};o.webkit=!o.chromium&&P.some(i=>O(t,i));const m=_(W,t);if(o.chromium=!!m.brand,o.chromiumVersion=m.version,!o.chromium){const i=_(P,t);o.webkit=!!i.brand,o.webkitVersion=i.version}const v=U.find(i=>new RegExp(`${i.test}`,"g").exec(d));if(a.name=v?v.id:"",s&&(a.version=s.platformVersion),e&&e.length){const i=_(I,e);o.name=i.brand||o.name,o.version=i.version||o.version}else{const i=_(I,t);o.name=i.brand||o.name,o.version=i.brand&&s?s.uaFullVersion:i.version}return o.webkit&&(a.name=r?"ios":"mac"),a.name==="ios"&&o.webview&&(o.version="-1"),a.version=B(a.version),o.version=B(o.version),a.majorVersion=parseInt(a.version,10),o.majorVersion=parseInt(o.version,10),{browser:o,os:a,isMobile:r,isHints:!0}}async function pe(){if(M()){const s=await navigator.userAgentData.getHighEntropyValues(["architecture","model","platform","platformVersion","uaFullVersion","fullVersionList"]);return H(s)}return ge()}function ge(s){return typeof s>"u"&&M()?H():be(s)}const he={class:"header"},_e={class:"logo"},Ve={class:"login-block"},ke=["placeholder"],ye={class:"d-grid mt-4"},Se=["disabled"],Ae={class:"d-grid mt-4"},Ee={key:0,class:"tips"},Te=z({__name:"LoginView",setup(s){const{handleSubmit:n,isSubmitting:t}=fe(),e=y(!1),r=y(!1),c=y("");let d;const o=window.location.protocol==="http:"?!1:!window.navigator.userAgentData,{t:a}=J(),{value:m,errorMessage:v}=we("password",G().required()),i=y(!1);async function K(){const b=await(await fetch(`${de()}/init`,{method:"POST",headers:le()})).text();b?(m.value=b,i.value=!1):i.value=!0}K();const $=n(async()=>{const f=localStorage.getItem("client_id");d=new WebSocket(`${Q()}?cid=${f}&auth=1`);const b=m.value??"",k=X(b),g=Y(k);c.value="",e.value=!1,d.onopen=async()=>{t.value=!0;const l=await pe(),A=Z(g,JSON.stringify({password:k,browserName:l.browser.name,browserVersion:l.browser.version,osName:l.os.name,osVersion:l.os.version,isMobile:l.isMobile}));d.send(ee(A))},d.onmessage=async l=>{var L;const A=se(g,ne(await l.data.arrayBuffer())),x=JSON.parse(A);x.status==="PENDING"?r.value=!0:(localStorage.setItem("auth_token",x.token),d.close(),j.push({path:((L=j.currentRoute.value.query.redirect)==null?void 0:L.toString())??"/",replace:!0}))},d.onclose=l=>{l.reason==="abort"||l.reason==="OK"||(t.value=!1,e.value=!0,r.value=!1,c.value=`login.${l.reason?l.reason:"failed"}`)},window.setTimeout(function(){d.readyState!==1&&d.close(3001,"timeout")},2e3)});function q(){r.value=!1,e.value=!1,t.value=!1,d.close(3001,"abort")}return(f,b)=>{const k=ue;return E(),T(ce,null,[u("div",he,[te(k,{"logged-in":!1})]),u("div",_e,[u("div",null,p(f.$t("app_name")),1)]),u("div",Ve,[h(u("form",{onSubmit:b[1]||(b[1]=oe((...g)=>w($)&&w($)(...g),["prevent"]))},[h(u("div",{class:"alert alert-danger",role:"alert"},p(c.value?f.$t(c.value):""),513),[[S,e.value]]),i.value?h((E(),T("input",{key:0,type:"password",class:"form-control","onUpdate:modelValue":b[0]||(b[0]=g=>re(m)?m.value=g:null),placeholder:w(a)("password")},null,8,ke)),[[ie,w(m)]]):C("",!0),h(u("div",{class:"invalid-feedback"},p(w(v)?f.$t(w(v)):""),513),[[S,w(v)]]),u("div",ye,[u("button",{class:"btn",type:"submit",disabled:w(t)},p(f.$t(w(t)?"logging_in":"log_in")),9,Se)])],544),[[S,!r.value]]),h(u("div",null,[ae(p(f.$t("login.to_continue"))+" ",1),u("div",Ae,[u("button",{onClick:q,class:"btn",type:"button"},p(f.$t("cancel")),1)])],512),[[S,r.value]])]),w(o)?(E(),T("div",Ee,p(f.$t("browser_warning")),1)):C("",!0)],64)}}});const Pe=me(Te,[["__scopeId","data-v-0d118d42"]]);export{Pe as default};

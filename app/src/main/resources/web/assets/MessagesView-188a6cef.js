import{D as ue,u as pe,_ as _e,a as me,b as he}from"./data-17e9864e.js";import{d as ge,a as fe,s as ve,c as ke,r as g,u as ye,B as be,p as $e,C as Te,D as Ce,E as Se,G as we,H as De,I as Ve,e as d,f as e,x as r,h as a,J as $,w as T,j as A,y as Ae,t as o,F as M,A as j,K as Me,L as qe,M as Re,k as Ie,N as Le,n as C,O as S,o as n,P as Be,z as Ue,Q as Qe,R as He,g as Ne,S as ze,T as Fe,U as Ee,V as xe,W as Ge,X as w,Y as Ke,Z as Pe,$ as je}from"./index-71d8bb76.js";import{_ as Je}from"./Breadcrumb-91ff4b3f.js";import{n as Oe}from"./list-6498ebd9.js";import{u as We,a as Xe}from"./tags-779e8f21.js";import"./vee-validate.esm-49ea0aba.js";const Ye={class:"v-toolbar"},Ze=e("md-ripple",null,null,-1),et={class:"filters"},tt=["label"],st={class:"form-label"},at={type:"filter"},lt=["label","selected","onClick"],ot={class:"buttons"},nt=["onClick"],dt={class:"table-responsive"},ct={class:"table"},it=["checked","indeterminate"],rt=e("th",null,"ID",-1),ut=e("th",null,null,-1),pt=["onClick"],_t=["checked"],mt=["innerHTML"],ht={class:"nowrap"},gt={class:"action-btns"},ft=["onClick"],vt=e("md-ripple",null,null,-1),kt={class:"nowrap"},yt={class:"nowrap"},bt={key:0},$t={colspan:"8"},Tt={class:"no-data-placeholder"},f=50,qt=ge({__name:"MessagesView",setup(Ct){var G,K;const v=fe(),{app:J}=ve(ke()),_=g([]),q=g(),{t:O}=ye(),c=be({text:"",tags:[]}),u=ue.SMS,R=$e(),I=R.query,k=g(parseInt(((G=I.page)==null?void 0:G.toString())??"1")),i=g(Te(((K=I.q)==null?void 0:K.toString())??"")),D=g(""),{tags:y}=We(u,i,c,async t=>{p&&t.push({name:"type",op:"",value:se[p].toString()}),D.value=qe(t),await Re(),te()}),{addToTags:W}=Xe(u,_,y),{allChecked:L,realAllChecked:B,selectRealAll:X,allCheckedAlertVisible:Y,clearSelection:U,toggleAllChecked:Q,toggleItemChecked:H,toggleRow:Z,total:m,checked:N}=pe(_),{loading:ee,load:te,refetch:z}=Ce({handle:(t,l)=>{l?Ie(O(l),"error"):t&&(_.value=t.messages.map(h=>({...h,checked:!1})),m.value=t.messageCount)},document:Le,variables:()=>({offset:(k.value-1)*f,limit:f,query:D.value}),appApi:!0}),p=R.params.type,se={inbox:1,sent:2,drafts:3,outbox:4};Se(k,t=>{p?C(v,`/messages/${p}?page=${t}&q=${S(i.value)}`):C(v,`/messages?page=${t}&q=${S(i.value)}`)});function ae(t){c.tags.includes(t)?Fe(c.tags,l=>l.id===t.id):c.tags.push(t)}function le(){i.value=Ee(c),F(),q.value.dismiss()}function oe(t){xe(Ge,{type:u,tags:y.value,item:{key:t.id,title:"",size:0},selected:y.value.filter(l=>t.tags.some(h=>h.id===l.id))})}function F(){p?C(v,`/messages/${p}?q=${S(i.value)}`):C(v,`/messages?q=${S(i.value)}`)}const E=t=>{t.type===u&&(U(),z())},x=t=>{t.type===u&&z()};return we(()=>{w.on("item_tags_updated",x),w.on("items_tags_updated",E)}),De(()=>{w.off("item_tags_updated",x),w.off("items_tags_updated",E)}),(t,l)=>{const h=Je,P=Ke,ne=_e,de=me,ce=Pe,ie=je,re=he,V=Ve("tooltip");return n(),d(M,null,[e("div",Ye,[r(h,{current:()=>`${t.$t("page_title.messages")} (${a(m)})`},null,8,["current"]),a(N)?$((n(),d("button",{key:0,class:"icon-button",onClick:l[0]||(l[0]=T(s=>a(W)(a(B),D.value),["stop"]))},[Ze,r(P)])),[[V,t.$t("add_to_tags")]]):A("",!0),r(ne,{ref_key:"searchInputRef",ref:q,modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=s=>i.value=s),search:F},{filters:Ae(()=>[e("div",et,[$(e("md-outlined-text-field",{label:t.$t("keywords"),"onUpdate:modelValue":l[1]||(l[1]=s=>c.text=s),"keyup.enter":"applyAndDoSearch"},null,8,tt),[[Be,c.text]]),e("label",st,o(t.$t("tags")),1),e("md-chip-set",at,[(n(!0),d(M,null,j(a(y),s=>(n(),d("md-filter-chip",{key:s.id,label:s.name,selected:c.tags.includes(s),onClick:b=>ae(s)},null,8,lt))),128))]),e("div",ot,[e("md-filled-button",{onClick:T(le,["stop"])},o(t.$t("search")),9,nt)])])]),_:1},8,["modelValue"])]),r(de,{limit:f,total:a(m),"all-checked-alert-visible":a(Y),"real-all-checked":a(B),"select-real-all":a(X),"clear-selection":a(U)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e("div",dt,[e("table",ct,[e("thead",null,[e("tr",null,[e("th",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:l[3]||(l[3]=(...s)=>a(Q)&&a(Q)(...s)),checked:a(L),indeterminate:!a(L)&&a(N)},null,40,it)]),rt,e("th",null,o(t.$t("content")),1),ut,e("th",null,o(t.$t("sms_address")),1),e("th",null,o(t.$t("type")),1),e("th",null,o(t.$t("tags")),1),e("th",null,o(t.$t("time")),1)])]),e("tbody",null,[(n(!0),d(M,null,j(_.value,s=>(n(),d("tr",{key:s.id,class:Ue({selected:s.checked}),onClick:T(b=>a(Z)(s),["stop"])},[e("td",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:l[4]||(l[4]=(...b)=>a(H)&&a(H)(...b)),checked:s.checked},null,40,_t)]),e("td",null,[r(ce,{id:s.id,raw:s},null,8,["id","raw"])]),e("td",{innerHTML:a(Qe)(s.body)},null,8,mt),e("td",ht,[e("div",gt,[$((n(),d("button",{class:"icon-button",onClick:T(b=>oe(s),["stop"])},[vt,r(P)],8,ft)),[[V,t.$t("add_to_tags")]])])]),e("td",null,o(s.address),1),e("td",kt,o(t.$t(`message_type.${s.type}`)),1),e("td",null,[r(ie,{tags:s.tags,type:a(u)},null,8,["tags","type"])]),e("td",yt,[$((n(),d("span",null,[Ne(o(a(ze)(s.date)),1)])),[[V,a(He)(s.date)]])])],10,pt))),128))]),_.value.length?A("",!0):(n(),d("tfoot",bt,[e("tr",null,[e("td",$t,[e("div",Tt,o(t.$t(a(Oe)(a(ee),a(J).permissions,"READ_SMS"))),1)])])]))])]),a(m)>f?(n(),Me(re,{key:0,modelValue:k.value,"onUpdate:modelValue":l[5]||(l[5]=s=>k.value=s),total:a(m),limit:f},null,8,["modelValue","total"])):A("",!0)],64)}}});export{qt as default};

import{D as re,u as ue,_ as pe,a as _e,b as me}from"./list-052a81ba.js";import{d as he,a as ge,s as fe,c as ke,r as g,u as ve,B as ye,p as be,C as $e,D as Te,E as Ce,G as Se,t as we,H as De,I as Ve,J as Ae,K as Me,L as qe,o as n,e as d,f as e,x as r,k as a,M as $,w as T,m as A,y as Ie,N as Le,j as o,F as M,A as j,z as Re,O as Be,P as Ue,g as Qe,Q as He,R as Ne,n as C,S,T as ze,U as Fe,V as Ee,W as xe,X as Ge,Y as Ke,Z as Pe,$ as w}from"./index-5e3ce573.js";import{_ as je}from"./Breadcrumb-db3f2c63.js";import{n as Je}from"./list-6498ebd9.js";import{u as Oe,a as We}from"./tags-25ba5c36.js";import"./vee-validate.esm-e8a787ff.js";const Xe={class:"v-toolbar"},Ye=e("md-ripple",null,null,-1),Ze={class:"filters"},et=["label"],tt={class:"form-label"},st={type:"filter"},at=["label","selected","onClick"],lt={class:"buttons"},ot=["onClick"],nt={class:"table-responsive"},dt={class:"table"},ct=["checked","indeterminate"],it=e("th",null,"ID",-1),rt=e("th",null,null,-1),ut=["onClick"],pt=["checked"],_t=["innerHTML"],mt={class:"nowrap"},ht={class:"action-btns"},gt=["onClick"],ft=e("md-ripple",null,null,-1),kt={class:"nowrap"},vt={class:"nowrap"},yt={key:0},bt={colspan:"8"},$t={class:"no-data-placeholder"},f=50,Mt=he({__name:"MessagesView",setup(Tt){var G,K;const k=ge(),{app:J}=fe(ke()),_=g([]),q=g(),{t:O}=ve(),c=ye({text:"",tags:[]}),u=re.SMS,I=be(),L=I.query,v=g(parseInt(((G=L.page)==null?void 0:G.toString())??"1")),i=g($e(((K=L.q)==null?void 0:K.toString())??"")),D=g(""),{tags:y}=Oe(u,i,c,async t=>{p&&t.push({name:"type",op:"",value:te[p].toString()}),D.value=Te(t),await Ce(),ee()}),{addToTags:W}=We(u,_,y),{allChecked:R,realAllChecked:B,selectRealAll:X,allCheckedAlertVisible:Y,clearSelection:U,toggleAllChecked:Q,toggleItemChecked:H,total:m,checked:N}=ue(_),{loading:Z,load:ee,refetch:z}=Se({handle:(t,l)=>{l?we(O(l),"error"):t&&(_.value=t.messages.map(h=>({...h,checked:!1})),m.value=t.messageCount)},document:De,variables:()=>({offset:(v.value-1)*f,limit:f,query:D.value}),appApi:!0}),p=I.params.type,te={inbox:1,sent:2,drafts:3,outbox:4};Ve(v,t=>{p?C(k,`/messages/${p}?page=${t}&q=${S(i.value)}`):C(k,`/messages?page=${t}&q=${S(i.value)}`)});function se(t){c.tags.includes(t)?ze(c.tags,l=>l.id===t.id):c.tags.push(t)}function ae(){i.value=Fe(c),F(),q.value.dismiss()}function le(t){Ee(xe,{type:u,tags:y.value,item:{key:t.id,title:"",size:0},selected:y.value.filter(l=>t.tags.some(h=>h.id===l.id))})}function F(){p?C(k,`/messages/${p}?q=${S(i.value)}`):C(k,`/messages?q=${S(i.value)}`)}const E=t=>{t.type===u&&(U(),z())},x=t=>{t.type===u&&z()};return Ae(()=>{w.on("item_tags_updated",x),w.on("items_tags_updated",E)}),Me(()=>{w.off("item_tags_updated",x),w.off("items_tags_updated",E)}),(t,l)=>{const h=je,P=Ge,oe=pe,ne=_e,de=Ke,ce=Pe,ie=me,V=qe("tooltip");return n(),d(M,null,[e("div",Xe,[r(h,{current:()=>`${t.$t("page_title.messages")} (${a(m)})`},null,8,["current"]),a(N)?$((n(),d("button",{key:0,class:"icon-button",onClick:l[0]||(l[0]=T(s=>a(W)(a(B),D.value),["stop"]))},[Ye,r(P)])),[[V,t.$t("add_to_tags")]]):A("",!0),r(oe,{ref_key:"searchInputRef",ref:q,modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=s=>i.value=s),search:F},{filters:Ie(()=>[e("div",Ze,[$(e("md-outlined-text-field",{label:t.$t("keywords"),"onUpdate:modelValue":l[1]||(l[1]=s=>c.text=s),"keyup.enter":"applyAndDoSearch"},null,8,et),[[Le,c.text]]),e("label",tt,o(t.$t("tags")),1),e("md-chip-set",st,[(n(!0),d(M,null,j(a(y),s=>(n(),d("md-filter-chip",{key:s.id,label:s.name,selected:c.tags.includes(s),onClick:b=>se(s)},null,8,at))),128))]),e("div",lt,[e("md-filled-button",{onClick:T(ae,["stop"])},o(t.$t("search")),9,ot)])])]),_:1},8,["modelValue"])]),r(ne,{limit:f,total:a(m),"all-checked-alert-visible":a(Y),"real-all-checked":a(B),"select-real-all":a(X),"clear-selection":a(U)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e("div",nt,[e("table",dt,[e("thead",null,[e("tr",null,[e("th",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:l[3]||(l[3]=(...s)=>a(Q)&&a(Q)(...s)),checked:a(R),indeterminate:!a(R)&&a(N)},null,40,ct)]),it,e("th",null,o(t.$t("content")),1),rt,e("th",null,o(t.$t("sms_address")),1),e("th",null,o(t.$t("type")),1),e("th",null,o(t.$t("tags")),1),e("th",null,o(t.$t("time")),1)])]),e("tbody",null,[(n(!0),d(M,null,j(_.value,s=>(n(),d("tr",{key:s.id,class:Re({selected:s.checked}),onClick:T(b=>s.checked=!s.checked,["stop"])},[e("td",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:l[4]||(l[4]=(...b)=>a(H)&&a(H)(...b)),checked:s.checked},null,40,pt)]),e("td",null,[r(de,{id:s.id,raw:s},null,8,["id","raw"])]),e("td",{innerHTML:a(Be)(s.body)},null,8,_t),e("td",mt,[e("div",ht,[$((n(),d("button",{class:"icon-button",onClick:T(b=>le(s),["stop"])},[ft,r(P)],8,gt)),[[V,t.$t("add_to_tags")]])])]),e("td",null,o(s.address),1),e("td",kt,o(t.$t(`message_type.${s.type}`)),1),e("td",null,[r(ce,{tags:s.tags,type:a(u)},null,8,["tags","type"])]),e("td",vt,[$((n(),d("span",null,[Qe(o(a(He)(s.date)),1)])),[[V,a(Ue)(s.date)]])])],10,ut))),128))]),_.value.length?A("",!0):(n(),d("tfoot",yt,[e("tr",null,[e("td",bt,[e("div",$t,o(t.$t(a(Je)(a(Z),a(J).permissions,"READ_SMS"))),1)])])]))])]),a(m)>f?(n(),Ne(ie,{key:0,modelValue:v.value,"onUpdate:modelValue":l[5]||(l[5]=s=>v.value=s),total:a(m),limit:f},null,8,["modelValue","total"])):A("",!0)],64)}}});export{Mt as default};

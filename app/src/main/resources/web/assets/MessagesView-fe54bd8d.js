import{u as ee,_ as te,a as se}from"./list-99d4982b.js";import{_ as oe}from"./FieldId-e37ba71f.js";import{_ as ae}from"./Multiselect-346d4eab.js";import{_ as ne,a as le}from"./label-outline-rounded-657ec04e.js";import{_ as ue}from"./Breadcrumb-731a6814.js";import{d as ce,p as ie,s as re,a as de,r as _,u as pe,B as _e,n as me,C as ge,D as he,E as fe,G as be,H as ye,t as ve,I as ke,J as $e,K as Ve,L as Se,o as u,c as i,b as e,e as p,g as a,F as v,w as k,k as C,x as Te,f as n,M as q,N as we,O as Ce,P as L,Q as qe,z as N,y as De,R as Me,S as Ue,T as Be,A as $,U as V,V as Ae}from"./index-66bea2e9.js";import{n as Fe}from"./list-6498ebd9.js";import{u as Qe,a as Re,b as Ke}from"./tags-4fd68896.js";import"./VModal.vuevuetypescriptsetuptruelang-091ab08d.js";import"./vee-validate.esm-18b68f3d.js";const Ie={class:"v-toolbar"},Le={class:"right-actions"},Ne=["title"],ze=["title"],Ee={class:"row mb-3"},xe={class:"col-md-3 col-form-label"},Ge={class:"col-md-9"},Pe=["onKeyup"],He={class:"row mb-3"},Je={class:"col-md-3 col-form-label"},Oe={class:"col-md-9"},je={class:"actions"},We=["onClick"],Xe={class:"table"},Ye=e("th",null,"ID",-1),Ze=["onClick"],et=["onUpdate:modelValue"],tt={class:"nowrap"},st={class:"badge"},ot=["title"],at={key:0},nt={colspan:"7"},lt={class:"no-data-placeholder"},bt=ce({__name:"MessagesView",setup(ut){var K,I;const m=ie(),{app:z}=re(de()),c=_([]),{t:E}=pe(),r=_e({text:"",tags:[]}),g="SMS",D=me(),M=D.query,h=_(parseInt(((K=M.page)==null?void 0:K.toString())??"1")),f=50,b=_(0),l=_(ge(((I=M.q)==null?void 0:I.toString())??"")),U=_(""),{tags:S}=Qe(g,l,r,async s=>{d&&s.push({name:"type",op:"",value:J[d].toString()}),U.value=he(s),await fe(),P()}),{addToTags:B}=Re(g,c,S),{removeFromTags:A}=Ke(g,c,S),x=be(()=>c.value.some(s=>s.checked)),{selectAll:T,toggleSelect:F}=ee(c),{loading:G,load:P,refetch:H}=ye({handle:(s,o)=>{o?ve(E(o),"error"):s&&(c.value=s.messages.map(w=>({...w,checked:!1})),b.value=s.messageCount)},document:ke,variables:()=>({offset:(h.value-1)*f,limit:f,query:U.value}),appApi:!0}),d=D.params.type,J={inbox:1,sent:2,drafts:3,outbox:4};$e(h,s=>{d?$(m,`/messages/${d}?page=${s}&q=${V(l.value)}`):$(m,`/messages?page=${s}&q=${V(l.value)}`)});function Q(){l.value=Ae(r),R()}function R(){d?$(m,`/messages/${d}?q=${V(l.value)}`):$(m,`/messages?q=${V(l.value)}`)}return Ve(()=>{Se.on("refetch_by_tag_type",s=>{s===g&&H()})}),(s,o)=>{const w=ue,O=ne,j=le,W=ae,X=te,Y=oe,Z=se;return u(),i(v,null,[e("div",Ie,[p(w,{current:()=>`${s.$t("page_title.messages")} (${b.value})`},null,8,["current"]),e("div",Le,[a(x)?(u(),i(v,{key:0},[e("button",{type:"button",class:"btn btn-action",onClick:o[0]||(o[0]=k((...t)=>a(B)&&a(B)(...t),["stop"])),title:s.$t("add_to_tags")},[p(O,{class:"bi"})],8,Ne),e("button",{type:"button",class:"btn btn-action",onClick:o[1]||(o[1]=k((...t)=>a(A)&&a(A)(...t),["stop"])),title:s.$t("remove_from_tags")},[p(j,{class:"bi"})],8,ze)],64)):C("",!0),p(X,{modelValue:l.value,"onUpdate:modelValue":o[4]||(o[4]=t=>l.value=t),search:R},{filters:Te(()=>[e("div",Ee,[e("label",xe,n(s.$t("keywords")),1),e("div",Ge,[q(e("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=t=>r.text=t),class:"form-control",onKeyup:Ce(Q,["enter"])},null,40,Pe),[[we,r.text]])])]),e("div",He,[e("label",Je,n(s.$t("tags")),1),e("div",Oe,[p(W,{modelValue:r.tags,"onUpdate:modelValue":o[3]||(o[3]=t=>r.tags=t),label:"name","track-by":"id",options:a(S)},null,8,["modelValue","options"])])]),e("div",je,[e("button",{type:"button",class:"btn",onClick:k(Q,["stop"])},n(s.$t("search")),9,We)])]),_:1},8,["modelValue"])])]),e("table",Xe,[e("thead",null,[e("tr",null,[e("th",null,[q(e("input",{class:"form-check-input",type:"checkbox",onChange:o[5]||(o[5]=(...t)=>a(F)&&a(F)(...t)),"onUpdate:modelValue":o[6]||(o[6]=t=>qe(T)?T.value=t:null)},null,544),[[L,a(T)]])]),Ye,e("th",null,n(s.$t("content")),1),e("th",null,n(s.$t("sms_address")),1),e("th",null,n(s.$t("type")),1),e("th",null,n(s.$t("tags")),1),e("th",null,n(s.$t("time")),1)])]),e("tbody",null,[(u(!0),i(v,null,N(c.value,t=>(u(),i("tr",{key:t.id,class:De({checked:t.checked}),onClick:k(y=>t.checked=!t.checked,["stop"])},[e("td",null,[q(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":y=>t.checked=y},null,8,et),[[L,t.checked]])]),e("td",null,[p(Y,{id:t.id,raw:t},null,8,["id","raw"])]),e("td",null,n(t.body),1),e("td",null,n(t.address),1),e("td",tt,n(s.$t(`message_type.${t.type}`)),1),e("td",null,[(u(!0),i(v,null,N(t.tags,y=>(u(),i("span",st,n(y.name),1))),256))]),e("td",{title:a(Me)(t.date),class:"nowrap"},n(a(Ue)(t.date)),9,ot)],10,Ze))),128))]),c.value.length?C("",!0):(u(),i("tfoot",at,[e("tr",null,[e("td",nt,[e("div",lt,n(s.$t(a(Fe)(a(G),a(z).permissions,"READ_SMS"))),1)])])]))]),b.value>f?(u(),Be(Z,{key:0,modelValue:h.value,"onUpdate:modelValue":o[7]||(o[7]=t=>h.value=t),total:b.value,limit:f},null,8,["modelValue","total"])):C("",!0)],64)}}});export{bt as default};

import{_ as P}from"./MonacoEditor.vuevuetypescriptsetuptruelang-a762fc4a.js";import{aJ as X,aK as W,aL as z,d as Y,p as Z,u as q,n as ee,r as b,s as te,a as ne,aA as ae,i as F,t as Q,aM as ie,aN as se,a3 as oe,aO as re,aP as ue,K as le,L as G,M as ce,N as de,o as x,c as C,e as D,x as T,y as L,f as me,g as H,j as M,T as fe,l as K,F as _e,A as pe,O as ve,w as ge,J as he,S as ye,X as Te,Y as ke,$ as be,Z as xe,_ as Me}from"./index-df35a132.js";import{_ as Ne}from"./Breadcrumb-120bdd32.js";import{g as U,M as we}from"./splitpanes.es-c959884b.js";import{u as Ee}from"./markdown-cf6b239f.js";import{t as Ce}from"./truncate-cc7a2700.js";import"./stringToArray-a8dcbce9.js";var Le=function(){return X.Date.now()};const R=Le;var Ae="Expected a function",Ve=Math.max,Ie=Math.min;function Se(A,l,o){var m,u,a,s,i,c,_=0,N=!1,f=!1,h=!0;if(typeof A!="function")throw new TypeError(Ae);l=W(l)||0,z(o)&&(N=!!o.leading,f="maxWait"in o,a=f?Ve(W(o.maxWait)||0,l):a,h="trailing"in o?!!o.trailing:h);function d(t){var e=m,n=u;return m=u=void 0,_=t,s=A.apply(n,e),s}function V(t){return _=t,i=setTimeout(p,l),N?d(t):s}function w(t){var e=t-c,n=t-_,r=l-e;return f?Ie(r,a-n):r}function y(t){var e=t-c,n=t-_;return c===void 0||e>=l||e<0||f&&n>=a}function p(){var t=R();if(y(t))return E(t);i=setTimeout(p,w(t))}function E(t){return i=void 0,h&&m?d(t):(m=u=void 0,s)}function I(){i!==void 0&&clearTimeout(i),_=0,m=c=u=i=void 0}function S(){return i===void 0?s:E(R())}function k(){var t=R(),e=y(t);if(m=arguments,u=this,c=t,e){if(i===void 0)return V(c);if(f)return clearTimeout(i),i=setTimeout(p,l),d(c)}return i===void 0&&(i=setTimeout(p,l)),s}return k.cancel=I,k.flush=S,k}const $e={class:"page-container"},De={class:"main"},Re={class:"v-toolbar"},Be=["onClick"],Oe=["innerHTML"],B="NOTE",We=Y({__name:"NoteEditView",setup(A){const l=Z(),{t:o}=q(),m=ee(),u=b(m.params.id),a=b(),s=b(""),i=b(""),{app:c,fileIdKey:_}=te(ne()),N=ae(()=>{var e;return(e=a.value)!=null&&e.deletedAt?["/notes","/notes/trash"]:["/notes"]}),{render:f}=Ee(c,_);let h=!1;function d(){return u.value==="create"}const V=Se(()=>{E({id:d()?"":u.value,input:{content:s.value,title:Ce(s.value,{length:100,omission:""})}})},500),w=()=>{he(s,async e=>{i.value=await f(e),V()})},y=b();F({handle:(e,n)=>{n?Q(o(n),"error"):e&&(y.value=e.tags)},document:ie,variables:{type:B},appApi:!0});let p=()=>{};if(d())w();else{const{refetch:e}=F({handle:async(n,r)=>{if(r)Q(o(r),"error");else{if(a.value=n.note,h)return;s.value=n.note.content,i.value=await f(s.value),h=!0,w()}},document:se,variables:()=>({id:u.value}),appApi:!0});p=e}const{mutate:E,onDone:I}=oe({document:re,appApi:!0});I(e=>{var r,v;a.value=e.data.saveNote,d()&&((r=a.value)!=null&&r.id)&&(u.value=(v=a.value)==null?void 0:v.id,ue(l,`/notes/${u.value}`))});function S(){var n;const e=(n=a==null?void 0:a.value)==null?void 0:n.updatedAt;return e?`(${o("updated_at")}: ${ye(e)})`:""}function k(){var e,n;Te(ke,{tagType:B,tags:y.value,item:{key:(e=a.value)==null?void 0:e.id,title:"",size:0},selected:(n=y.value)==null?void 0:n.filter(r=>{var v;return(v=a.value)==null?void 0:v.tags.some($=>$.id===r.id)})})}const t=e=>{e===B&&p()};return le(()=>{G.on("refetch_by_tag_type",t)}),ce(()=>{G.off("refetch_by_tag_type",t)}),(e,n)=>{var O;const r=be,v=Ne,$=xe,j=P,J=de("tooltip");return x(),C("div",$e,[D("div",De,[D("div",Re,[T(v,{paths:N.value},{current:L(()=>{var g;return[me(H(d()?M(o)("create"):M(o)("edit"))+" ",1),(g=a.value)!=null&&g.updatedAt?(x(),fe(r,{key:0,class:"time",id:S(),raw:a.value},null,8,["id","raw"])):K("",!0)]}),_:1},8,["paths"]),(x(!0),C(_e,null,pe((O=a.value)==null?void 0:O.tags,g=>(x(),C("span",{key:g.id,class:"badge"},H(g.name),1))),128)),d()?K("",!0):ve((x(),C("md-icon-button",{key:0,onClick:ge(k,["prevent"]),style:{"margin-inline-start":"8px"}},[T($)],8,Be)),[[J,e.$t("add_to_tags")]])]),T(M(we),{class:"panel-container"},{default:L(()=>[T(M(U),null,{default:L(()=>[T(j,{language:"html",modelValue:s.value,"onUpdate:modelValue":n[0]||(n[0]=g=>s.value=g)},null,8,["modelValue"])]),_:1}),T(M(U),null,{default:L(()=>[D("div",{class:"md-container",innerHTML:i.value},null,8,Oe)]),_:1})]),_:1})])])}}});const Je=Me(We,[["__scopeId","data-v-82d87724"]]);export{Je as default};

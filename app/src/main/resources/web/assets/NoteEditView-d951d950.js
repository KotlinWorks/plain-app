import{_ as X}from"./MonacoEditor.vuevuetypescriptsetuptruelang-f46da3d6.js";import{aK as J,aL as H,aM as Y,d as q,a as Z,u as ee,p as te,r as w,s as ae,c as ne,az as se,i as O,t as U,aN as ie,aO as oe,a2 as re,aP as ue,aQ as le,J as de,K as ce,L as me,o as M,e as L,f as $,x as b,y as S,g as _e,j as G,k as N,R as fe,m as K,F as pe,A as ve,M as ge,w as he,I as Te,Q as ye,V as ke,W as be,Y as xe,X as we,au as Me,av as Ne,$ as V,_ as Ee}from"./index-2c8e7849.js";import{_ as Ce}from"./Breadcrumb-01ba2071.js";import{g as j,M as Ie}from"./splitpanes.es-c9c152ea.js";import{u as Le}from"./markdown-9d7c41d2.js";import{t as Se}from"./truncate-74788062.js";import"./stringToArray-36968540.js";var Ve=function(){return J.Date.now()};const B=Ve;var Ae="Expected a function",$e=Math.max,De=Math.min;function Re(v,l,o){var _,r,a,i,s,d,g=0,E=!1,f=!1,y=!0;if(typeof v!="function")throw new TypeError(Ae);l=H(l)||0,Y(o)&&(E=!!o.leading,f="maxWait"in o,a=f?$e(H(o.maxWait)||0,l):a,y="trailing"in o?!!o.trailing:y);function c(t){var u=_,e=r;return _=r=void 0,g=t,i=v.apply(e,u),i}function D(t){return g=t,s=setTimeout(p,l),E?c(t):i}function C(t){var u=t-d,e=t-g,n=l-u;return f?De(n,a-e):n}function k(t){var u=t-d,e=t-g;return d===void 0||u>=l||u<0||f&&e>=a}function p(){var t=B();if(k(t))return I(t);s=setTimeout(p,C(t))}function I(t){return s=void 0,y&&_?c(t):(_=r=void 0,i)}function R(){s!==void 0&&clearTimeout(s),g=0,_=d=r=s=void 0}function Q(){return s===void 0?i:I(B())}function x(){var t=B(),u=k(t);if(_=arguments,r=this,d=t,u){if(s===void 0)return D(d);if(f)return clearTimeout(s),s=setTimeout(p,l),c(d)}return s===void 0&&(s=setTimeout(p,l)),i}return x.cancel=R,x.flush=Q,x}const Qe=v=>(Me("data-v-f6d301b6"),v=v(),Ne(),v),We={class:"page-container"},Be={class:"main"},Fe={class:"v-toolbar"},He=["onClick"],Oe=Qe(()=>$("md-ripple",null,null,-1)),Ue=["innerHTML"],A="NOTE",Ge=q({__name:"NoteEditView",setup(v){const l=Z(),{t:o}=ee(),_=te(),r=w(_.params.id),a=w(),i=w(""),s=w(""),{app:d,urlTokenKey:g}=ae(ne()),E=se(()=>{var e;return(e=a.value)!=null&&e.deletedAt?["/notes","/notes/trash"]:["/notes"]}),{render:f}=Le(d,g);let y=!1;function c(){return r.value==="create"}const D=Re(()=>{I({id:c()?"":r.value,input:{content:i.value,title:Se(i.value,{length:100,omission:""})}})},500),C=()=>{Te(i,async e=>{s.value=await f(e),D()})},k=w();O({handle:(e,n)=>{n?U(o(n),"error"):e&&(k.value=e.tags)},document:ie,variables:{type:A},appApi:!0});let p=()=>{};if(c())C();else{const{refetch:e}=O({handle:async(n,m)=>{if(m)U(o(m),"error");else{if(a.value=n.note,y)return;i.value=n.note.content,s.value=await f(i.value),y=!0,C()}},document:oe,variables:()=>({id:r.value}),appApi:!0});p=e}const{mutate:I,onDone:R}=re({document:ue,appApi:!0});R(e=>{var m,h;a.value=e.data.saveNote,c()&&((m=a.value)!=null&&m.id)&&(r.value=(h=a.value)==null?void 0:h.id,le(l,`/notes/${r.value}`))});function Q(){var n;const e=(n=a==null?void 0:a.value)==null?void 0:n.updatedAt;return e?`(${o("updated_at")}: ${ye(e)})`:""}function x(){var e,n;ke(be,{type:A,tags:k.value,item:{key:(e=a.value)==null?void 0:e.id,title:"",size:0},selected:(n=k.value)==null?void 0:n.filter(m=>{var h;return(h=a.value)==null?void 0:h.tags.some(W=>W.id===m.id)})})}const t=e=>{e.type===A&&p()},u=e=>{e.type===A&&p()};return de(()=>{V.on("item_tags_updated",u),V.on("items_tags_updated",t)}),ce(()=>{V.off("item_tags_updated",u),V.off("items_tags_updated",t)}),(e,n)=>{var F;const m=xe,h=Ce,W=we,z=X,P=me("tooltip");return M(),L("div",We,[$("div",Be,[$("div",Fe,[b(h,{paths:E.value},{current:S(()=>{var T;return[_e(G(c()?N(o)("create"):N(o)("edit"))+" ",1),(T=a.value)!=null&&T.updatedAt?(M(),fe(m,{key:0,class:"time",id:Q(),raw:a.value},null,8,["id","raw"])):K("",!0)]}),_:1},8,["paths"]),(M(!0),L(pe,null,ve((F=a.value)==null?void 0:F.tags,T=>(M(),L("span",{key:T.id,class:"badge"},G(T.name),1))),128)),c()?K("",!0):ge((M(),L("button",{key:0,class:"icon-button",onClick:he(x,["prevent"]),style:{"margin-inline-start":"8px"}},[Oe,b(W)],8,He)),[[P,e.$t("add_to_tags")]])]),b(N(Ie),{class:"panel-container"},{default:S(()=>[b(N(j),null,{default:S(()=>[b(z,{language:"html",modelValue:i.value,"onUpdate:modelValue":n[0]||(n[0]=T=>i.value=T)},null,8,["modelValue"])]),_:1}),b(N(j),null,{default:S(()=>[$("div",{class:"md-container",innerHTML:s.value},null,8,Ue)]),_:1})]),_:1})])])}}});const qe=Ee(Ge,[["__scopeId","data-v-f6d301b6"]]);export{qe as default};

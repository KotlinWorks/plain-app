import{_ as X}from"./MonacoEditor.vuevuetypescriptsetuptruelang-43649ee4.js";import{aL as J,aM as F,aN as Y,d as Z,a as q,u as ee,p as te,r as w,s as ae,c as ne,az as se,i as G,a0 as ie,aO as oe,G as re,H as ue,I as le,e as S,f as D,x as b,y as L,F as de,A as ce,J as me,w as fe,j as O,h as E,E as _e,k as U,aP as pe,aQ as ve,aR as ge,o as N,g as he,t as j,K as Te,at as ye,au as ke,S as be,V as xe,W as we,X as V,Z as Ee,Y as Ne,_ as Me}from"./index-71d8bb76.js";import{_ as Ce}from"./Breadcrumb-91ff4b3f.js";import{g as z,M as Ie}from"./splitpanes.es-85db08aa.js";import{u as Se}from"./markdown-3cbce55d.js";import{t as Le}from"./truncate-66113621.js";import"./stringToArray-4eaf66ad.js";var Ve=function(){return J.Date.now()};const Q=Ve;var Ae="Expected a function",De=Math.max,$e=Math.min;function Re(v,l,o){var f,r,a,i,s,d,g=0,M=!1,_=!1,y=!0;if(typeof v!="function")throw new TypeError(Ae);l=F(l)||0,Y(o)&&(M=!!o.leading,_="maxWait"in o,a=_?De(F(o.maxWait)||0,l):a,y="trailing"in o?!!o.trailing:y);function c(t){var u=f,e=r;return f=r=void 0,g=t,i=v.apply(e,u),i}function $(t){return g=t,s=setTimeout(p,l),M?c(t):i}function C(t){var u=t-d,e=t-g,n=l-u;return _?$e(n,a-e):n}function k(t){var u=t-d,e=t-g;return d===void 0||u>=l||u<0||_&&e>=a}function p(){var t=Q();if(k(t))return I(t);s=setTimeout(p,C(t))}function I(t){return s=void 0,y&&f?c(t):(f=r=void 0,i)}function R(){s!==void 0&&clearTimeout(s),g=0,f=d=r=s=void 0}function W(){return s===void 0?i:I(Q())}function x(){var t=Q(),u=k(t);if(f=arguments,r=this,d=t,u){if(s===void 0)return $(d);if(_)return clearTimeout(s),s=setTimeout(p,l),c(d)}return s===void 0&&(s=setTimeout(p,l)),i}return x.cancel=R,x.flush=W,x}const We=v=>(ye("data-v-f6d301b6"),v=v(),ke(),v),He={class:"page-container"},Qe={class:"main"},Be={class:"v-toolbar"},Fe=["onClick"],Ge=We(()=>D("md-ripple",null,null,-1)),Oe=["innerHTML"],A="NOTE",Ue=Z({__name:"NoteEditView",setup(v){const l=q(),{t:o}=ee(),f=te(),r=w(f.params.id),a=w(),i=w(""),s=w(""),{app:d,urlTokenKey:g}=ae(ne()),M=se(()=>{var e;return(e=a.value)!=null&&e.deletedAt?["/notes","/notes/trash"]:["/notes"]}),{render:_}=Se(d,g);let y=!1;function c(){return r.value==="create"}const $=Re(()=>{I({id:c()?"":r.value,input:{content:i.value,title:Le(i.value,{length:100,omission:""})}})},500),C=()=>{_e(i,async e=>{s.value=await _(e),$()})},k=w();G({handle:(e,n)=>{n?U(o(n),"error"):e&&(k.value=e.tags)},document:pe,variables:{type:A},appApi:!0});let p=()=>{};if(c())C();else{const{refetch:e}=G({handle:async(n,m)=>{if(m)U(o(m),"error");else{if(a.value=n.note,y)return;i.value=n.note.content,s.value=await _(i.value),y=!0,C()}},document:ve,variables:()=>({id:r.value}),appApi:!0});p=e}const{mutate:I,onDone:R}=ie({document:ge,appApi:!0});R(e=>{var m,h;a.value=e.data.saveNote,c()&&((m=a.value)!=null&&m.id)&&(r.value=(h=a.value)==null?void 0:h.id,oe(l,`/notes/${r.value}`))});function W(){var n;const e=(n=a==null?void 0:a.value)==null?void 0:n.updatedAt;return e?`(${o("updated_at")}: ${be(e)})`:""}function x(){var e,n;xe(we,{type:A,tags:k.value,item:{key:(e=a.value)==null?void 0:e.id,title:"",size:0},selected:(n=k.value)==null?void 0:n.filter(m=>{var h;return(h=a.value)==null?void 0:h.tags.some(H=>H.id===m.id)})})}const t=e=>{e.type===A&&p()},u=e=>{e.type===A&&p()};return re(()=>{V.on("item_tags_updated",u),V.on("items_tags_updated",t)}),ue(()=>{V.off("item_tags_updated",u),V.off("items_tags_updated",t)}),(e,n)=>{var B;const m=Ee,h=Ce,H=Ne,K=X,P=le("tooltip");return N(),S("div",He,[D("div",Qe,[D("div",Be,[b(h,{paths:M.value},{current:L(()=>{var T;return[he(j(c()?E(o)("create"):E(o)("edit"))+" ",1),(T=a.value)!=null&&T.updatedAt?(N(),Te(m,{key:0,class:"time",id:W(),raw:a.value},null,8,["id","raw"])):O("",!0)]}),_:1},8,["paths"]),(N(!0),S(de,null,ce((B=a.value)==null?void 0:B.tags,T=>(N(),S("span",{key:T.id,class:"badge"},j(T.name),1))),128)),c()?O("",!0):me((N(),S("button",{key:0,class:"icon-button",onClick:fe(x,["prevent"]),style:{"margin-inline-start":"8px"}},[Ge,b(H)],8,Fe)),[[P,e.$t("add_to_tags")]])]),b(E(Ie),{class:"panel-container"},{default:L(()=>[b(E(z),null,{default:L(()=>[b(K,{language:"html",modelValue:i.value,"onUpdate:modelValue":n[0]||(n[0]=T=>i.value=T)},null,8,["modelValue"])]),_:1}),b(E(z),null,{default:L(()=>[D("div",{class:"md-container",innerHTML:s.value},null,8,Oe)]),_:1})]),_:1})])])}}});const Ze=Me(Ue,[["__scopeId","data-v-f6d301b6"]]);export{Ze as default};

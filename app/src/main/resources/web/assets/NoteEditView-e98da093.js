import{_ as te}from"./MonacoEditor.vuevuetypescriptsetuptruelang-b0e9b25f.js";import{_ as ne}from"./print-outline-rounded-de0b4f0f.js";import{aN as ae,aO as j,aP as se,d as oe,e as ie,u as re,D as ue,r as x,s as le,f as ce,aC as de,g as z,i as _e,aQ as me,O as pe,P as D,Q as fe,R as ve,c as L,a as S,p as y,H as R,F as ge,J as he,m as O,l as J,k as W,j as A,aR as Te,w as ye,x as K,aS as ke,aT as be,aU as we,o as N,h as Ce,t as X,aV as xe,S as Ne,A as Se,B as Ee,Z as Me,a2 as Ie,a3 as Ve,a5 as Le,a4 as Ae,_ as $e}from"./index-5e07ed19.js";import{_ as De}from"./Breadcrumb-91f57f67.js";import{g as Z,M as Re}from"./splitpanes.es-f9a29c1d.js";import{u as Qe}from"./markdown-cd50d5fc.js";var Ue=function(){return ae.Date.now()};const F=Ue;var Be="Expected a function",He=Math.max,Oe=Math.min;function We(f,l,i){var _,r,n,o,a,u,v=0,$=!1,g=!1,k=!0;if(typeof f!="function")throw new TypeError(Be);l=j(l)||0,se(i)&&($=!!i.leading,g="maxWait"in i,n=g?He(j(i.maxWait)||0,l):n,k="trailing"in i?!!i.trailing:k);function b(t){var c=_,p=r;return _=r=void 0,v=t,o=f.apply(p,c),o}function m(t){return v=t,a=setTimeout(w,l),$?b(t):o}function U(t){var c=t-u,p=t-v,V=l-c;return g?Oe(V,n-p):V}function E(t){var c=t-u,p=t-v;return u===void 0||c>=l||c<0||g&&p>=n}function w(){var t=F();if(E(t))return C(t);a=setTimeout(w,U(t))}function C(t){return a=void 0,k&&_?b(t):(_=r=void 0,o)}function M(){a!==void 0&&clearTimeout(a),v=0,_=u=r=a=void 0}function B(){return a===void 0?o:C(F())}function I(){var t=F(),c=E(t);if(_=arguments,r=this,u=t,c){if(a===void 0)return m(u);if(g)return clearTimeout(a),a=setTimeout(w,l),b(u)}return a===void 0&&(a=setTimeout(w,l)),o}return I.cancel=M,I.flush=B,I}const q=f=>(Se("data-v-1574eff6"),f=f(),Ee(),f),Fe={class:"page-container"},Ge={class:"main"},Pe={class:"v-toolbar"},je={class:"state-point"},ze=["onClick"],Je=q(()=>S("md-ripple",null,null,-1)),Ke=["onClick"],Xe=q(()=>S("md-ripple",null,null,-1)),Ze=["innerHTML"],Q="NOTE",qe=oe({__name:"NoteEditView",setup(f){const l=ie(),{t:i}=re(),_=ue(),r=x(_.params.id),n=x(),o=x(""),a=x(""),u=x(!1),{app:v,urlTokenKey:$}=le(ce()),g=de(()=>{var e;return(e=n.value)!=null&&e.deletedAt?["/notes","/notes/trash"]:["/notes"]}),{render:k}=Qe(v,$);let b=!1;function m(){return r.value==="create"}const U=We(()=>{u.value=!1,B({id:m()?"":r.value,input:{content:o.value,title:Te(o.value,{length:100,omission:""})}})},500),E=()=>{ye(o,async e=>{u.value=!0,a.value=await k(e),U()})},w=()=>{window.print()},C=x();z({handle:(e,s)=>{s?K(i(s),"error"):e&&(C.value=e.tags)},document:ke,variables:{type:Q},appApi:!0});let M=()=>{};if(m())E();else{const{refetch:e}=z({handle:async(s,d)=>{if(d)K(i(d),"error");else{if(n.value=s.note,b)return;o.value=s.note.content,a.value=await k(o.value),b=!0,E()}},document:be,variables:()=>({id:r.value}),appApi:!0});M=e}const{mutate:B,onDone:I}=_e({document:we,appApi:!0});I(e=>{var d,h;n.value=e.data.saveNote,m()&&((d=n.value)!=null&&d.id)&&(r.value=(h=n.value)==null?void 0:h.id,me(l,`/notes/${r.value}`))});function t(){var s;const e=(s=n==null?void 0:n.value)==null?void 0:s.updatedAt;return e?`(${i("updated_at")}: ${Me(e)})`:""}function c(){var e,s;Ie(Ve,{type:Q,tags:C.value,item:{key:(e=n.value)==null?void 0:e.id,title:"",size:0},selected:(s=C.value)==null?void 0:s.filter(d=>{var h;return(h=n.value)==null?void 0:h.tags.some(H=>H.id===d.id)})})}const p=e=>{e.type===Q&&M()},V=e=>{e.type===Q&&M()};return pe(()=>{D.on("item_tags_updated",V),D.on("items_tags_updated",p)}),fe(()=>{D.off("item_tags_updated",V),D.off("items_tags_updated",p)}),(e,s)=>{var P;const d=Le,h=De,H=Ae,Y=ne,ee=te,G=ve("tooltip");return N(),L("div",Fe,[S("div",Ge,[S("div",Pe,[y(h,{paths:g.value},{current:R(()=>{var T;return[Ce(X(m()?A(i)("create"):A(i)("edit"))+" ",1),O(S("span",je,"*",512),[[xe,u.value]]),(T=n.value)!=null&&T.updatedAt?(N(),Ne(d,{key:0,class:"time",id:t(),raw:n.value},null,8,["id","raw"])):W("",!0)]}),_:1},8,["paths"]),(N(!0),L(ge,null,he((P=n.value)==null?void 0:P.tags,T=>(N(),L("span",{key:T.id,class:"badge"},X(T.name),1))),128)),m()?W("",!0):O((N(),L("button",{key:0,class:"icon-button",onClick:J(c,["prevent"]),style:{"margin-inline-start":"8px"}},[Je,y(H)],8,ze)),[[G,e.$t("add_to_tags")]]),m()?W("",!0):O((N(),L("button",{key:1,class:"icon-button",onClick:J(w,["prevent"])},[Xe,y(Y)],8,Ke)),[[G,e.$t("print")]])]),y(A(Re),{class:"panel-container"},{default:R(()=>[y(A(Z),null,{default:R(()=>[y(ee,{language:"html",modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=T=>o.value=T)},null,8,["modelValue"])]),_:1}),y(A(Z),null,{default:R(()=>[S("div",{class:"md-container",innerHTML:a.value},null,8,Ze)]),_:1})]),_:1})])])}}});const ot=$e(qe,[["__scopeId","data-v-1574eff6"]]);export{ot as default};

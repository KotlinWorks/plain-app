import{u as de,_ as ue,a as re}from"./list-3f4b71c4.js";import{o as n,c as l,e as t,d as _e,p as pe,r as p,u as he,C as me,n as fe,D as ve,E as ge,G as ke,H as Te,t as R,aQ as ye,J as $e,a3 as be,aR as Ce,L as q,K as qe,M as we,N as Ve,x as d,j as a,F as $,O as f,w as u,l as w,g as c,y as Se,P as De,A as E,z as Me,S as F,T as Ae,X as Be,Y as Ne,B as G,U as K,V as Ie,W as Qe,m as O,Z as Ze,$ as Le,a0 as Ue}from"./index-df35a132.js";import{_ as ze}from"./Breadcrumb-120bdd32.js";import{n as He}from"./list-6498ebd9.js";import{u as Re,a as Ee}from"./tags-ecacebdb.js";import"./vee-validate.esm-aa1410cb.js";const Fe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ge=t("path",{fill:"currentColor",d:"M7 21q-.825 0-1.413-.588T5 19V6q-.425 0-.713-.288T4 5q0-.425.288-.713T5 4h4q0-.425.288-.713T10 3h4q.425 0 .713.288T15 4h4q.425 0 .713.288T20 5q0 .425-.288.713T19 6v13q0 .825-.588 1.413T17 21H7ZM7 6v13h10V6H7Zm2 10q0 .425.288.713T10 17q.425 0 .713-.288T11 16V9q0-.425-.288-.713T10 8q-.425 0-.713.288T9 9v7Zm4 0q0 .425.288.713T14 17q.425 0 .713-.288T15 16V9q0-.425-.288-.713T14 8q-.425 0-.713.288T13 9v7ZM7 6v13V6Z"},null,-1),Ke=[Ge];function Oe(P,C){return n(),l("svg",Fe,Ke)}const Pe={name:"material-symbols-delete-outline-rounded",render:Oe},je={class:"v-toolbar"},Je=["onClick"],We=["onClick"],Xe={class:"filters"},Ye=["label"],xe={class:"form-label"},et={type:"filter"},tt=["label","selected","onClick"],ot={class:"buttons"},st=["onClick"],nt={class:"table-responsive"},at={class:"table"},lt=["checked"],ct=t("th",null,"ID",-1),it=t("th",null,null,-1),dt=["onClick"],ut=["checked"],rt=["onClick"],_t={class:"nowrap"},pt={class:"action-btns"},ht=["onClick"],mt=["onClick"],ft={class:"nowrap"},vt={class:"nowrap"},gt={key:0},kt={colspan:"7"},Tt={class:"no-data-placeholder"},h="NOTE",b=50,St=_e({__name:"NotesView",setup(P){var L,U;const C=pe(),r=p([]),V=p(),{t:S}=he(),i=me({text:"",tags:[]}),D=fe().query,v=p(parseInt(((L=D.page)==null?void 0:L.toString())??"1")),g=p(0),_=p(ve(((U=D.q)==null?void 0:U.toString())??"")),M=p(""),{tags:k}=Re(h,_,i,async e=>{e.push({name:"trash",op:"",value:"false"}),M.value=ge(e),await ke(),X()}),{addToTags:A}=Ee(h,r,k),{selectAll:j,toggleSelect:B,checked:J}=de(r),{loading:W,load:X,refetch:N}=Te({handle:(e,s)=>{s?R(S(s),"error"):e&&(r.value=e.notes.map(m=>({...m,checked:!1})),g.value=e.noteCount)},document:ye,variables:()=>({offset:(v.value-1)*b,limit:b,query:M.value}),appApi:!0});function Y(e){Be(Ne,{tagType:h,tags:k.value,item:{key:e.id,title:"",size:0},selected:k.value.filter(s=>e.tags.some(m=>m.id===s.id))})}$e(v,e=>{G(C,`/notes?page=${e}&q=${K(_.value)}`)});const{mutate:I,onDone:x}=be({document:Ce,appApi:!0});function ee(){const e=r.value.filter(s=>s.checked);if(e.length===0){R(S("select_first"),"error");return}I({ids:e.map(s=>s.id)})}x(()=>{N(),r.value.some(e=>e.tags.length)&&q.emit("refetch_tags",h)});function te(e){i.tags.includes(e)?Ie(i.tags,s=>s.id===e.id):i.tags.push(e)}function oe(){_.value=Qe(i),Q(),V.value.dismiss()}function Q(){G(C,`/notes?q=${K(_.value)}`)}const Z=e=>{e===h&&N()};qe(()=>{q.on("refetch_by_tag_type",Z)}),we(()=>{q.off("refetch_by_tag_type",Z)});function se(e){O.push(`/notes/${e.id}`)}function ne(){O.push("/notes/create")}return(e,s)=>{const m=ze,z=Ze,H=Pe,ae=ue,le=Le,ce=Ue,ie=re,T=Ve("tooltip");return n(),l($,null,[t("div",je,[d(m,{current:()=>`${e.$t("page_title.notes")} (${g.value})`},null,8,["current"]),a(J)?(n(),l($,{key:0},[f((n(),l("md-icon-button",{onClick:s[0]||(s[0]=u((...o)=>a(A)&&a(A)(...o),["stop"]))},[d(z)])),[[T,e.$t("add_to_tags")]]),f((n(),l("md-icon-button",{onClick:u(ee,["stop"])},[d(H)],8,Je)),[[T,e.$t("move_to_trash")]])],64)):w("",!0),t("md-outlined-button",{onClick:u(ne,["prevent"])},c(e.$t("create")),9,We),d(ae,{ref_key:"searchInputRef",ref:V,modelValue:_.value,"onUpdate:modelValue":s[2]||(s[2]=o=>_.value=o),search:Q},{filters:Se(()=>[t("div",Xe,[f(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":s[1]||(s[1]=o=>i.text=o),"keyup.enter":"applyAndDoSearch"},null,8,Ye),[[De,i.text]]),t("label",xe,c(e.$t("tags")),1),t("md-chip-set",et,[(n(!0),l($,null,E(a(k),o=>(n(),l("md-filter-chip",{key:o.id,label:o.name,selected:i.tags.includes(o),onClick:y=>te(o)},null,8,tt))),128))]),t("div",ot,[t("md-filled-button",{onClick:u(oe,["stop"])},c(e.$t("search")),9,st)])])]),_:1},8,["modelValue"])]),t("div",nt,[t("table",at,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:s[3]||(s[3]=(...o)=>a(B)&&a(B)(...o)),checked:a(j)},null,40,lt)]),ct,t("th",null,c(e.$t("title")),1),it,t("th",null,c(e.$t("tags")),1),t("th",null,c(e.$t("updated_at")),1),t("th",null,c(e.$t("created_at")),1)])]),t("tbody",null,[(n(!0),l($,null,E(r.value,o=>(n(),l("tr",{key:o.id,class:Me({selected:o.checked}),onClick:u(y=>o.checked=!o.checked,["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",checked:o.checked},null,8,ut)]),t("td",null,[d(le,{id:o.id,raw:o},null,8,["id","raw"])]),t("td",null,[t("a",{href:"#",onClick:u(y=>se(o),["prevent"])},c(o.title||e.$t("no_content")),9,rt)]),t("td",_t,[t("div",pt,[f((n(),l("md-icon-button",{onClick:u(y=>a(I)({ids:[o.id]}),["stop"])},[d(H)],8,ht)),[[T,e.$t("move_to_trash")]]),f((n(),l("md-icon-button",{onClick:u(y=>Y(o),["stop"])},[d(z)],8,mt)),[[T,e.$t("add_to_tags")]])])]),t("td",null,[d(ce,{tags:o.tags,tagType:h},null,8,["tags"])]),t("td",ft,c(a(F)(o.updatedAt)),1),t("td",vt,c(a(F)(o.createdAt)),1)],10,dt))),128))]),r.value.length?w("",!0):(n(),l("tfoot",gt,[t("tr",null,[t("td",kt,[t("div",Tt,c(e.$t(a(He)(a(W)))),1)])])]))])]),g.value>b?(n(),Ae(ie,{key:0,modelValue:v.value,"onUpdate:modelValue":s[4]||(s[4]=o=>v.value=o),total:g.value,limit:b},null,8,["modelValue","total"])):w("",!0)],64)}}});export{St as default};

import{D as fe,u as ve,_ as ge,a as ke,b as be}from"./list-c18b89b9.js";import{o as l,e as a,f as t,d as $e,a as Te,r as v,u as ye,B as Ce,p as qe,C as we,D as Ve,E as Ae,G as De,t as K,aR as Se,I as Ie,a2 as Me,aS as Be,$ as g,J as Ne,K as Qe,L as Re,x as i,k as o,F as C,M as k,w as r,m as A,j as c,y as Ue,N as Ze,A as J,z as Le,Q as O,R as ze,V as He,W as Ee,n as P,S as W,T as Fe,U as Ge,aT as X,X as je,Y as Ke,Z as Je}from"./index-2c8e7849.js";import{_ as Oe}from"./Breadcrumb-01ba2071.js";import{n as Pe}from"./list-6498ebd9.js";import{u as We,a as Xe}from"./tags-9332a6bc.js";import"./vee-validate.esm-83a41e33.js";const Ye={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},xe=t("path",{fill:"currentColor",d:"M7 21q-.825 0-1.413-.588T5 19V6q-.425 0-.713-.288T4 5q0-.425.288-.713T5 4h4q0-.425.288-.713T10 3h4q.425 0 .713.288T15 4h4q.425 0 .713.288T20 5q0 .425-.288.713T19 6v13q0 .825-.588 1.413T17 21H7ZM7 6v13h10V6H7Zm2 10q0 .425.288.713T10 17q.425 0 .713-.288T11 16V9q0-.425-.288-.713T10 8q-.425 0-.713.288T9 9v7Zm4 0q0 .425.288.713T14 17q.425 0 .713-.288T15 16V9q0-.425-.288-.713T14 8q-.425 0-.713.288T13 9v7ZM7 6v13V6Z"},null,-1),et=[xe];function tt(Y,q){return l(),a("svg",Ye,et)}const st={name:"material-symbols-delete-outline-rounded",render:tt},ot={class:"v-toolbar"},nt=["onClick"],lt=t("md-ripple",null,null,-1),at=t("md-ripple",null,null,-1),ct=["onClick"],it={class:"filters"},dt=["label"],rt={class:"form-label"},ut={type:"filter"},_t=["label","selected","onClick"],pt={class:"buttons"},ht=["onClick"],mt={class:"table-responsive"},ft={class:"table"},vt=["checked","indeterminate"],gt=t("th",null,"ID",-1),kt=t("th",null,null,-1),bt=["onClick"],$t=["checked"],Tt=["onClick"],yt={class:"nowrap"},Ct={class:"action-btns"},qt=["onClick"],wt=t("md-ripple",null,null,-1),Vt=["onClick"],At=t("md-ripple",null,null,-1),Dt={class:"nowrap"},St={class:"nowrap"},It={key:0},Mt={colspan:"7"},Bt={class:"no-data-placeholder"},b=50,Ht=$e({__name:"NotesView",setup(Y){var E,F;const q=Te(),u=v([]),D=v(),{t:S}=ye(),d=Ce({text:"",tags:[]}),_=fe.NOTE,I=qe().query,$=v(parseInt(((E=I.page)==null?void 0:E.toString())??"1")),p=v(we(((F=I.q)==null?void 0:F.toString())??"")),w=v(""),{tags:T}=We(_,p,d,async e=>{e.push({name:"trash",op:"",value:"false"}),w.value=Ve(e),await Ae(),oe()}),{addToTags:x}=Xe(_,u,T),{allChecked:M,realAllChecked:B,selectRealAll:ee,allCheckedAlertVisible:te,clearSelection:N,toggleAllChecked:Q,toggleItemChecked:R,total:m,checked:U}=ve(u),{loading:se,load:oe,refetch:V}=De({handle:(e,n)=>{n?K(S(n),"error"):e&&(u.value=e.notes.map(f=>({...f,checked:!1})),m.value=e.noteCount)},document:Se,variables:()=>({offset:($.value-1)*b,limit:b,query:w.value}),appApi:!0});function ne(e){He(Ee,{type:_,tags:T.value,item:{key:e.id,title:"",size:0},selected:T.value.filter(n=>e.tags.some(f=>f.id===n.id))})}Ie($,e=>{P(q,`/notes?page=${e}&q=${W(p.value)}`)});const{mutate:Z,onDone:le}=Me({document:Be,appApi:!0});function ae(){const e=u.value.filter(n=>n.checked);if(e.length===0){K(S("select_first"),"error");return}Z({query:`ids:${e.map(n=>n.id).join(",")}`})}le(()=>{V(),u.value.some(e=>e.tags.length)&&g.emit("refetch_tags",_)});function ce(e){d.tags.includes(e)?Fe(d.tags,n=>n.id===e.id):d.tags.push(e)}function ie(){p.value=Ge(d),L(),D.value.dismiss()}function L(){P(q,`/notes?q=${W(p.value)}`)}const z=e=>{e.type===_&&(N(),V())},H=e=>{e.type===_&&V()};Ne(()=>{g.on("item_tags_updated",H),g.on("items_tags_updated",z)}),Qe(()=>{g.off("item_tags_updated",H),g.off("items_tags_updated",z)});function de(e){X.push(`/notes/${e.id}`)}function re(){X.push("/notes/create")}return(e,n)=>{const f=Oe,G=st,j=je,ue=ge,_e=ke,pe=Ke,he=Je,me=be,y=Re("tooltip");return l(),a(C,null,[t("div",ot,[i(f,{current:()=>`${e.$t("page_title.notes")} (${o(m)})`},null,8,["current"]),o(U)?(l(),a(C,{key:0},[k((l(),a("button",{class:"icon-button",onClick:r(ae,["stop"])},[lt,i(G)],8,nt)),[[y,e.$t("move_to_trash")]]),k((l(),a("button",{class:"icon-button",onClick:n[0]||(n[0]=r(s=>o(x)(o(B),w.value),["stop"]))},[at,i(j)])),[[y,e.$t("add_to_tags")]])],64)):A("",!0),t("md-outlined-button",{onClick:r(re,["prevent"])},c(e.$t("create")),9,ct),i(ue,{ref_key:"searchInputRef",ref:D,modelValue:p.value,"onUpdate:modelValue":n[2]||(n[2]=s=>p.value=s),search:L},{filters:Ue(()=>[t("div",it,[k(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":n[1]||(n[1]=s=>d.text=s),"keyup.enter":"applyAndDoSearch"},null,8,dt),[[Ze,d.text]]),t("label",rt,c(e.$t("tags")),1),t("md-chip-set",ut,[(l(!0),a(C,null,J(o(T),s=>(l(),a("md-filter-chip",{key:s.id,label:s.name,selected:d.tags.includes(s),onClick:h=>ce(s)},null,8,_t))),128))]),t("div",pt,[t("md-filled-button",{onClick:r(ie,["stop"])},c(e.$t("search")),9,ht)])])]),_:1},8,["modelValue"])]),i(_e,{limit:b,total:o(m),"all-checked-alert-visible":o(te),"real-all-checked":o(B),"select-real-all":o(ee),"clear-selection":o(N)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",mt,[t("table",ft,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:n[3]||(n[3]=(...s)=>o(Q)&&o(Q)(...s)),checked:o(M),indeterminate:!o(M)&&o(U)},null,40,vt)]),gt,t("th",null,c(e.$t("title")),1),kt,t("th",null,c(e.$t("tags")),1),t("th",null,c(e.$t("updated_at")),1),t("th",null,c(e.$t("created_at")),1)])]),t("tbody",null,[(l(!0),a(C,null,J(u.value,s=>(l(),a("tr",{key:s.id,class:Le({selected:s.checked}),onClick:r(h=>s.checked=!s.checked,["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:n[4]||(n[4]=(...h)=>o(R)&&o(R)(...h)),checked:s.checked},null,40,$t)]),t("td",null,[i(pe,{id:s.id,raw:s},null,8,["id","raw"])]),t("td",null,[t("a",{href:"#",onClick:r(h=>de(s),["prevent"])},c(s.title||e.$t("no_content")),9,Tt)]),t("td",yt,[t("div",Ct,[k((l(),a("button",{class:"icon-button",onClick:r(h=>o(Z)({query:`ids:${s.id}`}),["stop"])},[wt,i(G)],8,qt)),[[y,e.$t("move_to_trash")]]),k((l(),a("button",{class:"icon-button",onClick:r(h=>ne(s),["stop"])},[At,i(j)],8,Vt)),[[y,e.$t("add_to_tags")]])])]),t("td",null,[i(he,{tags:s.tags,type:o(_)},null,8,["tags","type"])]),t("td",Dt,c(o(O)(s.updatedAt)),1),t("td",St,c(o(O)(s.createdAt)),1)],10,bt))),128))]),u.value.length?A("",!0):(l(),a("tfoot",It,[t("tr",null,[t("td",Mt,[t("div",Bt,c(e.$t(o(Pe)(o(se)))),1)])])]))])]),o(m)>b?(l(),ze(me,{key:0,modelValue:$.value,"onUpdate:modelValue":n[5]||(n[5]=s=>$.value=s),total:o(m),limit:b},null,8,["modelValue","total"])):A("",!0)],64)}}});export{Ht as default};

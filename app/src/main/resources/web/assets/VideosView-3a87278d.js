import{D as qe,u as Be,_ as Me,a as Le,b as Ne}from"./data-17e9864e.js";import{d as xe,ax as He,a as Qe,r as I,u as Ge,c as Oe,s as Ke,B as We,p as Xe,C as Pe,ay as je,aa as Je,az as Ye,D as Ze,E as et,G as tt,H as ot,I as st,e as a,f as o,x as c,h as t,F as S,J as m,w as _,j as f,K as M,y as lt,A as L,t as u,L as nt,M as at,k as it,aA as dt,aE as ct,n as ce,O as ue,o as n,P as ut,a4 as _e,z as _t,as as re,aC as N,m as rt,at as pt,au as mt,af as ht,T as vt,V as gt,W as ft,U as kt,an as yt,aD as bt,X as k,a8 as wt,ag as Ct,Y as $t,Z as Tt,$ as Vt,_ as It}from"./index-71d8bb76.js";import{_ as St,a as Dt}from"./ConfirmModal.vuevuetypescriptsetuptruelang-cb898a8f.js";import{_ as At,a as Rt}from"./grid-view-outline-rounded-eaae9780.js";import{_ as zt}from"./Breadcrumb-91ff4b3f.js";import{n as pe}from"./list-6498ebd9.js";import{u as Et,a as Ft}from"./tags-779e8f21.js";import"./vee-validate.esm-49ea0aba.js";const r=A=>(pt("data-v-2711b4b7"),A=A(),mt(),A),Ut={class:"v-toolbar"},qt=r(()=>o("md-ripple",null,null,-1)),Bt=r(()=>o("md-ripple",null,null,-1)),Mt=r(()=>o("md-ripple",null,null,-1)),Lt=["onClick"],Nt=r(()=>o("md-ripple",null,null,-1)),xt=["onClick"],Ht=r(()=>o("md-ripple",null,null,-1)),Qt={class:"filters"},Gt=["label"],Ot={class:"form-label"},Kt={type:"filter"},Wt=["label","selected","onClick"],Xt={class:"buttons"},Pt=["onClick"],jt={key:0,class:"image-container",style:{"margin-bottom":"24px"}},Jt=["onClick","onContextmenu"],Yt=["src"],Zt={class:"duration"},eo={key:1,class:"no-data-placeholder"},to={key:2,class:"table-responsive"},oo={class:"table"},so=["checked","indeterminate"],lo=r(()=>o("th",null,"ID",-1)),no=r(()=>o("th",null,null,-1)),ao=r(()=>o("th",null,null,-1)),io=["onClick"],co=["checked"],uo=["src","onClick"],_o={class:"nowrap"},ro={class:"action-btns"},po=["onClick"],mo=r(()=>o("md-ripple",null,null,-1)),ho=["onClick"],vo=r(()=>o("md-ripple",null,null,-1)),go=["onClick"],fo=r(()=>o("md-ripple",null,null,-1)),ko={class:"nowrap"},yo={class:"nowrap"},bo={key:0},wo={colspan:"8"},Co={class:"no-data-placeholder"},D=48,$o=xe({__name:"VideosView",setup(A){var ne,ae;const me=He(),i=Qe(),h=I([]),x=I(),{t:C}=Ge(),H=Oe(),{app:Q,urlTokenKey:U}=Ke(H),v=We({text:"",tags:[]}),d=qe.VIDEO,G=Xe().query,$=I(parseInt(((ne=G.page)==null?void 0:ne.toString())??"1")),y=I(Pe(((ae=G.q)==null?void 0:ae.toString())??"")),T=I(""),{tags:R}=Et(d,y,v,async e=>{T.value=nt(e),await at(),be()}),{addToTags:he}=Ft(d,h,R),{deleteItems:ve,deleteItem:O}=je(),{allChecked:K,realAllChecked:z,selectRealAll:ge,allCheckedAlertVisible:fe,clearSelection:E,toggleAllChecked:W,toggleItemChecked:X,toggleRow:ke,total:b,checked:P}=Be(h),{downloadItems:ye}=Je(U,d,h,E,"videos.zip"),{downloadFile:j}=ht(U),q=Ye(()=>h.value.map(e=>({src:re(e.fileId),name:N(e.path),duration:e.duration,size:e.size,path:e.path,data:e,type:d}))),{loading:J,load:be,refetch:B}=Ze({handle:async(e,l)=>{if(l)it(C(l),"error");else if(e){const w=[];for(const V of e.videos)w.push({...V,checked:!1,fileId:dt(U.value,V.path)});h.value=w,b.value=e.videoCount}},document:ct,variables:()=>({offset:($.value-1)*D,limit:D,query:T.value}),appApi:!0});function we(){ce(i,`/videos?page=${$.value}&q=${ue(y.value)}`)}function Y(e){H.lightbox={sources:q.value,index:e,visible:!0}}et($,()=>{we()});function Ce(e){v.tags.includes(e)?vt(v.tags,l=>l.id===e.id):v.tags.push(e)}function Z(e){gt(ft,{type:d,tags:R.value,item:{key:e.id,title:e.title,size:e.size},selected:R.value.filter(l=>e.tags.some(w=>w.id===l.id))})}function $e(){y.value=kt(v),ee(),x.value.dismiss()}function ee(){ce(i,`/videos?q=${ue(y.value)}`)}function Te(){i.videoViewType==="grid"?i.videoViewType="list":i.videoViewType="grid"}function Ve(){me.push("/files"),yt(St,{message:C("upload_videos")})}function Ie(e,l){e.preventDefault(),bt({x:e.x,y:e.y,items:[{label:C("add_to_tags"),onClick:()=>{Z(l)}},{label:C("download"),onClick:()=>{j(l.path,N(l.path).replace(" ","-"))}},{label:C("delete"),onClick:()=>{O(d,l)}}]})}const te=e=>{e.type===d&&(E(),B())},oe=e=>{e.type===d&&B()},se=e=>{e.type===d&&(E(),B())},le=()=>{b.value--};return tt(()=>{k.on("item_tags_updated",oe),k.on("items_tags_updated",te),k.on("media_item_deleted",le),k.on("media_items_deleted",se)}),ot(()=>{k.off("item_tags_updated",oe),k.off("items_tags_updated",te),k.off("media_item_deleted",le),k.off("media_items_deleted",se)}),(e,l)=>{const w=zt,V=wt,ie=Ct,de=$t,Se=At,De=Rt,Ae=Dt,Re=Me,ze=Le,Ee=Tt,Fe=Vt,Ue=Ne,g=st("tooltip");return n(),a(S,null,[o("div",Ut,[c(w,{current:()=>`${e.$t("page_title.videos")} (${t(b)})`},null,8,["current"]),t(P)&&t(i).videoViewType==="list"?(n(),a(S,{key:0},[m((n(),a("button",{class:"icon-button",onClick:l[0]||(l[0]=_(s=>t(ve)(t(d),h.value,t(z),T.value),["stop"]))},[qt,c(V)])),[[g,e.$t("delete")]]),m((n(),a("button",{class:"icon-button",onClick:l[1]||(l[1]=_(s=>t(ye)(t(z),T.value),["stop"]))},[Bt,c(ie)])),[[g,e.$t("download")]]),m((n(),a("button",{class:"icon-button",onClick:l[2]||(l[2]=_(s=>t(he)(t(z),T.value),["stop"]))},[Mt,c(de)])),[[g,e.$t("add_to_tags")]])],64)):f("",!0),m((n(),a("button",{class:"icon-button",onClick:_(Te,["prevent"])},[Nt,t(i).videoViewType==="list"?(n(),M(Se,{key:0})):f("",!0),t(i).videoViewType==="grid"?(n(),M(De,{key:1})):f("",!0)],8,Lt)),[[g,e.$t(t(i).videoViewType==="list"?"view_as_grid":"view_as_list")]]),m((n(),a("button",{class:"icon-button",onClick:_(Ve,["prevent"])},[Ht,c(Ae)],8,xt)),[[g,e.$t("upload")]]),c(Re,{ref_key:"searchInputRef",ref:x,modelValue:y.value,"onUpdate:modelValue":l[4]||(l[4]=s=>y.value=s),search:ee},{filters:lt(()=>[o("div",Qt,[m(o("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":l[3]||(l[3]=s=>v.text=s),"keyup.enter":"applyAndDoSearch"},null,8,Gt),[[ut,v.text]]),o("label",Ot,u(e.$t("tags")),1),o("md-chip-set",Kt,[(n(!0),a(S,null,L(t(R),s=>(n(),a("md-filter-chip",{key:s.id,label:s.name,selected:v.tags.includes(s),onClick:F=>Ce(s)},null,8,Wt))),128))]),o("div",Xt,[o("md-filled-button",{onClick:_($e,["stop"])},u(e.$t("search")),9,Pt)])])]),_:1},8,["modelValue"])]),t(i).videoViewType==="grid"?(n(),a("div",jt,[(n(!0),a(S,null,L(q.value,(s,F)=>(n(),a("div",{class:"item",onClick:p=>Y(F),onContextmenu:p=>Ie(p,s.data)},[o("img",{class:"image",src:s.src+"&w=300&h=300"},null,8,Yt),o("span",Zt,u(t(_e)(s.duration)),1)],40,Jt))),256))])):f("",!0),t(i).videoViewType==="grid"&&q.value.length===0?(n(),a("div",eo,u(e.$t(t(pe)(t(J),t(Q).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):f("",!0),c(ze,{limit:D,total:t(b),"all-checked-alert-visible":t(fe),"real-all-checked":t(z),"select-real-all":t(ge),"clear-selection":t(E)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t(i).videoViewType==="list"?(n(),a("div",to,[o("table",oo,[o("thead",null,[o("tr",null,[o("th",null,[o("md-checkbox",{"touch-target":"wrapper",onChange:l[5]||(l[5]=(...s)=>t(W)&&t(W)(...s)),checked:t(K),indeterminate:!t(K)&&t(P)},null,40,so)]),lo,no,o("th",null,u(e.$t("name")),1),ao,o("th",null,u(e.$t("tags")),1),o("th",null,u(e.$t("duration")),1),o("th",null,u(e.$t("file_size")),1)])]),o("tbody",null,[(n(!0),a(S,null,L(h.value,(s,F)=>(n(),a("tr",{key:s.id,class:_t({selected:s.checked}),onClick:_(p=>t(ke)(s),["stop"])},[o("td",null,[o("md-checkbox",{"touch-target":"wrapper",onChange:l[6]||(l[6]=(...p)=>t(X)&&t(X)(...p)),checked:s.checked},null,40,co)]),o("td",null,[c(Ee,{id:s.id,raw:s},null,8,["id","raw"])]),o("td",null,[o("img",{class:"img-video",src:t(re)(s.fileId)+"&w=300&h=300",width:"50",height:"50",style:{cursor:"pointer"},onClick:_(p=>Y(F),["stop"])},null,8,uo)]),o("td",null,u(s.title),1),o("td",_o,[o("div",ro,[m((n(),a("button",{class:"icon-button",onClick:_(p=>t(O)(t(d),s),["stop"])},[mo,c(V)],8,po)),[[g,e.$t("delete")]]),m((n(),a("button",{class:"icon-button",onClick:_(p=>t(j)(s.path,t(N)(s.path).replace(" ","-")),["stop"])},[vo,c(ie)],8,ho)),[[g,e.$t("download")]]),m((n(),a("button",{class:"icon-button",onClick:_(p=>Z(s),["stop"])},[fo,c(de)],8,go)),[[g,e.$t("add_to_tags")]])])]),o("td",null,[c(Fe,{tags:s.tags,type:t(d)},null,8,["tags","type"])]),o("td",ko,u(t(_e)(s.duration)),1),o("td",yo,u(t(rt)(s.size)),1)],10,io))),128))]),h.value.length?f("",!0):(n(),a("tfoot",bo,[o("tr",null,[o("td",wo,[o("div",Co,u(e.$t(t(pe)(t(J),t(Q).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])])):f("",!0),t(b)>D?(n(),M(Ue,{key:3,modelValue:$.value,"onUpdate:modelValue":l[7]||(l[7]=s=>$.value=s),total:t(b),limit:D},null,8,["modelValue","total"])):f("",!0)],64)}}});const Fo=It($o,[["__scopeId","data-v-2711b4b7"]]);export{Fo as default};

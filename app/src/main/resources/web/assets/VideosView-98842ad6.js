import{D as Be,u as Ne,_ as Le,a as Me,b as Qe}from"./list-c18b89b9.js";import{d as Ge,ax as He,a as Ke,r as w,u as Oe,c as We,s as Xe,B as je,p as Je,C as Pe,D as Ye,E as Ze,ay as xe,aa as et,az as tt,G as st,t as ot,aA as lt,aD as nt,I as de,J as at,K as it,L as dt,o as n,e as a,f as t,x as d,k as s,F as S,M as p,w as _,m as g,R as N,y as ct,N as ut,j as c,A as L,a4 as ce,z as _t,as as ue,aC as _e,l as rt,af as pt,T as mt,V as ht,W as vt,U as gt,n as re,S as pe,an as ft,a8 as kt,ag as bt,X as yt,Y as $t,Z as wt,au as Ct,av as It,$ as f,_ as Tt}from"./index-2c8e7849.js";import{_ as St,a as Vt}from"./ConfirmModal.vuevuetypescriptsetuptruelang-9dd98671.js";import{_ as Dt,a as At}from"./grid-view-outline-rounded-2599736f.js";import{_ as Rt}from"./Breadcrumb-01ba2071.js";import{n as me}from"./list-6498ebd9.js";import{u as zt,a as Et}from"./tags-9332a6bc.js";import"./vee-validate.esm-83a41e33.js";const r=D=>(Ct("data-v-c6fdcb3b"),D=D(),It(),D),Ft={class:"v-toolbar"},Ut=r(()=>t("md-ripple",null,null,-1)),qt=r(()=>t("md-ripple",null,null,-1)),Bt=r(()=>t("md-ripple",null,null,-1)),Nt=["onClick"],Lt=r(()=>t("md-ripple",null,null,-1)),Mt=["onClick"],Qt=r(()=>t("md-ripple",null,null,-1)),Gt={class:"filters"},Ht=["label"],Kt={class:"form-label"},Ot={type:"filter"},Wt=["label","selected","onClick"],Xt={class:"buttons"},jt=["onClick"],Jt={key:0,class:"image-container",style:{"margin-bottom":"24px"}},Pt=["onClick"],Yt=["src"],Zt={class:"duration"},xt={key:1,class:"no-data-placeholder"},es={class:"table-responsive"},ts={key:0,class:"table"},ss=["checked","indeterminate"],os=r(()=>t("th",null,"ID",-1)),ls=r(()=>t("th",null,null,-1)),ns=r(()=>t("th",null,null,-1)),as=["onClick"],is=["checked"],ds=["src","onClick"],cs={class:"nowrap"},us={class:"action-btns"},_s=["onClick"],rs=r(()=>t("md-ripple",null,null,-1)),ps=["onClick"],ms=r(()=>t("md-ripple",null,null,-1)),hs=["onClick"],vs=r(()=>t("md-ripple",null,null,-1)),gs={class:"nowrap"},fs={class:"nowrap"},ks={key:0},bs={colspan:"8"},ys={class:"no-data-placeholder"},V=50,$s=Ge({__name:"VideosView",setup(D){var oe,le,ne;const he=He(),M=Ke(),m=w([]),Q=w(),{t:G}=Oe(),H=We(),{app:K,urlTokenKey:F}=Xe(H),h=je({text:"",tags:[]}),u=Be.VIDEO,U=Je().query,C=w(parseInt(((oe=U.page)==null?void 0:oe.toString())??"1")),b=w(Pe(((le=U.q)==null?void 0:le.toString())??"")),I=w(""),{tags:A}=zt(u,b,h,async e=>{I.value=Ye(e),await Ze(),we()}),i=w(((ne=U.view)==null?void 0:ne.toString())??"grid"),{addToTags:ve}=Et(u,m,A),{deleteItems:ge,deleteItem:fe}=xe(),{allChecked:O,realAllChecked:R,selectRealAll:ke,allCheckedAlertVisible:be,clearSelection:z,toggleAllChecked:W,toggleItemChecked:X,total:y,checked:j}=Ne(m),{downloadItems:ye}=et(F,u,m,z,"videos.zip"),{downloadFile:$e}=pt(F),q=tt(()=>m.value.map(e=>({src:ue(e.fileId),name:_e(e.path),duration:e.duration,size:e.size,path:e.path,data:e,type:u}))),{loading:J,load:we,refetch:B}=st({handle:async(e,l)=>{if(l)ot(G(l),"error");else if(e){const $=[];for(const T of e.videos)$.push({...T,checked:!1,fileId:lt(F.value,T.path)});m.value=$,y.value=e.videoCount}},document:nt,variables:()=>({offset:(C.value-1)*V,limit:V,query:I.value}),appApi:!0});function P(){re(M,`/videos?page=${C.value}&q=${pe(b.value)}&view=${i.value}`)}function Y(e){H.lightbox={sources:q.value,index:e,visible:!0}}de(C,()=>{P()}),de(i,()=>{P()});function Ce(e){h.tags.includes(e)?mt(h.tags,l=>l.id===e.id):h.tags.push(e)}function Ie(e){ht(vt,{type:u,tags:A.value,item:{key:e.id,title:e.title,size:e.size},selected:A.value.filter(l=>e.tags.some($=>$.id===l.id))})}function Te(){b.value=gt(h),Z(),Q.value.dismiss()}function Z(){re(M,`/videos?q=${pe(b.value)}&view=${i.value}`)}function Se(){i.value==="grid"?i.value="list":i.value="grid"}function Ve(){he.push("/files"),ft(St,{message:G("upload_videos")})}const x=e=>{e.type===u&&(z(),B())},ee=e=>{e.type===u&&B()},te=e=>{e.type===u&&(z(),B())},se=()=>{y.value--};return at(()=>{f.on("item_tags_updated",ee),f.on("items_tags_updated",x),f.on("media_item_deleted",se),f.on("media_items_deleted",te)}),it(()=>{f.off("item_tags_updated",ee),f.off("items_tags_updated",x),f.off("media_item_deleted",se),f.off("media_items_deleted",te)}),(e,l)=>{const $=Rt,T=kt,ae=bt,ie=yt,De=Dt,Ae=At,Re=Vt,ze=Le,Ee=Me,Fe=$t,Ue=wt,qe=Qe,v=dt("tooltip");return n(),a(S,null,[t("div",Ft,[d($,{current:()=>`${e.$t("page_title.videos")} (${s(y)})`},null,8,["current"]),s(j)&&i.value==="list"?(n(),a(S,{key:0},[p((n(),a("button",{class:"icon-button",onClick:l[0]||(l[0]=_(o=>s(ge)(s(u),m.value,s(R),I.value),["stop"]))},[Ut,d(T)])),[[v,e.$t("delete")]]),p((n(),a("button",{class:"icon-button",onClick:l[1]||(l[1]=_(o=>s(ye)(s(R),I.value),["stop"]))},[qt,d(ae)])),[[v,e.$t("download")]]),p((n(),a("button",{class:"icon-button",onClick:l[2]||(l[2]=_(o=>s(ve)(s(R),I.value),["stop"]))},[Bt,d(ie)])),[[v,e.$t("add_to_tags")]])],64)):g("",!0),p((n(),a("button",{class:"icon-button",onClick:_(Se,["prevent"])},[Lt,i.value==="list"?(n(),N(De,{key:0})):g("",!0),i.value==="grid"?(n(),N(Ae,{key:1})):g("",!0)],8,Nt)),[[v,e.$t(i.value==="list"?"view_as_grid":"view_as_list")]]),p((n(),a("button",{class:"icon-button",onClick:_(Ve,["prevent"])},[Qt,d(Re)],8,Mt)),[[v,e.$t("upload")]]),d(ze,{ref_key:"searchInputRef",ref:Q,modelValue:b.value,"onUpdate:modelValue":l[4]||(l[4]=o=>b.value=o),search:Z},{filters:ct(()=>[t("div",Gt,[p(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":l[3]||(l[3]=o=>h.text=o),"keyup.enter":"applyAndDoSearch"},null,8,Ht),[[ut,h.text]]),t("label",Kt,c(e.$t("tags")),1),t("md-chip-set",Ot,[(n(!0),a(S,null,L(s(A),o=>(n(),a("md-filter-chip",{key:o.id,label:o.name,selected:h.tags.includes(o),onClick:E=>Ce(o)},null,8,Wt))),128))]),t("div",Xt,[t("md-filled-button",{onClick:_(Te,["stop"])},c(e.$t("search")),9,jt)])])]),_:1},8,["modelValue"])]),i.value==="grid"?(n(),a("div",Jt,[(n(!0),a(S,null,L(q.value,(o,E)=>(n(),a("div",{class:"item",onClick:k=>Y(E)},[t("img",{class:"image",src:o.src+"&w=300&h=300"},null,8,Yt),t("span",Zt,c(s(ce)(o.duration)),1)],8,Pt))),256))])):g("",!0),i.value==="grid"&&q.value.length===0?(n(),a("div",xt,c(e.$t(s(me)(s(J),s(K).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):g("",!0),d(Ee,{limit:V,total:s(y),"all-checked-alert-visible":s(be),"real-all-checked":s(R),"select-real-all":s(ke),"clear-selection":s(z)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",es,[i.value==="list"?(n(),a("table",ts,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[5]||(l[5]=(...o)=>s(W)&&s(W)(...o)),checked:s(O),indeterminate:!s(O)&&s(j)},null,40,ss)]),os,ls,t("th",null,c(e.$t("name")),1),ns,t("th",null,c(e.$t("tags")),1),t("th",null,c(e.$t("duration")),1),t("th",null,c(e.$t("file_size")),1)])]),t("tbody",null,[(n(!0),a(S,null,L(m.value,(o,E)=>(n(),a("tr",{key:o.id,class:_t({selected:o.checked}),onClick:_(k=>o.checked=!o.checked,["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[6]||(l[6]=(...k)=>s(X)&&s(X)(...k)),checked:o.checked},null,40,is)]),t("td",null,[d(Fe,{id:o.id,raw:o},null,8,["id","raw"])]),t("td",null,[t("img",{class:"img-video",src:s(ue)(o.fileId)+"&w=300&h=300",width:"50",height:"50",style:{cursor:"pointer"},onClick:_(k=>Y(E),["stop"])},null,8,ds)]),t("td",null,c(o.title),1),t("td",cs,[t("div",us,[p((n(),a("button",{class:"icon-button",onClick:_(k=>s(fe)(s(u),o),["stop"])},[rs,d(T)],8,_s)),[[v,e.$t("delete")]]),p((n(),a("button",{class:"icon-button",onClick:_(k=>s($e)(o.path,s(_e)(o.path).replace(" ","-")),["stop"])},[ms,d(ae)],8,ps)),[[v,e.$t("download")]]),p((n(),a("button",{class:"icon-button",onClick:_(k=>Ie(o),["stop"])},[vs,d(ie)],8,hs)),[[v,e.$t("add_to_tags")]])])]),t("td",null,[d(Ue,{tags:o.tags,type:s(u)},null,8,["tags","type"])]),t("td",gs,c(s(ce)(o.duration)),1),t("td",fs,c(s(rt)(o.size)),1)],10,as))),128))]),m.value.length?g("",!0):(n(),a("tfoot",ks,[t("tr",null,[t("td",bs,[t("div",ys,c(e.$t(s(me)(s(J),s(K).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])):g("",!0)]),s(y)>V?(n(),N(qe,{key:2,modelValue:C.value,"onUpdate:modelValue":l[7]||(l[7]=o=>C.value=o),total:s(y),limit:V},null,8,["modelValue","total"])):g("",!0)],64)}}});const zs=Tt($s,[["__scopeId","data-v-c6fdcb3b"]]);export{zs as default};

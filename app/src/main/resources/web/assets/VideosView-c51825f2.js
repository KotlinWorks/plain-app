import{u as Ve,_ as De,a as ze}from"./list-3f4b71c4.js";import{d as Ee,ay as Ae,p as Re,r as g,u as Be,a as Fe,s as qe,C as Me,n as Ne,D as Ue,E as Le,G as Qe,az as Ge,ab as Oe,aA as Ke,H as We,t as Xe,aB as He,aE as Pe,J as ee,K as je,L as te,M as Je,N as Ye,o as s,c as l,e as o,x as c,j as n,F as w,O as r,w as u,l as v,T as E,y as Ze,P as xe,g as d,A,a5 as oe,z as et,at as se,aD as ne,k as tt,ag as ot,V as st,X as nt,Y as at,W as lt,B as ae,U as le,ao as it,a9 as dt,ah as ct,Z as ut,$ as rt,a0 as _t,av as pt,aw as mt,_ as vt}from"./index-df35a132.js";import{_ as ht,a as gt}from"./ConfirmModal.vuevuetypescriptsetuptruelang-7328d99c.js";import{_ as ft,a as kt}from"./grid-view-outline-rounded-89da8be1.js";import{_ as yt}from"./Breadcrumb-120bdd32.js";import{n as ie}from"./list-6498ebd9.js";import{u as bt,a as $t}from"./tags-ecacebdb.js";import"./vee-validate.esm-aa1410cb.js";const R=C=>(pt("data-v-73871abe"),C=C(),mt(),C),wt={class:"v-toolbar"},Ct=["onClick"],Tt=["onClick"],It={class:"filters"},St=["label"],Vt={class:"form-label"},Dt={type:"filter"},zt=["label","selected","onClick"],Et={class:"buttons"},At=["onClick"],Rt={key:0,class:"image-container",style:{"margin-bottom":"24px"}},Bt=["onClick"],Ft=["src"],qt={class:"duration"},Mt={key:1,class:"no-data-placeholder"},Nt={key:2,class:"table"},Ut=["checked"],Lt=R(()=>o("th",null,"ID",-1)),Qt=R(()=>o("th",null,null,-1)),Gt=R(()=>o("th",null,null,-1)),Ot=["onClick"],Kt=["checked"],Wt=["src","onClick"],Xt={class:"nowrap"},Ht={class:"action-btns"},Pt=["onClick"],jt=["onClick"],Jt=["onClick"],Yt={class:"nowrap"},Zt={class:"nowrap"},xt={key:0},eo={colspan:"8"},to={class:"no-data-placeholder"},h="VIDEO",V=50,oo=Ee({__name:"VideosView",setup(C){var j,J,Y;const de=Ae(),B=Re(),_=g([]),F=g(),{t:q}=Be(),M=Fe(),{app:N,fileIdKey:U}=qe(M),p=Me({text:"",tags:[]}),D=Ne().query,y=g(parseInt(((j=D.page)==null?void 0:j.toString())??"1")),T=g(0),f=g(Ue(((J=D.q)==null?void 0:J.toString())??"")),L=g(""),{tags:I}=bt(h,f,p,async e=>{L.value=Le(e),await Qe(),me()}),i=g(((Y=D.view)==null?void 0:Y.toString())??"grid"),{addToTags:Q}=$t(h,_,I),{deleteItems:ce,deleteItem:ue}=Ge(),{downloadItems:G}=Oe(_,"videos.zip"),{downloadFile:re}=ot(U),z=Ke(()=>_.value.map(e=>({src:se(e.fileId),name:ne(e.path),duration:e.duration,size:e.size,path:e.path,data:e,tagType:h}))),{selectAll:_e,toggleSelect:O,checked:pe}=Ve(_),{loading:K,load:me,refetch:ve}=We({handle:async(e,a)=>{if(a)Xe(q(a),"error");else if(e){const k=[];for(const b of e.videos)k.push({...b,checked:!1,fileId:He(U.value,b.path)});_.value=k,T.value=e.videoCount}},document:Pe,variables:()=>({offset:(y.value-1)*V,limit:V,query:L.value}),appApi:!0});function W(){ae(B,`/videos?page=${y.value}&q=${le(f.value)}&view=${i.value}`)}function X(e){M.lightbox={sources:z.value,index:e,visible:!0}}ee(y,()=>{W()}),ee(i,()=>{W()});function he(e){p.tags.includes(e)?st(p.tags,a=>a.id===e.id):p.tags.push(e)}function ge(e){nt(at,{tagType:h,tags:I.value,item:{key:e.id,title:e.title,size:e.size},selected:I.value.filter(a=>e.tags.some(k=>k.id===a.id))})}function fe(){f.value=lt(p),H(),F.value.dismiss()}function H(){ae(B,`/videos?q=${le(f.value)}&view=${i.value}`)}function ke(){i.value==="grid"?i.value="list":i.value="grid"}function ye(){de.push("/files"),it(ht,{message:q("upload_videos")})}const P=e=>{e===h&&ve()};return je(()=>{te.on("refetch_by_tag_type",P)}),Je(()=>{te.off("refetch_by_tag_type",P)}),(e,a)=>{const k=yt,b=dt,Z=ct,x=ut,be=ft,$e=kt,we=gt,Ce=De,Te=rt,Ie=_t,Se=ze,m=Ye("tooltip");return s(),l(w,null,[o("div",wt,[c(k,{current:()=>`${e.$t("page_title.videos")} (${T.value})`},null,8,["current"]),n(pe)&&i.value==="list"?(s(),l(w,{key:0},[r((s(),l("md-icon-button",{onClick:a[0]||(a[0]=u(t=>n(ce)(h,_.value),["stop"]))},[c(b)])),[[m,e.$t("delete")]]),r((s(),l("md-icon-button",{onClick:a[1]||(a[1]=u((...t)=>n(G)&&n(G)(...t),["stop"]))},[c(Z)])),[[m,e.$t("download")]]),r((s(),l("md-icon-button",{onClick:a[2]||(a[2]=u((...t)=>n(Q)&&n(Q)(...t),["stop"]))},[c(x)])),[[m,e.$t("add_to_tags")]])],64)):v("",!0),r((s(),l("md-icon-button",{onClick:u(ke,["prevent"])},[i.value==="list"?(s(),E(be,{key:0})):v("",!0),i.value==="grid"?(s(),E($e,{key:1})):v("",!0)],8,Ct)),[[m,e.$t(i.value==="list"?"view_as_grid":"view_as_list")]]),r((s(),l("md-icon-button",{onClick:u(ye,["prevent"])},[c(we)],8,Tt)),[[m,e.$t("upload")]]),c(Ce,{ref_key:"searchInputRef",ref:F,modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=t=>f.value=t),search:H},{filters:Ze(()=>[o("div",It,[r(o("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":a[3]||(a[3]=t=>p.text=t),"keyup.enter":"applyAndDoSearch"},null,8,St),[[xe,p.text]]),o("label",Vt,d(e.$t("tags")),1),o("md-chip-set",Dt,[(s(!0),l(w,null,A(n(I),t=>(s(),l("md-filter-chip",{key:t.id,label:t.name,selected:p.tags.includes(t),onClick:S=>he(t)},null,8,zt))),128))]),o("div",Et,[o("md-filled-button",{onClick:u(fe,["stop"])},d(e.$t("search")),9,At)])])]),_:1},8,["modelValue"])]),i.value==="grid"?(s(),l("div",Rt,[(s(!0),l(w,null,A(z.value,(t,S)=>(s(),l("div",{class:"item",onClick:$=>X(S)},[o("img",{class:"image",src:t.src+"&w=300&h=300"},null,8,Ft),o("span",qt,d(n(oe)(t.duration)),1)],8,Bt))),256))])):v("",!0),i.value==="grid"&&z.value.length===0?(s(),l("div",Mt,d(e.$t(n(ie)(n(K),n(N).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):v("",!0),i.value==="list"?(s(),l("table",Nt,[o("thead",null,[o("tr",null,[o("th",null,[o("md-checkbox",{"touch-target":"wrapper",onChange:a[5]||(a[5]=(...t)=>n(O)&&n(O)(...t)),checked:n(_e)},null,40,Ut)]),Lt,Qt,o("th",null,d(e.$t("name")),1),Gt,o("th",null,d(e.$t("tags")),1),o("th",null,d(e.$t("duration")),1),o("th",null,d(e.$t("file_size")),1)])]),o("tbody",null,[(s(!0),l(w,null,A(_.value,(t,S)=>(s(),l("tr",{key:t.id,class:et({selected:t.checked}),onClick:u($=>t.checked=!t.checked,["stop"])},[o("td",null,[o("md-checkbox",{"touch-target":"wrapper",checked:t.checked},null,8,Kt)]),o("td",null,[c(Te,{id:t.id,raw:t},null,8,["id","raw"])]),o("td",null,[o("img",{class:"img-video",src:n(se)(t.fileId)+"&w=300&h=300",width:"50",height:"50",style:{cursor:"pointer"},onClick:u($=>X(S),["stop"])},null,8,Wt)]),o("td",null,d(t.title),1),o("td",Xt,[o("div",Ht,[r((s(),l("md-icon-button",{onClick:u($=>n(ue)(h,t),["stop"])},[c(b)],8,Pt)),[[m,e.$t("delete")]]),r((s(),l("md-icon-button",{onClick:u($=>n(re)(t.path,n(ne)(t.path).replace(" ","-")),["stop"])},[c(Z)],8,jt)),[[m,e.$t("download")]]),r((s(),l("md-icon-button",{onClick:u($=>ge(t),["stop"])},[c(x)],8,Jt)),[[m,e.$t("add_to_tags")]])])]),o("td",null,[c(Ie,{tags:t.tags,tagType:h},null,8,["tags"])]),o("td",Yt,d(n(oe)(t.duration)),1),o("td",Zt,d(n(tt)(t.size)),1)],10,Ot))),128))]),_.value.length?v("",!0):(s(),l("tfoot",xt,[o("tr",null,[o("td",eo,[o("div",to,d(e.$t(n(ie)(n(K),n(N).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])):v("",!0),T.value>V?(s(),E(Se,{key:3,modelValue:y.value,"onUpdate:modelValue":a[6]||(a[6]=t=>y.value=t),total:T.value,limit:V},null,8,["modelValue","total"])):v("",!0)],64)}}});const po=vt(oo,[["__scopeId","data-v-73871abe"]]);export{po as default};

import{u as Ge,_ as Oe,a as xe,b as Ke}from"./list-0d76acfa.js";import{d as We,aA as Je,e as Pe,s as _e,r as D,u as Xe,f as je,K as Ye,L as Ze,D as et,M as tt,aB as ot,af as st,aC as nt,N as lt,w as at,O as it,P as k,Q as dt,R as ct,c as a,a as o,p as i,j as t,F as C,m,l as r,k as y,S as H,H as L,J as F,t as c,T as ut,U as _t,x as rt,aD as pt,aJ as mt,C as re,W as pe,at as ht,o as l,v as vt,a9 as me,$ as he,I as ft,ax as ve,aF as Q,z as gt,A as kt,B as yt,al as bt,aG as $t,a0 as wt,a2 as Ct,a3 as Tt,a1 as It,as as Vt,aH as St,aI as Dt,ad as At,am as Rt,a4 as zt,a5 as Bt,a6 as Et,_ as Ft}from"./index-1dff6785.js";import{_ as Ut}from"./sort-rounded-b8d8e47a.js";import{_ as Mt}from"./upload-rounded-dd35ce68.js";import{_ as qt,a as Nt}from"./grid-view-outline-rounded-5cff260c.js";import{_ as Ht}from"./Breadcrumb-cba2b95b.js";import{u as Lt,a as Qt}from"./tags-ba1ad11a.js";import"./vee-validate.esm-b0b47415.js";const _=R=>(kt("data-v-efec5940"),R=R(),yt(),R),Gt={class:"v-toolbar"},Ot=_(()=>o("md-ripple",null,null,-1)),xt=_(()=>o("md-ripple",null,null,-1)),Kt=_(()=>o("md-ripple",null,null,-1)),Wt=["onClick"],Jt=_(()=>o("md-ripple",null,null,-1)),Pt=["onClick"],Xt=_(()=>o("md-ripple",null,null,-1)),jt={class:"icon-button btn-sort"},Yt=_(()=>o("md-ripple",null,null,-1)),Zt={class:"menu-items"},eo=["onClick","selected"],to={slot:"headline"},oo={class:"filters"},so=["label"],no={class:"form-label"},lo=["label","selected","onClick"],ao={class:"buttons"},io=["onClick"],co={key:0,class:"image-container",style:{"margin-bottom":"24px"}},uo=["onClick","onContextmenu"],_o=["src"],ro={class:"duration"},po={key:1,class:"no-data-placeholder"},mo={key:2,class:"table-responsive"},ho={class:"table"},vo=["checked","indeterminate"],fo=_(()=>o("th",null,"ID",-1)),go=_(()=>o("th",null,null,-1)),ko=_(()=>o("th",null,null,-1)),yo=["onClick"],bo=["checked"],$o=["src","onClick"],wo={class:"nowrap"},Co={class:"action-btns"},To=["onClick"],Io=_(()=>o("md-ripple",null,null,-1)),Vo=["onClick"],So=_(()=>o("md-ripple",null,null,-1)),Do=["onClick"],Ao=_(()=>o("md-ripple",null,null,-1)),Ro={class:"nowrap"},zo={class:"nowrap"},Bo={key:0},Eo={colspan:"8"},Fo={class:"no-data-placeholder"},A=48,Uo=We({__name:"VideosView",setup(R){var ie,de;const fe=Je(),d=Pe(),{videoSortBy:U}=_e(d),v=D([]),G=D(),{t:T}=Xe(),O=je(),{app:x,urlTokenKey:M}=_e(O),f=Ye({text:"",tags:[]}),u=Ze.VIDEO,K=et().query,I=D(parseInt(((ie=K.page)==null?void 0:ie.toString())??"1")),b=D(tt(((de=K.q)==null?void 0:de.toString())??"")),V=D(""),{tags:z}=Lt(u,b,f,async e=>{V.value=ut(e),await _t(),Te()}),{addToTags:ge}=Qt(u,v,z),{deleteItems:ke,deleteItem:W}=ot(),{allChecked:J,realAllChecked:B,selectRealAll:ye,allCheckedAlertVisible:be,clearSelection:E,toggleAllChecked:P,toggleItemChecked:X,toggleRow:$e,total:$,checked:j}=Ge(v),{downloadItems:we}=st(M,u,v,E,"videos.zip"),{downloadFile:Y}=bt(M),Ce=$t(),q=nt(()=>v.value.map(e=>({src:ve(e.fileId),name:Q(e.path),duration:e.duration,size:e.size,path:e.path,data:e,type:u}))),{loading:Z,load:Te,refetch:N}=lt({handle:async(e,n)=>{if(n)rt(T(n),"error");else if(e){const w=[];for(const S of e.videos)w.push({...S,checked:!1,fileId:pt(M.value,S.path)});v.value=w,$.value=e.videoCount}},document:mt,variables:()=>({offset:(I.value-1)*A,limit:A,query:V.value,sortBy:U.value}),appApi:!0});function Ie(){re(d,`/videos?page=${I.value}&q=${pe(b.value)}`)}function ee(e){O.lightbox={sources:q.value,index:e,visible:!0}}function Ve(e,n){U.value=n,e.close()}at(I,()=>{Ie()});function Se(e){f.tags.includes(e)?wt(f.tags,n=>n.id===e.id):f.tags.push(e)}function te(e){Ct(Tt,{type:u,tags:z.value,item:{key:e.id,title:e.title,size:e.size},selected:z.value.filter(n=>e.tags.some(w=>w.id===n.id))})}function De(){b.value=It(f),oe(),G.value.dismiss()}function oe(){re(d,`/videos?q=${pe(b.value)}`)}function Ae(){d.videoViewType==="grid"?d.videoViewType="list":d.videoViewType="grid"}function Re(){fe.push("/files"),Vt(St,{message:T("upload_videos")})}function ze(e,n){e.preventDefault(),Dt({x:e.x,y:e.y,items:[{label:T("add_to_tags"),onClick:()=>{te(n)}},{label:T("download"),onClick:()=>{Y(n.path,Q(n.path).replace(" ","-"))}},{label:T("delete"),onClick:()=>{W(u,n)}}]})}const se=e=>{e.type===u&&(E(),N())},ne=e=>{e.type===u&&N()},le=e=>{e.type===u&&(E(),N())},ae=()=>{$.value--};return it(()=>{k.on("item_tags_updated",ne),k.on("items_tags_updated",se),k.on("media_item_deleted",ae),k.on("media_items_deleted",le)}),dt(()=>{k.off("item_tags_updated",ne),k.off("items_tags_updated",se),k.off("media_item_deleted",ae),k.off("media_items_deleted",le)}),(e,n)=>{const w=Ht,S=At,ce=Rt,ue=zt,Be=qt,Ee=Nt,Fe=Mt,Ue=Ut,Me=ht,qe=Oe,Ne=xe,He=Bt,Le=Et,Qe=Ke,h=ct("tooltip");return l(),a(C,null,[o("div",Gt,[i(w,{current:()=>`${e.$t("page_title.videos")} (${t($)})`},null,8,["current"]),t(j)&&t(d).videoViewType==="list"?(l(),a(C,{key:0},[m((l(),a("button",{class:"icon-button",onClick:n[0]||(n[0]=r(s=>t(ke)(t(u),v.value,t(B),V.value),["stop"]))},[Ot,i(S)])),[[h,e.$t("delete")]]),m((l(),a("button",{class:"icon-button",onClick:n[1]||(n[1]=r(s=>t(we)(t(B),V.value),["stop"]))},[xt,i(ce)])),[[h,e.$t("download")]]),m((l(),a("button",{class:"icon-button",onClick:n[2]||(n[2]=r(s=>t(ge)(t(B),V.value),["stop"]))},[Kt,i(ue)])),[[h,e.$t("add_to_tags")]])],64)):y("",!0),m((l(),a("button",{class:"icon-button",onClick:r(Ae,["prevent"])},[Jt,t(d).videoViewType==="list"?(l(),H(Be,{key:0})):y("",!0),t(d).videoViewType==="grid"?(l(),H(Ee,{key:1})):y("",!0)],8,Wt)),[[h,e.$t(t(d).videoViewType==="list"?"view_as_grid":"view_as_list")]]),m((l(),a("button",{class:"icon-button",onClick:r(Re,["prevent"])},[Xt,i(Fe)],8,Pt)),[[h,e.$t("upload")]]),i(Me,null,{content:L(s=>[o("div",Zt,[(l(!0),a(C,null,F(t(Ce),g=>(l(),a("md-menu-item",{onClick:p=>Ve(s,g.value),selected:g.value===t(U)},[o("div",to,c(e.$t(g.label)),1)],8,eo))),256))])]),default:L(()=>[m((l(),a("button",jt,[Yt,i(Ue)])),[[h,e.$t("sort")]])]),_:1}),i(qe,{ref_key:"searchInputRef",ref:G,modelValue:b.value,"onUpdate:modelValue":n[4]||(n[4]=s=>b.value=s),search:oe},{filters:L(()=>[o("div",oo,[m(o("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":n[3]||(n[3]=s=>f.text=s),"keyup.enter":"applyAndDoSearch"},null,8,so),[[vt,f.text]]),o("label",no,c(e.$t("tags")),1),o("md-chip-set",null,[(l(!0),a(C,null,F(t(z),s=>(l(),a("md-filter-chip",{key:s.id,label:s.name,selected:f.tags.includes(s),onClick:g=>Se(s)},null,8,lo))),128))]),o("div",ao,[o("md-filled-button",{onClick:r(De,["stop"])},c(e.$t("search")),9,io)])])]),_:1},8,["modelValue"])]),t(d).videoViewType==="grid"?(l(),a("div",co,[(l(!0),a(C,null,F(q.value,(s,g)=>(l(),a("div",{class:"item",onClick:p=>ee(g),onContextmenu:p=>ze(p,s.data)},[o("img",{class:"image",src:s.src+"&w=300&h=300"},null,8,_o),o("span",ro,c(t(me)(s.duration)),1)],40,uo))),256))])):y("",!0),t(d).videoViewType==="grid"&&q.value.length===0?(l(),a("div",po,c(e.$t(t(he)(t(Z),t(x).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):y("",!0),i(Ne,{limit:A,total:t($),"all-checked-alert-visible":t(be),"real-all-checked":t(B),"select-real-all":t(ye),"clear-selection":t(E)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t(d).videoViewType==="list"?(l(),a("div",mo,[o("table",ho,[o("thead",null,[o("tr",null,[o("th",null,[o("md-checkbox",{"touch-target":"wrapper",onChange:n[5]||(n[5]=(...s)=>t(P)&&t(P)(...s)),checked:t(J),indeterminate:!t(J)&&t(j)},null,40,vo)]),fo,go,o("th",null,c(e.$t("name")),1),ko,o("th",null,c(e.$t("tags")),1),o("th",null,c(e.$t("duration")),1),o("th",null,c(e.$t("file_size")),1)])]),o("tbody",null,[(l(!0),a(C,null,F(v.value,(s,g)=>(l(),a("tr",{key:s.id,class:ft({selected:s.checked}),onClick:r(p=>t($e)(s),["stop"])},[o("td",null,[o("md-checkbox",{"touch-target":"wrapper",onChange:n[6]||(n[6]=(...p)=>t(X)&&t(X)(...p)),checked:s.checked},null,40,bo)]),o("td",null,[i(He,{id:s.id,raw:s},null,8,["id","raw"])]),o("td",null,[o("img",{class:"img-video",src:t(ve)(s.fileId)+"&w=300&h=300",width:"50",height:"50",style:{cursor:"pointer"},onClick:r(p=>ee(g),["stop"])},null,8,$o)]),o("td",null,c(s.title),1),o("td",wo,[o("div",Co,[m((l(),a("button",{class:"icon-button",onClick:r(p=>t(W)(t(u),s),["stop"])},[Io,i(S)],8,To)),[[h,e.$t("delete")]]),m((l(),a("button",{class:"icon-button",onClick:r(p=>t(Y)(s.path,t(Q)(s.path).replace(" ","-")),["stop"])},[So,i(ce)],8,Vo)),[[h,e.$t("download")]]),m((l(),a("button",{class:"icon-button",onClick:r(p=>te(s),["stop"])},[Ao,i(ue)],8,Do)),[[h,e.$t("add_to_tags")]])])]),o("td",null,[i(Le,{tags:s.tags,type:t(u)},null,8,["tags","type"])]),o("td",Ro,c(t(me)(s.duration)),1),o("td",zo,c(t(gt)(s.size)),1)],10,yo))),128))]),v.value.length?y("",!0):(l(),a("tfoot",Bo,[o("tr",null,[o("td",Eo,[o("div",Fo,c(e.$t(t(he)(t(Z),t(x).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])])):y("",!0),t($)>A?(l(),H(Qe,{key:3,modelValue:I.value,"onUpdate:modelValue":n[7]||(n[7]=s=>I.value=s),total:t($),limit:A},null,8,["modelValue","total"])):y("",!0)],64)}}});const Ko=Ft(Uo,[["__scopeId","data-v-efec5940"]]);export{Ko as default};

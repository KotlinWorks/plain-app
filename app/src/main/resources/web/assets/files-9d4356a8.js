import{a_ as R,r as c,U as D,a$ as U,b0 as I,ak as F,b1 as V,i as k,b2 as C,u as T,t as $,aR as A,aQ as Q,b3 as G,b4 as L,b5 as M,ay as z,R as S,b6 as _,b7 as B,s as O,a as j,aO as H,b8 as x,b9 as g,aP as J,ba as W,aS as q}from"./index-03d179e2.js";import{b as K}from"./search-fae66e3e.js";import{b as X}from"./baseIndexOf-70b929c6.js";import{a as Y}from"./toInteger-dbfb180b.js";var Z=Math.max;function N(o,n,e){var a=o==null?0:o.length;if(!a)return-1;var t=e==null?0:Y(e);return t<0&&(t=Z(a+t,0)),X(o,R(n),t)}const ne=(o,n)=>{const e=c("");return{createPath:e,createVariables(a){return{path:e.value+"/"+a}},createMutation(){return D({document:U,options:{update:async(a,t)=>{const{fileIdToken:s}=o.value;for(const l of n.value)if(l.dir===e.value){const u=t.data.createDir;l.items.push({...u,name:I(u.path),fileId:await F(s,u.path)})}}},appApi:!0})}}},oe=o=>{const n=c(""),e=c("");return{renameValue:n,renamePath:e,renameDone(a){const t=e.value,s=n.value;for(const l of o.value)l.rename(t,s,a)},renameMutation(){return D({document:V,appApi:!0})},renameVariables(a){return{path:e.value,name:a}}}},le=(o,n,e)=>({onDeleted(a){for(const t of o.value)a.forEach(s=>{t.deleteItem(s.path)});a.forEach(t=>{if(n.value.startsWith(t.path)){const s=t.path.lastIndexOf("/");n.value=t.path.substring(0,s)}}),e()}}),ue=()=>{const o=c(null),n=c(null),{refetch:e}=k({handle:(a,t)=>{t||(o.value=a.storageStats.internal,n.value=a.storageStats.sdcard)},document:C,appApi:!0});return{internal:o,sdcard:n,refetch:e}},ie=(o,n,e)=>{const a=c(""),t=c(n),s=c([]),{t:l}=T();let u=0,r=!1;const{loading:f}=k({handle:async(m,v)=>{if(v)$(l(v),"error");else{const{dir:b,items:w}=m.files,{fileIdToken:y}=o.value,d=[];for(const p of w){const h={...p,name:I(p.path)};(A(h.name)||Q(h.name))&&(h.fileId=await F(y,p.path)),d.push(h)}const i=b.replace(n,"").split("/").length;for(;s.value.length>=i;)s.value.pop();if(s.value.push(new G(b,d)),e&&!r){const p=e.replace(n+"/","").split("/");d.length===0?r=!0:u<p.length?(t.value=n+"/"+p.slice(0,u+1).join("/"),u++):r=!0}}},document:L,variables:{dir:t,showHidden:!0},options:{fetchPolicy:"no-cache"},appApi:!0}),{refetch:P}=k({handle:async(m,v)=>{if(v)$(l(v),"error");else{const{dir:b,items:w}=m.files,{fileIdToken:y}=o.value,d=[];for(const i of w)d.push({...i,name:I(i.path),fileId:await F(y,i.path)});s.value.forEach(i=>{i.dir===b&&(i.items=d)})}a.value=""},document:L,variables:{dir:a,showHidden:!0},options:()=>({fetchPolicy:"no-cache",enabled:!!a.value}),appApi:!0});return{loading:f,panels:s,refetch(m){a.value=m,P()},currentDir:t}},ce=o=>{const{t:n}=T(),e=c([]),{loading:a}=k({handle:async(t,s)=>{if(s)$(n(s),"error");else{const l=t.recentFiles,{fileIdToken:u}=o.value;for(const r of l){const f={...r,name:I(r.path)};(A(f.name)||Q(f.name))&&(f.fileId=await F(u,r.path)),e.value.push(f)}}},document:M,options:{fetchPolicy:"no-cache"},appApi:!0});return{files:e,loading:a}},re=o=>({async downloadFile(n,e){const{fileIdToken:a}=o.value,t=await W(a,n);e?g(t+`&dl=1&name=${e}`,e):g(t+"&dl=1",I(n))},async downloadDir(n,e){const{fileIdToken:a}=o.value,t=await F(a,n),s=`${x()}/zip/dir?id=${encodeURIComponent(t)}`;e?g(s+`&name=${e}`,e):g(s,I(n))},downloadFiles(n,e){const a=`${x()}/zip/files?id=${encodeURIComponent(n)}`;e?g(a+`&name=${e}`,e):g(a,"")}}),pe=(o,n)=>({view(e,a){o.value=e.filter(s=>Q(s.name)||A(s.name)||q(s.name)).map(s=>({path:s.path,src:"",name:I(s.path)}));const t=N(o.value,s=>s.path===a.path);n(t)}}),de=(o,n,e,a)=>{const t=c(null);return{selectedItem:t,select(s,l){l.isDir?o.value=l.path:s.items.some(r=>r.path===o.value)&&s.items.some(r=>r.path===l.path)&&(o.value=s.dir);const u=[];u.push({name:"path",op:"",value:l.path}),u.push({name:"isDir",op:"",value:o.value===l.path?"1":"0"}),e.value=K(u),t.value=l,z(a,n==="sdcard"?`/files/sdcard?q=${S(e.value)}`:`/files?q=${S(e.value)}`)}}},he=(o,n)=>{const e=c(null),a=c(null),t=c(!1),s=c(),{mutate:l,loading:u,onDone:r,onError:f}=D({document:_,appApi:!0}),{mutate:P,loading:m,onDone:v,onError:b}=D({document:B,appApi:!0}),{t:w}=T(),y=i=>{$(w(i.message))};f(y),b(y);const d=()=>{var i;if(t.value){const p=a.value.items.findIndex(h=>h.path===e.value.path);(i=a.value)==null||i.items.splice(p,1)}e.value=null,setTimeout(()=>{o(s.value),n()},500)};return r(d),v(d),{loading:u||m,canPaste(){return!!e.value},copy(i){e.value=i,t.value=!1},cut(i,p){e.value=p,a.value=i,t.value=!0},paste(i){var h,E;s.value=i;const p={src:(h=e.value)==null?void 0:h.path,dst:i+"/"+((E=e.value)==null?void 0:E.name),overwrite:!1};t.value?P(p):l(p)}}},fe=()=>{const{uploads:o}=O(j()),n=c(""),e=c();return{input:e,upload(a){n.value=a,e.value.value="",e.value.click()},uploadChanged(a){const t=a.target.files;if(!t)return;const s=[];for(let l=0;l<t.length;l++){const u=t[l];s.push({dir:n.value,file:u,status:"created",uploadedSize:0,error:""})}o.value=[...o.value,...s]}}},me=(o,n)=>{const{t:e}=T(),{mutate:a,onDone:t}=D({document:H,appApi:!0});return t(s=>{const l=`${x()}/zip/files?id=${encodeURIComponent(s.data.setTempValue.key)}&name=${n}`;g(l,n),o.value.forEach(u=>{u.checked=!1})}),{downloadItems:()=>{const s=o.value.filter(u=>u.checked);if(s.length===0){$(e("select_first"),"error");return}const l=[];s.forEach(u=>{n==="apps.zip"?l.push({path:u.path,name:`${u.name.replace(" ","")}-${u.id}.apk`}):l.push({path:u.path})}),a({key:J(),value:JSON.stringify(l)})}}};export{me as a,re as b,ie as c,ne as d,oe as e,ue as f,de as g,he as h,le as i,pe as j,ce as k,fe as u};

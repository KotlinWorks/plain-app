import{d as ye,Z as ge,a2 as et,ad as tt,o as c,U as P,y as q,e as l,j as a,g as m,u as st,r as V,p as at,D as ot,a5 as nt,q as lt,s as ue,a as it,aZ as rt,ar as ct,a_ as ut,a$ as dt,b0 as pt,b1 as mt,b2 as _t,a3 as de,b3 as ht,H as ft,K as bt,L as vt,M as kt,c as d,f as $,F as g,w as pe,l as h,N as H,Q as L,R as yt,A as me,z as gt,b4 as _e,b5 as he,an as Ct,k as B,T as Dt,m as k,a9 as wt,b6 as Vt,a1 as U,b7 as $t,av as It,b8 as Ft,b9 as xt,ba as St,_ as Tt}from"./inde-e40fd5ce.js";import{_ as Mt}from"./download-rounded-cf14c305.js";import{_ as Bt}from"./delete-outline-rounded-5f6a14f2.js";import{_ as Ut}from"./readcrumb-ccb81e51.js";import{c as fe}from"./inde-a986ec4f.js";import{g as be,M as Pt}from"./splitpanes.es-aeea8e83.js";import{n as qt}from"./list-6498ebd9.js";import{_ as At}from"./odal.vuevuetypescriptsetuptruelang-c1337498.js";import{t as Rt}from"./truncate-85f6ccee.js";import{_ as ve}from"./ditalueodal.vuevuetypescriptsetuptruelang-41de1b05.js";import"./stringorray-30261b4a.js";import"./vee-validate.esm-30412532.js";const Et=["disabled"],ke=ye({__name:"DeleteFileConfirm",props:{onDone:{type:Function,required:!0},files:{type:Array,required:!0}},setup(A){const s=A,{mutate:I,loading:F,onDone:R}=ge({document:et`
    mutation DeleteFiles($paths: [String!]!) {
      deleteFiles(paths: $paths)
    }
  `,appApi:!0});function u(){I({paths:s.files.map(v=>v.path)})}return R(()=>{s.onDone(s.files),tt()}),(v,x)=>{const _=At;return c(),P(_,{class:"delete-modal",title:v.$t("confirm_to_delete_name",{name:a(Rt)(A.files.map(y=>y.name).join(", "),{length:200})})},{action:q(()=>[l("button",{type:"button",disabled:a(F),class:"btn",onClick:u},m(v.$t("delete")),9,Et)]),_:1},8,["title"])}}}),Nt={class:"v-toolbar"},zt={class:"right-actions"},Wt=["onClick","title"],Ht=["onClick","title"],Lt={class:"form-check mt-2 me-3 ms-3"},Ot={class:"form-check-label",for:"select-mode"},Qt={class:"form-check mt-2"},jt={class:"form-check-label",for:"show-hidden"},Gt={class:"file-items"},Kt=["onClick","onDblclick","onContextmenu"],Zt=["onUpdate:modelValue"],Jt=["src"],Xt={class:"title"},Yt={style:{"font-size":"0.75rem"}},es=["onContextmenu"],ts={key:0,class:"no-files"},ss={key:0,class:"file-item-info"},as=ye({__name:"FilesVIew",setup(A){var ne,le,ie,re;const{t:s}=st(),I=V([]),F=at(),R=F.query,u=F.params.type,v=V(ot(((ne=R.q)==null?void 0:ne.toString())??"")),x=nt(v.value),_=V(((le=x.find(e=>e.name==="path"))==null?void 0:le.value)??"");let y=((ie=x.find(e=>e.name==="dir"))==null?void 0:ie.value)??"";y||(((re=x.find(t=>t.name==="isDir"))==null?void 0:re.value)==="1"?y=_.value:y=_.value.substring(0,_.value.lastIndexOf("/")));const Ce=V(y),C=V(!1),O=lt(),{app:f}=ue(it());let S=f.value.internalStoragePath;u&&(u==="sdcard"?S=f.value.sdcardPath:u.startsWith("usb")?S=f.value.usbDiskPaths[parseInt(u.substring(3))-1]:u==="app"&&(S=f.value.externalFilesDir));const{loading:De,panels:p,currentDir:E,refetch:Q}=rt(f,S,Ce.value),{visible:we,index:Ve,view:$e,hide:Ie}=ct(),{createPath:Fe,createVariables:xe,createMutation:Se}=ut(f,p),{renameValue:Te,renamePath:Me,renameDone:Be,renameMutation:Ue,renameVariables:Pe}=dt(p),{internal:j,sdcard:G,usb:qe,refetch:N}=pt(),{onDeleted:K}=Ft(p,E,N),{downloadFile:Z,downloadDir:Ae,downloadFiles:Re}=wt(f),{view:J}=xt(I,$e),{selectedItem:T,select:Ee}=mt(E,u,v,O),{canPaste:X,copy:Y,cut:Ne,paste:z}=_t(Q,N),{input:ze,upload:ee,uploadChanged:te}=de(),{input:We,upload:se,uploadChanged:ae}=de(),{mutate:He,onDone:Le}=ge({document:ht,appApi:!0});Le(e=>{Re(e.data.setTempValue.key)});const W=()=>{const e=[];return p.value.forEach(t=>{t.items.forEach(o=>{o.checked&&e.push(o)})}),e},Oe=()=>{He({key:Vt(),value:JSON.stringify(W().map(e=>({path:e.path})))})},Qe=ft(()=>W().length>0),je=()=>{U(ke,{files:W(),onDone:K})},{fileShowHidden:D}=ue(O);_.value&&bt(()=>p.value.length,()=>{if(p.value.length>0&&_.value){const t=p.value[p.value.length-1].items.find(o=>o.path===_.value);t&&(T.value=t,_.value="")}});function Ge(){var e,t,o,i;if(u){if(u==="sdcard")return`${s("sdcard")} (${s("storage_free_total",{free:k(((e=G.value)==null?void 0:e.freeBytes)??0),total:k(((t=G.value)==null?void 0:t.totalBytes)??0)})})`;if(u==="app")return s("app_name");if(u.startsWith("usb")){const M=parseInt(u.substring(3)),b=qe.value[M-1];return`${s("usb_storage")} ${M} (${s("storage_free_total",{free:k((b==null?void 0:b.freeBytes)??0),total:k((b==null?void 0:b.totalBytes)??0)})})`}}return`${s("page_title.files")} (${s("storage_free_total",{free:k(((o=j.value)==null?void 0:o.freeBytes)??0),total:k(((i=j.value)==null?void 0:i.totalBytes)??0)})})`}function Ke(e,t){if(C.value){t.checked=!t.checked;return}Ee(e,t)}function oe(e){return _e(e.name)||he(e.name)||St(e.name)}function Ze(e,t){t.isDir||(oe(t)?J(e.items,t):Z(t.path))}function Je(e,t){e.preventDefault();const o=[{label:s("create_folder"),onClick:()=>{Fe.value=t,U(ve,{title:s("name"),placeholder:s("name"),mutation:Se,getVariables:xe})}},{label:s("upload_files"),onClick:()=>{ee(t)}},{label:s("upload_folder"),onClick:()=>{se(t)}}];X()&&o.push({label:s("paste"),onClick:()=>{z(t)}}),fe({x:e.x,y:e.y,items:o})}function Xe(e,t,o){e.preventDefault();let i;o.isDir?i=[{label:s("upload_files"),onClick:()=>{ee(o.path)}},{label:s("upload_folder"),onClick:()=>{se(o.path)}},{label:s("download"),onClick:()=>{Ae(o.path)}}]:(i=[],oe(o)&&i.push({label:s("open"),onClick:()=>{J(t.items,o)}}),i.push({label:s("download"),onClick:()=>{Z(o.path)}})),i.push({label:s("duplicate"),onClick:()=>{Y(o),z(t.dir)}}),i.push({label:s("cut"),onClick:()=>{Ne(t,o)}}),i.push({label:s("copy"),onClick:()=>{Y(o)}}),o.isDir&&X()&&i.push({label:s("paste"),onClick:()=>{z(o.path)}}),i=[...i,{label:s("rename"),onClick:()=>{Te.value=o.name,Me.value=o.path,U(ve,{title:s("rename"),placeholder:s("name"),value:o.name,mutation:Ue,getVariables:Pe,done:Be})}},{label:s("delete"),onClick:()=>{U(ke,{files:[o],onDone:K})}}],fe({x:e.x,y:e.y,items:i})}return vt(()=>{kt.on("upload_task_done",e=>{e.status==="done"&&setTimeout(()=>{Q(e.dir),N()},1e3)})}),(e,t)=>{const o=Ut,i=Bt,M=Mt,b=$t,Ye=It;return c(),d(g,null,[l("div",Nt,[$(o,{current:Ge}),l("div",zt,[C.value&&a(Qe)?(c(),d(g,{key:0},[l("button",{type:"button",class:"btn btn-action",onClick:pe(je,["stop"]),title:e.$t("delete")},[$(i,{class:"bi"})],8,Wt),l("button",{type:"button",class:"btn btn-action",onClick:pe(Oe,["stop"]),title:e.$t("download")},[$(M,{class:"bi"})],8,Ht)],64)):h("",!0),l("div",Lt,[H(l("input",{class:"form-check-input","onUpdate:modelValue":t[0]||(t[0]=r=>C.value=r),id:"select-mode",type:"checkbox"},null,512),[[L,C.value]]),l("label",Ot,m(e.$t("select_mode")),1)]),l("div",Qt,[H(l("input",{class:"form-check-input","onUpdate:modelValue":t[1]||(t[1]=r=>yt(D)?D.value=r:null),id:"show-hidden",type:"checkbox"},null,512),[[L,a(D)]]),l("label",jt,m(e.$t("show_hidden")),1)])])]),$(a(Pt),{class:"panel-container"},{default:q(()=>[(c(!0),d(g,null,me(a(p),r=>(c(),P(a(be),{key:r.dir},{default:q(()=>[l("div",Gt,[(c(!0),d(g,null,me(r.items,n=>{var ce;return c(),d(g,{key:n.path},[!n.name.startsWith(".")||a(D)?(c(),d("div",{key:0,class:gt(["file-item",{active:(a(E)+"/").startsWith(n.path+"/")||((ce=a(T))==null?void 0:ce.path)===n.path}]),onClick:w=>Ke(r,n),onDblclick:w=>Ze(r,n),onContextmenu:w=>Xe(w,r,n)},[C.value?H((c(),d("input",{key:0,class:"form-check-input","onUpdate:modelValue":w=>n.checked=w,type:"checkbox"},null,8,Zt)),[[L,n.checked]]):h("",!0),n.isDir?(c(),P(b,{key:1,class:"bi"})):h("",!0),a(_e)(n.name)||a(he)(n.name)?(c(),d("img",{key:2,src:a(Ct)(n.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,Jt)):h("",!0),l("div",Xt,[B(m(n.name)+" ",1),l("div",Yt,[B(m(a(Dt)(n.updatedAt)),1),n.isDir?h("",!0):(c(),d(g,{key:0},[B(", "+m(a(k)(n.size)),1)],64))])])],42,Kt)):h("",!0)],64)}),128)),l("div",{class:"empty",onContextmenu:n=>Je(n,r.dir)},[r.items.filter(n=>!n.name.startsWith(".")||a(D)).length===0?(c(),d("div",ts,m(e.$t("no_files")),1)):h("",!0)],40,es)])]),_:2},1024))),128)),a(p).length===0?(c(),P(a(be),{key:0,class:"no-data-placeholder"},{default:q(()=>[B(m(e.$t(a(qt)(a(De),a(f).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):h("",!0)]),_:1}),a(T)?(c(),d("div",ss,m(e.$t("path"))+": "+m(a(T).path),1)):h("",!0),$(Ye,{visible:a(we),index:a(Ve),sources:I.value,onHide:a(Ie)},null,8,["visible","index","sources","onHide"]),l("input",{ref_key:"fileInput",ref:ze,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...r)=>a(te)&&a(te)(...r))},null,544),l("input",{ref_key:"dirFileInput",ref:We,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[3]||(t[3]=(...r)=>a(ae)&&a(ae)(...r))},null,544)],64)}}});const fs=Tt(as,[["__scopeId","data-v-b68aefca"]]);export{fs as default};

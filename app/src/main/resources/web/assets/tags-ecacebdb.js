import{o as y,c as T,e as a,d as Z,r as C,bT as w,a3 as M,bU as B,bV as D,g as h,x as L,F as Q,A as x,j as n,O as E,by as G,aj as q,L as $,V as H,Z as j,_ as z,u as S,i as N,t as F,ac as O,bC as R,aM as U,X}from"./index-df35a132.js";import{u as J,a as K}from"./vee-validate.esm-aa1410cb.js";const P={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},W=a("path",{fill:"currentColor",d:"M18.45 15.6L17 14.15L18.55 12L15 7H9.85l-2-2H15q.5 0 .925.213t.725.637l3.525 5q.35.525.35 1.15t-.35 1.15L18.45 15.6ZM5 19q-.825 0-1.413-.588T3 17V7q0-.275.063-.5t.187-.45L2.1 4.9q-.275-.275-.275-.7t.275-.7q.275-.275.7-.275t.7.275l17 17q.275.275.275.7t-.275.7q-.275.275-.7.275t-.7-.275l-3.15-3.15q-.225.125-.45.188T15 19H5Zm4.575-6.6Zm3.85-1.825ZM14.2 17L5 7.8V17h9.2Z"},null,-1),Y=[W];function ee(c,o){return y(),T("svg",P,Y)}const te={name:"material-symbols-label-off-outline-rounded",render:ee},se={slot:"headline"},ae={slot:"content"},oe=["label","selected"],ne=["label","selected"],de={type:"filter"},le=["label","selected","onClick"],ie={slot:"actions"},ue=["disabled"],ce=Z({__name:"AddToTagsModal",props:{tagType:{type:String,required:!0},tags:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]}},setup(c){const o=c,{handleSubmit:d}=J(),l=C("add_to_tags");function r(e){const{button:i}=e.detail,k=i.dataset.value;l.value=k}const{value:t,errorMessage:_}=K("selectedTags",w().test("required",()=>"valid.required",e=>e.length),{initialValue:[]}),{mutate:p,loading:v,onDone:m}=M({document:B,appApi:!0}),{mutate:f,loading:s,onDone:g}=M({document:D,appApi:!0}),b=()=>{$.emit("refetch_by_tag_type",o.tagType),$.emit("refetch_tags",o.tagType),q()};g(b),m(b);function I(e){t.value.includes(e)?H(t.value,i=>i.id===e.id):t.value.push(e)}const A=d(()=>{l.value==="add_to_tags"?f({tagType:o.tagType,tagIds:t.value.map(e=>e.id),items:o.items}):p({tagIds:t.value.map(e=>e.id),keys:o.items.map(e=>e.key)})});return(e,i)=>{const k=j,V=te;return y(),T("md-dialog",null,[a("div",se,h(e.$t("tags")),1),a("div",ae,[a("md-outlined-segmented-button-set",{onSegmentedButtonSetSelection:r},[a("md-outlined-segmented-button",{label:e.$t("add_to_tags"),selected:l.value==="add_to_tags"},[L(k,{slot:"icon"})],8,oe),a("md-outlined-segmented-button",{label:e.$t("remove_from_tags"),selected:l.value==="remove_from_tags"},[L(V,{slot:"icon"})],8,ne)],32),a("md-chip-set",de,[(y(!0),T(Q,null,x(c.tags,u=>(y(),T("md-filter-chip",{key:u.id,label:u.name,selected:n(t).includes(u),onClick:_e=>I(u)},null,8,le))),128))]),E(a("div",{class:"invalid-feedback"},h(n(_)?e.$t(n(_)):""),513),[[G,n(_)]])]),a("div",ie,[a("md-outlined-button",{value:"cancel",onClick:i[0]||(i[0]=(...u)=>n(q)&&n(q)(...u)),autofocus:""},h(e.$t("cancel")),1),a("md-filled-button",{value:"save",disabled:n(s)||n(v),onClick:i[1]||(i[1]=(...u)=>n(A)&&n(A)(...u))},h(e.$t("save")),9,ue)])])}}});const re=z(ce,[["__scopeId","data-v-1d01addb"]]),pe=(c,o,d)=>{const{t:l}=S();return{addToTags:()=>{const r=o.value.filter(t=>t.checked);if(r.length===0){F(l("select_first"),"error");return}X(re,{tagType:c,tags:d.value,items:r.map(t=>({key:t.id,title:t.title??"",size:t.size??0}))})}}},ve=(c,o,d,l)=>{const r=C([]),{t}=S();return N({handle:async(_,p)=>{if(p)F(t(p),"error");else if(_){r.value=_.tags;const v=O(o.value);d.tags=[];const m=[];v.forEach(s=>{if(s.name==="text")d.text=s.value;else if(s.name==="tag"){const g=_.tags.find(b=>R(b.name)===s.value);g?(d.tags.push(g),m.push(g.id)):m.push("invalid")}else s.name==="bucket_id"&&(d.bucketId=s.value)});const f=[...v].filter(s=>s.name!=="tag");m.forEach(s=>{f.push({name:"tag_id",op:"",value:s})}),l(f)}},document:U,variables:{type:c},appApi:!0}),{tags:r}};export{pe as a,ve as u};
